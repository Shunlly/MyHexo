{"meta":{"version":1,"warehouse":"4.0.2"},"models":{"Asset":[{"_id":"themes/butterfly/source/css/var.styl","path":"css/var.styl","modified":0,"renderable":1},{"_id":"themes/butterfly/source/css/index.styl","path":"css/index.styl","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/404.jpg","path":"img/404.jpg","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/favicon.png","path":"img/favicon.png","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/friend_404.gif","path":"img/friend_404.gif","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/main.js","path":"js/main.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/tw_cn.js","path":"js/tw_cn.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/search/algolia.js","path":"js/search/algolia.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/search/local-search.js","path":"js/search/local-search.js","modified":0,"renderable":1}],"Cache":[{"_id":"source/.DS_Store","hash":"140bd9be153cf6b8056a7473b4f20d1ec852f14c","modified":1665371347584},{"_id":"source/_posts/.DS_Store","hash":"df2fbeb1400acda0909a32c1cf6bf492f1121e07","modified":1665371352603},{"_id":"source/_posts/Docker私有仓库安装.md","hash":"0acdc89a953f46616eca1853568af469e96de58f","modified":1665900876570},{"_id":"source/link/index.md","hash":"1c63e5caa5185202ae48f1bade70719094cc17a9","modified":1665308586680},{"_id":"source/_posts/Harbor安装.md","hash":"d8efc05099e4fccec2e43719d8cac2c391e67509","modified":1665900954242},{"_id":"source/_posts/Linux命令记录.md","hash":"244cf8e358ead52474bad715c297a9a5878bdd0c","modified":1665901242353},{"_id":"source/_posts/Docker学习笔记.md","hash":"3a1628791f7f93683eb115f9eee37318d4370035","modified":1665305849160},{"_id":"source/_posts/Pritunl的安装.md","hash":"59e62436d6c01a6df5b5eb8b1a0f751d60700315","modified":1665901069748},{"_id":"source/_posts/eml文件解析.md","hash":"60661f73bd48245f13a5e4054a56b6e5f8f7c764","modified":1665901151319},{"_id":"source/_posts/Vue学习.md","hash":"2cda04b30fb12f0e5da6bc19b2308318dc5349a0","modified":1665305889722},{"_id":"source/_posts/jenkins安装.md","hash":"4f92b0b79ce26607a327e47c76c37f449168e95f","modified":1665901010196},{"_id":"source/categories/index.md","hash":"a8a8fec2a2483e8748be77cfa997110ba29edfa1","modified":1665305154447},{"_id":"source/_posts/mysql实时同步至es.md","hash":"54b04bbbf77d13f25fc36db8ad6cfa80615eb350","modified":1665371522399},{"_id":"source/_data/link.yml","hash":"31d1ca86009a50ac37643a1f60eeff330a320b0e","modified":1665310443380},{"_id":"source/_posts/爬虫的简单介绍.md","hash":"e30d0c9d00c852a2e2bcfcd13dd14205bd0b676f","modified":1665371433187},{"_id":"source/Gallery/index.md","hash":"25efcbca7c10dc3ec05f32e3f1efc8121a925c7c","modified":1665305224875},{"_id":"source/tags/index.md","hash":"5158313c529db1f2a84db65a5955b005c3fb7eef","modified":1665305164239},{"_id":"themes/butterfly/package.json","hash":"a937d4aa286401430c672bce28d93fe417d87a1e","modified":1665298073968},{"_id":"themes/butterfly/README_CN.md","hash":"ec3df032fa5e197eef3822c1af517e29a91da2df","modified":1665298073950},{"_id":"themes/butterfly/LICENSE","hash":"1128f8f91104ba9ef98d37eea6523a888dcfa5de","modified":1665298073949},{"_id":"themes/butterfly/README.md","hash":"249abda2d59e738d8e5416c9b0e2727fc73493dd","modified":1665298073950},{"_id":"themes/butterfly/_config.yml","hash":"76f9883745d6d28f751f76328aa04b20865d09fb","modified":1665298073950},{"_id":"themes/butterfly/languages/default.yml","hash":"1e37a3695d50e3e61d7c36e58a6dac872a4a56cd","modified":1665298073950},{"_id":"themes/butterfly/plugins.yml","hash":"b96cbef0a8af718b1b7bbe3317bb7a15484e7985","modified":1665298073968},{"_id":"themes/butterfly/languages/en.yml","hash":"d1bb560698eb8b0079495b7b18b44facb610f9fd","modified":1665298073950},{"_id":"themes/butterfly/languages/zh-CN.yml","hash":"28b6f0c39155651d747eb595e0a283bc97be2e09","modified":1665298073950},{"_id":"themes/butterfly/languages/zh-TW.yml","hash":"947f794e862bb2813e36887f777bdb760f70a322","modified":1665298073951},{"_id":"themes/butterfly/layout/archive.pug","hash":"a0c034c2d319320a54046805e80b58dc48b7e233","modified":1665298073951},{"_id":"themes/butterfly/layout/category.pug","hash":"710708cfdb436bc875602abf096c919ccdf544db","modified":1665298073951},{"_id":"themes/butterfly/layout/index.pug","hash":"e1c3146834c16e6077406180858add0a8183875a","modified":1665298073967},{"_id":"themes/butterfly/layout/post.pug","hash":"fc9f45252d78fcd15e4a82bfd144401cba5b169a","modified":1665298073967},{"_id":"themes/butterfly/layout/tag.pug","hash":"0440f42569df2676273c026a92384fa7729bc4e9","modified":1665298073967},{"_id":"themes/butterfly/layout/page.pug","hash":"baf469784aef227e4cc840550888554588e87a13","modified":1665298073967},{"_id":"themes/butterfly/.github/workflows/stale.yml","hash":"ac62b989b5550c756e1986fcc68f243170705383","modified":1665298073949},{"_id":"themes/butterfly/.github/ISSUE_TEMPLATE/bug_report.yml","hash":"67e4f5a66d4b8cabadbaad0410628364ee75e0ae","modified":1665298073948},{"_id":"themes/butterfly/.github/ISSUE_TEMPLATE/config.yml","hash":"7dfe7189ffeaebb6db13842237f8e124649bea3d","modified":1665298073948},{"_id":"themes/butterfly/scripts/events/404.js","hash":"83cd7f73225ccad123afbd526ce1834eb1eb6a6d","modified":1665298073968},{"_id":"themes/butterfly/.github/workflows/publish.yml","hash":"05857c2f265246d8de00e31037f2720709540c09","modified":1665298073949},{"_id":"themes/butterfly/scripts/events/cdn.js","hash":"acfe765fb2c607bff7198630dbfa53a888c36357","modified":1665298073968},{"_id":"themes/butterfly/scripts/events/comment.js","hash":"a3d1f417965ca20253c36f9e93429f3df6268856","modified":1665298073968},{"_id":"themes/butterfly/scripts/events/init.js","hash":"b4940a5c73d3a5cd8bb5883e3041ecdd905a74e0","modified":1665298073968},{"_id":"themes/butterfly/scripts/events/welcome.js","hash":"3cfc46c749e2fd7ae9c2a17206238ed0e0e17e7d","modified":1665298073969},{"_id":"themes/butterfly/scripts/events/stylus.js","hash":"9819f0996234fbd80d6c50a9e526c56ebf22588d","modified":1665298073968},{"_id":"themes/butterfly/.github/ISSUE_TEMPLATE/feature_request.yml","hash":"996640605ed1e8e35182f0fd9a60a88783b24b03","modified":1665298073949},{"_id":"themes/butterfly/scripts/filters/post_lazyload.js","hash":"932df912976261929f809b7dbd4eb473e7787345","modified":1665298073969},{"_id":"themes/butterfly/scripts/filters/random_cover.js","hash":"21379ed2dccb69c43b893895c9d56238c11e5f43","modified":1665298073969},{"_id":"themes/butterfly/scripts/helpers/aside_archives.js","hash":"2ec66513d5322f185d2071acc052978ba9415a8e","modified":1665298073969},{"_id":"themes/butterfly/scripts/helpers/findArchiveLength.js","hash":"ee3e70098eb0849497d50b75e18cf4a27c397d52","modified":1665298073969},{"_id":"themes/butterfly/scripts/helpers/aside_categories.js","hash":"e00efdb5d02bc5c6eb4159e498af69fa61a7dbb9","modified":1665298073969},{"_id":"themes/butterfly/scripts/helpers/inject_head_js.js","hash":"b4cd617c619d1a0df93603721a6fa1317526174b","modified":1665298073970},{"_id":"themes/butterfly/scripts/helpers/page.js","hash":"763dab5c83f50c1c62fffc9a9dfedea29bb4e629","modified":1665298073970},{"_id":"themes/butterfly/scripts/helpers/related_post.js","hash":"d368a8830e506c8b5eb6512b709ec8db354d5ea1","modified":1665298073970},{"_id":"themes/butterfly/scripts/tag/inlineImg.js","hash":"a43ee2c7871bdd93cb6beb804429e404570f7929","modified":1665298073971},{"_id":"themes/butterfly/scripts/tag/button.js","hash":"91d954f6e9fe6e571eb8ec9f8996294b2dc3688e","modified":1665298073970},{"_id":"themes/butterfly/scripts/tag/flink.js","hash":"ab62919fa567b95fbe14889517abda649991b1ee","modified":1665298073970},{"_id":"themes/butterfly/scripts/tag/gallery.js","hash":"f79c99f6c5b626c272dc2bed2b0250d6b91bb28a","modified":1665298073971},{"_id":"themes/butterfly/scripts/tag/hide.js","hash":"396c3ab1bcf1c7693ad7e506eadd13016c6769b6","modified":1665298073971},{"_id":"themes/butterfly/scripts/tag/label.js","hash":"03b2afef41d02bd1045c89578a02402c28356006","modified":1665298073971},{"_id":"themes/butterfly/scripts/tag/mermaid.js","hash":"531808a290b8bdd66bac2faab211ada8e9646a37","modified":1665298073971},{"_id":"themes/butterfly/scripts/tag/note.js","hash":"d51812b43924f1bbf413c67499510dd125022005","modified":1665298073972},{"_id":"themes/butterfly/scripts/tag/tabs.js","hash":"6c6e415623d0fd39da016d9e353bb4f5cca444f5","modified":1665298073972},{"_id":"themes/butterfly/scripts/tag/timeline.js","hash":"300eb779588bf35a1b687d9f829d866074b707e3","modified":1665298073972},{"_id":"themes/butterfly/layout/includes/404.pug","hash":"cb49f737aca272ccfeb62880bd651eccee72a129","modified":1665298073951},{"_id":"themes/butterfly/layout/includes/footer.pug","hash":"02390a5b6ae1f57497b22ba2e6be9f13cfb7acac","modified":1665298073952},{"_id":"themes/butterfly/layout/includes/additional-js.pug","hash":"594a977ebe8d97e60fa3d7cb40fc260ded4d8a58","modified":1665298073951},{"_id":"themes/butterfly/layout/includes/head.pug","hash":"de8e618ec03295561c667a49e1c383213b856f6f","modified":1665298073952},{"_id":"themes/butterfly/layout/includes/rightside.pug","hash":"699d0d2cff233628752956c4434125c8203f7d63","modified":1665298073957},{"_id":"themes/butterfly/layout/includes/layout.pug","hash":"a557280a25f63f4312afad63fc3303ec74165557","modified":1665298073954},{"_id":"themes/butterfly/layout/includes/pagination.pug","hash":"0b80f04950bd0fe5e6c4e7b7559adf4d0ce28436","modified":1665298073956},{"_id":"themes/butterfly/layout/includes/sidebar.pug","hash":"8d39473ed112d113674a0f689f63fae06c72abd2","modified":1665298073957},{"_id":"themes/butterfly/source/css/var.styl","hash":"4890a40366d6443f8b8942a4e9a6dce9fe3494f5","modified":1665298073981},{"_id":"themes/butterfly/source/css/index.styl","hash":"861998e4ac67a59529a8245a9130d68f826c9c12","modified":1665298073981},{"_id":"themes/butterfly/source/img/404.jpg","hash":"fb4489bc1d30c93d28f7332158c1c6c1416148de","modified":1665298073982},{"_id":"themes/butterfly/source/img/favicon.png","hash":"3cf89864b4f6c9b532522a4d260a2e887971c92d","modified":1665298073982},{"_id":"themes/butterfly/source/js/main.js","hash":"73d2624ed465e4cfb1ebb00b2c8a24f5fc29bb21","modified":1665298073983},{"_id":"themes/butterfly/source/js/utils.js","hash":"0b95daada72abb5d64a1e3236049a60120e47cca","modified":1665298073984},{"_id":"themes/butterfly/source/img/friend_404.gif","hash":"8d2d0ebef70a8eb07329f57e645889b0e420fa48","modified":1665298073982},{"_id":"themes/butterfly/source/js/tw_cn.js","hash":"00053ce73210274b3679f42607edef1206eebc68","modified":1665298073983},{"_id":"themes/butterfly/layout/includes/head/Open_Graph.pug","hash":"6c41f49a3e682067533dd9384e6e4511fc3a1349","modified":1665298073952},{"_id":"themes/butterfly/layout/includes/head/analytics.pug","hash":"15530d9ac59c576d79af75dd687efe71e8d261b0","modified":1665298073952},{"_id":"themes/butterfly/layout/includes/head/config.pug","hash":"8f41fa9732ea654a10f6e666d9c782c7e27e5ea6","modified":1665298073952},{"_id":"themes/butterfly/layout/includes/head/config_site.pug","hash":"7df90c8e432e33716517ab918b0a125bc284041b","modified":1665298073952},{"_id":"themes/butterfly/layout/includes/head/noscript.pug","hash":"d16ad2ee0ff5751fd7f8a5ce1b83935518674977","modified":1665298073952},{"_id":"themes/butterfly/layout/includes/head/google_adsense.pug","hash":"95a37e92b39c44bcbea4be7e29ddb3921c5b8220","modified":1665298073952},{"_id":"themes/butterfly/layout/includes/head/pwa.pug","hash":"3d492cfe645d37c94d30512e0b230b0a09913148","modified":1665298073953},{"_id":"themes/butterfly/layout/includes/head/preconnect.pug","hash":"65a23b5170204e55b813ce13a79d799b66b7382c","modified":1665298073953},{"_id":"themes/butterfly/layout/includes/mixins/article-sort.pug","hash":"2fb74d0b0e4b98749427c5a1a1b0acb6c85fadc4","modified":1665298073955},{"_id":"themes/butterfly/layout/includes/head/site_verification.pug","hash":"e2e8d681f183f00ce5ee239c42d2e36b3744daad","modified":1665298073953},{"_id":"themes/butterfly/layout/includes/header/index.pug","hash":"aa175e2254704335f4da09175e59ef2375ca7d03","modified":1665298073953},{"_id":"themes/butterfly/layout/includes/header/menu_item.pug","hash":"31346a210f4f9912c5b29f51d8f659913492f388","modified":1665298073953},{"_id":"themes/butterfly/layout/includes/header/nav.pug","hash":"78a3abd90bb3c18cd773d3d5abac3541e7f415e5","modified":1665298073953},{"_id":"themes/butterfly/layout/includes/header/post-info.pug","hash":"9698f22751778dde063cbfbd01c59ca4462ccd85","modified":1665298073954},{"_id":"themes/butterfly/layout/includes/mixins/post-ui.pug","hash":"6ae047d566289294cc2f6192cacbff297cec9f1a","modified":1665298073955},{"_id":"themes/butterfly/layout/includes/page/categories.pug","hash":"5276a8d2835e05bd535fedc9f593a0ce8c3e8437","modified":1665298073955},{"_id":"themes/butterfly/layout/includes/loading/loading.pug","hash":"5276937fbcceb9d62879dc47be880cd469a27349","modified":1665298073954},{"_id":"themes/butterfly/layout/includes/header/social.pug","hash":"0d953e51d04a9294a64153c89c20f491a9ec42d4","modified":1665298073954},{"_id":"themes/butterfly/layout/includes/loading/loading-js.pug","hash":"4cfcf0100e37ce91864703cd44f1cb99cb5493ea","modified":1665298073954},{"_id":"themes/butterfly/layout/includes/page/flink.pug","hash":"fed069baa9b383f57db32bb631115071d29bdc60","modified":1665298073956},{"_id":"themes/butterfly/layout/includes/page/default-page.pug","hash":"12c65c174d26a41821df9bad26cdf1087ec5b0ca","modified":1665298073955},{"_id":"themes/butterfly/layout/includes/page/tags.pug","hash":"6311eda08e4515281c51bd49f43902a51832383c","modified":1665298073956},{"_id":"themes/butterfly/layout/includes/post/reward.pug","hash":"864869c43fe5b5bb6f4ac6b13dd4bfb16ea47550","modified":1665298073957},{"_id":"themes/butterfly/layout/includes/third-party/aplayer.pug","hash":"c7cfade2b160380432c47eef4cd62273b6508c58","modified":1665298073957},{"_id":"themes/butterfly/layout/includes/post/post-copyright.pug","hash":"ebecba46a5f4efe1c98a386df06c56e26fbd07b9","modified":1665298073957},{"_id":"themes/butterfly/layout/includes/third-party/pangu.pug","hash":"0f024e36b8116118233e10118714bde304e01e12","modified":1665298073963},{"_id":"themes/butterfly/layout/includes/third-party/effect.pug","hash":"6528e86656906117a1af6b90e0349c2c4651d5e1","modified":1665298073961},{"_id":"themes/butterfly/layout/includes/third-party/pjax.pug","hash":"6d6474ef186c18d9b4f334e1f735eadd6699effa","modified":1665298073964},{"_id":"themes/butterfly/layout/includes/third-party/prismjs.pug","hash":"ffb9ea15a2b54423cd4cd441e2d061b8233e9b58","modified":1665298073964},{"_id":"themes/butterfly/layout/includes/third-party/subtitle.pug","hash":"142621f70bedcb5033ee99a988f7bb6c5eea3493","modified":1665298073965},{"_id":"themes/butterfly/source/css/_global/function.styl","hash":"644d520fe80cc82058467708ab82ccad313b0c27","modified":1665298073973},{"_id":"themes/butterfly/source/css/_global/index.styl","hash":"714f19e7d66df84938bd1b82b33d5667abe1f147","modified":1665298073973},{"_id":"themes/butterfly/source/css/_highlight/highlight.styl","hash":"2f95e99b8351fbecd9037a1bbdc3fee9d6ea8a77","modified":1665298073973},{"_id":"themes/butterfly/layout/includes/widget/card_ad.pug","hash":"60dc48a7b5d89c2a49123c3fc5893ab9c57dd225","modified":1665298073965},{"_id":"themes/butterfly/layout/includes/widget/card_archives.pug","hash":"86897010fe71503e239887fd8f6a4f5851737be9","modified":1665298073966},{"_id":"themes/butterfly/source/css/_highlight/theme.styl","hash":"bcd384c8b2aa0390c9eb69ac1abbfd1240ce1da4","modified":1665298073974},{"_id":"themes/butterfly/layout/includes/widget/card_announcement.pug","hash":"ae392459ad401a083ca51ee0b27526b3c1e1faed","modified":1665298073966},{"_id":"themes/butterfly/layout/includes/widget/card_author.pug","hash":"e37468e63db2a0ac09b65d21b7de3e62425bb455","modified":1665298073966},{"_id":"themes/butterfly/layout/includes/widget/card_bottom_self.pug","hash":"13dc8ce922e2e2332fe6ad5856ebb5dbf9ea4444","modified":1665298073966},{"_id":"themes/butterfly/layout/includes/widget/card_post_toc.pug","hash":"3057a2f6f051355e35d3b205121af8735100eacf","modified":1665298073966},{"_id":"themes/butterfly/layout/includes/widget/card_categories.pug","hash":"d1a416d0a8a7916d0b1a41d73adc66f8c811e493","modified":1665298073966},{"_id":"themes/butterfly/layout/includes/widget/card_newest_comment.pug","hash":"6d93564a8bd13cb9b52ee5e178db3bcbf18b1bc6","modified":1665298073966},{"_id":"themes/butterfly/layout/includes/widget/card_tags.pug","hash":"438aea3e713ed16b7559b9a80a9c5ec0221263df","modified":1665298073967},{"_id":"themes/butterfly/layout/includes/widget/card_recent_post.pug","hash":"9c1229af6ab48961021886882c473514101fba21","modified":1665298073966},{"_id":"themes/butterfly/source/css/_mode/darkmode.styl","hash":"a92984f566c97bb4179f34be79240af1552c6f17","modified":1665298073976},{"_id":"themes/butterfly/layout/includes/widget/card_webinfo.pug","hash":"35ce167c5a275211bfc1fa3d49adfde5b404d98f","modified":1665298073967},{"_id":"themes/butterfly/layout/includes/widget/card_top_self.pug","hash":"ae67c6d4130a6c075058a9c1faea1648bcc6f83e","modified":1665298073967},{"_id":"themes/butterfly/layout/includes/widget/index.pug","hash":"7fb096656c8a6c21a4b6a5100885b1081d6021ed","modified":1665298073967},{"_id":"themes/butterfly/source/css/_mode/readmode.styl","hash":"69f8e9414526dfda3af9a71c8e528fdd0ecbbfe5","modified":1665298073977},{"_id":"themes/butterfly/source/css/_search/algolia.styl","hash":"51e45625929d57c9df3ba9090af99b9b7bb9a15b","modified":1665298073978},{"_id":"themes/butterfly/source/css/_search/index.styl","hash":"39d61cbe0c1e937f83ba3b147afaa29b4de2f87d","modified":1665298073978},{"_id":"themes/butterfly/source/css/_page/404.styl","hash":"50dbb9e6d98c71ffe16741b8c1b0c1b9771efd2b","modified":1665298073977},{"_id":"themes/butterfly/source/css/_page/categories.styl","hash":"f01ee74948cedb44e53cd3bb1ef36b7d2778ede7","modified":1665298073977},{"_id":"themes/butterfly/source/css/_page/archives.styl","hash":"6f4b4ede52305bce9b22c8c897dcbde8af6e2ce4","modified":1665298073977},{"_id":"themes/butterfly/source/css/_page/homepage.styl","hash":"8c90483d461e09cb06e91b16d8bb7b3205b0a40c","modified":1665298073977},{"_id":"themes/butterfly/source/css/_page/common.styl","hash":"a58d35d698885f1034dedbe99f7dbc1a801412c6","modified":1665298073977},{"_id":"themes/butterfly/source/css/_search/local-search.styl","hash":"25e58a7a8bda4b73d0a0e551643ca01b09ccd7e5","modified":1665298073978},{"_id":"themes/butterfly/source/css/_page/flink.styl","hash":"98d755b686ee833e9da10afaa40c4ec2bd66c19a","modified":1665298073977},{"_id":"themes/butterfly/source/css/_tags/button.styl","hash":"45f0c32bdea117540f6b14ebac6450d7142bd710","modified":1665298073979},{"_id":"themes/butterfly/source/css/_tags/hexo.styl","hash":"d76c38adf1d9c1279ef4241835667789f5b736e0","modified":1665298073979},{"_id":"themes/butterfly/source/css/_tags/hide.styl","hash":"ce489ca2e249e2a3cf71584e20d84bdb022e3475","modified":1665298073979},{"_id":"themes/butterfly/source/css/_page/tags.styl","hash":"580feb7e8b0822a1be48ac380f8c5c53b1523321","modified":1665298073978},{"_id":"themes/butterfly/source/css/_tags/inlineImg.styl","hash":"df9d405c33a9a68946b530410f64096bcb72560c","modified":1665298073979},{"_id":"themes/butterfly/source/css/_tags/note.styl","hash":"85ae91c83691ea4511f4277da1194a185251cc78","modified":1665298073980},{"_id":"themes/butterfly/source/css/_tags/label.styl","hash":"66c59e193d794cdb02cca7bd1dc4aea5a19d7e84","modified":1665298073980},{"_id":"themes/butterfly/source/css/_tags/timeline.styl","hash":"f071156d439556e7463ed4bc61ceee87170d5d08","modified":1665298073981},{"_id":"themes/butterfly/source/css/_tags/gallery.styl","hash":"a310e48f826a4cacc55d8e68f43806e5085554f6","modified":1665298073979},{"_id":"themes/butterfly/source/css/_layout/chat.styl","hash":"f9a5d3f1fc5ed0ed2ee4c1eaa58ed650d11ddebd","modified":1665298073974},{"_id":"themes/butterfly/source/css/_layout/aside.styl","hash":"a0010d833ed30211601c1e0bbbc68e85b77428c6","modified":1665298073974},{"_id":"themes/butterfly/source/css/_tags/tabs.styl","hash":"bf9568444dd54e39dc59b461323dcd38942f27d9","modified":1665298073980},{"_id":"themes/butterfly/source/css/_layout/comments.styl","hash":"c61dccca690d486c3d9c29cf028d87b777385141","modified":1665298073975},{"_id":"themes/butterfly/source/css/_layout/footer.styl","hash":"26be2afa9d4e7016cf3c42a6cd166f01e8e4ad5c","modified":1665298073975},{"_id":"themes/butterfly/source/css/_third-party/normalize.min.css","hash":"2c18a1c9604af475b4749def8f1959df88d8b276","modified":1665298073981},{"_id":"themes/butterfly/source/css/_layout/loading.styl","hash":"ef21990de28bd75dcd0f88b8d616e1a7a137502f","modified":1665298073975},{"_id":"themes/butterfly/source/css/_layout/head.styl","hash":"a457a0dbe23af21a7b6b8bfc5ee103c9fe92e89c","modified":1665298073975},{"_id":"themes/butterfly/source/css/_layout/pagination.styl","hash":"fb9f78bfbb79579f1d752cb73fb6d25c8418e0fd","modified":1665298073975},{"_id":"themes/butterfly/source/css/_layout/rightside.styl","hash":"bd88ee30ebf8ca2e7b4d3a034c317fd61733921f","modified":1665298073976},{"_id":"themes/butterfly/source/css/_layout/post.styl","hash":"15056fba0bd5a45ea8dc97eb557f6929ff16797a","modified":1665298073975},{"_id":"themes/butterfly/source/css/_layout/reward.styl","hash":"c5cfed620708807a48076b5ee59b0ba84e29aa80","modified":1665298073976},{"_id":"themes/butterfly/source/css/_layout/third-party.styl","hash":"8314e9749eb1ae40c4bae9735b7a6638b2d6876a","modified":1665298073976},{"_id":"themes/butterfly/source/css/_layout/relatedposts.styl","hash":"d53de408cb27a2e704aba7f7402b7caebe0410d8","modified":1665298073976},{"_id":"themes/butterfly/source/js/search/algolia.js","hash":"9feb248552667c53ce1b19bc7a295215f8c77008","modified":1665298073983},{"_id":"themes/butterfly/source/js/search/local-search.js","hash":"3071a4208fdf89ad7e0031536dd6ffa7bc951e4d","modified":1665298073983},{"_id":"themes/butterfly/source/css/_layout/sidebar.styl","hash":"631ca35a38bc4ac052e9caf47508ff1f99842fc7","modified":1665298073976},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/artalk.pug","hash":"99d9b17668260b242749c16851d9ec1024d31899","modified":1665298073957},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/fb.pug","hash":"f0ddc0f1ffee143d86c81bee1136ae6ee01e8ea5","modified":1665298073958},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/index.pug","hash":"b2d274db84ef22fbd6d5ea8f4404821898934209","modified":1665298073958},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/disqus.pug","hash":"d85c3737b5c9548553a78b757a7698df126a52cf","modified":1665298073958},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/remark42.pug","hash":"001e8be47854b891efe04013c240c38fed4185eb","modified":1665298073958},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/twikoo.pug","hash":"58406a7a3bf45815769f652bf3ef81e57dcd07eb","modified":1665298073958},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/valine.pug","hash":"39427e107230a10790972349c9dd4c4f31d55eb7","modified":1665298073958},{"_id":"themes/butterfly/layout/includes/third-party/math/index.pug","hash":"b8ae5fd7d74e1edcef21f5004fc96147e064d219","modified":1665298073962},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/waline.pug","hash":"5f648086a33a32d169a2f8d8c549c08aa02f67db","modified":1665298073958},{"_id":"themes/butterfly/layout/includes/third-party/math/mathjax.pug","hash":"f4dc7d02c8192979404ae9e134c5048d3d0a76e2","modified":1665298073962},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/github-issues.pug","hash":"e846ddfe4a63b15d1416f6055f5756af5e3da7c6","modified":1665298073963},{"_id":"themes/butterfly/layout/includes/third-party/math/katex.pug","hash":"dfcbd9881be569ea420eff1a6b00e4f4dbe2138e","modified":1665298073962},{"_id":"themes/butterfly/layout/includes/third-party/math/mermaid.pug","hash":"8e33aca36a4d3ae9e041ba05ced8eff56ae38f77","modified":1665298073962},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/index.pug","hash":"4ec0642f2d5444acfab570a6f8c7868e7ff43fde","modified":1665298073963},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/disqus-comment.pug","hash":"04b2a5882e789a988e41d45abe606f0617b08e38","modified":1665298073962},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/remark42.pug","hash":"ab167c00da4506f591b96f0591bf5bd214a26d4b","modified":1665298073963},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/twikoo-comment.pug","hash":"233907dd7f5b5f33412701d2ccffbc0bbae8707b","modified":1665298073963},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/valine.pug","hash":"d19e1c2c0a50f0e4547d71a17b9be88e8152f17c","modified":1665298073963},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/waline.pug","hash":"dd0bc119029b62dce5dc965d5de7377e438fa29a","modified":1665298073963},{"_id":"themes/butterfly/layout/includes/third-party/search/algolia.pug","hash":"e8245d0b4933129bb1c485d8de11a9e52e676348","modified":1665298073964},{"_id":"themes/butterfly/layout/includes/third-party/search/index.pug","hash":"da3b9437d061ee68dbc383057db5c73034c49605","modified":1665298073964},{"_id":"themes/butterfly/layout/includes/third-party/search/local-search.pug","hash":"178c9cdcc4ce5a006885b24ce4a3d624e4734899","modified":1665298073964},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/artalk.pug","hash":"c12c898b35dd014780c1f3220ddbe12e7270983c","modified":1665298073962},{"_id":"themes/butterfly/layout/includes/third-party/share/add-this.pug","hash":"2980f1889226ca981aa23b8eb1853fde26dcf89a","modified":1665298073965},{"_id":"themes/butterfly/layout/includes/third-party/share/addtoany.pug","hash":"85c92f8a7e44d7cd1c86f089a05be438535e5362","modified":1665298073965},{"_id":"themes/butterfly/layout/includes/third-party/share/index.pug","hash":"4c4a9c15215ae8ac5eadb0e086b278f76db9ee92","modified":1665298073965},{"_id":"themes/butterfly/source/css/_highlight/highlight/index.styl","hash":"18804c58239d95798fa86d0597f32d7f7dd30051","modified":1665298073973},{"_id":"themes/butterfly/source/css/_highlight/highlight/diff.styl","hash":"cf1fae641c927621a4df1be5ca4a853b9b526e23","modified":1665298073973},{"_id":"themes/butterfly/layout/includes/third-party/share/share-js.pug","hash":"f61d63724ea5c5f352568b3a16bde023affefbe5","modified":1665298073965},{"_id":"themes/butterfly/layout/includes/third-party/chat/chatra.pug","hash":"481cd5053bafb1a19f623554a27d3aa077ea59c3","modified":1665298073959},{"_id":"themes/butterfly/layout/includes/third-party/chat/daovoice.pug","hash":"cfe63e7d26a6665df6aa32ca90868ad48e05ec04","modified":1665298073959},{"_id":"themes/butterfly/layout/includes/third-party/chat/crisp.pug","hash":"76634112c64023177260d1317ae39cef2a68e35f","modified":1665298073959},{"_id":"themes/butterfly/layout/includes/third-party/chat/gitter.pug","hash":"d1d2474420bf4edc2e43ccdff6f92b8b082143df","modified":1665298073959},{"_id":"themes/butterfly/layout/includes/third-party/chat/index.pug","hash":"0611d9216f4c128ebdea4cc21454c3dc4a6398d5","modified":1665298073959},{"_id":"themes/butterfly/layout/includes/third-party/chat/messenger.pug","hash":"bfe7b5a8fad041b63a10c6c6ed02e7c87afb94cd","modified":1665298073959},{"_id":"themes/butterfly/layout/includes/third-party/chat/tidio.pug","hash":"24a926756c2300b9c561aaab6bd3a71fdd16e16d","modified":1665298073959},{"_id":"themes/butterfly/layout/includes/third-party/comments/artalk.pug","hash":"49dcc23815e1d5264bb65c91e7dc67b1a723d1ea","modified":1665298073960},{"_id":"themes/butterfly/layout/includes/third-party/comments/disqus.pug","hash":"8ec24c1939895ac0db2b2e8700bc9307b4ceb53c","modified":1665298073960},{"_id":"themes/butterfly/layout/includes/third-party/comments/facebook_comments.pug","hash":"2c095186033b6b273634ce97a75873da1f3646db","modified":1665298073960},{"_id":"themes/butterfly/layout/includes/third-party/comments/disqusjs.pug","hash":"98ef20f8a3b10c1692f9b2b3c06033d2da8a8eae","modified":1665298073960},{"_id":"themes/butterfly/layout/includes/third-party/comments/giscus.pug","hash":"591ef23c583690bd74af0cafb09af64ba5bd8151","modified":1665298073960},{"_id":"themes/butterfly/layout/includes/third-party/comments/gitalk.pug","hash":"22e2ef30fe5eb1db7566e89943c74ece029b2a8e","modified":1665298073960},{"_id":"themes/butterfly/layout/includes/third-party/comments/index.pug","hash":"351fe25fbf02635b1f9e86e5e244c7d61f69baa7","modified":1665298073960},{"_id":"themes/butterfly/layout/includes/third-party/comments/js.pug","hash":"00ed91c52939b9675b316137f854d13684c895a6","modified":1665298073960},{"_id":"themes/butterfly/layout/includes/third-party/comments/remark42.pug","hash":"e9bdf80d6796afc04eb809dbbe780d97f22c7fcd","modified":1665298073961},{"_id":"themes/butterfly/layout/includes/third-party/comments/utterances.pug","hash":"a737046e730eb7264606ba0536218964044492f9","modified":1665298073961},{"_id":"themes/butterfly/layout/includes/third-party/comments/waline.pug","hash":"15462d1ed04651ad3b430c682842ac400f6f9b47","modified":1665298073961},{"_id":"themes/butterfly/layout/includes/third-party/comments/livere.pug","hash":"52ea8aa26b84d3ad38ae28cdf0f163e9ca8dced7","modified":1665298073961},{"_id":"themes/butterfly/layout/includes/third-party/comments/valine.pug","hash":"e55b9c0f8ced231f47eb88bd7f4ec99f29c5c29d","modified":1665298073961},{"_id":"themes/butterfly/layout/includes/third-party/comments/twikoo.pug","hash":"e18fbd88d8942e53e771f29b26209ab735c5c567","modified":1665298073961},{"_id":"themes/butterfly/source/css/_highlight/prismjs/diff.styl","hash":"5972c61f5125068cbe0af279a0c93a54847fdc3b","modified":1665298073974},{"_id":"themes/butterfly/source/css/_highlight/prismjs/index.styl","hash":"5dc2e0bcae9a54bfb9bdcc82d02ae5a3cf1ca97d","modified":1665298073974},{"_id":"themes/butterfly/source/css/_highlight/prismjs/line-number.styl","hash":"8970cc1916c982b64a1478792b2822d1d31e276d","modified":1665298073974},{"_id":"public/404.html","hash":"e57b99c3a43b6bdc7750f173be16399824901b53","modified":1680574120161},{"_id":"public/tags/index.html","hash":"0c3a4f532cf44ef79604891046bd120115633d4f","modified":1680574120161},{"_id":"public/link/index.html","hash":"f2f5f86e8a969c15c9b594522a0c7b1f1e4e8e51","modified":1680574120161},{"_id":"public/Gallery/index.html","hash":"a956944bd4724fc8492b6c0403f9fcde5c952143","modified":1680574120161},{"_id":"public/categories/index.html","hash":"ab95a0f3ee8bdaff3f1ea773a6e7f76750954790","modified":1680574120161},{"_id":"public/2022/10/14/jenkins安装/index.html","hash":"f13654dd5ddcf83b04d5dfa2b84b1e91af4ea5bd","modified":1680574120161},{"_id":"public/2022/10/14/Harbor安装/index.html","hash":"6fc58376eaa80953abf54f9b396ae75241f602c0","modified":1680574120161},{"_id":"public/2022/10/14/Docker私有仓库安装/index.html","hash":"f4f62721a3cb7b50ca2e269839ce7c9a8c4e4a48","modified":1680574120161},{"_id":"public/2022/07/19/eml文件解析/index.html","hash":"785573e525366910725cb343fb60f7232c11ac8a","modified":1680574120161},{"_id":"public/2021/11/20/Linux命令记录/index.html","hash":"e58e9ade623bb750957fa2e3b59c98323e3c3ac2","modified":1680574120161},{"_id":"public/2021/11/20/mysql实时同步至es/index.html","hash":"f435eb93f0c1dd4b0494da0ec6490c7179372a44","modified":1680574120161},{"_id":"public/2021/11/20/Pritunl的安装/index.html","hash":"ccaebdc229cd49c458b0e5e6431d02006e6e06e2","modified":1680574120161},{"_id":"public/2021/10/17/Docker学习笔记/index.html","hash":"f4a10b50df9e3c251a340c19c6d07c6c06174847","modified":1680574120161},{"_id":"public/2021/10/17/Vue学习/index.html","hash":"edc70e97004dd7acfe83a4608853d13d988d4c5c","modified":1680574120161},{"_id":"public/2021/10/17/爬虫的简单介绍/index.html","hash":"4b98752adfabfaaa75a45be4d484033aa663f1da","modified":1680574120161},{"_id":"public/archives/index.html","hash":"b3a7496f2d8c3d2665c175526cf27d541be51363","modified":1680574120161},{"_id":"public/archives/2021/index.html","hash":"bab45f5c5a197245568e99c194045ff3186de97a","modified":1680574120161},{"_id":"public/archives/2021/10/index.html","hash":"583020fedc0676a0845aad3592733c7eb1443688","modified":1680574120161},{"_id":"public/archives/2021/11/index.html","hash":"76bca2a26d6ea0544539e859952b66acf741b4a6","modified":1680574120161},{"_id":"public/archives/2022/index.html","hash":"e6c421f402f1e575ac52027d725d219f81af0333","modified":1680574120161},{"_id":"public/archives/2022/07/index.html","hash":"67ef518e3c57fba7f91eff3f3d0b9019952f2962","modified":1680574120161},{"_id":"public/archives/2022/10/index.html","hash":"383f55e58c9e1f9bff3dbc83e434da4d90f12bf5","modified":1680574120161},{"_id":"public/categories/安装/index.html","hash":"3609a345483cacd291335bee8fed45927d81aa7f","modified":1680574120161},{"_id":"public/categories/linux/index.html","hash":"1d45099a281cbcf6183175e35c39669b0dc61208","modified":1680574120161},{"_id":"public/categories/学习/index.html","hash":"29ccae75f6e1fe22ae1f53a8bf2f271cb714b041","modified":1680574120161},{"_id":"public/tags/docker/index.html","hash":"72deede01b1d36bfc544c0a8091721493663ea0d","modified":1680574120161},{"_id":"public/tags/Harbor/index.html","hash":"f708a8985ce84f73d22c1d3c3963fc93c6864c06","modified":1680574120161},{"_id":"public/index.html","hash":"fbea491d828f5a2e6e6b1a5726235a5eaca2e86b","modified":1680574120161},{"_id":"public/tags/linux/index.html","hash":"7a2e03ca8c570c2e48ed6240f8c3b9131df4d2a6","modified":1680574120161},{"_id":"public/tags/Pritunl/index.html","hash":"c803ed7cba165318133ec813028a2bfca3e6caeb","modified":1680574120161},{"_id":"public/tags/mysql/index.html","hash":"1cbd1a3c3099d98226321b6d0a4bc3a18382acb9","modified":1680574120161},{"_id":"public/tags/jenkins/index.html","hash":"daae4fc70d39e5ca0f644eb1727f508d45ec0725","modified":1680574120161},{"_id":"public/tags/vue/index.html","hash":"1d7c8f6810d87e0fc19670db6cdfea5f05038573","modified":1680574120161},{"_id":"public/tags/爬虫/index.html","hash":"4f4770428e0b1d757144cee5cbb14d8230e336c5","modified":1680574120161},{"_id":"public/img/favicon.png","hash":"3cf89864b4f6c9b532522a4d260a2e887971c92d","modified":1680574120161},{"_id":"public/img/404.jpg","hash":"fb4489bc1d30c93d28f7332158c1c6c1416148de","modified":1680574120161},{"_id":"public/img/friend_404.gif","hash":"8d2d0ebef70a8eb07329f57e645889b0e420fa48","modified":1680574120161},{"_id":"public/css/var.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1680574120161},{"_id":"public/js/utils.js","hash":"0b95daada72abb5d64a1e3236049a60120e47cca","modified":1680574120161},{"_id":"public/js/search/algolia.js","hash":"9feb248552667c53ce1b19bc7a295215f8c77008","modified":1680574120161},{"_id":"public/js/search/local-search.js","hash":"3071a4208fdf89ad7e0031536dd6ffa7bc951e4d","modified":1680574120161},{"_id":"public/css/index.css","hash":"b35f7e84f84e49b832063795e1a4d9055a653e33","modified":1680574120161},{"_id":"public/js/main.js","hash":"73d2624ed465e4cfb1ebb00b2c8a24f5fc29bb21","modified":1680574120161},{"_id":"public/js/tw_cn.js","hash":"00053ce73210274b3679f42607edef1206eebc68","modified":1680574120161},{"_id":"themes/butterfly/.DS_Store","hash":"df2fbeb1400acda0909a32c1cf6bf492f1121e07","modified":1684122481553}],"Category":[{"name":"安装","_id":"clg1mfury000427qg0uvu344d"},{"name":"linux","_id":"clg1mfus8000h27qghsf260rh"},{"name":"学习","_id":"clg1mfuse000p27qgbd5p63mr"}],"Data":[{"_id":"link","data":[{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"动漫图片和壁纸","link":"https://anime-pictures.net/?lang=zh_CN","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"图片网站"},{"name":"Wallhaven","link":"https://wallhaven.cc/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"4k图片网站"},{"name":"WALLPAPER ABYSS","link":"https://wall.alphacoders.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"WALLPAPER ABYSS"},{"name":"极简壁纸","link":"https://bz.zzzmh.cn/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"极简壁纸"},{"name":"Wallroom","link":"https://wallroom.io/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"Wallroom"}]}]}],"Page":[{"title":"友情链接","date":"2022-10-09T09:42:04.000Z","type":"link","_content":"","source":"link/index.md","raw":"---\ntitle: 友情链接\ndate: 2022-10-09 17:42:04\ntype: \"link\"\n---\n","updated":"2022-10-09T09:43:06.680Z","path":"link/index.html","comments":1,"layout":"page","_id":"clg1mfurn000027qgg65waww2","content":"","site":{"data":{"link":[{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"动漫图片和壁纸","link":"https://anime-pictures.net/?lang=zh_CN","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"图片网站"},{"name":"Wallhaven","link":"https://wallhaven.cc/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"4k图片网站"},{"name":"WALLPAPER ABYSS","link":"https://wall.alphacoders.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"WALLPAPER ABYSS"},{"name":"极简壁纸","link":"https://bz.zzzmh.cn/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"极简壁纸"},{"name":"Wallroom","link":"https://wallroom.io/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"Wallroom"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":""},{"title":"标签","date":"2022-10-09T07:31:34.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: 标签\ndate: 2022-10-09 15:31:34\ntype: \"tags\"\n---\n","updated":"2022-10-09T08:46:04.239Z","path":"tags/index.html","comments":1,"layout":"page","_id":"clg1mfurw000227qg93o6e618","content":"","site":{"data":{"link":[{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"动漫图片和壁纸","link":"https://anime-pictures.net/?lang=zh_CN","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"图片网站"},{"name":"Wallhaven","link":"https://wallhaven.cc/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"4k图片网站"},{"name":"WALLPAPER ABYSS","link":"https://wall.alphacoders.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"WALLPAPER ABYSS"},{"name":"极简壁纸","link":"https://bz.zzzmh.cn/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"极简壁纸"},{"name":"Wallroom","link":"https://wallroom.io/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"Wallroom"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":""},{"title":"图片","date":"2022-10-09T08:40:49.000Z","type":"Gallery","_content":"","source":"Gallery/index.md","raw":"---\ntitle: 图片\ndate: 2022-10-09 16:40:49\ntype: \"Gallery\"\n---\n","updated":"2022-10-09T08:47:04.875Z","path":"Gallery/index.html","comments":1,"layout":"page","_id":"clg1mfus0000627qg7k7iewq4","content":"","site":{"data":{"link":[{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"动漫图片和壁纸","link":"https://anime-pictures.net/?lang=zh_CN","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"图片网站"},{"name":"Wallhaven","link":"https://wallhaven.cc/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"4k图片网站"},{"name":"WALLPAPER ABYSS","link":"https://wall.alphacoders.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"WALLPAPER ABYSS"},{"name":"极简壁纸","link":"https://bz.zzzmh.cn/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"极简壁纸"},{"name":"Wallroom","link":"https://wallroom.io/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"Wallroom"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":""},{"title":"分类","date":"2022-10-09T08:45:30.000Z","type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: 分类\ndate: 2022-10-09 16:45:30\ntype: \"categories\"\n---\n","updated":"2022-10-09T08:45:54.447Z","path":"categories/index.html","comments":1,"layout":"page","_id":"clg1mfus1000827qg14pogb69","content":"","site":{"data":{"link":[{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"动漫图片和壁纸","link":"https://anime-pictures.net/?lang=zh_CN","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"图片网站"},{"name":"Wallhaven","link":"https://wallhaven.cc/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"4k图片网站"},{"name":"WALLPAPER ABYSS","link":"https://wall.alphacoders.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"WALLPAPER ABYSS"},{"name":"极简壁纸","link":"https://bz.zzzmh.cn/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"极简壁纸"},{"name":"Wallroom","link":"https://wallroom.io/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"Wallroom"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":""}],"Post":[{"title":"Docker私有仓库安装","date":"2022-10-14T05:21:01.000Z","keywords":"docker","description":"Docker私用仓库安装","cover":"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg","top_img":"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg","_content":"\n# Docker私有仓库安装\n\n> 注意：如果使用ubantu安装的docker，这个默认是通过snap安装的，它安装的权限只能控制当前用户的目录创建文件夹，例如：如果是root安装的docker，那么它只能在/root这个目录下创建文件夹，不能操纵/下的其他目录\n\n- 环境准备\n\n  | 序号 | 环境准备 | 版本         |\n  | ---- | -------- | ------------ |\n  | 1    | Ubantu   | 20.04_server |\n  | 2    | Docker   | 最新的       |\n  | 3    | registry | 最新的       |\n\n- docker安装\n\n  卸载旧版本\n\n  ```\n  apt-get remove docker docker-engine docker.io containerd runc\n  ```\n\n  安装前提依赖\n\n  ```\n  apt update\n  apt-get install ca-certificates curl gnupg lsb-release\n  ```\n\n  安装GPG证书\n\n  ```\n  curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -\n  ```\n\n  写入软件源信息\n\n  ```\n  add-apt-repository \"deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable\"\n  ```\n\n  安装最新版本\n\n  ```\n  apt-get install docker-ce docker-ce-cli containerd.io\n  ```\n\n  配置用户组\n\n  ```\n  groupadd docker\n  ```\n\n  启动docker\n\n  ```\n  systemctl start docker\n  ```\n\n  docker换源\n\n  ```\n  # 修改 /etc/docker/daemon.json (如果该文件不存在，则创建)\n  {\n      \"registry-mirrors\": [\n          \"https://hub-mirror.c.163.com\"\n  \t]\n  }\n  ```\n\n- 私有仓库搭建\n\n  查看registry版本\n\n  ```\n  docker search registry\n  ```\n\n  安装registry\n\n  ```\n  docker pull registry\n  ```\n\n  创建本地目录，用于映射本地目录进docker里，目的是，当容器崩溃时，数据还在，随时以启用一个新容器替换\n\n  ```\n  mkdir -p /data/dockerhub\n  ```\n\n  启动registry\n\n  ```\n  docker run -d -v /data/dockerhub:/var/lib/registry -p 5000:5000 --restart=always --name dockerhub-registry registry\n  ```\n\n  访问网址http://ip:5000/v2，如果出现以下页面说明正常\n\n  ```\n  [root@dockerhub250 ~]# curl http://ip:5000/v2/\n  {}\n  ```\n\n  server端daemon.json文件配置\n\n  ```json\n  {\n  \n  \"insecure-registries\":[\"sz-memect.tpddns.cn:5000\"]\n  \n  }\n  ```\n\n  client端daemon.json文件配置\n\n  ```\n  {\n  \n  \"insecure-registries\":[\"sz-memect.tpddns.cn:5000\"]\n  \n  }\n  ```\n\n  上传镜像至私有仓库\n\n  ```\n  [root@dockerhub250 ~]# docker images\n  REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\n  nginx               latest              4bb46517cac3        8 days ago          133MB\n  registry            latest              2d4f4b5309b1        2 months ago        26.2MB\n  #将要推送至私有仓库的docker镜像做标识\n  [root@dockerhub250 ~]# docker tag nginx:latest 172.16.1.250:5000/nginx:latest\n  [root@dockerhub250 ~]# docker images\n  REPOSITORY                TAG                 IMAGE ID            CREATED             SIZE\n  nginx                     latest              4bb46517cac3        8 days ago          133MB\n  172.16.1.250:5000/nginx   latest              4bb46517cac3        8 days ago          133MB\n  registry                  latest              2d4f4b5309b1        2 months ago        26.2MB\n  #通过 docker push 命令将 nginx 镜像 push到私有仓库\n  [root@dockerhub250 ~]# docker push 172.16.1.250:5000/nginx:latest\n  The push refers to repository [172.16.1.250:5000/nginx]\n  550333325e31: Pushed\n  22ea89b1a816: Pushed\n  a4d893caa5c9: Pushed\n  0338db614b95: Pushed\n  d0f104dc0a1f: Pushed\n  latest: digest: sha256:179412c42fe3336e7cdc253ad4a2e03d32f50e3037a860cf5edbeb1aaddb915c size: 1362\n  #查看是否上传成功\n  [root@dockerhub250 ~]# curl http://127.0.0.1:5000/v2/_catalog\n  {\"repositories\":[\"nginx\"]}\n  #查看镜像信息\n  [root@dockerhub250 ~]# curl http://172.16.1.250:5000/v2/nginx/tags/list\n  {\"name\":\"nginx\",\"tags\":[\"latest\"]}\n  ```\n\n  从其他内网机器验证拉取镜像\n\n  ```\n  [root@k8snode172 ~]# docker pull 172.16.1.250:5000/nginx\n  Using default tag: latest\n  latest: Pulling from nginx\n  bf5952930446: Pull complete\n  cb9a6de05e5a: Pull complete\n  9513ea0afb93: Pull complete\n  b49ea07d2e93: Pull complete\n  a5e4a503d449: Pull complete\n  Digest: sha256:179412c42fe3336e7cdc253ad4a2e03d32f50e3037a860cf5edbeb1aaddb915c\n  Status: Downloaded newer image for 172.16.1.250:5000/nginx:latest\n  172.16.1.250:5000/nginx:latest\n  [root@k8snode172 ~]# docker images\n  REPOSITORY                                  TAG                 IMAGE ID            CREATED             SIZE\n  172.16.1.250:5000/nginx                     latest              4bb46517cac3        8 days ago          133MB\n  ```\n\n  \n\n","source":"_posts/Docker私有仓库安装.md","raw":"---\ntitle: Docker私有仓库安装\ndate: 2022-10-14 13:21:01\ntags: docker\ncategories: 安装\nkeywords: docker\ndescription: Docker私用仓库安装\ncover: https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg\ntop_img: https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg\n---\n\n# Docker私有仓库安装\n\n> 注意：如果使用ubantu安装的docker，这个默认是通过snap安装的，它安装的权限只能控制当前用户的目录创建文件夹，例如：如果是root安装的docker，那么它只能在/root这个目录下创建文件夹，不能操纵/下的其他目录\n\n- 环境准备\n\n  | 序号 | 环境准备 | 版本         |\n  | ---- | -------- | ------------ |\n  | 1    | Ubantu   | 20.04_server |\n  | 2    | Docker   | 最新的       |\n  | 3    | registry | 最新的       |\n\n- docker安装\n\n  卸载旧版本\n\n  ```\n  apt-get remove docker docker-engine docker.io containerd runc\n  ```\n\n  安装前提依赖\n\n  ```\n  apt update\n  apt-get install ca-certificates curl gnupg lsb-release\n  ```\n\n  安装GPG证书\n\n  ```\n  curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -\n  ```\n\n  写入软件源信息\n\n  ```\n  add-apt-repository \"deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable\"\n  ```\n\n  安装最新版本\n\n  ```\n  apt-get install docker-ce docker-ce-cli containerd.io\n  ```\n\n  配置用户组\n\n  ```\n  groupadd docker\n  ```\n\n  启动docker\n\n  ```\n  systemctl start docker\n  ```\n\n  docker换源\n\n  ```\n  # 修改 /etc/docker/daemon.json (如果该文件不存在，则创建)\n  {\n      \"registry-mirrors\": [\n          \"https://hub-mirror.c.163.com\"\n  \t]\n  }\n  ```\n\n- 私有仓库搭建\n\n  查看registry版本\n\n  ```\n  docker search registry\n  ```\n\n  安装registry\n\n  ```\n  docker pull registry\n  ```\n\n  创建本地目录，用于映射本地目录进docker里，目的是，当容器崩溃时，数据还在，随时以启用一个新容器替换\n\n  ```\n  mkdir -p /data/dockerhub\n  ```\n\n  启动registry\n\n  ```\n  docker run -d -v /data/dockerhub:/var/lib/registry -p 5000:5000 --restart=always --name dockerhub-registry registry\n  ```\n\n  访问网址http://ip:5000/v2，如果出现以下页面说明正常\n\n  ```\n  [root@dockerhub250 ~]# curl http://ip:5000/v2/\n  {}\n  ```\n\n  server端daemon.json文件配置\n\n  ```json\n  {\n  \n  \"insecure-registries\":[\"sz-memect.tpddns.cn:5000\"]\n  \n  }\n  ```\n\n  client端daemon.json文件配置\n\n  ```\n  {\n  \n  \"insecure-registries\":[\"sz-memect.tpddns.cn:5000\"]\n  \n  }\n  ```\n\n  上传镜像至私有仓库\n\n  ```\n  [root@dockerhub250 ~]# docker images\n  REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\n  nginx               latest              4bb46517cac3        8 days ago          133MB\n  registry            latest              2d4f4b5309b1        2 months ago        26.2MB\n  #将要推送至私有仓库的docker镜像做标识\n  [root@dockerhub250 ~]# docker tag nginx:latest 172.16.1.250:5000/nginx:latest\n  [root@dockerhub250 ~]# docker images\n  REPOSITORY                TAG                 IMAGE ID            CREATED             SIZE\n  nginx                     latest              4bb46517cac3        8 days ago          133MB\n  172.16.1.250:5000/nginx   latest              4bb46517cac3        8 days ago          133MB\n  registry                  latest              2d4f4b5309b1        2 months ago        26.2MB\n  #通过 docker push 命令将 nginx 镜像 push到私有仓库\n  [root@dockerhub250 ~]# docker push 172.16.1.250:5000/nginx:latest\n  The push refers to repository [172.16.1.250:5000/nginx]\n  550333325e31: Pushed\n  22ea89b1a816: Pushed\n  a4d893caa5c9: Pushed\n  0338db614b95: Pushed\n  d0f104dc0a1f: Pushed\n  latest: digest: sha256:179412c42fe3336e7cdc253ad4a2e03d32f50e3037a860cf5edbeb1aaddb915c size: 1362\n  #查看是否上传成功\n  [root@dockerhub250 ~]# curl http://127.0.0.1:5000/v2/_catalog\n  {\"repositories\":[\"nginx\"]}\n  #查看镜像信息\n  [root@dockerhub250 ~]# curl http://172.16.1.250:5000/v2/nginx/tags/list\n  {\"name\":\"nginx\",\"tags\":[\"latest\"]}\n  ```\n\n  从其他内网机器验证拉取镜像\n\n  ```\n  [root@k8snode172 ~]# docker pull 172.16.1.250:5000/nginx\n  Using default tag: latest\n  latest: Pulling from nginx\n  bf5952930446: Pull complete\n  cb9a6de05e5a: Pull complete\n  9513ea0afb93: Pull complete\n  b49ea07d2e93: Pull complete\n  a5e4a503d449: Pull complete\n  Digest: sha256:179412c42fe3336e7cdc253ad4a2e03d32f50e3037a860cf5edbeb1aaddb915c\n  Status: Downloaded newer image for 172.16.1.250:5000/nginx:latest\n  172.16.1.250:5000/nginx:latest\n  [root@k8snode172 ~]# docker images\n  REPOSITORY                                  TAG                 IMAGE ID            CREATED             SIZE\n  172.16.1.250:5000/nginx                     latest              4bb46517cac3        8 days ago          133MB\n  ```\n\n  \n\n","slug":"Docker私有仓库安装","published":1,"updated":"2022-10-16T06:14:36.570Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clg1mfurt000127qg0lu193c6","content":"<h1 id=\"Docker私有仓库安装\"><a href=\"#Docker私有仓库安装\" class=\"headerlink\" title=\"Docker私有仓库安装\"></a>Docker私有仓库安装</h1><blockquote>\n<p>注意：如果使用ubantu安装的docker，这个默认是通过snap安装的，它安装的权限只能控制当前用户的目录创建文件夹，例如：如果是root安装的docker，那么它只能在&#x2F;root这个目录下创建文件夹，不能操纵&#x2F;下的其他目录</p>\n</blockquote>\n<ul>\n<li><p>环境准备</p>\n<table>\n<thead>\n<tr>\n<th>序号</th>\n<th>环境准备</th>\n<th>版本</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>Ubantu</td>\n<td>20.04_server</td>\n</tr>\n<tr>\n<td>2</td>\n<td>Docker</td>\n<td>最新的</td>\n</tr>\n<tr>\n<td>3</td>\n<td>registry</td>\n<td>最新的</td>\n</tr>\n</tbody></table>\n</li>\n<li><p>docker安装</p>\n<p>卸载旧版本</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get remove docker docker-engine docker.io containerd runc</span><br></pre></td></tr></table></figure>\n\n<p>安装前提依赖</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt update</span><br><span class=\"line\">apt-get install ca-certificates curl gnupg lsb-release</span><br></pre></td></tr></table></figure>\n\n<p>安装GPG证书</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -</span><br></pre></td></tr></table></figure>\n\n<p>写入软件源信息</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">add-apt-repository &quot;deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable&quot;</span><br></pre></td></tr></table></figure>\n\n<p>安装最新版本</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>\n\n<p>配置用户组</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">groupadd docker</span><br></pre></td></tr></table></figure>\n\n<p>启动docker</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl start docker</span><br></pre></td></tr></table></figure>\n\n<p>docker换源</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 修改 /etc/docker/daemon.json (如果该文件不存在，则创建)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;registry-mirrors&quot;: [</span><br><span class=\"line\">        &quot;https://hub-mirror.c.163.com&quot;</span><br><span class=\"line\">\t]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>私有仓库搭建</p>\n<p>查看registry版本</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker search registry</span><br></pre></td></tr></table></figure>\n\n<p>安装registry</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull registry</span><br></pre></td></tr></table></figure>\n\n<p>创建本地目录，用于映射本地目录进docker里，目的是，当容器崩溃时，数据还在，随时以启用一个新容器替换</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p /data/dockerhub</span><br></pre></td></tr></table></figure>\n\n<p>启动registry</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d -v /data/dockerhub:/var/lib/registry -p 5000:5000 --restart=always --name dockerhub-registry registry</span><br></pre></td></tr></table></figure>\n\n<p>访问网址<a href=\"http://ip:5000/v2%EF%BC%8C%E5%A6%82%E6%9E%9C%E5%87%BA%E7%8E%B0%E4%BB%A5%E4%B8%8B%E9%A1%B5%E9%9D%A2%E8%AF%B4%E6%98%8E%E6%AD%A3%E5%B8%B8\">http://ip:5000/v2，如果出现以下页面说明正常</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@dockerhub250 ~]# curl http://ip:5000/v2/</span><br><span class=\"line\">&#123;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>server端daemon.json文件配置</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">&quot;insecure-registries&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">[</span><span class=\"string\">&quot;sz-memect.tpddns.cn:5000&quot;</span><span class=\"punctuation\">]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>client端daemon.json文件配置</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&quot;insecure-registries&quot;:[&quot;sz-memect.tpddns.cn:5000&quot;]</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>上传镜像至私有仓库</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@dockerhub250 ~]# docker images</span><br><span class=\"line\">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class=\"line\">nginx               latest              4bb46517cac3        8 days ago          133MB</span><br><span class=\"line\">registry            latest              2d4f4b5309b1        2 months ago        26.2MB</span><br><span class=\"line\">#将要推送至私有仓库的docker镜像做标识</span><br><span class=\"line\">[root@dockerhub250 ~]# docker tag nginx:latest 172.16.1.250:5000/nginx:latest</span><br><span class=\"line\">[root@dockerhub250 ~]# docker images</span><br><span class=\"line\">REPOSITORY                TAG                 IMAGE ID            CREATED             SIZE</span><br><span class=\"line\">nginx                     latest              4bb46517cac3        8 days ago          133MB</span><br><span class=\"line\">172.16.1.250:5000/nginx   latest              4bb46517cac3        8 days ago          133MB</span><br><span class=\"line\">registry                  latest              2d4f4b5309b1        2 months ago        26.2MB</span><br><span class=\"line\">#通过 docker push 命令将 nginx 镜像 push到私有仓库</span><br><span class=\"line\">[root@dockerhub250 ~]# docker push 172.16.1.250:5000/nginx:latest</span><br><span class=\"line\">The push refers to repository [172.16.1.250:5000/nginx]</span><br><span class=\"line\">550333325e31: Pushed</span><br><span class=\"line\">22ea89b1a816: Pushed</span><br><span class=\"line\">a4d893caa5c9: Pushed</span><br><span class=\"line\">0338db614b95: Pushed</span><br><span class=\"line\">d0f104dc0a1f: Pushed</span><br><span class=\"line\">latest: digest: sha256:179412c42fe3336e7cdc253ad4a2e03d32f50e3037a860cf5edbeb1aaddb915c size: 1362</span><br><span class=\"line\">#查看是否上传成功</span><br><span class=\"line\">[root@dockerhub250 ~]# curl http://127.0.0.1:5000/v2/_catalog</span><br><span class=\"line\">&#123;&quot;repositories&quot;:[&quot;nginx&quot;]&#125;</span><br><span class=\"line\">#查看镜像信息</span><br><span class=\"line\">[root@dockerhub250 ~]# curl http://172.16.1.250:5000/v2/nginx/tags/list</span><br><span class=\"line\">&#123;&quot;name&quot;:&quot;nginx&quot;,&quot;tags&quot;:[&quot;latest&quot;]&#125;</span><br></pre></td></tr></table></figure>\n\n<p>从其他内网机器验证拉取镜像</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@k8snode172 ~]# docker pull 172.16.1.250:5000/nginx</span><br><span class=\"line\">Using default tag: latest</span><br><span class=\"line\">latest: Pulling from nginx</span><br><span class=\"line\">bf5952930446: Pull complete</span><br><span class=\"line\">cb9a6de05e5a: Pull complete</span><br><span class=\"line\">9513ea0afb93: Pull complete</span><br><span class=\"line\">b49ea07d2e93: Pull complete</span><br><span class=\"line\">a5e4a503d449: Pull complete</span><br><span class=\"line\">Digest: sha256:179412c42fe3336e7cdc253ad4a2e03d32f50e3037a860cf5edbeb1aaddb915c</span><br><span class=\"line\">Status: Downloaded newer image for 172.16.1.250:5000/nginx:latest</span><br><span class=\"line\">172.16.1.250:5000/nginx:latest</span><br><span class=\"line\">[root@k8snode172 ~]# docker images</span><br><span class=\"line\">REPOSITORY                                  TAG                 IMAGE ID            CREATED             SIZE</span><br><span class=\"line\">172.16.1.250:5000/nginx                     latest              4bb46517cac3        8 days ago          133MB</span><br></pre></td></tr></table></figure></li>\n</ul>\n","site":{"data":{"link":[{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"动漫图片和壁纸","link":"https://anime-pictures.net/?lang=zh_CN","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"图片网站"},{"name":"Wallhaven","link":"https://wallhaven.cc/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"4k图片网站"},{"name":"WALLPAPER ABYSS","link":"https://wall.alphacoders.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"WALLPAPER ABYSS"},{"name":"极简壁纸","link":"https://bz.zzzmh.cn/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"极简壁纸"},{"name":"Wallroom","link":"https://wallroom.io/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"Wallroom"}]}]}},"excerpt":"","more":"<h1 id=\"Docker私有仓库安装\"><a href=\"#Docker私有仓库安装\" class=\"headerlink\" title=\"Docker私有仓库安装\"></a>Docker私有仓库安装</h1><blockquote>\n<p>注意：如果使用ubantu安装的docker，这个默认是通过snap安装的，它安装的权限只能控制当前用户的目录创建文件夹，例如：如果是root安装的docker，那么它只能在&#x2F;root这个目录下创建文件夹，不能操纵&#x2F;下的其他目录</p>\n</blockquote>\n<ul>\n<li><p>环境准备</p>\n<table>\n<thead>\n<tr>\n<th>序号</th>\n<th>环境准备</th>\n<th>版本</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>Ubantu</td>\n<td>20.04_server</td>\n</tr>\n<tr>\n<td>2</td>\n<td>Docker</td>\n<td>最新的</td>\n</tr>\n<tr>\n<td>3</td>\n<td>registry</td>\n<td>最新的</td>\n</tr>\n</tbody></table>\n</li>\n<li><p>docker安装</p>\n<p>卸载旧版本</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get remove docker docker-engine docker.io containerd runc</span><br></pre></td></tr></table></figure>\n\n<p>安装前提依赖</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt update</span><br><span class=\"line\">apt-get install ca-certificates curl gnupg lsb-release</span><br></pre></td></tr></table></figure>\n\n<p>安装GPG证书</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -</span><br></pre></td></tr></table></figure>\n\n<p>写入软件源信息</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">add-apt-repository &quot;deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable&quot;</span><br></pre></td></tr></table></figure>\n\n<p>安装最新版本</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>\n\n<p>配置用户组</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">groupadd docker</span><br></pre></td></tr></table></figure>\n\n<p>启动docker</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl start docker</span><br></pre></td></tr></table></figure>\n\n<p>docker换源</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 修改 /etc/docker/daemon.json (如果该文件不存在，则创建)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;registry-mirrors&quot;: [</span><br><span class=\"line\">        &quot;https://hub-mirror.c.163.com&quot;</span><br><span class=\"line\">\t]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>私有仓库搭建</p>\n<p>查看registry版本</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker search registry</span><br></pre></td></tr></table></figure>\n\n<p>安装registry</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull registry</span><br></pre></td></tr></table></figure>\n\n<p>创建本地目录，用于映射本地目录进docker里，目的是，当容器崩溃时，数据还在，随时以启用一个新容器替换</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p /data/dockerhub</span><br></pre></td></tr></table></figure>\n\n<p>启动registry</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d -v /data/dockerhub:/var/lib/registry -p 5000:5000 --restart=always --name dockerhub-registry registry</span><br></pre></td></tr></table></figure>\n\n<p>访问网址<a href=\"http://ip:5000/v2%EF%BC%8C%E5%A6%82%E6%9E%9C%E5%87%BA%E7%8E%B0%E4%BB%A5%E4%B8%8B%E9%A1%B5%E9%9D%A2%E8%AF%B4%E6%98%8E%E6%AD%A3%E5%B8%B8\">http://ip:5000/v2，如果出现以下页面说明正常</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@dockerhub250 ~]# curl http://ip:5000/v2/</span><br><span class=\"line\">&#123;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>server端daemon.json文件配置</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">&quot;insecure-registries&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">[</span><span class=\"string\">&quot;sz-memect.tpddns.cn:5000&quot;</span><span class=\"punctuation\">]</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>client端daemon.json文件配置</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&quot;insecure-registries&quot;:[&quot;sz-memect.tpddns.cn:5000&quot;]</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>上传镜像至私有仓库</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@dockerhub250 ~]# docker images</span><br><span class=\"line\">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class=\"line\">nginx               latest              4bb46517cac3        8 days ago          133MB</span><br><span class=\"line\">registry            latest              2d4f4b5309b1        2 months ago        26.2MB</span><br><span class=\"line\">#将要推送至私有仓库的docker镜像做标识</span><br><span class=\"line\">[root@dockerhub250 ~]# docker tag nginx:latest 172.16.1.250:5000/nginx:latest</span><br><span class=\"line\">[root@dockerhub250 ~]# docker images</span><br><span class=\"line\">REPOSITORY                TAG                 IMAGE ID            CREATED             SIZE</span><br><span class=\"line\">nginx                     latest              4bb46517cac3        8 days ago          133MB</span><br><span class=\"line\">172.16.1.250:5000/nginx   latest              4bb46517cac3        8 days ago          133MB</span><br><span class=\"line\">registry                  latest              2d4f4b5309b1        2 months ago        26.2MB</span><br><span class=\"line\">#通过 docker push 命令将 nginx 镜像 push到私有仓库</span><br><span class=\"line\">[root@dockerhub250 ~]# docker push 172.16.1.250:5000/nginx:latest</span><br><span class=\"line\">The push refers to repository [172.16.1.250:5000/nginx]</span><br><span class=\"line\">550333325e31: Pushed</span><br><span class=\"line\">22ea89b1a816: Pushed</span><br><span class=\"line\">a4d893caa5c9: Pushed</span><br><span class=\"line\">0338db614b95: Pushed</span><br><span class=\"line\">d0f104dc0a1f: Pushed</span><br><span class=\"line\">latest: digest: sha256:179412c42fe3336e7cdc253ad4a2e03d32f50e3037a860cf5edbeb1aaddb915c size: 1362</span><br><span class=\"line\">#查看是否上传成功</span><br><span class=\"line\">[root@dockerhub250 ~]# curl http://127.0.0.1:5000/v2/_catalog</span><br><span class=\"line\">&#123;&quot;repositories&quot;:[&quot;nginx&quot;]&#125;</span><br><span class=\"line\">#查看镜像信息</span><br><span class=\"line\">[root@dockerhub250 ~]# curl http://172.16.1.250:5000/v2/nginx/tags/list</span><br><span class=\"line\">&#123;&quot;name&quot;:&quot;nginx&quot;,&quot;tags&quot;:[&quot;latest&quot;]&#125;</span><br></pre></td></tr></table></figure>\n\n<p>从其他内网机器验证拉取镜像</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@k8snode172 ~]# docker pull 172.16.1.250:5000/nginx</span><br><span class=\"line\">Using default tag: latest</span><br><span class=\"line\">latest: Pulling from nginx</span><br><span class=\"line\">bf5952930446: Pull complete</span><br><span class=\"line\">cb9a6de05e5a: Pull complete</span><br><span class=\"line\">9513ea0afb93: Pull complete</span><br><span class=\"line\">b49ea07d2e93: Pull complete</span><br><span class=\"line\">a5e4a503d449: Pull complete</span><br><span class=\"line\">Digest: sha256:179412c42fe3336e7cdc253ad4a2e03d32f50e3037a860cf5edbeb1aaddb915c</span><br><span class=\"line\">Status: Downloaded newer image for 172.16.1.250:5000/nginx:latest</span><br><span class=\"line\">172.16.1.250:5000/nginx:latest</span><br><span class=\"line\">[root@k8snode172 ~]# docker images</span><br><span class=\"line\">REPOSITORY                                  TAG                 IMAGE ID            CREATED             SIZE</span><br><span class=\"line\">172.16.1.250:5000/nginx                     latest              4bb46517cac3        8 days ago          133MB</span><br></pre></td></tr></table></figure></li>\n</ul>\n"},{"title":"Harbor安装","date":"2022-10-14T06:11:01.000Z","keywords":"Harbor","description":"Harbor安装","cover":"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg","top_img":"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg","_content":"\n# Harbor安装\n\n| 序号 | 环境准备       | 版本         |\n| ---- | -------------- | ------------ |\n| 1    | Ubantu         | 20.04_server |\n| 2    | docker         | 最新         |\n| 3    | Docker-compose | 最新         |\n\n\n\n- [harbor项目地址](https://github.com/goharbor/harbor)\n\n  ![image-20221014113448665](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221014113448665.png)\n\n下载harbor-online-install-v2.6.1.tgz，这个会在安装的时候从公网上下载一些必要的工具\n\n如果使用的是harbor-offline-install-v2.6.1.tgz，那么建议提前将一些harbor集成的工具准备好，不然可能会安装失败\n\n解压harbor-online-install-v2.6.1.tgz\n\n```\ntar -zxvf harbor-online-install-v2.6.1.tgz\n```\n\nharbor默认工作方式是http，但是这只能在页面访问，默认harbor推送拉取镜像时走的是https，所以需要配置下https，一下是默认用ip地址去配置的\n\n```\n# 所有操作都是在临时文件夹 ~/ssl 下操作\nmkdir ~/ssl \n\n# 生成生成CA证书私钥\nopenssl genrsa -out ca.key 4096\n\n# 生成CA证书\nopenssl req -x509 -new -nodes -sha512 -days 3650 \\\n -subj \"/C=CN/ST=Shenzhen/L=Shenzhen/O=example/OU=Personal/CN=192.168.50.21\" \\\n -key ca.key \\\n -out ca.crt\n \n # 生成服务器证书-----生成私钥\n openssl genrsa -out 192.168.50.21.key 4096\n \n \n # 生成服务器证书-----生成证书签名请求（CSR）\n openssl req -sha512 -new \\\n    -subj \"/C=CN/ST=Shenzhen/L=Shenzhen/O=example/OU=Personal/CN=192.168.50.21\" \\\n    -key 192.168.50.21.key \\\n    -out 192.168.50.21.csr\n\n\n# 生成服务器证书-----生成一个x509 v3扩展文件\ncat > v3.ext <<-EOF\nauthorityKeyIdentifier=keyid,issuer\nbasicConstraints=CA:FALSE\nkeyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment\nextendedKeyUsage = serverAuth\nsubjectAltName = IP:192.168.50.21\nEOF\n\n\n# 生成服务器证书-----使用该v3.ext文件为您的Harbor主机生成证书\nopenssl x509 -req -sha512 -days 3650 \\\n    -extfile v3.ext \\\n    -CA ca.crt -CAkey ca.key -CAcreateserial \\\n    -in 192.168.50.21.csr \\\n    -out 192.168.50.21.crt\n\n\n# 将服务器证书和密钥复制到Harbor主机上的/data/cert/文件夹中\nmkdir -p /data/cert/\ncp 192.168.50.21.crt /data/cert/\ncp 192.168.50.21.key /data/cert/\n\n\n# 转换192.168.50.21.crt为192.168.50.21.cert，供Docker使用\nopenssl x509 -inform PEM -in 192.168.50.21.crt -out 192.168.50.21.cert\n\n\n# 将服务器证书，密钥和CA文件复制到Harbor主机上的Docker证书文件夹中。您必须首先创建适当的文件夹\n# 这个是使用4433端口，不用443端口的操作\nmkdir -p /etc/docker/certs.d/192.168.50.21:4433/\ncp 192.168.50.21.cert /etc/docker/certs.d/192.168.50.21:4433/\ncp 192.168.50.21.key /etc/docker/certs.d/192.168.50.21:4433/\ncp ca.crt /etc/docker/certs.d/192.168.50.21:4433/\n\n#如果将默认nginx端口443 映射到其他端口，请创建文件夹\n#/etc/docker/certs.d/yourdomain.com:port或/etc/docker/certs.d/harbor_IP:port\n\n\n```\n\nharbor用域名的形式配置\n\n```\n# 所有操作都是在临时文件夹 ~/ssl 下操作\nmkdir ~/ssl \n\n# 生成生成CA证书私钥\nopenssl genrsa -out ca.key 4096\n\n# 生成CA证书\nopenssl req -x509 -new -nodes -sha512 -days 3650 \\\n -subj \"/C=CN/ST=Shenzhen/L=Shenzhen/O=example/OU=Personal/CN=域名\" \\\n -key ca.key \\\n -out ca.crt\n \n # 生成服务器证书-----生成私钥\n openssl genrsa -out 域名.key 4096\n \n \n # 生成服务器证书-----生成证书签名请求（CSR）\n openssl req -sha512 -new \\\n    -subj \"/C=CN/ST=Shenzhen/L=Shenzhen/O=example/OU=Personal/CN=域名\" \\\n    -key 域名.key \\\n    -out 192.168.50.21.csr\n\n\n# 生成服务器证书-----生成一个x509 v3扩展文件\ncat > v3.ext <<-EOF\nauthorityKeyIdentifier=keyid,issuer\nbasicConstraints=CA:FALSE\nkeyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment\nextendedKeyUsage = serverAuth\nsubjectAltName = IP:192.168.50.21\nEOF\n\n\n# 生成服务器证书-----使用该v3.ext文件为您的Harbor主机生成证书\nopenssl x509 -req -sha512 -days 3650 \\\n    -extfile v3.ext \\\n    -CA ca.crt -CAkey ca.key -CAcreateserial \\\n    -in 域名.csr \\\n    -out 域名.crt\n\n\n# 将服务器证书和密钥复制到Harbor主机上的/data/cert/文件夹中\nmkdir -p /data/cert/\ncp 域名.crt /data/cert/\ncp 域名.key /data/cert/\n\n\n# 转换域名.crt为域名.cert，供Docker使用\nopenssl x509 -inform PEM -in 域名.crt -out 域名.cert\n\n\n# 将服务器证书，密钥和CA文件复制到Harbor主机上的Docker证书文件夹中。您必须首先创建适当的文件夹\n# 这个是使用4433端口，不用443端口的操作\nmkdir -p /etc/docker/certs.d/域名:4433/\ncp 192.168.50.21.cert /etc/docker/certs.d/域名:4433/\ncp 192.168.50.21.key /etc/docker/certs.d/域名:4433/\ncp ca.crt /etc/docker/certs.d/域名:4433/\n\n#如果将默认nginx端口443 映射到其他端口，请创建文件夹\n#/etc/docker/certs.d/yourdomain.com:port或/etc/docker/certs.d/harbor_IP:port\n\n\n```\n\n修改harbor.yml\n\n```\nmv harbor.yml.tmpl harbor.yml\nvim harbor.yml\n```\n\n```yml\n# Configuration file of Harbor\n\n# The IP address or hostname to access admin UI and registry service.\n# DO NOT use localhost or 127.0.0.1, because Harbor needs to be accessed by external clients.\nhostname: 192.168.50.21\n\n# http related config\nhttp:\n  # port for http, default is 80. If https enabled, this port will redirect to https port\n  port: 8099\n\n# https related config\nhttps:\n  # https port for harbor, default is 443\n  port: 4433\n  # The path of cert and key files for nginx\n  certificate: /data/cert/192.168.50.21.crt\n  private_key: /data/cert/192.168.50.21.key\n\n# # Uncomment following will enable tls communication between all harbor components\n# internal_tls:\n#   # set enabled to true means internal tls is enabled\n#   enabled: true\n#   # put your cert and key files on dir\n#   dir: /etc/harbor/tls/internal\n\n# Uncomment external_url if you want to enable external proxy\n# And when it enabled the hostname will no longer used\n# external_url: https://reg.mydomain.com:8433\n\n# The initial password of Harbor admin\n# It only works in first time to install harbor\n# Remember Change the admin password from UI after launching Harbor.\nharbor_admin_password: admin123\n\n# Harbor DB configuration\ndatabase:\n  # The password for the root user of Harbor DB. Change this before any production use.\n  password: root123\n  # The maximum number of connections in the idle connection pool. If it <=0, no idle connections are retained.\n  max_idle_conns: 100\n  # The maximum number of open connections to the database. If it <= 0, then there is no limit on the number of open connections.\n  # Note: the default number of connections is 1024 for postgres of harbor.\n  max_open_conns: 900\n\n# The default data volume\ndata_volume: /data\n\n# Harbor Storage settings by default is using /data dir on local filesystem\n# Uncomment storage_service setting If you want to using external storage\n# storage_service:\n#   # ca_bundle is the path to the custom root ca certificate, which will be injected into the truststore\n#   # of registry's and chart repository's containers.  This is usually needed when the user hosts a internal storage with self signed certificate.\n#   ca_bundle:\n\n#   # storage backend, default is filesystem, options include filesystem, azure, gcs, s3, swift and oss\n#   # for more info about this configuration please refer https://docs.docker.com/registry/configuration/\n#   filesystem:\n#     maxthreads: 100\n#   # set disable to true when you want to disable registry redirect\n#   redirect:\n#     disabled: false\n\n# Trivy configuration\n#\n# Trivy DB contains vulnerability information from NVD, Red Hat, and many other upstream vulnerability databases.\n# It is downloaded by Trivy from the GitHub release page https://github.com/aquasecurity/trivy-db/releases and cached\n# in the local file system. In addition, the database contains the update timestamp so Trivy can detect whether it\n# should download a newer version from the Internet or use the cached one. Currently, the database is updated every\n# 12 hours and published as a new release to GitHub.\ntrivy:\n  # ignoreUnfixed The flag to display only fixed vulnerabilities\n  ignore_unfixed: false\n  # skipUpdate The flag to enable or disable Trivy DB downloads from GitHub\n  #\n  # You might want to enable this flag in test or CI/CD environments to avoid GitHub rate limiting issues.\n  # If the flag is enabled you have to download the `trivy-offline.tar.gz` archive manually, extract `trivy.db` and\n  # `metadata.json` files and mount them in the `/home/scanner/.cache/trivy/db` path.\n  skip_update: false\n  #\n  # The offline_scan option prevents Trivy from sending API requests to identify dependencies.\n  # Scanning JAR files and pom.xml may require Internet access for better detection, but this option tries to avoid it.\n  # For example, the offline mode will not try to resolve transitive dependencies in pom.xml when the dependency doesn't\n  # exist in the local repositories. It means a number of detected vulnerabilities might be fewer in offline mode.\n  # It would work if all the dependencies are in local.\n  # This option doesn’t affect DB download. You need to specify \"skip-update\" as well as \"offline-scan\" in an air-gapped environment.\n  offline_scan: false\n  #\n  # insecure The flag to skip verifying registry certificate\n  insecure: false\n  # github_token The GitHub access token to download Trivy DB\n  #\n  # Anonymous downloads from GitHub are subject to the limit of 60 requests per hour. Normally such rate limit is enough\n  # for production operations. If, for any reason, it's not enough, you could increase the rate limit to 5000\n  # requests per hour by specifying the GitHub access token. For more details on GitHub rate limiting please consult\n  # https://developer.github.com/v3/#rate-limiting\n  #\n  # You can create a GitHub token by following the instructions in\n  # https://help.github.com/en/github/authenticating-to-github/creating-a-personal-access-token-for-the-command-line\n  #\n  # github_token: xxx\n\njobservice:\n  # Maximum number of job workers in job service\n  max_job_workers: 10\n\nnotification:\n  # Maximum retry count for webhook job\n  webhook_job_max_retry: 10\n\nchart:\n  # Change the value of absolute_url to enabled can enable absolute url in chart\n  absolute_url: disabled\n\n# Log configurations\nlog:\n  # options are debug, info, warning, error, fatal\n  level: info\n  # configs for logs in local storage\n  local:\n    # Log files are rotated log_rotate_count times before being removed. If count is 0, old versions are removed rather than rotated.\n    rotate_count: 50\n    # Log files are rotated only if they grow bigger than log_rotate_size bytes. If size is followed by k, the size is assumed to be in kilobytes.\n    # If the M is used, the size is in megabytes, and if G is used, the size is in gigabytes. So size 100, size 100k, size 100M and size 100G\n    # are all valid.\n    rotate_size: 200M\n    # The directory on your host that store log\n    location: /var/log/harbor\n\n  # Uncomment following lines to enable external syslog endpoint.\n  # external_endpoint:\n  #   # protocol used to transmit log to external endpoint, options is tcp or udp\n  #   protocol: tcp\n  #   # The host of external endpoint\n  #   host: localhost\n  #   # Port of external endpoint\n  #   port: 5140\n\n#This attribute is for migrator to detect the version of the .cfg file, DO NOT MODIFY!\n_version: 2.5.0\n\n# Uncomment external_database if using external database.\n# external_database:\n#   harbor:\n#     host: harbor_db_host\n#     port: harbor_db_port\n#     db_name: harbor_db_name\n#     username: harbor_db_username\n#     password: harbor_db_password\n#     ssl_mode: disable\n#     max_idle_conns: 2\n#     max_open_conns: 0\n#   notary_signer:\n#     host: notary_signer_db_host\n#     port: notary_signer_db_port\n#     db_name: notary_signer_db_name\n#     username: notary_signer_db_username\n#     password: notary_signer_db_password\n#     ssl_mode: disable\n#   notary_server:\n#     host: notary_server_db_host\n#     port: notary_server_db_port\n#     db_name: notary_server_db_name\n#     username: notary_server_db_username\n#     password: notary_server_db_password\n#     ssl_mode: disable\n\n# Uncomment external_redis if using external Redis server\n# external_redis:\n#   # support redis, redis+sentinel\n#   # host for redis: <host_redis>:<port_redis>\n#   # host for redis+sentinel:\n#   #  <host_sentinel1>:<port_sentinel1>,<host_sentinel2>:<port_sentinel2>,<host_sentinel3>:<port_sentinel3>\n#   host: redis:6379\n#   password: \n#   # sentinel_master_set must be set to support redis+sentinel\n#   #sentinel_master_set:\n#   # db_index 0 is for core, it's unchangeable\n#   registry_db_index: 1\n#   jobservice_db_index: 2\n#   chartmuseum_db_index: 3\n#   trivy_db_index: 5\n#   idle_timeout_seconds: 30\n\n# Uncomment uaa for trusting the certificate of uaa instance that is hosted via self-signed cert.\n# uaa:\n#   ca_file: /path/to/ca\n\n# Global proxy\n# Config http proxy for components, e.g. http://my.proxy.com:3128\n# Components doesn't need to connect to each others via http proxy.\n# Remove component from `components` array if want disable proxy\n# for it. If you want use proxy for replication, MUST enable proxy\n# for core and jobservice, and set `http_proxy` and `https_proxy`.\n# Add domain to the `no_proxy` field, when you want disable proxy\n# for some special registry.\nproxy:\n  http_proxy:\n  https_proxy:\n  no_proxy:\n  components:\n    - core\n    - jobservice\n    - trivy\n\n# metric:\n#   enabled: false\n#   port: 9090\n#   path: /metrics\n\n# Trace related config\n# only can enable one trace provider(jaeger or otel) at the same time,\n# and when using jaeger as provider, can only enable it with agent mode or collector mode.\n# if using jaeger collector mode, uncomment endpoint and uncomment username, password if needed\n# if using jaeger agetn mode uncomment agent_host and agent_port\n# trace:\n#   enabled: true\n#   # set sample_rate to 1 if you wanna sampling 100% of trace data; set 0.5 if you wanna sampling 50% of trace data, and so forth\n#   sample_rate: 1\n#   # # namespace used to differenciate different harbor services\n#   # namespace:\n#   # # attributes is a key value dict contains user defined attributes used to initialize trace provider\n#   # attributes:\n#   #   application: harbor\n#   # # jaeger should be 1.26 or newer.\n#   # jaeger:\n#   #   endpoint: http://hostname:14268/api/traces\n#   #   username:\n#   #   password:\n#   #   agent_host: hostname\n#   #   # export trace data by jaeger.thrift in compact mode\n#   #   agent_port: 6831\n#   # otel:\n#   #   endpoint: hostname:4318\n#   #   url_path: /v1/traces\n#   #   compression: false\n#   #   insecure: true\n#   #   timeout: 10s\n\n# enable purge _upload directories\nupload_purging:\n  enabled: true\n  # remove files in _upload directories which exist for a period of time, default is one week.\n  age: 168h\n  # the interval of the purge operations\n  interval: 24h\n  dryrun: false\n```\n\nharbor登录\n\n```\nsz-memect.tpddns.cn:4433\n账号：admin\n密码：admin123\n```\n\nharbor卸载\n\n```\n rm -rf `find / -name harbor`\n 删除容器\n docker rmi $(docker images -q)\n```\n\n另外一台机器拉取和推送镜像\n\n```\nmkdir /etc/docker/certs.d/192.168.50.21:4433\n```\n\n然后后从 Harbor 主机拷贝证书文件到 Docker 客户端上，需要 server 的证书和密钥以及 CA 证书。\n\n```\nscp /data/cert/192.168.50.21.key  root@192.168.50.20:/etc/docker/certs.d/192.168.50.21:4433\nscp /data/cert/192.168.50.21.cert  root@192.168.50.20:/etc/docker/certs.d/192.168.50.21:4433\nscp /data/cert/ca.crt  root@192.168.50.20:/etc/docker/certs.d/192.168.50.21:4433\n```\n\n拉取命令\n\n```\ndocker pull 192.168.50.21:4433/library/mysql:latest\n```\n\n推送镜像\n\n```\n# 打tag\ndocker tag mongo:latest 192.168.50.21:4433/library/mongo:latest\n\n# 推送镜像\ndocker push 192.168.50.21:4433/library/mongo:latest\n```\n\n","source":"_posts/Harbor安装.md","raw":"---\ntitle: Harbor安装\ndate: 2022-10-14 14:11:01\ntags: Harbor\ncategories: 安装\nkeywords: Harbor\ndescription: Harbor安装\ncover: https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg\ntop_img: https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg\n---\n\n# Harbor安装\n\n| 序号 | 环境准备       | 版本         |\n| ---- | -------------- | ------------ |\n| 1    | Ubantu         | 20.04_server |\n| 2    | docker         | 最新         |\n| 3    | Docker-compose | 最新         |\n\n\n\n- [harbor项目地址](https://github.com/goharbor/harbor)\n\n  ![image-20221014113448665](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221014113448665.png)\n\n下载harbor-online-install-v2.6.1.tgz，这个会在安装的时候从公网上下载一些必要的工具\n\n如果使用的是harbor-offline-install-v2.6.1.tgz，那么建议提前将一些harbor集成的工具准备好，不然可能会安装失败\n\n解压harbor-online-install-v2.6.1.tgz\n\n```\ntar -zxvf harbor-online-install-v2.6.1.tgz\n```\n\nharbor默认工作方式是http，但是这只能在页面访问，默认harbor推送拉取镜像时走的是https，所以需要配置下https，一下是默认用ip地址去配置的\n\n```\n# 所有操作都是在临时文件夹 ~/ssl 下操作\nmkdir ~/ssl \n\n# 生成生成CA证书私钥\nopenssl genrsa -out ca.key 4096\n\n# 生成CA证书\nopenssl req -x509 -new -nodes -sha512 -days 3650 \\\n -subj \"/C=CN/ST=Shenzhen/L=Shenzhen/O=example/OU=Personal/CN=192.168.50.21\" \\\n -key ca.key \\\n -out ca.crt\n \n # 生成服务器证书-----生成私钥\n openssl genrsa -out 192.168.50.21.key 4096\n \n \n # 生成服务器证书-----生成证书签名请求（CSR）\n openssl req -sha512 -new \\\n    -subj \"/C=CN/ST=Shenzhen/L=Shenzhen/O=example/OU=Personal/CN=192.168.50.21\" \\\n    -key 192.168.50.21.key \\\n    -out 192.168.50.21.csr\n\n\n# 生成服务器证书-----生成一个x509 v3扩展文件\ncat > v3.ext <<-EOF\nauthorityKeyIdentifier=keyid,issuer\nbasicConstraints=CA:FALSE\nkeyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment\nextendedKeyUsage = serverAuth\nsubjectAltName = IP:192.168.50.21\nEOF\n\n\n# 生成服务器证书-----使用该v3.ext文件为您的Harbor主机生成证书\nopenssl x509 -req -sha512 -days 3650 \\\n    -extfile v3.ext \\\n    -CA ca.crt -CAkey ca.key -CAcreateserial \\\n    -in 192.168.50.21.csr \\\n    -out 192.168.50.21.crt\n\n\n# 将服务器证书和密钥复制到Harbor主机上的/data/cert/文件夹中\nmkdir -p /data/cert/\ncp 192.168.50.21.crt /data/cert/\ncp 192.168.50.21.key /data/cert/\n\n\n# 转换192.168.50.21.crt为192.168.50.21.cert，供Docker使用\nopenssl x509 -inform PEM -in 192.168.50.21.crt -out 192.168.50.21.cert\n\n\n# 将服务器证书，密钥和CA文件复制到Harbor主机上的Docker证书文件夹中。您必须首先创建适当的文件夹\n# 这个是使用4433端口，不用443端口的操作\nmkdir -p /etc/docker/certs.d/192.168.50.21:4433/\ncp 192.168.50.21.cert /etc/docker/certs.d/192.168.50.21:4433/\ncp 192.168.50.21.key /etc/docker/certs.d/192.168.50.21:4433/\ncp ca.crt /etc/docker/certs.d/192.168.50.21:4433/\n\n#如果将默认nginx端口443 映射到其他端口，请创建文件夹\n#/etc/docker/certs.d/yourdomain.com:port或/etc/docker/certs.d/harbor_IP:port\n\n\n```\n\nharbor用域名的形式配置\n\n```\n# 所有操作都是在临时文件夹 ~/ssl 下操作\nmkdir ~/ssl \n\n# 生成生成CA证书私钥\nopenssl genrsa -out ca.key 4096\n\n# 生成CA证书\nopenssl req -x509 -new -nodes -sha512 -days 3650 \\\n -subj \"/C=CN/ST=Shenzhen/L=Shenzhen/O=example/OU=Personal/CN=域名\" \\\n -key ca.key \\\n -out ca.crt\n \n # 生成服务器证书-----生成私钥\n openssl genrsa -out 域名.key 4096\n \n \n # 生成服务器证书-----生成证书签名请求（CSR）\n openssl req -sha512 -new \\\n    -subj \"/C=CN/ST=Shenzhen/L=Shenzhen/O=example/OU=Personal/CN=域名\" \\\n    -key 域名.key \\\n    -out 192.168.50.21.csr\n\n\n# 生成服务器证书-----生成一个x509 v3扩展文件\ncat > v3.ext <<-EOF\nauthorityKeyIdentifier=keyid,issuer\nbasicConstraints=CA:FALSE\nkeyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment\nextendedKeyUsage = serverAuth\nsubjectAltName = IP:192.168.50.21\nEOF\n\n\n# 生成服务器证书-----使用该v3.ext文件为您的Harbor主机生成证书\nopenssl x509 -req -sha512 -days 3650 \\\n    -extfile v3.ext \\\n    -CA ca.crt -CAkey ca.key -CAcreateserial \\\n    -in 域名.csr \\\n    -out 域名.crt\n\n\n# 将服务器证书和密钥复制到Harbor主机上的/data/cert/文件夹中\nmkdir -p /data/cert/\ncp 域名.crt /data/cert/\ncp 域名.key /data/cert/\n\n\n# 转换域名.crt为域名.cert，供Docker使用\nopenssl x509 -inform PEM -in 域名.crt -out 域名.cert\n\n\n# 将服务器证书，密钥和CA文件复制到Harbor主机上的Docker证书文件夹中。您必须首先创建适当的文件夹\n# 这个是使用4433端口，不用443端口的操作\nmkdir -p /etc/docker/certs.d/域名:4433/\ncp 192.168.50.21.cert /etc/docker/certs.d/域名:4433/\ncp 192.168.50.21.key /etc/docker/certs.d/域名:4433/\ncp ca.crt /etc/docker/certs.d/域名:4433/\n\n#如果将默认nginx端口443 映射到其他端口，请创建文件夹\n#/etc/docker/certs.d/yourdomain.com:port或/etc/docker/certs.d/harbor_IP:port\n\n\n```\n\n修改harbor.yml\n\n```\nmv harbor.yml.tmpl harbor.yml\nvim harbor.yml\n```\n\n```yml\n# Configuration file of Harbor\n\n# The IP address or hostname to access admin UI and registry service.\n# DO NOT use localhost or 127.0.0.1, because Harbor needs to be accessed by external clients.\nhostname: 192.168.50.21\n\n# http related config\nhttp:\n  # port for http, default is 80. If https enabled, this port will redirect to https port\n  port: 8099\n\n# https related config\nhttps:\n  # https port for harbor, default is 443\n  port: 4433\n  # The path of cert and key files for nginx\n  certificate: /data/cert/192.168.50.21.crt\n  private_key: /data/cert/192.168.50.21.key\n\n# # Uncomment following will enable tls communication between all harbor components\n# internal_tls:\n#   # set enabled to true means internal tls is enabled\n#   enabled: true\n#   # put your cert and key files on dir\n#   dir: /etc/harbor/tls/internal\n\n# Uncomment external_url if you want to enable external proxy\n# And when it enabled the hostname will no longer used\n# external_url: https://reg.mydomain.com:8433\n\n# The initial password of Harbor admin\n# It only works in first time to install harbor\n# Remember Change the admin password from UI after launching Harbor.\nharbor_admin_password: admin123\n\n# Harbor DB configuration\ndatabase:\n  # The password for the root user of Harbor DB. Change this before any production use.\n  password: root123\n  # The maximum number of connections in the idle connection pool. If it <=0, no idle connections are retained.\n  max_idle_conns: 100\n  # The maximum number of open connections to the database. If it <= 0, then there is no limit on the number of open connections.\n  # Note: the default number of connections is 1024 for postgres of harbor.\n  max_open_conns: 900\n\n# The default data volume\ndata_volume: /data\n\n# Harbor Storage settings by default is using /data dir on local filesystem\n# Uncomment storage_service setting If you want to using external storage\n# storage_service:\n#   # ca_bundle is the path to the custom root ca certificate, which will be injected into the truststore\n#   # of registry's and chart repository's containers.  This is usually needed when the user hosts a internal storage with self signed certificate.\n#   ca_bundle:\n\n#   # storage backend, default is filesystem, options include filesystem, azure, gcs, s3, swift and oss\n#   # for more info about this configuration please refer https://docs.docker.com/registry/configuration/\n#   filesystem:\n#     maxthreads: 100\n#   # set disable to true when you want to disable registry redirect\n#   redirect:\n#     disabled: false\n\n# Trivy configuration\n#\n# Trivy DB contains vulnerability information from NVD, Red Hat, and many other upstream vulnerability databases.\n# It is downloaded by Trivy from the GitHub release page https://github.com/aquasecurity/trivy-db/releases and cached\n# in the local file system. In addition, the database contains the update timestamp so Trivy can detect whether it\n# should download a newer version from the Internet or use the cached one. Currently, the database is updated every\n# 12 hours and published as a new release to GitHub.\ntrivy:\n  # ignoreUnfixed The flag to display only fixed vulnerabilities\n  ignore_unfixed: false\n  # skipUpdate The flag to enable or disable Trivy DB downloads from GitHub\n  #\n  # You might want to enable this flag in test or CI/CD environments to avoid GitHub rate limiting issues.\n  # If the flag is enabled you have to download the `trivy-offline.tar.gz` archive manually, extract `trivy.db` and\n  # `metadata.json` files and mount them in the `/home/scanner/.cache/trivy/db` path.\n  skip_update: false\n  #\n  # The offline_scan option prevents Trivy from sending API requests to identify dependencies.\n  # Scanning JAR files and pom.xml may require Internet access for better detection, but this option tries to avoid it.\n  # For example, the offline mode will not try to resolve transitive dependencies in pom.xml when the dependency doesn't\n  # exist in the local repositories. It means a number of detected vulnerabilities might be fewer in offline mode.\n  # It would work if all the dependencies are in local.\n  # This option doesn’t affect DB download. You need to specify \"skip-update\" as well as \"offline-scan\" in an air-gapped environment.\n  offline_scan: false\n  #\n  # insecure The flag to skip verifying registry certificate\n  insecure: false\n  # github_token The GitHub access token to download Trivy DB\n  #\n  # Anonymous downloads from GitHub are subject to the limit of 60 requests per hour. Normally such rate limit is enough\n  # for production operations. If, for any reason, it's not enough, you could increase the rate limit to 5000\n  # requests per hour by specifying the GitHub access token. For more details on GitHub rate limiting please consult\n  # https://developer.github.com/v3/#rate-limiting\n  #\n  # You can create a GitHub token by following the instructions in\n  # https://help.github.com/en/github/authenticating-to-github/creating-a-personal-access-token-for-the-command-line\n  #\n  # github_token: xxx\n\njobservice:\n  # Maximum number of job workers in job service\n  max_job_workers: 10\n\nnotification:\n  # Maximum retry count for webhook job\n  webhook_job_max_retry: 10\n\nchart:\n  # Change the value of absolute_url to enabled can enable absolute url in chart\n  absolute_url: disabled\n\n# Log configurations\nlog:\n  # options are debug, info, warning, error, fatal\n  level: info\n  # configs for logs in local storage\n  local:\n    # Log files are rotated log_rotate_count times before being removed. If count is 0, old versions are removed rather than rotated.\n    rotate_count: 50\n    # Log files are rotated only if they grow bigger than log_rotate_size bytes. If size is followed by k, the size is assumed to be in kilobytes.\n    # If the M is used, the size is in megabytes, and if G is used, the size is in gigabytes. So size 100, size 100k, size 100M and size 100G\n    # are all valid.\n    rotate_size: 200M\n    # The directory on your host that store log\n    location: /var/log/harbor\n\n  # Uncomment following lines to enable external syslog endpoint.\n  # external_endpoint:\n  #   # protocol used to transmit log to external endpoint, options is tcp or udp\n  #   protocol: tcp\n  #   # The host of external endpoint\n  #   host: localhost\n  #   # Port of external endpoint\n  #   port: 5140\n\n#This attribute is for migrator to detect the version of the .cfg file, DO NOT MODIFY!\n_version: 2.5.0\n\n# Uncomment external_database if using external database.\n# external_database:\n#   harbor:\n#     host: harbor_db_host\n#     port: harbor_db_port\n#     db_name: harbor_db_name\n#     username: harbor_db_username\n#     password: harbor_db_password\n#     ssl_mode: disable\n#     max_idle_conns: 2\n#     max_open_conns: 0\n#   notary_signer:\n#     host: notary_signer_db_host\n#     port: notary_signer_db_port\n#     db_name: notary_signer_db_name\n#     username: notary_signer_db_username\n#     password: notary_signer_db_password\n#     ssl_mode: disable\n#   notary_server:\n#     host: notary_server_db_host\n#     port: notary_server_db_port\n#     db_name: notary_server_db_name\n#     username: notary_server_db_username\n#     password: notary_server_db_password\n#     ssl_mode: disable\n\n# Uncomment external_redis if using external Redis server\n# external_redis:\n#   # support redis, redis+sentinel\n#   # host for redis: <host_redis>:<port_redis>\n#   # host for redis+sentinel:\n#   #  <host_sentinel1>:<port_sentinel1>,<host_sentinel2>:<port_sentinel2>,<host_sentinel3>:<port_sentinel3>\n#   host: redis:6379\n#   password: \n#   # sentinel_master_set must be set to support redis+sentinel\n#   #sentinel_master_set:\n#   # db_index 0 is for core, it's unchangeable\n#   registry_db_index: 1\n#   jobservice_db_index: 2\n#   chartmuseum_db_index: 3\n#   trivy_db_index: 5\n#   idle_timeout_seconds: 30\n\n# Uncomment uaa for trusting the certificate of uaa instance that is hosted via self-signed cert.\n# uaa:\n#   ca_file: /path/to/ca\n\n# Global proxy\n# Config http proxy for components, e.g. http://my.proxy.com:3128\n# Components doesn't need to connect to each others via http proxy.\n# Remove component from `components` array if want disable proxy\n# for it. If you want use proxy for replication, MUST enable proxy\n# for core and jobservice, and set `http_proxy` and `https_proxy`.\n# Add domain to the `no_proxy` field, when you want disable proxy\n# for some special registry.\nproxy:\n  http_proxy:\n  https_proxy:\n  no_proxy:\n  components:\n    - core\n    - jobservice\n    - trivy\n\n# metric:\n#   enabled: false\n#   port: 9090\n#   path: /metrics\n\n# Trace related config\n# only can enable one trace provider(jaeger or otel) at the same time,\n# and when using jaeger as provider, can only enable it with agent mode or collector mode.\n# if using jaeger collector mode, uncomment endpoint and uncomment username, password if needed\n# if using jaeger agetn mode uncomment agent_host and agent_port\n# trace:\n#   enabled: true\n#   # set sample_rate to 1 if you wanna sampling 100% of trace data; set 0.5 if you wanna sampling 50% of trace data, and so forth\n#   sample_rate: 1\n#   # # namespace used to differenciate different harbor services\n#   # namespace:\n#   # # attributes is a key value dict contains user defined attributes used to initialize trace provider\n#   # attributes:\n#   #   application: harbor\n#   # # jaeger should be 1.26 or newer.\n#   # jaeger:\n#   #   endpoint: http://hostname:14268/api/traces\n#   #   username:\n#   #   password:\n#   #   agent_host: hostname\n#   #   # export trace data by jaeger.thrift in compact mode\n#   #   agent_port: 6831\n#   # otel:\n#   #   endpoint: hostname:4318\n#   #   url_path: /v1/traces\n#   #   compression: false\n#   #   insecure: true\n#   #   timeout: 10s\n\n# enable purge _upload directories\nupload_purging:\n  enabled: true\n  # remove files in _upload directories which exist for a period of time, default is one week.\n  age: 168h\n  # the interval of the purge operations\n  interval: 24h\n  dryrun: false\n```\n\nharbor登录\n\n```\nsz-memect.tpddns.cn:4433\n账号：admin\n密码：admin123\n```\n\nharbor卸载\n\n```\n rm -rf `find / -name harbor`\n 删除容器\n docker rmi $(docker images -q)\n```\n\n另外一台机器拉取和推送镜像\n\n```\nmkdir /etc/docker/certs.d/192.168.50.21:4433\n```\n\n然后后从 Harbor 主机拷贝证书文件到 Docker 客户端上，需要 server 的证书和密钥以及 CA 证书。\n\n```\nscp /data/cert/192.168.50.21.key  root@192.168.50.20:/etc/docker/certs.d/192.168.50.21:4433\nscp /data/cert/192.168.50.21.cert  root@192.168.50.20:/etc/docker/certs.d/192.168.50.21:4433\nscp /data/cert/ca.crt  root@192.168.50.20:/etc/docker/certs.d/192.168.50.21:4433\n```\n\n拉取命令\n\n```\ndocker pull 192.168.50.21:4433/library/mysql:latest\n```\n\n推送镜像\n\n```\n# 打tag\ndocker tag mongo:latest 192.168.50.21:4433/library/mongo:latest\n\n# 推送镜像\ndocker push 192.168.50.21:4433/library/mongo:latest\n```\n\n","slug":"Harbor安装","published":1,"updated":"2022-10-16T06:15:54.242Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clg1mfurw000327qgg4lngu3x","content":"<h1 id=\"Harbor安装\"><a href=\"#Harbor安装\" class=\"headerlink\" title=\"Harbor安装\"></a>Harbor安装</h1><table>\n<thead>\n<tr>\n<th>序号</th>\n<th>环境准备</th>\n<th>版本</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>Ubantu</td>\n<td>20.04_server</td>\n</tr>\n<tr>\n<td>2</td>\n<td>docker</td>\n<td>最新</td>\n</tr>\n<tr>\n<td>3</td>\n<td>Docker-compose</td>\n<td>最新</td>\n</tr>\n</tbody></table>\n<ul>\n<li><p><a href=\"https://github.com/goharbor/harbor\">harbor项目地址</a></p>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221014113448665.png\" alt=\"image-20221014113448665\"></p>\n</li>\n</ul>\n<p>下载harbor-online-install-v2.6.1.tgz，这个会在安装的时候从公网上下载一些必要的工具</p>\n<p>如果使用的是harbor-offline-install-v2.6.1.tgz，那么建议提前将一些harbor集成的工具准备好，不然可能会安装失败</p>\n<p>解压harbor-online-install-v2.6.1.tgz</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -zxvf harbor-online-install-v2.6.1.tgz</span><br></pre></td></tr></table></figure>\n\n<p>harbor默认工作方式是http，但是这只能在页面访问，默认harbor推送拉取镜像时走的是https，所以需要配置下https，一下是默认用ip地址去配置的</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 所有操作都是在临时文件夹 ~/ssl 下操作</span><br><span class=\"line\">mkdir ~/ssl </span><br><span class=\"line\"></span><br><span class=\"line\"># 生成生成CA证书私钥</span><br><span class=\"line\">openssl genrsa -out ca.key 4096</span><br><span class=\"line\"></span><br><span class=\"line\"># 生成CA证书</span><br><span class=\"line\">openssl req -x509 -new -nodes -sha512 -days 3650 \\</span><br><span class=\"line\"> -subj &quot;/C=CN/ST=Shenzhen/L=Shenzhen/O=example/OU=Personal/CN=192.168.50.21&quot; \\</span><br><span class=\"line\"> -key ca.key \\</span><br><span class=\"line\"> -out ca.crt</span><br><span class=\"line\"> </span><br><span class=\"line\"> # 生成服务器证书-----生成私钥</span><br><span class=\"line\"> openssl genrsa -out 192.168.50.21.key 4096</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> # 生成服务器证书-----生成证书签名请求（CSR）</span><br><span class=\"line\"> openssl req -sha512 -new \\</span><br><span class=\"line\">    -subj &quot;/C=CN/ST=Shenzhen/L=Shenzhen/O=example/OU=Personal/CN=192.168.50.21&quot; \\</span><br><span class=\"line\">    -key 192.168.50.21.key \\</span><br><span class=\"line\">    -out 192.168.50.21.csr</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 生成服务器证书-----生成一个x509 v3扩展文件</span><br><span class=\"line\">cat &gt; v3.ext &lt;&lt;-EOF</span><br><span class=\"line\">authorityKeyIdentifier=keyid,issuer</span><br><span class=\"line\">basicConstraints=CA:FALSE</span><br><span class=\"line\">keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment</span><br><span class=\"line\">extendedKeyUsage = serverAuth</span><br><span class=\"line\">subjectAltName = IP:192.168.50.21</span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 生成服务器证书-----使用该v3.ext文件为您的Harbor主机生成证书</span><br><span class=\"line\">openssl x509 -req -sha512 -days 3650 \\</span><br><span class=\"line\">    -extfile v3.ext \\</span><br><span class=\"line\">    -CA ca.crt -CAkey ca.key -CAcreateserial \\</span><br><span class=\"line\">    -in 192.168.50.21.csr \\</span><br><span class=\"line\">    -out 192.168.50.21.crt</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 将服务器证书和密钥复制到Harbor主机上的/data/cert/文件夹中</span><br><span class=\"line\">mkdir -p /data/cert/</span><br><span class=\"line\">cp 192.168.50.21.crt /data/cert/</span><br><span class=\"line\">cp 192.168.50.21.key /data/cert/</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 转换192.168.50.21.crt为192.168.50.21.cert，供Docker使用</span><br><span class=\"line\">openssl x509 -inform PEM -in 192.168.50.21.crt -out 192.168.50.21.cert</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 将服务器证书，密钥和CA文件复制到Harbor主机上的Docker证书文件夹中。您必须首先创建适当的文件夹</span><br><span class=\"line\"># 这个是使用4433端口，不用443端口的操作</span><br><span class=\"line\">mkdir -p /etc/docker/certs.d/192.168.50.21:4433/</span><br><span class=\"line\">cp 192.168.50.21.cert /etc/docker/certs.d/192.168.50.21:4433/</span><br><span class=\"line\">cp 192.168.50.21.key /etc/docker/certs.d/192.168.50.21:4433/</span><br><span class=\"line\">cp ca.crt /etc/docker/certs.d/192.168.50.21:4433/</span><br><span class=\"line\"></span><br><span class=\"line\">#如果将默认nginx端口443 映射到其他端口，请创建文件夹</span><br><span class=\"line\">#/etc/docker/certs.d/yourdomain.com:port或/etc/docker/certs.d/harbor_IP:port</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>harbor用域名的形式配置</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 所有操作都是在临时文件夹 ~/ssl 下操作</span><br><span class=\"line\">mkdir ~/ssl </span><br><span class=\"line\"></span><br><span class=\"line\"># 生成生成CA证书私钥</span><br><span class=\"line\">openssl genrsa -out ca.key 4096</span><br><span class=\"line\"></span><br><span class=\"line\"># 生成CA证书</span><br><span class=\"line\">openssl req -x509 -new -nodes -sha512 -days 3650 \\</span><br><span class=\"line\"> -subj &quot;/C=CN/ST=Shenzhen/L=Shenzhen/O=example/OU=Personal/CN=域名&quot; \\</span><br><span class=\"line\"> -key ca.key \\</span><br><span class=\"line\"> -out ca.crt</span><br><span class=\"line\"> </span><br><span class=\"line\"> # 生成服务器证书-----生成私钥</span><br><span class=\"line\"> openssl genrsa -out 域名.key 4096</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> # 生成服务器证书-----生成证书签名请求（CSR）</span><br><span class=\"line\"> openssl req -sha512 -new \\</span><br><span class=\"line\">    -subj &quot;/C=CN/ST=Shenzhen/L=Shenzhen/O=example/OU=Personal/CN=域名&quot; \\</span><br><span class=\"line\">    -key 域名.key \\</span><br><span class=\"line\">    -out 192.168.50.21.csr</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 生成服务器证书-----生成一个x509 v3扩展文件</span><br><span class=\"line\">cat &gt; v3.ext &lt;&lt;-EOF</span><br><span class=\"line\">authorityKeyIdentifier=keyid,issuer</span><br><span class=\"line\">basicConstraints=CA:FALSE</span><br><span class=\"line\">keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment</span><br><span class=\"line\">extendedKeyUsage = serverAuth</span><br><span class=\"line\">subjectAltName = IP:192.168.50.21</span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 生成服务器证书-----使用该v3.ext文件为您的Harbor主机生成证书</span><br><span class=\"line\">openssl x509 -req -sha512 -days 3650 \\</span><br><span class=\"line\">    -extfile v3.ext \\</span><br><span class=\"line\">    -CA ca.crt -CAkey ca.key -CAcreateserial \\</span><br><span class=\"line\">    -in 域名.csr \\</span><br><span class=\"line\">    -out 域名.crt</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 将服务器证书和密钥复制到Harbor主机上的/data/cert/文件夹中</span><br><span class=\"line\">mkdir -p /data/cert/</span><br><span class=\"line\">cp 域名.crt /data/cert/</span><br><span class=\"line\">cp 域名.key /data/cert/</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 转换域名.crt为域名.cert，供Docker使用</span><br><span class=\"line\">openssl x509 -inform PEM -in 域名.crt -out 域名.cert</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 将服务器证书，密钥和CA文件复制到Harbor主机上的Docker证书文件夹中。您必须首先创建适当的文件夹</span><br><span class=\"line\"># 这个是使用4433端口，不用443端口的操作</span><br><span class=\"line\">mkdir -p /etc/docker/certs.d/域名:4433/</span><br><span class=\"line\">cp 192.168.50.21.cert /etc/docker/certs.d/域名:4433/</span><br><span class=\"line\">cp 192.168.50.21.key /etc/docker/certs.d/域名:4433/</span><br><span class=\"line\">cp ca.crt /etc/docker/certs.d/域名:4433/</span><br><span class=\"line\"></span><br><span class=\"line\">#如果将默认nginx端口443 映射到其他端口，请创建文件夹</span><br><span class=\"line\">#/etc/docker/certs.d/yourdomain.com:port或/etc/docker/certs.d/harbor_IP:port</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>修改harbor.yml</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mv harbor.yml.tmpl harbor.yml</span><br><span class=\"line\">vim harbor.yml</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Configuration file of Harbor</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># The IP address or hostname to access admin UI and registry service.</span></span><br><span class=\"line\"><span class=\"comment\"># DO NOT use localhost or 127.0.0.1, because Harbor needs to be accessed by external clients.</span></span><br><span class=\"line\"><span class=\"attr\">hostname:</span> <span class=\"number\">192.168</span><span class=\"number\">.50</span><span class=\"number\">.21</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># http related config</span></span><br><span class=\"line\"><span class=\"attr\">http:</span></span><br><span class=\"line\">  <span class=\"comment\"># port for http, default is 80. If https enabled, this port will redirect to https port</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8099</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># https related config</span></span><br><span class=\"line\"><span class=\"attr\">https:</span></span><br><span class=\"line\">  <span class=\"comment\"># https port for harbor, default is 443</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">4433</span></span><br><span class=\"line\">  <span class=\"comment\"># The path of cert and key files for nginx</span></span><br><span class=\"line\">  <span class=\"attr\">certificate:</span> <span class=\"string\">/data/cert/192.168.50.21.crt</span></span><br><span class=\"line\">  <span class=\"attr\">private_key:</span> <span class=\"string\">/data/cert/192.168.50.21.key</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># # Uncomment following will enable tls communication between all harbor components</span></span><br><span class=\"line\"><span class=\"comment\"># internal_tls:</span></span><br><span class=\"line\"><span class=\"comment\">#   # set enabled to true means internal tls is enabled</span></span><br><span class=\"line\"><span class=\"comment\">#   enabled: true</span></span><br><span class=\"line\"><span class=\"comment\">#   # put your cert and key files on dir</span></span><br><span class=\"line\"><span class=\"comment\">#   dir: /etc/harbor/tls/internal</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Uncomment external_url if you want to enable external proxy</span></span><br><span class=\"line\"><span class=\"comment\"># And when it enabled the hostname will no longer used</span></span><br><span class=\"line\"><span class=\"comment\"># external_url: https://reg.mydomain.com:8433</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># The initial password of Harbor admin</span></span><br><span class=\"line\"><span class=\"comment\"># It only works in first time to install harbor</span></span><br><span class=\"line\"><span class=\"comment\"># Remember Change the admin password from UI after launching Harbor.</span></span><br><span class=\"line\"><span class=\"attr\">harbor_admin_password:</span> <span class=\"string\">admin123</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Harbor DB configuration</span></span><br><span class=\"line\"><span class=\"attr\">database:</span></span><br><span class=\"line\">  <span class=\"comment\"># The password for the root user of Harbor DB. Change this before any production use.</span></span><br><span class=\"line\">  <span class=\"attr\">password:</span> <span class=\"string\">root123</span></span><br><span class=\"line\">  <span class=\"comment\"># The maximum number of connections in the idle connection pool. If it &lt;=0, no idle connections are retained.</span></span><br><span class=\"line\">  <span class=\"attr\">max_idle_conns:</span> <span class=\"number\">100</span></span><br><span class=\"line\">  <span class=\"comment\"># The maximum number of open connections to the database. If it &lt;= 0, then there is no limit on the number of open connections.</span></span><br><span class=\"line\">  <span class=\"comment\"># <span class=\"doctag\">Note:</span> the default number of connections is 1024 for postgres of harbor.</span></span><br><span class=\"line\">  <span class=\"attr\">max_open_conns:</span> <span class=\"number\">900</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># The default data volume</span></span><br><span class=\"line\"><span class=\"attr\">data_volume:</span> <span class=\"string\">/data</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Harbor Storage settings by default is using /data dir on local filesystem</span></span><br><span class=\"line\"><span class=\"comment\"># Uncomment storage_service setting If you want to using external storage</span></span><br><span class=\"line\"><span class=\"comment\"># storage_service:</span></span><br><span class=\"line\"><span class=\"comment\">#   # ca_bundle is the path to the custom root ca certificate, which will be injected into the truststore</span></span><br><span class=\"line\"><span class=\"comment\">#   # of registry&#x27;s and chart repository&#x27;s containers.  This is usually needed when the user hosts a internal storage with self signed certificate.</span></span><br><span class=\"line\"><span class=\"comment\">#   ca_bundle:</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#   # storage backend, default is filesystem, options include filesystem, azure, gcs, s3, swift and oss</span></span><br><span class=\"line\"><span class=\"comment\">#   # for more info about this configuration please refer https://docs.docker.com/registry/configuration/</span></span><br><span class=\"line\"><span class=\"comment\">#   filesystem:</span></span><br><span class=\"line\"><span class=\"comment\">#     maxthreads: 100</span></span><br><span class=\"line\"><span class=\"comment\">#   # set disable to true when you want to disable registry redirect</span></span><br><span class=\"line\"><span class=\"comment\">#   redirect:</span></span><br><span class=\"line\"><span class=\"comment\">#     disabled: false</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Trivy configuration</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># Trivy DB contains vulnerability information from NVD, Red Hat, and many other upstream vulnerability databases.</span></span><br><span class=\"line\"><span class=\"comment\"># It is downloaded by Trivy from the GitHub release page https://github.com/aquasecurity/trivy-db/releases and cached</span></span><br><span class=\"line\"><span class=\"comment\"># in the local file system. In addition, the database contains the update timestamp so Trivy can detect whether it</span></span><br><span class=\"line\"><span class=\"comment\"># should download a newer version from the Internet or use the cached one. Currently, the database is updated every</span></span><br><span class=\"line\"><span class=\"comment\"># 12 hours and published as a new release to GitHub.</span></span><br><span class=\"line\"><span class=\"attr\">trivy:</span></span><br><span class=\"line\">  <span class=\"comment\"># ignoreUnfixed The flag to display only fixed vulnerabilities</span></span><br><span class=\"line\">  <span class=\"attr\">ignore_unfixed:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"comment\"># skipUpdate The flag to enable or disable Trivy DB downloads from GitHub</span></span><br><span class=\"line\">  <span class=\"comment\">#</span></span><br><span class=\"line\">  <span class=\"comment\"># You might want to enable this flag in test or CI/CD environments to avoid GitHub rate limiting issues.</span></span><br><span class=\"line\">  <span class=\"comment\"># If the flag is enabled you have to download the `trivy-offline.tar.gz` archive manually, extract `trivy.db` and</span></span><br><span class=\"line\">  <span class=\"comment\"># `metadata.json` files and mount them in the `/home/scanner/.cache/trivy/db` path.</span></span><br><span class=\"line\">  <span class=\"attr\">skip_update:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"comment\">#</span></span><br><span class=\"line\">  <span class=\"comment\"># The offline_scan option prevents Trivy from sending API requests to identify dependencies.</span></span><br><span class=\"line\">  <span class=\"comment\"># Scanning JAR files and pom.xml may require Internet access for better detection, but this option tries to avoid it.</span></span><br><span class=\"line\">  <span class=\"comment\"># For example, the offline mode will not try to resolve transitive dependencies in pom.xml when the dependency doesn&#x27;t</span></span><br><span class=\"line\">  <span class=\"comment\"># exist in the local repositories. It means a number of detected vulnerabilities might be fewer in offline mode.</span></span><br><span class=\"line\">  <span class=\"comment\"># It would work if all the dependencies are in local.</span></span><br><span class=\"line\">  <span class=\"comment\"># This option doesn’t affect DB download. You need to specify &quot;skip-update&quot; as well as &quot;offline-scan&quot; in an air-gapped environment.</span></span><br><span class=\"line\">  <span class=\"attr\">offline_scan:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"comment\">#</span></span><br><span class=\"line\">  <span class=\"comment\"># insecure The flag to skip verifying registry certificate</span></span><br><span class=\"line\">  <span class=\"attr\">insecure:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"comment\"># github_token The GitHub access token to download Trivy DB</span></span><br><span class=\"line\">  <span class=\"comment\">#</span></span><br><span class=\"line\">  <span class=\"comment\"># Anonymous downloads from GitHub are subject to the limit of 60 requests per hour. Normally such rate limit is enough</span></span><br><span class=\"line\">  <span class=\"comment\"># for production operations. If, for any reason, it&#x27;s not enough, you could increase the rate limit to 5000</span></span><br><span class=\"line\">  <span class=\"comment\"># requests per hour by specifying the GitHub access token. For more details on GitHub rate limiting please consult</span></span><br><span class=\"line\">  <span class=\"comment\"># https://developer.github.com/v3/#rate-limiting</span></span><br><span class=\"line\">  <span class=\"comment\">#</span></span><br><span class=\"line\">  <span class=\"comment\"># You can create a GitHub token by following the instructions in</span></span><br><span class=\"line\">  <span class=\"comment\"># https://help.github.com/en/github/authenticating-to-github/creating-a-personal-access-token-for-the-command-line</span></span><br><span class=\"line\">  <span class=\"comment\">#</span></span><br><span class=\"line\">  <span class=\"comment\"># github_token: xxx</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">jobservice:</span></span><br><span class=\"line\">  <span class=\"comment\"># Maximum number of job workers in job service</span></span><br><span class=\"line\">  <span class=\"attr\">max_job_workers:</span> <span class=\"number\">10</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">notification:</span></span><br><span class=\"line\">  <span class=\"comment\"># Maximum retry count for webhook job</span></span><br><span class=\"line\">  <span class=\"attr\">webhook_job_max_retry:</span> <span class=\"number\">10</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">chart:</span></span><br><span class=\"line\">  <span class=\"comment\"># Change the value of absolute_url to enabled can enable absolute url in chart</span></span><br><span class=\"line\">  <span class=\"attr\">absolute_url:</span> <span class=\"string\">disabled</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Log configurations</span></span><br><span class=\"line\"><span class=\"attr\">log:</span></span><br><span class=\"line\">  <span class=\"comment\"># options are debug, info, warning, error, fatal</span></span><br><span class=\"line\">  <span class=\"attr\">level:</span> <span class=\"string\">info</span></span><br><span class=\"line\">  <span class=\"comment\"># configs for logs in local storage</span></span><br><span class=\"line\">  <span class=\"attr\">local:</span></span><br><span class=\"line\">    <span class=\"comment\"># Log files are rotated log_rotate_count times before being removed. If count is 0, old versions are removed rather than rotated.</span></span><br><span class=\"line\">    <span class=\"attr\">rotate_count:</span> <span class=\"number\">50</span></span><br><span class=\"line\">    <span class=\"comment\"># Log files are rotated only if they grow bigger than log_rotate_size bytes. If size is followed by k, the size is assumed to be in kilobytes.</span></span><br><span class=\"line\">    <span class=\"comment\"># If the M is used, the size is in megabytes, and if G is used, the size is in gigabytes. So size 100, size 100k, size 100M and size 100G</span></span><br><span class=\"line\">    <span class=\"comment\"># are all valid.</span></span><br><span class=\"line\">    <span class=\"attr\">rotate_size:</span> <span class=\"string\">200M</span></span><br><span class=\"line\">    <span class=\"comment\"># The directory on your host that store log</span></span><br><span class=\"line\">    <span class=\"attr\">location:</span> <span class=\"string\">/var/log/harbor</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># Uncomment following lines to enable external syslog endpoint.</span></span><br><span class=\"line\">  <span class=\"comment\"># external_endpoint:</span></span><br><span class=\"line\">  <span class=\"comment\">#   # protocol used to transmit log to external endpoint, options is tcp or udp</span></span><br><span class=\"line\">  <span class=\"comment\">#   protocol: tcp</span></span><br><span class=\"line\">  <span class=\"comment\">#   # The host of external endpoint</span></span><br><span class=\"line\">  <span class=\"comment\">#   host: localhost</span></span><br><span class=\"line\">  <span class=\"comment\">#   # Port of external endpoint</span></span><br><span class=\"line\">  <span class=\"comment\">#   port: 5140</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#This attribute is for migrator to detect the version of the .cfg file, DO NOT MODIFY!</span></span><br><span class=\"line\"><span class=\"attr\">_version:</span> <span class=\"number\">2.5</span><span class=\"number\">.0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Uncomment external_database if using external database.</span></span><br><span class=\"line\"><span class=\"comment\"># external_database:</span></span><br><span class=\"line\"><span class=\"comment\">#   harbor:</span></span><br><span class=\"line\"><span class=\"comment\">#     host: harbor_db_host</span></span><br><span class=\"line\"><span class=\"comment\">#     port: harbor_db_port</span></span><br><span class=\"line\"><span class=\"comment\">#     db_name: harbor_db_name</span></span><br><span class=\"line\"><span class=\"comment\">#     username: harbor_db_username</span></span><br><span class=\"line\"><span class=\"comment\">#     password: harbor_db_password</span></span><br><span class=\"line\"><span class=\"comment\">#     ssl_mode: disable</span></span><br><span class=\"line\"><span class=\"comment\">#     max_idle_conns: 2</span></span><br><span class=\"line\"><span class=\"comment\">#     max_open_conns: 0</span></span><br><span class=\"line\"><span class=\"comment\">#   notary_signer:</span></span><br><span class=\"line\"><span class=\"comment\">#     host: notary_signer_db_host</span></span><br><span class=\"line\"><span class=\"comment\">#     port: notary_signer_db_port</span></span><br><span class=\"line\"><span class=\"comment\">#     db_name: notary_signer_db_name</span></span><br><span class=\"line\"><span class=\"comment\">#     username: notary_signer_db_username</span></span><br><span class=\"line\"><span class=\"comment\">#     password: notary_signer_db_password</span></span><br><span class=\"line\"><span class=\"comment\">#     ssl_mode: disable</span></span><br><span class=\"line\"><span class=\"comment\">#   notary_server:</span></span><br><span class=\"line\"><span class=\"comment\">#     host: notary_server_db_host</span></span><br><span class=\"line\"><span class=\"comment\">#     port: notary_server_db_port</span></span><br><span class=\"line\"><span class=\"comment\">#     db_name: notary_server_db_name</span></span><br><span class=\"line\"><span class=\"comment\">#     username: notary_server_db_username</span></span><br><span class=\"line\"><span class=\"comment\">#     password: notary_server_db_password</span></span><br><span class=\"line\"><span class=\"comment\">#     ssl_mode: disable</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Uncomment external_redis if using external Redis server</span></span><br><span class=\"line\"><span class=\"comment\"># external_redis:</span></span><br><span class=\"line\"><span class=\"comment\">#   # support redis, redis+sentinel</span></span><br><span class=\"line\"><span class=\"comment\">#   # host for redis: &lt;host_redis&gt;:&lt;port_redis&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#   # host for redis+sentinel:</span></span><br><span class=\"line\"><span class=\"comment\">#   #  &lt;host_sentinel1&gt;:&lt;port_sentinel1&gt;,&lt;host_sentinel2&gt;:&lt;port_sentinel2&gt;,&lt;host_sentinel3&gt;:&lt;port_sentinel3&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#   host: redis:6379</span></span><br><span class=\"line\"><span class=\"comment\">#   password: </span></span><br><span class=\"line\"><span class=\"comment\">#   # sentinel_master_set must be set to support redis+sentinel</span></span><br><span class=\"line\"><span class=\"comment\">#   #sentinel_master_set:</span></span><br><span class=\"line\"><span class=\"comment\">#   # db_index 0 is for core, it&#x27;s unchangeable</span></span><br><span class=\"line\"><span class=\"comment\">#   registry_db_index: 1</span></span><br><span class=\"line\"><span class=\"comment\">#   jobservice_db_index: 2</span></span><br><span class=\"line\"><span class=\"comment\">#   chartmuseum_db_index: 3</span></span><br><span class=\"line\"><span class=\"comment\">#   trivy_db_index: 5</span></span><br><span class=\"line\"><span class=\"comment\">#   idle_timeout_seconds: 30</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Uncomment uaa for trusting the certificate of uaa instance that is hosted via self-signed cert.</span></span><br><span class=\"line\"><span class=\"comment\"># uaa:</span></span><br><span class=\"line\"><span class=\"comment\">#   ca_file: /path/to/ca</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Global proxy</span></span><br><span class=\"line\"><span class=\"comment\"># Config http proxy for components, e.g. http://my.proxy.com:3128</span></span><br><span class=\"line\"><span class=\"comment\"># Components doesn&#x27;t need to connect to each others via http proxy.</span></span><br><span class=\"line\"><span class=\"comment\"># Remove component from `components` array if want disable proxy</span></span><br><span class=\"line\"><span class=\"comment\"># for it. If you want use proxy for replication, MUST enable proxy</span></span><br><span class=\"line\"><span class=\"comment\"># for core and jobservice, and set `http_proxy` and `https_proxy`.</span></span><br><span class=\"line\"><span class=\"comment\"># Add domain to the `no_proxy` field, when you want disable proxy</span></span><br><span class=\"line\"><span class=\"comment\"># for some special registry.</span></span><br><span class=\"line\"><span class=\"attr\">proxy:</span></span><br><span class=\"line\">  <span class=\"attr\">http_proxy:</span></span><br><span class=\"line\">  <span class=\"attr\">https_proxy:</span></span><br><span class=\"line\">  <span class=\"attr\">no_proxy:</span></span><br><span class=\"line\">  <span class=\"attr\">components:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">core</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">jobservice</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">trivy</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># metric:</span></span><br><span class=\"line\"><span class=\"comment\">#   enabled: false</span></span><br><span class=\"line\"><span class=\"comment\">#   port: 9090</span></span><br><span class=\"line\"><span class=\"comment\">#   path: /metrics</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Trace related config</span></span><br><span class=\"line\"><span class=\"comment\"># only can enable one trace provider(jaeger or otel) at the same time,</span></span><br><span class=\"line\"><span class=\"comment\"># and when using jaeger as provider, can only enable it with agent mode or collector mode.</span></span><br><span class=\"line\"><span class=\"comment\"># if using jaeger collector mode, uncomment endpoint and uncomment username, password if needed</span></span><br><span class=\"line\"><span class=\"comment\"># if using jaeger agetn mode uncomment agent_host and agent_port</span></span><br><span class=\"line\"><span class=\"comment\"># trace:</span></span><br><span class=\"line\"><span class=\"comment\">#   enabled: true</span></span><br><span class=\"line\"><span class=\"comment\">#   # set sample_rate to 1 if you wanna sampling 100% of trace data; set 0.5 if you wanna sampling 50% of trace data, and so forth</span></span><br><span class=\"line\"><span class=\"comment\">#   sample_rate: 1</span></span><br><span class=\"line\"><span class=\"comment\">#   # # namespace used to differenciate different harbor services</span></span><br><span class=\"line\"><span class=\"comment\">#   # namespace:</span></span><br><span class=\"line\"><span class=\"comment\">#   # # attributes is a key value dict contains user defined attributes used to initialize trace provider</span></span><br><span class=\"line\"><span class=\"comment\">#   # attributes:</span></span><br><span class=\"line\"><span class=\"comment\">#   #   application: harbor</span></span><br><span class=\"line\"><span class=\"comment\">#   # # jaeger should be 1.26 or newer.</span></span><br><span class=\"line\"><span class=\"comment\">#   # jaeger:</span></span><br><span class=\"line\"><span class=\"comment\">#   #   endpoint: http://hostname:14268/api/traces</span></span><br><span class=\"line\"><span class=\"comment\">#   #   username:</span></span><br><span class=\"line\"><span class=\"comment\">#   #   password:</span></span><br><span class=\"line\"><span class=\"comment\">#   #   agent_host: hostname</span></span><br><span class=\"line\"><span class=\"comment\">#   #   # export trace data by jaeger.thrift in compact mode</span></span><br><span class=\"line\"><span class=\"comment\">#   #   agent_port: 6831</span></span><br><span class=\"line\"><span class=\"comment\">#   # otel:</span></span><br><span class=\"line\"><span class=\"comment\">#   #   endpoint: hostname:4318</span></span><br><span class=\"line\"><span class=\"comment\">#   #   url_path: /v1/traces</span></span><br><span class=\"line\"><span class=\"comment\">#   #   compression: false</span></span><br><span class=\"line\"><span class=\"comment\">#   #   insecure: true</span></span><br><span class=\"line\"><span class=\"comment\">#   #   timeout: 10s</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># enable purge _upload directories</span></span><br><span class=\"line\"><span class=\"attr\">upload_purging:</span></span><br><span class=\"line\">  <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"comment\"># remove files in _upload directories which exist for a period of time, default is one week.</span></span><br><span class=\"line\">  <span class=\"attr\">age:</span> <span class=\"string\">168h</span></span><br><span class=\"line\">  <span class=\"comment\"># the interval of the purge operations</span></span><br><span class=\"line\">  <span class=\"attr\">interval:</span> <span class=\"string\">24h</span></span><br><span class=\"line\">  <span class=\"attr\">dryrun:</span> <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n\n<p>harbor登录</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sz-memect.tpddns.cn:4433</span><br><span class=\"line\">账号：admin</span><br><span class=\"line\">密码：admin123</span><br></pre></td></tr></table></figure>\n\n<p>harbor卸载</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rm -rf `find / -name harbor`</span><br><span class=\"line\">删除容器</span><br><span class=\"line\">docker rmi $(docker images -q)</span><br></pre></td></tr></table></figure>\n\n<p>另外一台机器拉取和推送镜像</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir /etc/docker/certs.d/192.168.50.21:4433</span><br></pre></td></tr></table></figure>\n\n<p>然后后从 Harbor 主机拷贝证书文件到 Docker 客户端上，需要 server 的证书和密钥以及 CA 证书。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scp /data/cert/192.168.50.21.key  root@192.168.50.20:/etc/docker/certs.d/192.168.50.21:4433</span><br><span class=\"line\">scp /data/cert/192.168.50.21.cert  root@192.168.50.20:/etc/docker/certs.d/192.168.50.21:4433</span><br><span class=\"line\">scp /data/cert/ca.crt  root@192.168.50.20:/etc/docker/certs.d/192.168.50.21:4433</span><br></pre></td></tr></table></figure>\n\n<p>拉取命令</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull 192.168.50.21:4433/library/mysql:latest</span><br></pre></td></tr></table></figure>\n\n<p>推送镜像</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 打tag</span><br><span class=\"line\">docker tag mongo:latest 192.168.50.21:4433/library/mongo:latest</span><br><span class=\"line\"></span><br><span class=\"line\"># 推送镜像</span><br><span class=\"line\">docker push 192.168.50.21:4433/library/mongo:latest</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{"link":[{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"动漫图片和壁纸","link":"https://anime-pictures.net/?lang=zh_CN","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"图片网站"},{"name":"Wallhaven","link":"https://wallhaven.cc/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"4k图片网站"},{"name":"WALLPAPER ABYSS","link":"https://wall.alphacoders.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"WALLPAPER ABYSS"},{"name":"极简壁纸","link":"https://bz.zzzmh.cn/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"极简壁纸"},{"name":"Wallroom","link":"https://wallroom.io/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"Wallroom"}]}]}},"excerpt":"","more":"<h1 id=\"Harbor安装\"><a href=\"#Harbor安装\" class=\"headerlink\" title=\"Harbor安装\"></a>Harbor安装</h1><table>\n<thead>\n<tr>\n<th>序号</th>\n<th>环境准备</th>\n<th>版本</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>Ubantu</td>\n<td>20.04_server</td>\n</tr>\n<tr>\n<td>2</td>\n<td>docker</td>\n<td>最新</td>\n</tr>\n<tr>\n<td>3</td>\n<td>Docker-compose</td>\n<td>最新</td>\n</tr>\n</tbody></table>\n<ul>\n<li><p><a href=\"https://github.com/goharbor/harbor\">harbor项目地址</a></p>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221014113448665.png\" alt=\"image-20221014113448665\"></p>\n</li>\n</ul>\n<p>下载harbor-online-install-v2.6.1.tgz，这个会在安装的时候从公网上下载一些必要的工具</p>\n<p>如果使用的是harbor-offline-install-v2.6.1.tgz，那么建议提前将一些harbor集成的工具准备好，不然可能会安装失败</p>\n<p>解压harbor-online-install-v2.6.1.tgz</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -zxvf harbor-online-install-v2.6.1.tgz</span><br></pre></td></tr></table></figure>\n\n<p>harbor默认工作方式是http，但是这只能在页面访问，默认harbor推送拉取镜像时走的是https，所以需要配置下https，一下是默认用ip地址去配置的</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 所有操作都是在临时文件夹 ~/ssl 下操作</span><br><span class=\"line\">mkdir ~/ssl </span><br><span class=\"line\"></span><br><span class=\"line\"># 生成生成CA证书私钥</span><br><span class=\"line\">openssl genrsa -out ca.key 4096</span><br><span class=\"line\"></span><br><span class=\"line\"># 生成CA证书</span><br><span class=\"line\">openssl req -x509 -new -nodes -sha512 -days 3650 \\</span><br><span class=\"line\"> -subj &quot;/C=CN/ST=Shenzhen/L=Shenzhen/O=example/OU=Personal/CN=192.168.50.21&quot; \\</span><br><span class=\"line\"> -key ca.key \\</span><br><span class=\"line\"> -out ca.crt</span><br><span class=\"line\"> </span><br><span class=\"line\"> # 生成服务器证书-----生成私钥</span><br><span class=\"line\"> openssl genrsa -out 192.168.50.21.key 4096</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> # 生成服务器证书-----生成证书签名请求（CSR）</span><br><span class=\"line\"> openssl req -sha512 -new \\</span><br><span class=\"line\">    -subj &quot;/C=CN/ST=Shenzhen/L=Shenzhen/O=example/OU=Personal/CN=192.168.50.21&quot; \\</span><br><span class=\"line\">    -key 192.168.50.21.key \\</span><br><span class=\"line\">    -out 192.168.50.21.csr</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 生成服务器证书-----生成一个x509 v3扩展文件</span><br><span class=\"line\">cat &gt; v3.ext &lt;&lt;-EOF</span><br><span class=\"line\">authorityKeyIdentifier=keyid,issuer</span><br><span class=\"line\">basicConstraints=CA:FALSE</span><br><span class=\"line\">keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment</span><br><span class=\"line\">extendedKeyUsage = serverAuth</span><br><span class=\"line\">subjectAltName = IP:192.168.50.21</span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 生成服务器证书-----使用该v3.ext文件为您的Harbor主机生成证书</span><br><span class=\"line\">openssl x509 -req -sha512 -days 3650 \\</span><br><span class=\"line\">    -extfile v3.ext \\</span><br><span class=\"line\">    -CA ca.crt -CAkey ca.key -CAcreateserial \\</span><br><span class=\"line\">    -in 192.168.50.21.csr \\</span><br><span class=\"line\">    -out 192.168.50.21.crt</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 将服务器证书和密钥复制到Harbor主机上的/data/cert/文件夹中</span><br><span class=\"line\">mkdir -p /data/cert/</span><br><span class=\"line\">cp 192.168.50.21.crt /data/cert/</span><br><span class=\"line\">cp 192.168.50.21.key /data/cert/</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 转换192.168.50.21.crt为192.168.50.21.cert，供Docker使用</span><br><span class=\"line\">openssl x509 -inform PEM -in 192.168.50.21.crt -out 192.168.50.21.cert</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 将服务器证书，密钥和CA文件复制到Harbor主机上的Docker证书文件夹中。您必须首先创建适当的文件夹</span><br><span class=\"line\"># 这个是使用4433端口，不用443端口的操作</span><br><span class=\"line\">mkdir -p /etc/docker/certs.d/192.168.50.21:4433/</span><br><span class=\"line\">cp 192.168.50.21.cert /etc/docker/certs.d/192.168.50.21:4433/</span><br><span class=\"line\">cp 192.168.50.21.key /etc/docker/certs.d/192.168.50.21:4433/</span><br><span class=\"line\">cp ca.crt /etc/docker/certs.d/192.168.50.21:4433/</span><br><span class=\"line\"></span><br><span class=\"line\">#如果将默认nginx端口443 映射到其他端口，请创建文件夹</span><br><span class=\"line\">#/etc/docker/certs.d/yourdomain.com:port或/etc/docker/certs.d/harbor_IP:port</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>harbor用域名的形式配置</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 所有操作都是在临时文件夹 ~/ssl 下操作</span><br><span class=\"line\">mkdir ~/ssl </span><br><span class=\"line\"></span><br><span class=\"line\"># 生成生成CA证书私钥</span><br><span class=\"line\">openssl genrsa -out ca.key 4096</span><br><span class=\"line\"></span><br><span class=\"line\"># 生成CA证书</span><br><span class=\"line\">openssl req -x509 -new -nodes -sha512 -days 3650 \\</span><br><span class=\"line\"> -subj &quot;/C=CN/ST=Shenzhen/L=Shenzhen/O=example/OU=Personal/CN=域名&quot; \\</span><br><span class=\"line\"> -key ca.key \\</span><br><span class=\"line\"> -out ca.crt</span><br><span class=\"line\"> </span><br><span class=\"line\"> # 生成服务器证书-----生成私钥</span><br><span class=\"line\"> openssl genrsa -out 域名.key 4096</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> # 生成服务器证书-----生成证书签名请求（CSR）</span><br><span class=\"line\"> openssl req -sha512 -new \\</span><br><span class=\"line\">    -subj &quot;/C=CN/ST=Shenzhen/L=Shenzhen/O=example/OU=Personal/CN=域名&quot; \\</span><br><span class=\"line\">    -key 域名.key \\</span><br><span class=\"line\">    -out 192.168.50.21.csr</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 生成服务器证书-----生成一个x509 v3扩展文件</span><br><span class=\"line\">cat &gt; v3.ext &lt;&lt;-EOF</span><br><span class=\"line\">authorityKeyIdentifier=keyid,issuer</span><br><span class=\"line\">basicConstraints=CA:FALSE</span><br><span class=\"line\">keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment</span><br><span class=\"line\">extendedKeyUsage = serverAuth</span><br><span class=\"line\">subjectAltName = IP:192.168.50.21</span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 生成服务器证书-----使用该v3.ext文件为您的Harbor主机生成证书</span><br><span class=\"line\">openssl x509 -req -sha512 -days 3650 \\</span><br><span class=\"line\">    -extfile v3.ext \\</span><br><span class=\"line\">    -CA ca.crt -CAkey ca.key -CAcreateserial \\</span><br><span class=\"line\">    -in 域名.csr \\</span><br><span class=\"line\">    -out 域名.crt</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 将服务器证书和密钥复制到Harbor主机上的/data/cert/文件夹中</span><br><span class=\"line\">mkdir -p /data/cert/</span><br><span class=\"line\">cp 域名.crt /data/cert/</span><br><span class=\"line\">cp 域名.key /data/cert/</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 转换域名.crt为域名.cert，供Docker使用</span><br><span class=\"line\">openssl x509 -inform PEM -in 域名.crt -out 域名.cert</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 将服务器证书，密钥和CA文件复制到Harbor主机上的Docker证书文件夹中。您必须首先创建适当的文件夹</span><br><span class=\"line\"># 这个是使用4433端口，不用443端口的操作</span><br><span class=\"line\">mkdir -p /etc/docker/certs.d/域名:4433/</span><br><span class=\"line\">cp 192.168.50.21.cert /etc/docker/certs.d/域名:4433/</span><br><span class=\"line\">cp 192.168.50.21.key /etc/docker/certs.d/域名:4433/</span><br><span class=\"line\">cp ca.crt /etc/docker/certs.d/域名:4433/</span><br><span class=\"line\"></span><br><span class=\"line\">#如果将默认nginx端口443 映射到其他端口，请创建文件夹</span><br><span class=\"line\">#/etc/docker/certs.d/yourdomain.com:port或/etc/docker/certs.d/harbor_IP:port</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>修改harbor.yml</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mv harbor.yml.tmpl harbor.yml</span><br><span class=\"line\">vim harbor.yml</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Configuration file of Harbor</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># The IP address or hostname to access admin UI and registry service.</span></span><br><span class=\"line\"><span class=\"comment\"># DO NOT use localhost or 127.0.0.1, because Harbor needs to be accessed by external clients.</span></span><br><span class=\"line\"><span class=\"attr\">hostname:</span> <span class=\"number\">192.168</span><span class=\"number\">.50</span><span class=\"number\">.21</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># http related config</span></span><br><span class=\"line\"><span class=\"attr\">http:</span></span><br><span class=\"line\">  <span class=\"comment\"># port for http, default is 80. If https enabled, this port will redirect to https port</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">8099</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># https related config</span></span><br><span class=\"line\"><span class=\"attr\">https:</span></span><br><span class=\"line\">  <span class=\"comment\"># https port for harbor, default is 443</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"number\">4433</span></span><br><span class=\"line\">  <span class=\"comment\"># The path of cert and key files for nginx</span></span><br><span class=\"line\">  <span class=\"attr\">certificate:</span> <span class=\"string\">/data/cert/192.168.50.21.crt</span></span><br><span class=\"line\">  <span class=\"attr\">private_key:</span> <span class=\"string\">/data/cert/192.168.50.21.key</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># # Uncomment following will enable tls communication between all harbor components</span></span><br><span class=\"line\"><span class=\"comment\"># internal_tls:</span></span><br><span class=\"line\"><span class=\"comment\">#   # set enabled to true means internal tls is enabled</span></span><br><span class=\"line\"><span class=\"comment\">#   enabled: true</span></span><br><span class=\"line\"><span class=\"comment\">#   # put your cert and key files on dir</span></span><br><span class=\"line\"><span class=\"comment\">#   dir: /etc/harbor/tls/internal</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Uncomment external_url if you want to enable external proxy</span></span><br><span class=\"line\"><span class=\"comment\"># And when it enabled the hostname will no longer used</span></span><br><span class=\"line\"><span class=\"comment\"># external_url: https://reg.mydomain.com:8433</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># The initial password of Harbor admin</span></span><br><span class=\"line\"><span class=\"comment\"># It only works in first time to install harbor</span></span><br><span class=\"line\"><span class=\"comment\"># Remember Change the admin password from UI after launching Harbor.</span></span><br><span class=\"line\"><span class=\"attr\">harbor_admin_password:</span> <span class=\"string\">admin123</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Harbor DB configuration</span></span><br><span class=\"line\"><span class=\"attr\">database:</span></span><br><span class=\"line\">  <span class=\"comment\"># The password for the root user of Harbor DB. Change this before any production use.</span></span><br><span class=\"line\">  <span class=\"attr\">password:</span> <span class=\"string\">root123</span></span><br><span class=\"line\">  <span class=\"comment\"># The maximum number of connections in the idle connection pool. If it &lt;=0, no idle connections are retained.</span></span><br><span class=\"line\">  <span class=\"attr\">max_idle_conns:</span> <span class=\"number\">100</span></span><br><span class=\"line\">  <span class=\"comment\"># The maximum number of open connections to the database. If it &lt;= 0, then there is no limit on the number of open connections.</span></span><br><span class=\"line\">  <span class=\"comment\"># <span class=\"doctag\">Note:</span> the default number of connections is 1024 for postgres of harbor.</span></span><br><span class=\"line\">  <span class=\"attr\">max_open_conns:</span> <span class=\"number\">900</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># The default data volume</span></span><br><span class=\"line\"><span class=\"attr\">data_volume:</span> <span class=\"string\">/data</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Harbor Storage settings by default is using /data dir on local filesystem</span></span><br><span class=\"line\"><span class=\"comment\"># Uncomment storage_service setting If you want to using external storage</span></span><br><span class=\"line\"><span class=\"comment\"># storage_service:</span></span><br><span class=\"line\"><span class=\"comment\">#   # ca_bundle is the path to the custom root ca certificate, which will be injected into the truststore</span></span><br><span class=\"line\"><span class=\"comment\">#   # of registry&#x27;s and chart repository&#x27;s containers.  This is usually needed when the user hosts a internal storage with self signed certificate.</span></span><br><span class=\"line\"><span class=\"comment\">#   ca_bundle:</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#   # storage backend, default is filesystem, options include filesystem, azure, gcs, s3, swift and oss</span></span><br><span class=\"line\"><span class=\"comment\">#   # for more info about this configuration please refer https://docs.docker.com/registry/configuration/</span></span><br><span class=\"line\"><span class=\"comment\">#   filesystem:</span></span><br><span class=\"line\"><span class=\"comment\">#     maxthreads: 100</span></span><br><span class=\"line\"><span class=\"comment\">#   # set disable to true when you want to disable registry redirect</span></span><br><span class=\"line\"><span class=\"comment\">#   redirect:</span></span><br><span class=\"line\"><span class=\"comment\">#     disabled: false</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Trivy configuration</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># Trivy DB contains vulnerability information from NVD, Red Hat, and many other upstream vulnerability databases.</span></span><br><span class=\"line\"><span class=\"comment\"># It is downloaded by Trivy from the GitHub release page https://github.com/aquasecurity/trivy-db/releases and cached</span></span><br><span class=\"line\"><span class=\"comment\"># in the local file system. In addition, the database contains the update timestamp so Trivy can detect whether it</span></span><br><span class=\"line\"><span class=\"comment\"># should download a newer version from the Internet or use the cached one. Currently, the database is updated every</span></span><br><span class=\"line\"><span class=\"comment\"># 12 hours and published as a new release to GitHub.</span></span><br><span class=\"line\"><span class=\"attr\">trivy:</span></span><br><span class=\"line\">  <span class=\"comment\"># ignoreUnfixed The flag to display only fixed vulnerabilities</span></span><br><span class=\"line\">  <span class=\"attr\">ignore_unfixed:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"comment\"># skipUpdate The flag to enable or disable Trivy DB downloads from GitHub</span></span><br><span class=\"line\">  <span class=\"comment\">#</span></span><br><span class=\"line\">  <span class=\"comment\"># You might want to enable this flag in test or CI/CD environments to avoid GitHub rate limiting issues.</span></span><br><span class=\"line\">  <span class=\"comment\"># If the flag is enabled you have to download the `trivy-offline.tar.gz` archive manually, extract `trivy.db` and</span></span><br><span class=\"line\">  <span class=\"comment\"># `metadata.json` files and mount them in the `/home/scanner/.cache/trivy/db` path.</span></span><br><span class=\"line\">  <span class=\"attr\">skip_update:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"comment\">#</span></span><br><span class=\"line\">  <span class=\"comment\"># The offline_scan option prevents Trivy from sending API requests to identify dependencies.</span></span><br><span class=\"line\">  <span class=\"comment\"># Scanning JAR files and pom.xml may require Internet access for better detection, but this option tries to avoid it.</span></span><br><span class=\"line\">  <span class=\"comment\"># For example, the offline mode will not try to resolve transitive dependencies in pom.xml when the dependency doesn&#x27;t</span></span><br><span class=\"line\">  <span class=\"comment\"># exist in the local repositories. It means a number of detected vulnerabilities might be fewer in offline mode.</span></span><br><span class=\"line\">  <span class=\"comment\"># It would work if all the dependencies are in local.</span></span><br><span class=\"line\">  <span class=\"comment\"># This option doesn’t affect DB download. You need to specify &quot;skip-update&quot; as well as &quot;offline-scan&quot; in an air-gapped environment.</span></span><br><span class=\"line\">  <span class=\"attr\">offline_scan:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"comment\">#</span></span><br><span class=\"line\">  <span class=\"comment\"># insecure The flag to skip verifying registry certificate</span></span><br><span class=\"line\">  <span class=\"attr\">insecure:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"comment\"># github_token The GitHub access token to download Trivy DB</span></span><br><span class=\"line\">  <span class=\"comment\">#</span></span><br><span class=\"line\">  <span class=\"comment\"># Anonymous downloads from GitHub are subject to the limit of 60 requests per hour. Normally such rate limit is enough</span></span><br><span class=\"line\">  <span class=\"comment\"># for production operations. If, for any reason, it&#x27;s not enough, you could increase the rate limit to 5000</span></span><br><span class=\"line\">  <span class=\"comment\"># requests per hour by specifying the GitHub access token. For more details on GitHub rate limiting please consult</span></span><br><span class=\"line\">  <span class=\"comment\"># https://developer.github.com/v3/#rate-limiting</span></span><br><span class=\"line\">  <span class=\"comment\">#</span></span><br><span class=\"line\">  <span class=\"comment\"># You can create a GitHub token by following the instructions in</span></span><br><span class=\"line\">  <span class=\"comment\"># https://help.github.com/en/github/authenticating-to-github/creating-a-personal-access-token-for-the-command-line</span></span><br><span class=\"line\">  <span class=\"comment\">#</span></span><br><span class=\"line\">  <span class=\"comment\"># github_token: xxx</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">jobservice:</span></span><br><span class=\"line\">  <span class=\"comment\"># Maximum number of job workers in job service</span></span><br><span class=\"line\">  <span class=\"attr\">max_job_workers:</span> <span class=\"number\">10</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">notification:</span></span><br><span class=\"line\">  <span class=\"comment\"># Maximum retry count for webhook job</span></span><br><span class=\"line\">  <span class=\"attr\">webhook_job_max_retry:</span> <span class=\"number\">10</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">chart:</span></span><br><span class=\"line\">  <span class=\"comment\"># Change the value of absolute_url to enabled can enable absolute url in chart</span></span><br><span class=\"line\">  <span class=\"attr\">absolute_url:</span> <span class=\"string\">disabled</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Log configurations</span></span><br><span class=\"line\"><span class=\"attr\">log:</span></span><br><span class=\"line\">  <span class=\"comment\"># options are debug, info, warning, error, fatal</span></span><br><span class=\"line\">  <span class=\"attr\">level:</span> <span class=\"string\">info</span></span><br><span class=\"line\">  <span class=\"comment\"># configs for logs in local storage</span></span><br><span class=\"line\">  <span class=\"attr\">local:</span></span><br><span class=\"line\">    <span class=\"comment\"># Log files are rotated log_rotate_count times before being removed. If count is 0, old versions are removed rather than rotated.</span></span><br><span class=\"line\">    <span class=\"attr\">rotate_count:</span> <span class=\"number\">50</span></span><br><span class=\"line\">    <span class=\"comment\"># Log files are rotated only if they grow bigger than log_rotate_size bytes. If size is followed by k, the size is assumed to be in kilobytes.</span></span><br><span class=\"line\">    <span class=\"comment\"># If the M is used, the size is in megabytes, and if G is used, the size is in gigabytes. So size 100, size 100k, size 100M and size 100G</span></span><br><span class=\"line\">    <span class=\"comment\"># are all valid.</span></span><br><span class=\"line\">    <span class=\"attr\">rotate_size:</span> <span class=\"string\">200M</span></span><br><span class=\"line\">    <span class=\"comment\"># The directory on your host that store log</span></span><br><span class=\"line\">    <span class=\"attr\">location:</span> <span class=\"string\">/var/log/harbor</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># Uncomment following lines to enable external syslog endpoint.</span></span><br><span class=\"line\">  <span class=\"comment\"># external_endpoint:</span></span><br><span class=\"line\">  <span class=\"comment\">#   # protocol used to transmit log to external endpoint, options is tcp or udp</span></span><br><span class=\"line\">  <span class=\"comment\">#   protocol: tcp</span></span><br><span class=\"line\">  <span class=\"comment\">#   # The host of external endpoint</span></span><br><span class=\"line\">  <span class=\"comment\">#   host: localhost</span></span><br><span class=\"line\">  <span class=\"comment\">#   # Port of external endpoint</span></span><br><span class=\"line\">  <span class=\"comment\">#   port: 5140</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#This attribute is for migrator to detect the version of the .cfg file, DO NOT MODIFY!</span></span><br><span class=\"line\"><span class=\"attr\">_version:</span> <span class=\"number\">2.5</span><span class=\"number\">.0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Uncomment external_database if using external database.</span></span><br><span class=\"line\"><span class=\"comment\"># external_database:</span></span><br><span class=\"line\"><span class=\"comment\">#   harbor:</span></span><br><span class=\"line\"><span class=\"comment\">#     host: harbor_db_host</span></span><br><span class=\"line\"><span class=\"comment\">#     port: harbor_db_port</span></span><br><span class=\"line\"><span class=\"comment\">#     db_name: harbor_db_name</span></span><br><span class=\"line\"><span class=\"comment\">#     username: harbor_db_username</span></span><br><span class=\"line\"><span class=\"comment\">#     password: harbor_db_password</span></span><br><span class=\"line\"><span class=\"comment\">#     ssl_mode: disable</span></span><br><span class=\"line\"><span class=\"comment\">#     max_idle_conns: 2</span></span><br><span class=\"line\"><span class=\"comment\">#     max_open_conns: 0</span></span><br><span class=\"line\"><span class=\"comment\">#   notary_signer:</span></span><br><span class=\"line\"><span class=\"comment\">#     host: notary_signer_db_host</span></span><br><span class=\"line\"><span class=\"comment\">#     port: notary_signer_db_port</span></span><br><span class=\"line\"><span class=\"comment\">#     db_name: notary_signer_db_name</span></span><br><span class=\"line\"><span class=\"comment\">#     username: notary_signer_db_username</span></span><br><span class=\"line\"><span class=\"comment\">#     password: notary_signer_db_password</span></span><br><span class=\"line\"><span class=\"comment\">#     ssl_mode: disable</span></span><br><span class=\"line\"><span class=\"comment\">#   notary_server:</span></span><br><span class=\"line\"><span class=\"comment\">#     host: notary_server_db_host</span></span><br><span class=\"line\"><span class=\"comment\">#     port: notary_server_db_port</span></span><br><span class=\"line\"><span class=\"comment\">#     db_name: notary_server_db_name</span></span><br><span class=\"line\"><span class=\"comment\">#     username: notary_server_db_username</span></span><br><span class=\"line\"><span class=\"comment\">#     password: notary_server_db_password</span></span><br><span class=\"line\"><span class=\"comment\">#     ssl_mode: disable</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Uncomment external_redis if using external Redis server</span></span><br><span class=\"line\"><span class=\"comment\"># external_redis:</span></span><br><span class=\"line\"><span class=\"comment\">#   # support redis, redis+sentinel</span></span><br><span class=\"line\"><span class=\"comment\">#   # host for redis: &lt;host_redis&gt;:&lt;port_redis&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#   # host for redis+sentinel:</span></span><br><span class=\"line\"><span class=\"comment\">#   #  &lt;host_sentinel1&gt;:&lt;port_sentinel1&gt;,&lt;host_sentinel2&gt;:&lt;port_sentinel2&gt;,&lt;host_sentinel3&gt;:&lt;port_sentinel3&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#   host: redis:6379</span></span><br><span class=\"line\"><span class=\"comment\">#   password: </span></span><br><span class=\"line\"><span class=\"comment\">#   # sentinel_master_set must be set to support redis+sentinel</span></span><br><span class=\"line\"><span class=\"comment\">#   #sentinel_master_set:</span></span><br><span class=\"line\"><span class=\"comment\">#   # db_index 0 is for core, it&#x27;s unchangeable</span></span><br><span class=\"line\"><span class=\"comment\">#   registry_db_index: 1</span></span><br><span class=\"line\"><span class=\"comment\">#   jobservice_db_index: 2</span></span><br><span class=\"line\"><span class=\"comment\">#   chartmuseum_db_index: 3</span></span><br><span class=\"line\"><span class=\"comment\">#   trivy_db_index: 5</span></span><br><span class=\"line\"><span class=\"comment\">#   idle_timeout_seconds: 30</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Uncomment uaa for trusting the certificate of uaa instance that is hosted via self-signed cert.</span></span><br><span class=\"line\"><span class=\"comment\"># uaa:</span></span><br><span class=\"line\"><span class=\"comment\">#   ca_file: /path/to/ca</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Global proxy</span></span><br><span class=\"line\"><span class=\"comment\"># Config http proxy for components, e.g. http://my.proxy.com:3128</span></span><br><span class=\"line\"><span class=\"comment\"># Components doesn&#x27;t need to connect to each others via http proxy.</span></span><br><span class=\"line\"><span class=\"comment\"># Remove component from `components` array if want disable proxy</span></span><br><span class=\"line\"><span class=\"comment\"># for it. If you want use proxy for replication, MUST enable proxy</span></span><br><span class=\"line\"><span class=\"comment\"># for core and jobservice, and set `http_proxy` and `https_proxy`.</span></span><br><span class=\"line\"><span class=\"comment\"># Add domain to the `no_proxy` field, when you want disable proxy</span></span><br><span class=\"line\"><span class=\"comment\"># for some special registry.</span></span><br><span class=\"line\"><span class=\"attr\">proxy:</span></span><br><span class=\"line\">  <span class=\"attr\">http_proxy:</span></span><br><span class=\"line\">  <span class=\"attr\">https_proxy:</span></span><br><span class=\"line\">  <span class=\"attr\">no_proxy:</span></span><br><span class=\"line\">  <span class=\"attr\">components:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">core</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">jobservice</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">trivy</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># metric:</span></span><br><span class=\"line\"><span class=\"comment\">#   enabled: false</span></span><br><span class=\"line\"><span class=\"comment\">#   port: 9090</span></span><br><span class=\"line\"><span class=\"comment\">#   path: /metrics</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Trace related config</span></span><br><span class=\"line\"><span class=\"comment\"># only can enable one trace provider(jaeger or otel) at the same time,</span></span><br><span class=\"line\"><span class=\"comment\"># and when using jaeger as provider, can only enable it with agent mode or collector mode.</span></span><br><span class=\"line\"><span class=\"comment\"># if using jaeger collector mode, uncomment endpoint and uncomment username, password if needed</span></span><br><span class=\"line\"><span class=\"comment\"># if using jaeger agetn mode uncomment agent_host and agent_port</span></span><br><span class=\"line\"><span class=\"comment\"># trace:</span></span><br><span class=\"line\"><span class=\"comment\">#   enabled: true</span></span><br><span class=\"line\"><span class=\"comment\">#   # set sample_rate to 1 if you wanna sampling 100% of trace data; set 0.5 if you wanna sampling 50% of trace data, and so forth</span></span><br><span class=\"line\"><span class=\"comment\">#   sample_rate: 1</span></span><br><span class=\"line\"><span class=\"comment\">#   # # namespace used to differenciate different harbor services</span></span><br><span class=\"line\"><span class=\"comment\">#   # namespace:</span></span><br><span class=\"line\"><span class=\"comment\">#   # # attributes is a key value dict contains user defined attributes used to initialize trace provider</span></span><br><span class=\"line\"><span class=\"comment\">#   # attributes:</span></span><br><span class=\"line\"><span class=\"comment\">#   #   application: harbor</span></span><br><span class=\"line\"><span class=\"comment\">#   # # jaeger should be 1.26 or newer.</span></span><br><span class=\"line\"><span class=\"comment\">#   # jaeger:</span></span><br><span class=\"line\"><span class=\"comment\">#   #   endpoint: http://hostname:14268/api/traces</span></span><br><span class=\"line\"><span class=\"comment\">#   #   username:</span></span><br><span class=\"line\"><span class=\"comment\">#   #   password:</span></span><br><span class=\"line\"><span class=\"comment\">#   #   agent_host: hostname</span></span><br><span class=\"line\"><span class=\"comment\">#   #   # export trace data by jaeger.thrift in compact mode</span></span><br><span class=\"line\"><span class=\"comment\">#   #   agent_port: 6831</span></span><br><span class=\"line\"><span class=\"comment\">#   # otel:</span></span><br><span class=\"line\"><span class=\"comment\">#   #   endpoint: hostname:4318</span></span><br><span class=\"line\"><span class=\"comment\">#   #   url_path: /v1/traces</span></span><br><span class=\"line\"><span class=\"comment\">#   #   compression: false</span></span><br><span class=\"line\"><span class=\"comment\">#   #   insecure: true</span></span><br><span class=\"line\"><span class=\"comment\">#   #   timeout: 10s</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># enable purge _upload directories</span></span><br><span class=\"line\"><span class=\"attr\">upload_purging:</span></span><br><span class=\"line\">  <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"comment\"># remove files in _upload directories which exist for a period of time, default is one week.</span></span><br><span class=\"line\">  <span class=\"attr\">age:</span> <span class=\"string\">168h</span></span><br><span class=\"line\">  <span class=\"comment\"># the interval of the purge operations</span></span><br><span class=\"line\">  <span class=\"attr\">interval:</span> <span class=\"string\">24h</span></span><br><span class=\"line\">  <span class=\"attr\">dryrun:</span> <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n\n<p>harbor登录</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sz-memect.tpddns.cn:4433</span><br><span class=\"line\">账号：admin</span><br><span class=\"line\">密码：admin123</span><br></pre></td></tr></table></figure>\n\n<p>harbor卸载</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rm -rf `find / -name harbor`</span><br><span class=\"line\">删除容器</span><br><span class=\"line\">docker rmi $(docker images -q)</span><br></pre></td></tr></table></figure>\n\n<p>另外一台机器拉取和推送镜像</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir /etc/docker/certs.d/192.168.50.21:4433</span><br></pre></td></tr></table></figure>\n\n<p>然后后从 Harbor 主机拷贝证书文件到 Docker 客户端上，需要 server 的证书和密钥以及 CA 证书。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scp /data/cert/192.168.50.21.key  root@192.168.50.20:/etc/docker/certs.d/192.168.50.21:4433</span><br><span class=\"line\">scp /data/cert/192.168.50.21.cert  root@192.168.50.20:/etc/docker/certs.d/192.168.50.21:4433</span><br><span class=\"line\">scp /data/cert/ca.crt  root@192.168.50.20:/etc/docker/certs.d/192.168.50.21:4433</span><br></pre></td></tr></table></figure>\n\n<p>拉取命令</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull 192.168.50.21:4433/library/mysql:latest</span><br></pre></td></tr></table></figure>\n\n<p>推送镜像</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 打tag</span><br><span class=\"line\">docker tag mongo:latest 192.168.50.21:4433/library/mongo:latest</span><br><span class=\"line\"></span><br><span class=\"line\"># 推送镜像</span><br><span class=\"line\">docker push 192.168.50.21:4433/library/mongo:latest</span><br></pre></td></tr></table></figure>\n\n"},{"title":"Linux命令记录","date":"2021-11-20T04:31:01.000Z","keywords":"linux","description":"linux命令记录","cover":"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg","top_img":"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg","_content":"\n# Linux命令记录\n\n## 基本操作\n\n> ### Linux关机,重启\n\n```\n# 关机\nshutdown -h now\n\n# 重启\nshutdown -r now\n```\n\n> ### 查看系统,CPU信息\n\n```\n# 查看系统内核信息\nuname -a\n\n# 查看系统内核版本\ncat /proc/version\n\n# 查看当前用户环境变量\nenv\n\ncat /proc/cpuinfo\n\n# 查看有几个逻辑cpu, 包括cpu型号\ncat /proc/cpuinfo | grep name | cut -f2 -d: | uniq -c\n\n# 查看有几颗cpu,每颗分别是几核\ncat /proc/cpuinfo | grep physical | uniq -c\n\n# 查看当前CPU运行在32bit还是64bit模式下, 如果是运行在32bit下也不代表CPU不支持64bit\ngetconf LONG_BIT\n\n# 结果大于0, 说明支持64bit计算. lm指long mode, 支持lm则是64bit\ncat /proc/cpuinfo | grep flags | grep ' lm ' | wc -l\n```\n\n> ### 建立软连接\n\n```\nln -s /usr/local/jdk1.8/ jdk\n```\n\n> ## rpm相关\n\n```\n# 查看是否通过rpm安装了该软件\nrpm -qa | grep 软件名\n```\n\n> ## sshkey\n\n```\n# 创建sshkey\nssh-keygen -t rsa -C your_email@example.com\n\n#id_rsa.pub 的内容拷贝到要控制的服务器的 home/username/.ssh/authorized_keys 中,如果没有则新建(.ssh权限为700, authorized_keys权限为600)\n```\n\n> ## 命令重命名\n\n```\n# 在各个用户的.bash_profile中添加重命名配置\nalias ll='ls -alF'\n```\n\n> ## 同步服务器时间\n\n```\nsudo ntpdate -u ntp.api.bz\n```\n\n> ## 后台运行命令\n\n```\n# 后台运行,并且有nohup.out输出\nnohup xxx &\n\n# 后台运行, 不输出任何日志\nnohup xxx > /dev/null &\n\n# 后台运行, 并将错误信息做标准输出到日志中 \nnohup xxx >out.log 2>&1 &\n```\n\n> ## 强制活动用户退出\n\n```\n# 命令来完成强制活动用户退出.其中TTY表示终端名称\npkill -kill -t [TTY]\n```\n\n> ## 查看命令路径\n\n```\nwhich <命令>\n```\n\n> ## 查看进程所有打开最大fd数\n\n```\nulimit -n\n```\n\n> ## 配置dns\n\n```\nvim /etc/resolv.conf\n```\n\n> ## nslookup,查看域名路由表\n\n```\nnslookup google.com\n```\n\n> ## last, 最近登录信息列表\n\n```\n# 最近登录的5个账号\nlast -n 5\n```\n\n> ## 设置固定ip\n\n```\nifconfig em1  192.168.5.177 netmask 255.255.255.0\n```\n\n> ## 查看进程内加载的环境变量\n\n```\n# 也可以去 cd /proc 目录下, 查看进程内存中加载的东西\nps eww -p  XXXXX(进程号)\n```\n\n> ## 查看进程树找到服务器进程\n\n```\nps auwxf\n```\n\n> ## 查看进程启动路径\n\n```\ncd /proc/xxx(进程号)\nls -all\n# cwd对应的是启动路径\n```\n\n> ## 添加用户, 配置sudo权限\n\n```\n# 新增用户\nuseradd 用户名\npasswd 用户名\n\n#增加sudo权限\nvim /etc/sudoers\n# 修改文件里面的\n# root    ALL=(ALL)       ALL\n# 用户名 ALL=(ALL)       ALL\n```\n\n> ## 强制关闭进程名包含xxx的所有进程\n\n```\nps aux|grep xxx | grep -v grep | awk '{print $2}' | xargs kill -9\n```\n\n\n\n## **磁盘,文件,目录相关操作**\n\n> ## vim操作\n\n```\n#normal模式下 g表示全局, x表示查找的内容, y表示替换后的内容\n:%s/x/y/g\n\n#normal模式下\n0  # 光标移到行首(数字0)\n$  # 光标移至行尾\nshift + g # 跳到文件最后\ngg # 跳到文件头\n\n# 显示行号\n:set nu\n\n# 去除行号\n:set nonu\n\n# 检索\n/xxx(检索内容)  # 从头检索, 按n查找下一个\n?xxx(检索内容)  # 从尾部检索\n```\n\n> ## 打开只读文件,修改后需要保存时(不用切换用户即可保存的方式)\n\n```\n# 在normal模式下\n:w !sudo tee %\n```\n\n> ## 查看磁盘, 文件目录基本信息\n\n```\n# 查看磁盘挂载情况\nmount\n\n# 查看磁盘分区信息\ndf\n\n# 查看目录及子目录大小\ndu -H -h\n\n# 查看当前目录下各个文件, 文件夹占了多少空间, 不会递归\ndu -sh *\n```\n\n> ## wc命令\n\n```\n# 查看文件里有多少行\nwc -l filename\n\n# 看文件里有多少个word\nwc -w filename\n\n# 文件里最长的那一行是多少个字\nwc -L filename\n\n# 统计字节数\nwc -c\n```\n\n> ## 常用压缩, 解压缩命令\n\n> ### 压缩命令\n\n```\ntar czvf xxx.tar 压缩目录\n\nzip -r xxx.zip 压缩目录\n```\n\n> ### 解压缩命令\n\n```\ntar zxvf xxx.tar\n\n# 解压到指定文件夹\ntar zxvf xxx.tar -C /xxx/yyy/\n\nunzip xxx.zip\n```\n\n> ## 变更文件所属用户, 用户组\n\n```\nchown eagleye.eagleye xxx.log\n```\n\n> ## cp, scp, mkdir\n\n```\n#复制\ncp xxx.log\n\n# 复制并强制覆盖同名文件\ncp -f xxx.log\n\n# 复制文件夹\ncp -r xxx(源文件夹) yyy(目标文件夹)\n\n# 远程复制\nscp -P ssh端口 username@10.10.10.101:/home/username/xxx /home/xxx\n\n# 级联创建目录\nmkdir -p /xxx/yyy/zzz\n\n# 批量创建文件夹, 会在test,main下都创建java, resources文件夹\nmkdir -p src/{test,main}/{java,resources}\n```\n\n> ## 比较两个文件\n\n```\ndiff -u 1.txt 2.txt\n```\n\n> ## 日志输出的字节数,可以用作性能测试\n\n```\n# 如果做性能测试, 可以每执行一次, 往日志里面输出 “.” , 这样日志中的字节数就是实际的性能测试运行的次数, 还可以看见实时速率.\ntail -f xxx.log | pv -bt\n```\n\n> ## 查看, 去除特殊字符\n\n```\n# 查看特殊字符\ncat -v xxx.sh\n\n# 去除特殊字符\nsed -i 's/^M//g’ env.sh  去除文件的特殊字符, 比如^M:  需要这样输入: ctrl+v+enter\n```\n\n> ## 处理因系统原因引起的文件中特殊字符的问题\n\n```\n# 可以转换为该系统下的文件格式\ncat file.sh > file.sh_bak\n\n# 先将file.sh中文件内容复制下来然后运行, 然后粘贴内容, 最后ctrl + d 保存退出\ncat > file1.sh\n\n# 在vim中通过如下设置文件编码和文件格式\n:set fileencodings=utf-8 ，然后 w （存盘）一下即可转化为 utf8 格式，\n:set fileformat=unix\n\n# 在mac下使用dos2unix进行文件格式化\nfind . -name \"*.sh\" | xargs dos2unix\n```\n\n> ## tee, 重定向的同时输出到屏幕\n\n```\nawk ‘{print $0}’ xxx.log | tee test.log\n```\n\n\n\n## **检索相关**\n\n> ## grep\n\n```\n# 反向匹配, 查找不包含xxx的内容\ngrep -v xxx\n\n# 排除所有空行\ngrep -v '^/pre>\n\n# 返回结果 2,则说明第二行是空行\ngrep -n “^$” 111.txt    \n\n# 查询以abc开头的行\ngrep -n “^abc” 111.txt \n\n# 同时列出该词语出现在文章的第几行\ngrep 'xxx' -n xxx.log\n\n# 计算一下该字串出现的次数\ngrep 'xxx' -c xxx.log\n\n# 比对的时候，不计较大小写的不同\ngrep 'xxx' -i xxx.log\n```\n\n> ## awk\n\n```\n# 以':' 为分隔符,如果第五域有user则输出该行\nawk -F ':' '{if ($5 ~ /user/) print $0}' /etc/passwd \n\n# 统计单个文件中某个字符（串）(中文无效)出现的次数\nawk -v RS='character' 'END {print --NR}' xxx.txt\n```\n\n> ## find检索命令\n\n```\n# 在目录下找后缀是.mysql的文件\nfind /home/eagleye -name '*.mysql' -print\n\n# 会从 /usr 目录开始往下找，找最近3天之内存取过的文件。\nfind /usr -atime 3 –print\n\n# 会从 /usr 目录开始往下找，找最近5天之内修改过的文件。\nfind /usr -ctime 5 –print\n\n# 会从 /doc 目录开始往下找，找jacky 的、文件名开头是 j的文件。  \nfind /doc -user jacky -name 'j*' –print\n\n# 会从 /doc 目录开始往下找，找寻文件名是 ja 开头或者 ma开头的文件。\nfind /doc \\( -name 'ja*' -o- -name 'ma*' \\) –print\n\n#  会从 /doc 目录开始往下找，找到凡是文件名结尾为 bak的文件，把它删除掉。-exec 选项是执行的意思，rm 是删除命令，{ } 表示文件名，“\\;”是规定的命令结尾。 \nfind /doc -name '*bak' -exec rm {} \\;\n```\n\n\n\n## **网络相关**\n\n> ## 查看什么进程使用了该端口\n\n```\nlsof -i:port\n```\n\n> ## 获取本机ip地址\n\n```\n/sbin/ifconfig -a|grep inet|grep -v 127.0.0.1|grep -v inet6|awk '{print $2}'|tr -d \"addr:\"\n```\n\n> ## iptables\n\n```\n# 查看iptables状态\nservice iptables status\n\n# 要封停一个ip\niptables -I INPUT -s ***.***.***.*** -j DROP\n\n# 要解封一个IP，使用下面这条命令：\niptables -D INPUT -s ***.***.***.*** -j DROP\n\n备注: 参数-I是表示Insert（添加），-D表示Delete（删除）。后面跟的是规则，INPUT表示入站，***.***.***.***表示要封停的IP，DROP表示放弃连接。\n\n#开启9090端口的访问\n/sbin/iptables -I INPUT -p tcp --dport 9090 -j ACCEPT \n\n# 防火墙开启、关闭、重启\n/etc/init.d/iptables status\n/etc/init.d/iptables start\n/etc/init.d/iptables stop\n/etc/init.d/iptables restart\n```\n\n> ## nc命令, tcp调试利器\n\n```\n#给某一个endpoint发送TCP请求,就将data的内容发送到对端\nnc 192.168.0.11 8000 < data.txt\n\n#nc可以当做服务器，监听某个端口号,把某一次请求的内容存储到received_data里\nnc -l 8000 > received_data\n\n#上边只监听一次，如果多次可以加上-k参数\nnc -lk 8000\n```\n\n> ## tcpdump\n\n```\n# dump出本机12301端口的tcp包\ntcpdump -i em1 tcp port 12301 -s 1500 -w abc.pcap\n```\n\n> ## 跟踪网络路由路径\n\n```\n# traceroute默认使用udp方式, 如果是-I则改成icmp方式\ntraceroute -I www.163.com\n\n# 从ttl第3跳跟踪\ntraceroute -M 3 www.163.com  \n\n# 加上端口跟踪\ntraceroute -p 8080 192.168.10.11\n```\n\n> ## ss\n\n```\n# 显示本地打开的所有端口\nss -l \n\n# 显示每个进程具体打开的socket\nss -pl \n\n# 显示所有tcp socket\nss -t -a \n\n# 显示所有的UDP Socekt\nss -u -a \n\n# 显示所有已建立的SMTP连接\nss -o state established '( dport = :smtp or sport = :smtp )'  \n\n# 显示所有已建立的HTTP连接 \nss -o state established '( dport = :http or sport = :http )'  \n\n找出所有连接X服务器的进程\nss -x src /tmp/.X11-unix/*  \n\n列出当前socket统计信息\nss -s \n\n解释：netstat是遍历/proc下面每个PID目录，ss直接读/proc/net下面的统计信息。所以ss执行的时候消耗资源以及消耗的时间都比netstat少很多\n```\n\n> ## netstat\n\n```\n# 输出每个ip的连接数，以及总的各个状态的连接数\nnetstat -n | awk '/^tcp/ {n=split($(NF-1),array,\":\");if(n<=2)++S[array[(1)]];else++S[array[(4)]];++s[$NF];++N} END {for(a in S){printf(\"%-20s %s\\n\", a, S[a]);++I}printf(\"%-20s %s\\n\",\"TOTAL_IP\",I);for(a in s) printf(\"%-20s %s\\n\",a, s[a]);printf(\"%-20s %s\\n\",\"TOTAL_LINK\",N);}'\n\n# 统计所有连接状态, \n# CLOSED：无连接是活动的或正在进行\n# LISTEN：服务器在等待进入呼叫\n# SYN_RECV：一个连接请求已经到达，等待确认\n# SYN_SENT：应用已经开始，打开一个连接\n# ESTABLISHED：正常数据传输状态\n# FIN_WAIT1：应用说它已经完成\n# FIN_WAIT2：另一边已同意释放\n# ITMED_WAIT：等待所有分组死掉\n# CLOSING：两边同时尝试关闭\n# TIME_WAIT：主动关闭连接一端还没有等到另一端反馈期间的状态\n# LAST_ACK：等待所有分组死掉\nnetstat -n | awk '/^tcp/ {++state[$NF]} END {for(key in state) print key,\"\\t\",state[key]}'\n\n# 查找较多time_wait连接\nnetstat -n|grep TIME_WAIT|awk '{print $5}'|sort|uniq -c|sort -rn|head -n20\n```\n\n\n\n## **监控linux性能命令**\n\n> ## top\n\n```\n按大写的 F 或 O 键，然后按 a-z 可以将进程按照相应的列进行排序, 然后回车。而大写的 R 键可以将当前的排序倒转\n```\n\n| 列名    | 含义                                                         |\n| :------ | :----------------------------------------------------------- |\n| PID     | 进程id                                                       |\n| PPID    | 父进程id                                                     |\n| RUSER   | Real user name                                               |\n| UID     | 进程所有者的用户id                                           |\n| USER    | 进程所有者的用户名                                           |\n| GROUP   | 进程所有者的组名                                             |\n| TTY     | 启动进程的终端名。不是从终端启动的进程则显示为 ?             |\n| PR      | 优先级                                                       |\n| NI      | nice值。负值表示高优先级，正值表示低优先级                   |\n| P       | 最后使用的CPU，仅在多CPU环境下有意义                         |\n| %CPU    | 上次更新到现在的CPU时间占用百分比                            |\n| TIME    | 进程使用的CPU时间总计，单位秒                                |\n| TIME+   | 进程使用的CPU时间总计，单位1/100秒                           |\n| %MEM    | 进程使用的物理内存百分比                                     |\n| VIRT    | 进程使用的虚拟内存总量，单位kb。VIRT=SWAP+RES                |\n| SWAP    | 进程使用的虚拟内存中，被换出的大小，单位kb。                 |\n| RES     | 进程使用的、未被换出的物理内存大小，单位kb。RES=CODE+DATA    |\n| CODE    | 可执行代码占用的物理内存大小，单位kb                         |\n| DATA    | 可执行代码以外的部分(数据段+栈)占用的物理内存大小，单位kb    |\n| SHR     | 共享内存大小，单位kb                                         |\n| nFLT    | 页面错误次数                                                 |\n| nDRT    | 最后一次写入到现在，被修改过的页面数。                       |\n| S       | 进程状态。D=不可中断的睡眠状态,R=运行,S=睡眠,T=跟踪/停止,Z=僵尸进程 |\n| COMMAND | 命令名/命令行                                                |\n| WCHAN   | 若该进程在睡眠，则显示睡眠中的系统函数名                     |\n| Flags   | 任务标志，参考 sched.h                                       |\n\n> ## dmesg,查看系统日志\n\n```\ndmesg\n```\n\n> ## iostat,磁盘IO情况监控\n\n```\niostat -xz 1\n\n# r/s, w/s, rkB/s, wkB/s：分别表示每秒读写次数和每秒读写数据量（千字节）。读写量过大，可能会引起性能问题。\n# await：IO操作的平均等待时间，单位是毫秒。这是应用程序在和磁盘交互时，需要消耗的时间，包括IO等待和实际操作的耗时。如果这个数值过大，可能是硬件设备遇到了瓶颈或者出现故障。\n# avgqu-sz：向设备发出的请求平均数量。如果这个数值大于1，可能是硬件设备已经饱和（部分前端硬件设备支持并行写入）。\n# %util：设备利用率。这个数值表示设备的繁忙程度，经验值是如果超过60，可能会影响IO性能（可以参照IO操作平均等待时间）。如果到达100%，说明硬件设备已经饱和。\n# 如果显示的是逻辑设备的数据，那么设备利用率不代表后端实际的硬件设备已经饱和。值得注意的是，即使IO性能不理想，也不一定意味这应用程序性能会不好，可以利用诸如预读取、写缓存等策略提升应用性能。\n```\n\n> ## free,内存使用情况\n\n```\nfree -m\n\neg:\n\n     total       used       free     shared    buffers     cached\nMem:          1002        769        232          0         62        421\n-/+ buffers/cache:          286        715\nSwap:          1153          0       1153\n\n第一部分Mem行:\ntotal 内存总数: 1002M\nused 已经使用的内存数: 769M\nfree 空闲的内存数: 232M\nshared 当前已经废弃不用,总是0\nbuffers Buffer 缓存内存数: 62M\ncached Page 缓存内存数:421M\n\n关系：total(1002M) = used(769M) + free(232M)\n\n第二部分(-/+ buffers/cache):\n(-buffers/cache) used内存数：286M (指的第一部分Mem行中的used – buffers – cached)\n(+buffers/cache) free内存数: 715M (指的第一部分Mem行中的free + buffers + cached)\n\n可见-buffers/cache反映的是被程序实实在在吃掉的内存,而+buffers/cache反映的是可以挪用的内存总数.\n\n第三部分是指交换分区\n```\n\n> ## sar,查看网络吞吐状态\n\n```\n# sar命令在这里可以查看网络设备的吞吐率。在排查性能问题时，可以通过网络设备的吞吐量，判断网络设备是否已经饱和\nsar -n DEV 1\n\n#\n# sar命令在这里用于查看TCP连接状态，其中包括：\n# active/s：每秒本地发起的TCP连接数，既通过connect调用创建的TCP连接；\n# passive/s：每秒远程发起的TCP连接数，即通过accept调用创建的TCP连接；\n# retrans/s：每秒TCP重传数量；\n# TCP连接数可以用来判断性能问题是否由于建立了过多的连接，进一步可以判断是主动发起的连接，还是被动接受的连接。TCP重传可能是因为网络环境恶劣，或者服务器压力过大导致丢包\nsar -n TCP,ETCP 1\n```\n\n> ## vmstat, 给定时间监控CPU使用率, 内存使用, 虚拟内存交互, IO读写\n\n```\n# 2表示每2秒采集一次状态信息, 1表示只采集一次(忽略既是一直采集)\nvmstat 2 1\n\neg:\nr b swpd free buff cache si so bi bo in cs us sy id wa\n1 0 0 3499840 315836 3819660 0 0 0 1 2 0 0 0 100 0\n0 0 0 3499584 315836 3819660 0 0 0 0 88 158 0 0 100 0\n0 0 0 3499708 315836 3819660 0 0 0 2 86 162 0 0 100 0\n0 0 0 3499708 315836 3819660 0 0 0 10 81 151 0 0 100 0\n1 0 0 3499732 315836 3819660 0 0 0 2 83 154 0 0 100 0\n```\n\n- r 表示运行队列(就是说多少个进程真的分配到CPU)，我测试的服务器目前CPU比较空闲，没什么程序在跑，当这个值超过了CPU数目，就会出现CPU瓶颈了。这个也和top的负载有关系，一般负载超过了3就比较高，超过了5就高，超过了10就不正常了，服务器的状态很危险。top的负载类似每秒的运行队列。如果运行队列过大，表示你的CPU很繁忙，一般会造成CPU使用率很高。\n\n- b 表示阻塞的进程,这个不多说，进程阻塞，大家懂的。\n\n- swpd 虚拟内存已使用的大小，如果大于0，表示你的机器物理内存不足了，如果不是程序内存泄露的原因，那么你该升级内存了或者把耗内存的任务迁移到其他机器。\n\n- free 空闲的物理内存的大小，我的机器内存总共8G，剩余3415M。\n\n- buff Linux/Unix系统是用来存储，目录里面有什么内容，权限等的缓存，我本机大概占用300多M\n\n- cache cache直接用来记忆我们打开的文件,给文件做缓冲，我本机大概占用300多M(这里是Linux/Unix的聪明之处，把空闲的物理内存的一部分拿来做文件和目录的缓存，是为了提高 程序执行的性能，当程序使用内存时，buffer/cached会很快地被使用。)\n\n- si 每秒从磁盘读入虚拟内存的大小，如果这个值大于0，表示物理内存不够用或者内存泄露了，要查找耗内存进程解决掉。我的机器内存充裕，一切正常。\n\n- so 每秒虚拟内存写入磁盘的大小，如果这个值大于0，同上。\n\n- bi 块设备每秒接收的块数量，这里的块设备是指系统上所有的磁盘和其他块设备，默认块大小是1024byte，我本机上没什么IO操作，所以一直是0，但是我曾在处理拷贝大量数据(2-3T)的机器上看过可以达到140000/s，磁盘写入速度差不多140M每秒\n\n- bo 块设备每秒发送的块数量，例如我们读取文件，bo就要大于0。bi和bo一般都要接近0，不然就是IO过于频繁，需要调整。\n\n- in 每秒CPU的中断次数，包括时间中断\n\n- cs 每秒上下文切换次数，例如我们调用系统函数，就要进行上下文切换，线程的切换，也要进程上下文切换，这个值要越小越好，太大了，要考虑调低线程或者进程的数目,例如在apache和nginx这种web服务器中，我们一般做性能测试时会进行几千并发甚至几万并发的测试，选择web服务器的进程可以由进程或者线程的峰值一直下调，压测，直到cs到一个比较小的值，这个进程和线程数就是比较合适的值了。系统调用也是，每次调用系统函数，我们的代码就会进入内核空间，导致上下文切换，这个是很耗资源，也要尽量避免频繁调用系统函数。上下文切换次数过多表示你的CPU大部分浪费在上下文切换，导致CPU干正经事的时间少了，CPU没有充分利用，是不可取的。\n\n- us 用户CPU时间，我曾经在一个做加密解密很频繁的服务器上，可以看到us接近100,r运行队列达到80(机器在做压力测试，性能表现不佳)。\n\n- sy 系统CPU时间，如果太高，表示系统调用时间长，例如是IO操作频繁。\n\n- id 空闲 CPU时间，一般来说，id + us + sy = 100,一般我认为id是空闲CPU使用率，us是用户CPU使用率，sy是系统CPU使用率。\n\n- wt 等待IO CPU时间。\n\n- \n\n- ```\n  export DOCKERPATH=/usr/bin/docker\n  export PATH=$PATH:$DOCKERPATH\n  \n  sz-memect.tpddns.cn:5000\n  chown -R root:root /usr/share/jenkins\n  chown -R root:root /usr/share/doc/jenkins\n  chown -R root:root /usr/bin/jenkins\n  chown -R root:root /var/lib/jenkins\n  chown -R root:root /var/log/jenkins\n  chown -R root:root /var/cache/jenkins\n  chown -R root:root /etc/default/jenkins\n  chown -R root:root /etc/init.d/jenkins\n  chown -R root:root /etc/logrotate.d/jenkins\n  ```\n","source":"_posts/Linux命令记录.md","raw":"---\ntitle: Linux命令记录\ndate: 2021-11-20 12:31:01\ntags: linux\ncategories: linux\nkeywords: linux\ndescription: linux命令记录\ncover: https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg\ntop_img: https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg\n---\n\n# Linux命令记录\n\n## 基本操作\n\n> ### Linux关机,重启\n\n```\n# 关机\nshutdown -h now\n\n# 重启\nshutdown -r now\n```\n\n> ### 查看系统,CPU信息\n\n```\n# 查看系统内核信息\nuname -a\n\n# 查看系统内核版本\ncat /proc/version\n\n# 查看当前用户环境变量\nenv\n\ncat /proc/cpuinfo\n\n# 查看有几个逻辑cpu, 包括cpu型号\ncat /proc/cpuinfo | grep name | cut -f2 -d: | uniq -c\n\n# 查看有几颗cpu,每颗分别是几核\ncat /proc/cpuinfo | grep physical | uniq -c\n\n# 查看当前CPU运行在32bit还是64bit模式下, 如果是运行在32bit下也不代表CPU不支持64bit\ngetconf LONG_BIT\n\n# 结果大于0, 说明支持64bit计算. lm指long mode, 支持lm则是64bit\ncat /proc/cpuinfo | grep flags | grep ' lm ' | wc -l\n```\n\n> ### 建立软连接\n\n```\nln -s /usr/local/jdk1.8/ jdk\n```\n\n> ## rpm相关\n\n```\n# 查看是否通过rpm安装了该软件\nrpm -qa | grep 软件名\n```\n\n> ## sshkey\n\n```\n# 创建sshkey\nssh-keygen -t rsa -C your_email@example.com\n\n#id_rsa.pub 的内容拷贝到要控制的服务器的 home/username/.ssh/authorized_keys 中,如果没有则新建(.ssh权限为700, authorized_keys权限为600)\n```\n\n> ## 命令重命名\n\n```\n# 在各个用户的.bash_profile中添加重命名配置\nalias ll='ls -alF'\n```\n\n> ## 同步服务器时间\n\n```\nsudo ntpdate -u ntp.api.bz\n```\n\n> ## 后台运行命令\n\n```\n# 后台运行,并且有nohup.out输出\nnohup xxx &\n\n# 后台运行, 不输出任何日志\nnohup xxx > /dev/null &\n\n# 后台运行, 并将错误信息做标准输出到日志中 \nnohup xxx >out.log 2>&1 &\n```\n\n> ## 强制活动用户退出\n\n```\n# 命令来完成强制活动用户退出.其中TTY表示终端名称\npkill -kill -t [TTY]\n```\n\n> ## 查看命令路径\n\n```\nwhich <命令>\n```\n\n> ## 查看进程所有打开最大fd数\n\n```\nulimit -n\n```\n\n> ## 配置dns\n\n```\nvim /etc/resolv.conf\n```\n\n> ## nslookup,查看域名路由表\n\n```\nnslookup google.com\n```\n\n> ## last, 最近登录信息列表\n\n```\n# 最近登录的5个账号\nlast -n 5\n```\n\n> ## 设置固定ip\n\n```\nifconfig em1  192.168.5.177 netmask 255.255.255.0\n```\n\n> ## 查看进程内加载的环境变量\n\n```\n# 也可以去 cd /proc 目录下, 查看进程内存中加载的东西\nps eww -p  XXXXX(进程号)\n```\n\n> ## 查看进程树找到服务器进程\n\n```\nps auwxf\n```\n\n> ## 查看进程启动路径\n\n```\ncd /proc/xxx(进程号)\nls -all\n# cwd对应的是启动路径\n```\n\n> ## 添加用户, 配置sudo权限\n\n```\n# 新增用户\nuseradd 用户名\npasswd 用户名\n\n#增加sudo权限\nvim /etc/sudoers\n# 修改文件里面的\n# root    ALL=(ALL)       ALL\n# 用户名 ALL=(ALL)       ALL\n```\n\n> ## 强制关闭进程名包含xxx的所有进程\n\n```\nps aux|grep xxx | grep -v grep | awk '{print $2}' | xargs kill -9\n```\n\n\n\n## **磁盘,文件,目录相关操作**\n\n> ## vim操作\n\n```\n#normal模式下 g表示全局, x表示查找的内容, y表示替换后的内容\n:%s/x/y/g\n\n#normal模式下\n0  # 光标移到行首(数字0)\n$  # 光标移至行尾\nshift + g # 跳到文件最后\ngg # 跳到文件头\n\n# 显示行号\n:set nu\n\n# 去除行号\n:set nonu\n\n# 检索\n/xxx(检索内容)  # 从头检索, 按n查找下一个\n?xxx(检索内容)  # 从尾部检索\n```\n\n> ## 打开只读文件,修改后需要保存时(不用切换用户即可保存的方式)\n\n```\n# 在normal模式下\n:w !sudo tee %\n```\n\n> ## 查看磁盘, 文件目录基本信息\n\n```\n# 查看磁盘挂载情况\nmount\n\n# 查看磁盘分区信息\ndf\n\n# 查看目录及子目录大小\ndu -H -h\n\n# 查看当前目录下各个文件, 文件夹占了多少空间, 不会递归\ndu -sh *\n```\n\n> ## wc命令\n\n```\n# 查看文件里有多少行\nwc -l filename\n\n# 看文件里有多少个word\nwc -w filename\n\n# 文件里最长的那一行是多少个字\nwc -L filename\n\n# 统计字节数\nwc -c\n```\n\n> ## 常用压缩, 解压缩命令\n\n> ### 压缩命令\n\n```\ntar czvf xxx.tar 压缩目录\n\nzip -r xxx.zip 压缩目录\n```\n\n> ### 解压缩命令\n\n```\ntar zxvf xxx.tar\n\n# 解压到指定文件夹\ntar zxvf xxx.tar -C /xxx/yyy/\n\nunzip xxx.zip\n```\n\n> ## 变更文件所属用户, 用户组\n\n```\nchown eagleye.eagleye xxx.log\n```\n\n> ## cp, scp, mkdir\n\n```\n#复制\ncp xxx.log\n\n# 复制并强制覆盖同名文件\ncp -f xxx.log\n\n# 复制文件夹\ncp -r xxx(源文件夹) yyy(目标文件夹)\n\n# 远程复制\nscp -P ssh端口 username@10.10.10.101:/home/username/xxx /home/xxx\n\n# 级联创建目录\nmkdir -p /xxx/yyy/zzz\n\n# 批量创建文件夹, 会在test,main下都创建java, resources文件夹\nmkdir -p src/{test,main}/{java,resources}\n```\n\n> ## 比较两个文件\n\n```\ndiff -u 1.txt 2.txt\n```\n\n> ## 日志输出的字节数,可以用作性能测试\n\n```\n# 如果做性能测试, 可以每执行一次, 往日志里面输出 “.” , 这样日志中的字节数就是实际的性能测试运行的次数, 还可以看见实时速率.\ntail -f xxx.log | pv -bt\n```\n\n> ## 查看, 去除特殊字符\n\n```\n# 查看特殊字符\ncat -v xxx.sh\n\n# 去除特殊字符\nsed -i 's/^M//g’ env.sh  去除文件的特殊字符, 比如^M:  需要这样输入: ctrl+v+enter\n```\n\n> ## 处理因系统原因引起的文件中特殊字符的问题\n\n```\n# 可以转换为该系统下的文件格式\ncat file.sh > file.sh_bak\n\n# 先将file.sh中文件内容复制下来然后运行, 然后粘贴内容, 最后ctrl + d 保存退出\ncat > file1.sh\n\n# 在vim中通过如下设置文件编码和文件格式\n:set fileencodings=utf-8 ，然后 w （存盘）一下即可转化为 utf8 格式，\n:set fileformat=unix\n\n# 在mac下使用dos2unix进行文件格式化\nfind . -name \"*.sh\" | xargs dos2unix\n```\n\n> ## tee, 重定向的同时输出到屏幕\n\n```\nawk ‘{print $0}’ xxx.log | tee test.log\n```\n\n\n\n## **检索相关**\n\n> ## grep\n\n```\n# 反向匹配, 查找不包含xxx的内容\ngrep -v xxx\n\n# 排除所有空行\ngrep -v '^/pre>\n\n# 返回结果 2,则说明第二行是空行\ngrep -n “^$” 111.txt    \n\n# 查询以abc开头的行\ngrep -n “^abc” 111.txt \n\n# 同时列出该词语出现在文章的第几行\ngrep 'xxx' -n xxx.log\n\n# 计算一下该字串出现的次数\ngrep 'xxx' -c xxx.log\n\n# 比对的时候，不计较大小写的不同\ngrep 'xxx' -i xxx.log\n```\n\n> ## awk\n\n```\n# 以':' 为分隔符,如果第五域有user则输出该行\nawk -F ':' '{if ($5 ~ /user/) print $0}' /etc/passwd \n\n# 统计单个文件中某个字符（串）(中文无效)出现的次数\nawk -v RS='character' 'END {print --NR}' xxx.txt\n```\n\n> ## find检索命令\n\n```\n# 在目录下找后缀是.mysql的文件\nfind /home/eagleye -name '*.mysql' -print\n\n# 会从 /usr 目录开始往下找，找最近3天之内存取过的文件。\nfind /usr -atime 3 –print\n\n# 会从 /usr 目录开始往下找，找最近5天之内修改过的文件。\nfind /usr -ctime 5 –print\n\n# 会从 /doc 目录开始往下找，找jacky 的、文件名开头是 j的文件。  \nfind /doc -user jacky -name 'j*' –print\n\n# 会从 /doc 目录开始往下找，找寻文件名是 ja 开头或者 ma开头的文件。\nfind /doc \\( -name 'ja*' -o- -name 'ma*' \\) –print\n\n#  会从 /doc 目录开始往下找，找到凡是文件名结尾为 bak的文件，把它删除掉。-exec 选项是执行的意思，rm 是删除命令，{ } 表示文件名，“\\;”是规定的命令结尾。 \nfind /doc -name '*bak' -exec rm {} \\;\n```\n\n\n\n## **网络相关**\n\n> ## 查看什么进程使用了该端口\n\n```\nlsof -i:port\n```\n\n> ## 获取本机ip地址\n\n```\n/sbin/ifconfig -a|grep inet|grep -v 127.0.0.1|grep -v inet6|awk '{print $2}'|tr -d \"addr:\"\n```\n\n> ## iptables\n\n```\n# 查看iptables状态\nservice iptables status\n\n# 要封停一个ip\niptables -I INPUT -s ***.***.***.*** -j DROP\n\n# 要解封一个IP，使用下面这条命令：\niptables -D INPUT -s ***.***.***.*** -j DROP\n\n备注: 参数-I是表示Insert（添加），-D表示Delete（删除）。后面跟的是规则，INPUT表示入站，***.***.***.***表示要封停的IP，DROP表示放弃连接。\n\n#开启9090端口的访问\n/sbin/iptables -I INPUT -p tcp --dport 9090 -j ACCEPT \n\n# 防火墙开启、关闭、重启\n/etc/init.d/iptables status\n/etc/init.d/iptables start\n/etc/init.d/iptables stop\n/etc/init.d/iptables restart\n```\n\n> ## nc命令, tcp调试利器\n\n```\n#给某一个endpoint发送TCP请求,就将data的内容发送到对端\nnc 192.168.0.11 8000 < data.txt\n\n#nc可以当做服务器，监听某个端口号,把某一次请求的内容存储到received_data里\nnc -l 8000 > received_data\n\n#上边只监听一次，如果多次可以加上-k参数\nnc -lk 8000\n```\n\n> ## tcpdump\n\n```\n# dump出本机12301端口的tcp包\ntcpdump -i em1 tcp port 12301 -s 1500 -w abc.pcap\n```\n\n> ## 跟踪网络路由路径\n\n```\n# traceroute默认使用udp方式, 如果是-I则改成icmp方式\ntraceroute -I www.163.com\n\n# 从ttl第3跳跟踪\ntraceroute -M 3 www.163.com  \n\n# 加上端口跟踪\ntraceroute -p 8080 192.168.10.11\n```\n\n> ## ss\n\n```\n# 显示本地打开的所有端口\nss -l \n\n# 显示每个进程具体打开的socket\nss -pl \n\n# 显示所有tcp socket\nss -t -a \n\n# 显示所有的UDP Socekt\nss -u -a \n\n# 显示所有已建立的SMTP连接\nss -o state established '( dport = :smtp or sport = :smtp )'  \n\n# 显示所有已建立的HTTP连接 \nss -o state established '( dport = :http or sport = :http )'  \n\n找出所有连接X服务器的进程\nss -x src /tmp/.X11-unix/*  \n\n列出当前socket统计信息\nss -s \n\n解释：netstat是遍历/proc下面每个PID目录，ss直接读/proc/net下面的统计信息。所以ss执行的时候消耗资源以及消耗的时间都比netstat少很多\n```\n\n> ## netstat\n\n```\n# 输出每个ip的连接数，以及总的各个状态的连接数\nnetstat -n | awk '/^tcp/ {n=split($(NF-1),array,\":\");if(n<=2)++S[array[(1)]];else++S[array[(4)]];++s[$NF];++N} END {for(a in S){printf(\"%-20s %s\\n\", a, S[a]);++I}printf(\"%-20s %s\\n\",\"TOTAL_IP\",I);for(a in s) printf(\"%-20s %s\\n\",a, s[a]);printf(\"%-20s %s\\n\",\"TOTAL_LINK\",N);}'\n\n# 统计所有连接状态, \n# CLOSED：无连接是活动的或正在进行\n# LISTEN：服务器在等待进入呼叫\n# SYN_RECV：一个连接请求已经到达，等待确认\n# SYN_SENT：应用已经开始，打开一个连接\n# ESTABLISHED：正常数据传输状态\n# FIN_WAIT1：应用说它已经完成\n# FIN_WAIT2：另一边已同意释放\n# ITMED_WAIT：等待所有分组死掉\n# CLOSING：两边同时尝试关闭\n# TIME_WAIT：主动关闭连接一端还没有等到另一端反馈期间的状态\n# LAST_ACK：等待所有分组死掉\nnetstat -n | awk '/^tcp/ {++state[$NF]} END {for(key in state) print key,\"\\t\",state[key]}'\n\n# 查找较多time_wait连接\nnetstat -n|grep TIME_WAIT|awk '{print $5}'|sort|uniq -c|sort -rn|head -n20\n```\n\n\n\n## **监控linux性能命令**\n\n> ## top\n\n```\n按大写的 F 或 O 键，然后按 a-z 可以将进程按照相应的列进行排序, 然后回车。而大写的 R 键可以将当前的排序倒转\n```\n\n| 列名    | 含义                                                         |\n| :------ | :----------------------------------------------------------- |\n| PID     | 进程id                                                       |\n| PPID    | 父进程id                                                     |\n| RUSER   | Real user name                                               |\n| UID     | 进程所有者的用户id                                           |\n| USER    | 进程所有者的用户名                                           |\n| GROUP   | 进程所有者的组名                                             |\n| TTY     | 启动进程的终端名。不是从终端启动的进程则显示为 ?             |\n| PR      | 优先级                                                       |\n| NI      | nice值。负值表示高优先级，正值表示低优先级                   |\n| P       | 最后使用的CPU，仅在多CPU环境下有意义                         |\n| %CPU    | 上次更新到现在的CPU时间占用百分比                            |\n| TIME    | 进程使用的CPU时间总计，单位秒                                |\n| TIME+   | 进程使用的CPU时间总计，单位1/100秒                           |\n| %MEM    | 进程使用的物理内存百分比                                     |\n| VIRT    | 进程使用的虚拟内存总量，单位kb。VIRT=SWAP+RES                |\n| SWAP    | 进程使用的虚拟内存中，被换出的大小，单位kb。                 |\n| RES     | 进程使用的、未被换出的物理内存大小，单位kb。RES=CODE+DATA    |\n| CODE    | 可执行代码占用的物理内存大小，单位kb                         |\n| DATA    | 可执行代码以外的部分(数据段+栈)占用的物理内存大小，单位kb    |\n| SHR     | 共享内存大小，单位kb                                         |\n| nFLT    | 页面错误次数                                                 |\n| nDRT    | 最后一次写入到现在，被修改过的页面数。                       |\n| S       | 进程状态。D=不可中断的睡眠状态,R=运行,S=睡眠,T=跟踪/停止,Z=僵尸进程 |\n| COMMAND | 命令名/命令行                                                |\n| WCHAN   | 若该进程在睡眠，则显示睡眠中的系统函数名                     |\n| Flags   | 任务标志，参考 sched.h                                       |\n\n> ## dmesg,查看系统日志\n\n```\ndmesg\n```\n\n> ## iostat,磁盘IO情况监控\n\n```\niostat -xz 1\n\n# r/s, w/s, rkB/s, wkB/s：分别表示每秒读写次数和每秒读写数据量（千字节）。读写量过大，可能会引起性能问题。\n# await：IO操作的平均等待时间，单位是毫秒。这是应用程序在和磁盘交互时，需要消耗的时间，包括IO等待和实际操作的耗时。如果这个数值过大，可能是硬件设备遇到了瓶颈或者出现故障。\n# avgqu-sz：向设备发出的请求平均数量。如果这个数值大于1，可能是硬件设备已经饱和（部分前端硬件设备支持并行写入）。\n# %util：设备利用率。这个数值表示设备的繁忙程度，经验值是如果超过60，可能会影响IO性能（可以参照IO操作平均等待时间）。如果到达100%，说明硬件设备已经饱和。\n# 如果显示的是逻辑设备的数据，那么设备利用率不代表后端实际的硬件设备已经饱和。值得注意的是，即使IO性能不理想，也不一定意味这应用程序性能会不好，可以利用诸如预读取、写缓存等策略提升应用性能。\n```\n\n> ## free,内存使用情况\n\n```\nfree -m\n\neg:\n\n     total       used       free     shared    buffers     cached\nMem:          1002        769        232          0         62        421\n-/+ buffers/cache:          286        715\nSwap:          1153          0       1153\n\n第一部分Mem行:\ntotal 内存总数: 1002M\nused 已经使用的内存数: 769M\nfree 空闲的内存数: 232M\nshared 当前已经废弃不用,总是0\nbuffers Buffer 缓存内存数: 62M\ncached Page 缓存内存数:421M\n\n关系：total(1002M) = used(769M) + free(232M)\n\n第二部分(-/+ buffers/cache):\n(-buffers/cache) used内存数：286M (指的第一部分Mem行中的used – buffers – cached)\n(+buffers/cache) free内存数: 715M (指的第一部分Mem行中的free + buffers + cached)\n\n可见-buffers/cache反映的是被程序实实在在吃掉的内存,而+buffers/cache反映的是可以挪用的内存总数.\n\n第三部分是指交换分区\n```\n\n> ## sar,查看网络吞吐状态\n\n```\n# sar命令在这里可以查看网络设备的吞吐率。在排查性能问题时，可以通过网络设备的吞吐量，判断网络设备是否已经饱和\nsar -n DEV 1\n\n#\n# sar命令在这里用于查看TCP连接状态，其中包括：\n# active/s：每秒本地发起的TCP连接数，既通过connect调用创建的TCP连接；\n# passive/s：每秒远程发起的TCP连接数，即通过accept调用创建的TCP连接；\n# retrans/s：每秒TCP重传数量；\n# TCP连接数可以用来判断性能问题是否由于建立了过多的连接，进一步可以判断是主动发起的连接，还是被动接受的连接。TCP重传可能是因为网络环境恶劣，或者服务器压力过大导致丢包\nsar -n TCP,ETCP 1\n```\n\n> ## vmstat, 给定时间监控CPU使用率, 内存使用, 虚拟内存交互, IO读写\n\n```\n# 2表示每2秒采集一次状态信息, 1表示只采集一次(忽略既是一直采集)\nvmstat 2 1\n\neg:\nr b swpd free buff cache si so bi bo in cs us sy id wa\n1 0 0 3499840 315836 3819660 0 0 0 1 2 0 0 0 100 0\n0 0 0 3499584 315836 3819660 0 0 0 0 88 158 0 0 100 0\n0 0 0 3499708 315836 3819660 0 0 0 2 86 162 0 0 100 0\n0 0 0 3499708 315836 3819660 0 0 0 10 81 151 0 0 100 0\n1 0 0 3499732 315836 3819660 0 0 0 2 83 154 0 0 100 0\n```\n\n- r 表示运行队列(就是说多少个进程真的分配到CPU)，我测试的服务器目前CPU比较空闲，没什么程序在跑，当这个值超过了CPU数目，就会出现CPU瓶颈了。这个也和top的负载有关系，一般负载超过了3就比较高，超过了5就高，超过了10就不正常了，服务器的状态很危险。top的负载类似每秒的运行队列。如果运行队列过大，表示你的CPU很繁忙，一般会造成CPU使用率很高。\n\n- b 表示阻塞的进程,这个不多说，进程阻塞，大家懂的。\n\n- swpd 虚拟内存已使用的大小，如果大于0，表示你的机器物理内存不足了，如果不是程序内存泄露的原因，那么你该升级内存了或者把耗内存的任务迁移到其他机器。\n\n- free 空闲的物理内存的大小，我的机器内存总共8G，剩余3415M。\n\n- buff Linux/Unix系统是用来存储，目录里面有什么内容，权限等的缓存，我本机大概占用300多M\n\n- cache cache直接用来记忆我们打开的文件,给文件做缓冲，我本机大概占用300多M(这里是Linux/Unix的聪明之处，把空闲的物理内存的一部分拿来做文件和目录的缓存，是为了提高 程序执行的性能，当程序使用内存时，buffer/cached会很快地被使用。)\n\n- si 每秒从磁盘读入虚拟内存的大小，如果这个值大于0，表示物理内存不够用或者内存泄露了，要查找耗内存进程解决掉。我的机器内存充裕，一切正常。\n\n- so 每秒虚拟内存写入磁盘的大小，如果这个值大于0，同上。\n\n- bi 块设备每秒接收的块数量，这里的块设备是指系统上所有的磁盘和其他块设备，默认块大小是1024byte，我本机上没什么IO操作，所以一直是0，但是我曾在处理拷贝大量数据(2-3T)的机器上看过可以达到140000/s，磁盘写入速度差不多140M每秒\n\n- bo 块设备每秒发送的块数量，例如我们读取文件，bo就要大于0。bi和bo一般都要接近0，不然就是IO过于频繁，需要调整。\n\n- in 每秒CPU的中断次数，包括时间中断\n\n- cs 每秒上下文切换次数，例如我们调用系统函数，就要进行上下文切换，线程的切换，也要进程上下文切换，这个值要越小越好，太大了，要考虑调低线程或者进程的数目,例如在apache和nginx这种web服务器中，我们一般做性能测试时会进行几千并发甚至几万并发的测试，选择web服务器的进程可以由进程或者线程的峰值一直下调，压测，直到cs到一个比较小的值，这个进程和线程数就是比较合适的值了。系统调用也是，每次调用系统函数，我们的代码就会进入内核空间，导致上下文切换，这个是很耗资源，也要尽量避免频繁调用系统函数。上下文切换次数过多表示你的CPU大部分浪费在上下文切换，导致CPU干正经事的时间少了，CPU没有充分利用，是不可取的。\n\n- us 用户CPU时间，我曾经在一个做加密解密很频繁的服务器上，可以看到us接近100,r运行队列达到80(机器在做压力测试，性能表现不佳)。\n\n- sy 系统CPU时间，如果太高，表示系统调用时间长，例如是IO操作频繁。\n\n- id 空闲 CPU时间，一般来说，id + us + sy = 100,一般我认为id是空闲CPU使用率，us是用户CPU使用率，sy是系统CPU使用率。\n\n- wt 等待IO CPU时间。\n\n- \n\n- ```\n  export DOCKERPATH=/usr/bin/docker\n  export PATH=$PATH:$DOCKERPATH\n  \n  sz-memect.tpddns.cn:5000\n  chown -R root:root /usr/share/jenkins\n  chown -R root:root /usr/share/doc/jenkins\n  chown -R root:root /usr/bin/jenkins\n  chown -R root:root /var/lib/jenkins\n  chown -R root:root /var/log/jenkins\n  chown -R root:root /var/cache/jenkins\n  chown -R root:root /etc/default/jenkins\n  chown -R root:root /etc/init.d/jenkins\n  chown -R root:root /etc/logrotate.d/jenkins\n  ```\n","slug":"Linux命令记录","published":1,"updated":"2022-10-16T06:20:42.353Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clg1mfus0000727qg3quyhn8n","content":"<h1 id=\"Linux命令记录\"><a href=\"#Linux命令记录\" class=\"headerlink\" title=\"Linux命令记录\"></a>Linux命令记录</h1><h2 id=\"基本操作\"><a href=\"#基本操作\" class=\"headerlink\" title=\"基本操作\"></a>基本操作</h2><blockquote>\n<h3 id=\"Linux关机-重启\"><a href=\"#Linux关机-重启\" class=\"headerlink\" title=\"Linux关机,重启\"></a>Linux关机,重启</h3></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 关机</span><br><span class=\"line\">shutdown -h now</span><br><span class=\"line\"></span><br><span class=\"line\"># 重启</span><br><span class=\"line\">shutdown -r now</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h3 id=\"查看系统-CPU信息\"><a href=\"#查看系统-CPU信息\" class=\"headerlink\" title=\"查看系统,CPU信息\"></a>查看系统,CPU信息</h3></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 查看系统内核信息</span><br><span class=\"line\">uname -a</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看系统内核版本</span><br><span class=\"line\">cat /proc/version</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看当前用户环境变量</span><br><span class=\"line\">env</span><br><span class=\"line\"></span><br><span class=\"line\">cat /proc/cpuinfo</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看有几个逻辑cpu, 包括cpu型号</span><br><span class=\"line\">cat /proc/cpuinfo | grep name | cut -f2 -d: | uniq -c</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看有几颗cpu,每颗分别是几核</span><br><span class=\"line\">cat /proc/cpuinfo | grep physical | uniq -c</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看当前CPU运行在32bit还是64bit模式下, 如果是运行在32bit下也不代表CPU不支持64bit</span><br><span class=\"line\">getconf LONG_BIT</span><br><span class=\"line\"></span><br><span class=\"line\"># 结果大于0, 说明支持64bit计算. lm指long mode, 支持lm则是64bit</span><br><span class=\"line\">cat /proc/cpuinfo | grep flags | grep &#x27; lm &#x27; | wc -l</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h3 id=\"建立软连接\"><a href=\"#建立软连接\" class=\"headerlink\" title=\"建立软连接\"></a>建立软连接</h3></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ln -s /usr/local/jdk1.8/ jdk</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"rpm相关\"><a href=\"#rpm相关\" class=\"headerlink\" title=\"rpm相关\"></a>rpm相关</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 查看是否通过rpm安装了该软件</span><br><span class=\"line\">rpm -qa | grep 软件名</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"sshkey\"><a href=\"#sshkey\" class=\"headerlink\" title=\"sshkey\"></a>sshkey</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 创建sshkey</span><br><span class=\"line\">ssh-keygen -t rsa -C your_email@example.com</span><br><span class=\"line\"></span><br><span class=\"line\">#id_rsa.pub 的内容拷贝到要控制的服务器的 home/username/.ssh/authorized_keys 中,如果没有则新建(.ssh权限为700, authorized_keys权限为600)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"命令重命名\"><a href=\"#命令重命名\" class=\"headerlink\" title=\"命令重命名\"></a>命令重命名</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 在各个用户的.bash_profile中添加重命名配置</span><br><span class=\"line\">alias ll=&#x27;ls -alF&#x27;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"同步服务器时间\"><a href=\"#同步服务器时间\" class=\"headerlink\" title=\"同步服务器时间\"></a>同步服务器时间</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo ntpdate -u ntp.api.bz</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"后台运行命令\"><a href=\"#后台运行命令\" class=\"headerlink\" title=\"后台运行命令\"></a>后台运行命令</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 后台运行,并且有nohup.out输出</span><br><span class=\"line\">nohup xxx &amp;</span><br><span class=\"line\"></span><br><span class=\"line\"># 后台运行, 不输出任何日志</span><br><span class=\"line\">nohup xxx &gt; /dev/null &amp;</span><br><span class=\"line\"></span><br><span class=\"line\"># 后台运行, 并将错误信息做标准输出到日志中 </span><br><span class=\"line\">nohup xxx &gt;out.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"强制活动用户退出\"><a href=\"#强制活动用户退出\" class=\"headerlink\" title=\"强制活动用户退出\"></a>强制活动用户退出</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 命令来完成强制活动用户退出.其中TTY表示终端名称</span><br><span class=\"line\">pkill -kill -t [TTY]</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"查看命令路径\"><a href=\"#查看命令路径\" class=\"headerlink\" title=\"查看命令路径\"></a>查看命令路径</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">which &lt;命令&gt;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"查看进程所有打开最大fd数\"><a href=\"#查看进程所有打开最大fd数\" class=\"headerlink\" title=\"查看进程所有打开最大fd数\"></a>查看进程所有打开最大fd数</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ulimit -n</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"配置dns\"><a href=\"#配置dns\" class=\"headerlink\" title=\"配置dns\"></a>配置dns</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/resolv.conf</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"nslookup-查看域名路由表\"><a href=\"#nslookup-查看域名路由表\" class=\"headerlink\" title=\"nslookup,查看域名路由表\"></a>nslookup,查看域名路由表</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nslookup google.com</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"last-最近登录信息列表\"><a href=\"#last-最近登录信息列表\" class=\"headerlink\" title=\"last, 最近登录信息列表\"></a>last, 最近登录信息列表</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 最近登录的5个账号</span><br><span class=\"line\">last -n 5</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"设置固定ip\"><a href=\"#设置固定ip\" class=\"headerlink\" title=\"设置固定ip\"></a>设置固定ip</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ifconfig em1  192.168.5.177 netmask 255.255.255.0</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"查看进程内加载的环境变量\"><a href=\"#查看进程内加载的环境变量\" class=\"headerlink\" title=\"查看进程内加载的环境变量\"></a>查看进程内加载的环境变量</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 也可以去 cd /proc 目录下, 查看进程内存中加载的东西</span><br><span class=\"line\">ps eww -p  XXXXX(进程号)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"查看进程树找到服务器进程\"><a href=\"#查看进程树找到服务器进程\" class=\"headerlink\" title=\"查看进程树找到服务器进程\"></a>查看进程树找到服务器进程</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ps auwxf</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"查看进程启动路径\"><a href=\"#查看进程启动路径\" class=\"headerlink\" title=\"查看进程启动路径\"></a>查看进程启动路径</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /proc/xxx(进程号)</span><br><span class=\"line\">ls -all</span><br><span class=\"line\"># cwd对应的是启动路径</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"添加用户-配置sudo权限\"><a href=\"#添加用户-配置sudo权限\" class=\"headerlink\" title=\"添加用户, 配置sudo权限\"></a>添加用户, 配置sudo权限</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 新增用户</span><br><span class=\"line\">useradd 用户名</span><br><span class=\"line\">passwd 用户名</span><br><span class=\"line\"></span><br><span class=\"line\">#增加sudo权限</span><br><span class=\"line\">vim /etc/sudoers</span><br><span class=\"line\"># 修改文件里面的</span><br><span class=\"line\"># root    ALL=(ALL)       ALL</span><br><span class=\"line\"># 用户名 ALL=(ALL)       ALL</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"强制关闭进程名包含xxx的所有进程\"><a href=\"#强制关闭进程名包含xxx的所有进程\" class=\"headerlink\" title=\"强制关闭进程名包含xxx的所有进程\"></a>强制关闭进程名包含xxx的所有进程</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ps aux|grep xxx | grep -v grep | awk &#x27;&#123;print $2&#125;&#x27; | xargs kill -9</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"磁盘-文件-目录相关操作\"><a href=\"#磁盘-文件-目录相关操作\" class=\"headerlink\" title=\"磁盘,文件,目录相关操作\"></a><strong>磁盘,文件,目录相关操作</strong></h2><blockquote>\n<h2 id=\"vim操作\"><a href=\"#vim操作\" class=\"headerlink\" title=\"vim操作\"></a>vim操作</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#normal模式下 g表示全局, x表示查找的内容, y表示替换后的内容</span><br><span class=\"line\">:%s/x/y/g</span><br><span class=\"line\"></span><br><span class=\"line\">#normal模式下</span><br><span class=\"line\">0  # 光标移到行首(数字0)</span><br><span class=\"line\">$  # 光标移至行尾</span><br><span class=\"line\">shift + g # 跳到文件最后</span><br><span class=\"line\">gg # 跳到文件头</span><br><span class=\"line\"></span><br><span class=\"line\"># 显示行号</span><br><span class=\"line\">:set nu</span><br><span class=\"line\"></span><br><span class=\"line\"># 去除行号</span><br><span class=\"line\">:set nonu</span><br><span class=\"line\"></span><br><span class=\"line\"># 检索</span><br><span class=\"line\">/xxx(检索内容)  # 从头检索, 按n查找下一个</span><br><span class=\"line\">?xxx(检索内容)  # 从尾部检索</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"打开只读文件-修改后需要保存时-不用切换用户即可保存的方式\"><a href=\"#打开只读文件-修改后需要保存时-不用切换用户即可保存的方式\" class=\"headerlink\" title=\"打开只读文件,修改后需要保存时(不用切换用户即可保存的方式)\"></a>打开只读文件,修改后需要保存时(不用切换用户即可保存的方式)</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 在normal模式下</span><br><span class=\"line\">:w !sudo tee %</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"查看磁盘-文件目录基本信息\"><a href=\"#查看磁盘-文件目录基本信息\" class=\"headerlink\" title=\"查看磁盘, 文件目录基本信息\"></a>查看磁盘, 文件目录基本信息</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 查看磁盘挂载情况</span><br><span class=\"line\">mount</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看磁盘分区信息</span><br><span class=\"line\">df</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看目录及子目录大小</span><br><span class=\"line\">du -H -h</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看当前目录下各个文件, 文件夹占了多少空间, 不会递归</span><br><span class=\"line\">du -sh *</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"wc命令\"><a href=\"#wc命令\" class=\"headerlink\" title=\"wc命令\"></a>wc命令</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 查看文件里有多少行</span><br><span class=\"line\">wc -l filename</span><br><span class=\"line\"></span><br><span class=\"line\"># 看文件里有多少个word</span><br><span class=\"line\">wc -w filename</span><br><span class=\"line\"></span><br><span class=\"line\"># 文件里最长的那一行是多少个字</span><br><span class=\"line\">wc -L filename</span><br><span class=\"line\"></span><br><span class=\"line\"># 统计字节数</span><br><span class=\"line\">wc -c</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"常用压缩-解压缩命令\"><a href=\"#常用压缩-解压缩命令\" class=\"headerlink\" title=\"常用压缩, 解压缩命令\"></a>常用压缩, 解压缩命令</h2></blockquote>\n<blockquote>\n<h3 id=\"压缩命令\"><a href=\"#压缩命令\" class=\"headerlink\" title=\"压缩命令\"></a>压缩命令</h3></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar czvf xxx.tar 压缩目录</span><br><span class=\"line\"></span><br><span class=\"line\">zip -r xxx.zip 压缩目录</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h3 id=\"解压缩命令\"><a href=\"#解压缩命令\" class=\"headerlink\" title=\"解压缩命令\"></a>解压缩命令</h3></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar zxvf xxx.tar</span><br><span class=\"line\"></span><br><span class=\"line\"># 解压到指定文件夹</span><br><span class=\"line\">tar zxvf xxx.tar -C /xxx/yyy/</span><br><span class=\"line\"></span><br><span class=\"line\">unzip xxx.zip</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"变更文件所属用户-用户组\"><a href=\"#变更文件所属用户-用户组\" class=\"headerlink\" title=\"变更文件所属用户, 用户组\"></a>变更文件所属用户, 用户组</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chown eagleye.eagleye xxx.log</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"cp-scp-mkdir\"><a href=\"#cp-scp-mkdir\" class=\"headerlink\" title=\"cp, scp, mkdir\"></a>cp, scp, mkdir</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#复制</span><br><span class=\"line\">cp xxx.log</span><br><span class=\"line\"></span><br><span class=\"line\"># 复制并强制覆盖同名文件</span><br><span class=\"line\">cp -f xxx.log</span><br><span class=\"line\"></span><br><span class=\"line\"># 复制文件夹</span><br><span class=\"line\">cp -r xxx(源文件夹) yyy(目标文件夹)</span><br><span class=\"line\"></span><br><span class=\"line\"># 远程复制</span><br><span class=\"line\">scp -P ssh端口 username@10.10.10.101:/home/username/xxx /home/xxx</span><br><span class=\"line\"></span><br><span class=\"line\"># 级联创建目录</span><br><span class=\"line\">mkdir -p /xxx/yyy/zzz</span><br><span class=\"line\"></span><br><span class=\"line\"># 批量创建文件夹, 会在test,main下都创建java, resources文件夹</span><br><span class=\"line\">mkdir -p src/&#123;test,main&#125;/&#123;java,resources&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"比较两个文件\"><a href=\"#比较两个文件\" class=\"headerlink\" title=\"比较两个文件\"></a>比较两个文件</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">diff -u 1.txt 2.txt</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"日志输出的字节数-可以用作性能测试\"><a href=\"#日志输出的字节数-可以用作性能测试\" class=\"headerlink\" title=\"日志输出的字节数,可以用作性能测试\"></a>日志输出的字节数,可以用作性能测试</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 如果做性能测试, 可以每执行一次, 往日志里面输出 “.” , 这样日志中的字节数就是实际的性能测试运行的次数, 还可以看见实时速率.</span><br><span class=\"line\">tail -f xxx.log | pv -bt</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"查看-去除特殊字符\"><a href=\"#查看-去除特殊字符\" class=\"headerlink\" title=\"查看, 去除特殊字符\"></a>查看, 去除特殊字符</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 查看特殊字符</span><br><span class=\"line\">cat -v xxx.sh</span><br><span class=\"line\"></span><br><span class=\"line\"># 去除特殊字符</span><br><span class=\"line\">sed -i &#x27;s/^M//g’ env.sh  去除文件的特殊字符, 比如^M:  需要这样输入: ctrl+v+enter</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"处理因系统原因引起的文件中特殊字符的问题\"><a href=\"#处理因系统原因引起的文件中特殊字符的问题\" class=\"headerlink\" title=\"处理因系统原因引起的文件中特殊字符的问题\"></a>处理因系统原因引起的文件中特殊字符的问题</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 可以转换为该系统下的文件格式</span><br><span class=\"line\">cat file.sh &gt; file.sh_bak</span><br><span class=\"line\"></span><br><span class=\"line\"># 先将file.sh中文件内容复制下来然后运行, 然后粘贴内容, 最后ctrl + d 保存退出</span><br><span class=\"line\">cat &gt; file1.sh</span><br><span class=\"line\"></span><br><span class=\"line\"># 在vim中通过如下设置文件编码和文件格式</span><br><span class=\"line\">:set fileencodings=utf-8 ，然后 w （存盘）一下即可转化为 utf8 格式，</span><br><span class=\"line\">:set fileformat=unix</span><br><span class=\"line\"></span><br><span class=\"line\"># 在mac下使用dos2unix进行文件格式化</span><br><span class=\"line\">find . -name &quot;*.sh&quot; | xargs dos2unix</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"tee-重定向的同时输出到屏幕\"><a href=\"#tee-重定向的同时输出到屏幕\" class=\"headerlink\" title=\"tee, 重定向的同时输出到屏幕\"></a>tee, 重定向的同时输出到屏幕</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">awk ‘&#123;print $0&#125;’ xxx.log | tee test.log</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"检索相关\"><a href=\"#检索相关\" class=\"headerlink\" title=\"检索相关\"></a><strong>检索相关</strong></h2><blockquote>\n<h2 id=\"grep\"><a href=\"#grep\" class=\"headerlink\" title=\"grep\"></a>grep</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 反向匹配, 查找不包含xxx的内容</span><br><span class=\"line\">grep -v xxx</span><br><span class=\"line\"></span><br><span class=\"line\"># 排除所有空行</span><br><span class=\"line\">grep -v &#x27;^/pre&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"># 返回结果 2,则说明第二行是空行</span><br><span class=\"line\">grep -n “^$” 111.txt    </span><br><span class=\"line\"></span><br><span class=\"line\"># 查询以abc开头的行</span><br><span class=\"line\">grep -n “^abc” 111.txt </span><br><span class=\"line\"></span><br><span class=\"line\"># 同时列出该词语出现在文章的第几行</span><br><span class=\"line\">grep &#x27;xxx&#x27; -n xxx.log</span><br><span class=\"line\"></span><br><span class=\"line\"># 计算一下该字串出现的次数</span><br><span class=\"line\">grep &#x27;xxx&#x27; -c xxx.log</span><br><span class=\"line\"></span><br><span class=\"line\"># 比对的时候，不计较大小写的不同</span><br><span class=\"line\">grep &#x27;xxx&#x27; -i xxx.log</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"awk\"><a href=\"#awk\" class=\"headerlink\" title=\"awk\"></a>awk</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 以&#x27;:&#x27; 为分隔符,如果第五域有user则输出该行</span><br><span class=\"line\">awk -F &#x27;:&#x27; &#x27;&#123;if ($5 ~ /user/) print $0&#125;&#x27; /etc/passwd </span><br><span class=\"line\"></span><br><span class=\"line\"># 统计单个文件中某个字符（串）(中文无效)出现的次数</span><br><span class=\"line\">awk -v RS=&#x27;character&#x27; &#x27;END &#123;print --NR&#125;&#x27; xxx.txt</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"find检索命令\"><a href=\"#find检索命令\" class=\"headerlink\" title=\"find检索命令\"></a>find检索命令</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 在目录下找后缀是.mysql的文件</span><br><span class=\"line\">find /home/eagleye -name &#x27;*.mysql&#x27; -print</span><br><span class=\"line\"></span><br><span class=\"line\"># 会从 /usr 目录开始往下找，找最近3天之内存取过的文件。</span><br><span class=\"line\">find /usr -atime 3 –print</span><br><span class=\"line\"></span><br><span class=\"line\"># 会从 /usr 目录开始往下找，找最近5天之内修改过的文件。</span><br><span class=\"line\">find /usr -ctime 5 –print</span><br><span class=\"line\"></span><br><span class=\"line\"># 会从 /doc 目录开始往下找，找jacky 的、文件名开头是 j的文件。  </span><br><span class=\"line\">find /doc -user jacky -name &#x27;j*&#x27; –print</span><br><span class=\"line\"></span><br><span class=\"line\"># 会从 /doc 目录开始往下找，找寻文件名是 ja 开头或者 ma开头的文件。</span><br><span class=\"line\">find /doc \\( -name &#x27;ja*&#x27; -o- -name &#x27;ma*&#x27; \\) –print</span><br><span class=\"line\"></span><br><span class=\"line\">#  会从 /doc 目录开始往下找，找到凡是文件名结尾为 bak的文件，把它删除掉。-exec 选项是执行的意思，rm 是删除命令，&#123; &#125; 表示文件名，“\\;”是规定的命令结尾。 </span><br><span class=\"line\">find /doc -name &#x27;*bak&#x27; -exec rm &#123;&#125; \\;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"网络相关\"><a href=\"#网络相关\" class=\"headerlink\" title=\"网络相关\"></a><strong>网络相关</strong></h2><blockquote>\n<h2 id=\"查看什么进程使用了该端口\"><a href=\"#查看什么进程使用了该端口\" class=\"headerlink\" title=\"查看什么进程使用了该端口\"></a>查看什么进程使用了该端口</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lsof -i:port</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"获取本机ip地址\"><a href=\"#获取本机ip地址\" class=\"headerlink\" title=\"获取本机ip地址\"></a>获取本机ip地址</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/sbin/ifconfig -a|grep inet|grep -v 127.0.0.1|grep -v inet6|awk &#x27;&#123;print $2&#125;&#x27;|tr -d &quot;addr:&quot;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"iptables\"><a href=\"#iptables\" class=\"headerlink\" title=\"iptables\"></a>iptables</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 查看iptables状态</span><br><span class=\"line\">service iptables status</span><br><span class=\"line\"></span><br><span class=\"line\"># 要封停一个ip</span><br><span class=\"line\">iptables -I INPUT -s ***.***.***.*** -j DROP</span><br><span class=\"line\"></span><br><span class=\"line\"># 要解封一个IP，使用下面这条命令：</span><br><span class=\"line\">iptables -D INPUT -s ***.***.***.*** -j DROP</span><br><span class=\"line\"></span><br><span class=\"line\">备注: 参数-I是表示Insert（添加），-D表示Delete（删除）。后面跟的是规则，INPUT表示入站，***.***.***.***表示要封停的IP，DROP表示放弃连接。</span><br><span class=\"line\"></span><br><span class=\"line\">#开启9090端口的访问</span><br><span class=\"line\">/sbin/iptables -I INPUT -p tcp --dport 9090 -j ACCEPT </span><br><span class=\"line\"></span><br><span class=\"line\"># 防火墙开启、关闭、重启</span><br><span class=\"line\">/etc/init.d/iptables status</span><br><span class=\"line\">/etc/init.d/iptables start</span><br><span class=\"line\">/etc/init.d/iptables stop</span><br><span class=\"line\">/etc/init.d/iptables restart</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"nc命令-tcp调试利器\"><a href=\"#nc命令-tcp调试利器\" class=\"headerlink\" title=\"nc命令, tcp调试利器\"></a>nc命令, tcp调试利器</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#给某一个endpoint发送TCP请求,就将data的内容发送到对端</span><br><span class=\"line\">nc 192.168.0.11 8000 &lt; data.txt</span><br><span class=\"line\"></span><br><span class=\"line\">#nc可以当做服务器，监听某个端口号,把某一次请求的内容存储到received_data里</span><br><span class=\"line\">nc -l 8000 &gt; received_data</span><br><span class=\"line\"></span><br><span class=\"line\">#上边只监听一次，如果多次可以加上-k参数</span><br><span class=\"line\">nc -lk 8000</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"tcpdump\"><a href=\"#tcpdump\" class=\"headerlink\" title=\"tcpdump\"></a>tcpdump</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># dump出本机12301端口的tcp包</span><br><span class=\"line\">tcpdump -i em1 tcp port 12301 -s 1500 -w abc.pcap</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"跟踪网络路由路径\"><a href=\"#跟踪网络路由路径\" class=\"headerlink\" title=\"跟踪网络路由路径\"></a>跟踪网络路由路径</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># traceroute默认使用udp方式, 如果是-I则改成icmp方式</span><br><span class=\"line\">traceroute -I www.163.com</span><br><span class=\"line\"></span><br><span class=\"line\"># 从ttl第3跳跟踪</span><br><span class=\"line\">traceroute -M 3 www.163.com  </span><br><span class=\"line\"></span><br><span class=\"line\"># 加上端口跟踪</span><br><span class=\"line\">traceroute -p 8080 192.168.10.11</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"ss\"><a href=\"#ss\" class=\"headerlink\" title=\"ss\"></a>ss</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 显示本地打开的所有端口</span><br><span class=\"line\">ss -l </span><br><span class=\"line\"></span><br><span class=\"line\"># 显示每个进程具体打开的socket</span><br><span class=\"line\">ss -pl </span><br><span class=\"line\"></span><br><span class=\"line\"># 显示所有tcp socket</span><br><span class=\"line\">ss -t -a </span><br><span class=\"line\"></span><br><span class=\"line\"># 显示所有的UDP Socekt</span><br><span class=\"line\">ss -u -a </span><br><span class=\"line\"></span><br><span class=\"line\"># 显示所有已建立的SMTP连接</span><br><span class=\"line\">ss -o state established &#x27;( dport = :smtp or sport = :smtp )&#x27;  </span><br><span class=\"line\"></span><br><span class=\"line\"># 显示所有已建立的HTTP连接 </span><br><span class=\"line\">ss -o state established &#x27;( dport = :http or sport = :http )&#x27;  </span><br><span class=\"line\"></span><br><span class=\"line\">找出所有连接X服务器的进程</span><br><span class=\"line\">ss -x src /tmp/.X11-unix/*  </span><br><span class=\"line\"></span><br><span class=\"line\">列出当前socket统计信息</span><br><span class=\"line\">ss -s </span><br><span class=\"line\"></span><br><span class=\"line\">解释：netstat是遍历/proc下面每个PID目录，ss直接读/proc/net下面的统计信息。所以ss执行的时候消耗资源以及消耗的时间都比netstat少很多</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"netstat\"><a href=\"#netstat\" class=\"headerlink\" title=\"netstat\"></a>netstat</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 输出每个ip的连接数，以及总的各个状态的连接数</span><br><span class=\"line\">netstat -n | awk &#x27;/^tcp/ &#123;n=split($(NF-1),array,&quot;:&quot;);if(n&lt;=2)++S[array[(1)]];else++S[array[(4)]];++s[$NF];++N&#125; END &#123;for(a in S)&#123;printf(&quot;%-20s %s\\n&quot;, a, S[a]);++I&#125;printf(&quot;%-20s %s\\n&quot;,&quot;TOTAL_IP&quot;,I);for(a in s) printf(&quot;%-20s %s\\n&quot;,a, s[a]);printf(&quot;%-20s %s\\n&quot;,&quot;TOTAL_LINK&quot;,N);&#125;&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\"># 统计所有连接状态, </span><br><span class=\"line\"># CLOSED：无连接是活动的或正在进行</span><br><span class=\"line\"># LISTEN：服务器在等待进入呼叫</span><br><span class=\"line\"># SYN_RECV：一个连接请求已经到达，等待确认</span><br><span class=\"line\"># SYN_SENT：应用已经开始，打开一个连接</span><br><span class=\"line\"># ESTABLISHED：正常数据传输状态</span><br><span class=\"line\"># FIN_WAIT1：应用说它已经完成</span><br><span class=\"line\"># FIN_WAIT2：另一边已同意释放</span><br><span class=\"line\"># ITMED_WAIT：等待所有分组死掉</span><br><span class=\"line\"># CLOSING：两边同时尝试关闭</span><br><span class=\"line\"># TIME_WAIT：主动关闭连接一端还没有等到另一端反馈期间的状态</span><br><span class=\"line\"># LAST_ACK：等待所有分组死掉</span><br><span class=\"line\">netstat -n | awk &#x27;/^tcp/ &#123;++state[$NF]&#125; END &#123;for(key in state) print key,&quot;\\t&quot;,state[key]&#125;&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\"># 查找较多time_wait连接</span><br><span class=\"line\">netstat -n|grep TIME_WAIT|awk &#x27;&#123;print $5&#125;&#x27;|sort|uniq -c|sort -rn|head -n20</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"监控linux性能命令\"><a href=\"#监控linux性能命令\" class=\"headerlink\" title=\"监控linux性能命令\"></a><strong>监控linux性能命令</strong></h2><blockquote>\n<h2 id=\"top\"><a href=\"#top\" class=\"headerlink\" title=\"top\"></a>top</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">按大写的 F 或 O 键，然后按 a-z 可以将进程按照相应的列进行排序, 然后回车。而大写的 R 键可以将当前的排序倒转</span><br></pre></td></tr></table></figure>\n\n<table>\n<thead>\n<tr>\n<th align=\"left\">列名</th>\n<th align=\"left\">含义</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">PID</td>\n<td align=\"left\">进程id</td>\n</tr>\n<tr>\n<td align=\"left\">PPID</td>\n<td align=\"left\">父进程id</td>\n</tr>\n<tr>\n<td align=\"left\">RUSER</td>\n<td align=\"left\">Real user name</td>\n</tr>\n<tr>\n<td align=\"left\">UID</td>\n<td align=\"left\">进程所有者的用户id</td>\n</tr>\n<tr>\n<td align=\"left\">USER</td>\n<td align=\"left\">进程所有者的用户名</td>\n</tr>\n<tr>\n<td align=\"left\">GROUP</td>\n<td align=\"left\">进程所有者的组名</td>\n</tr>\n<tr>\n<td align=\"left\">TTY</td>\n<td align=\"left\">启动进程的终端名。不是从终端启动的进程则显示为 ?</td>\n</tr>\n<tr>\n<td align=\"left\">PR</td>\n<td align=\"left\">优先级</td>\n</tr>\n<tr>\n<td align=\"left\">NI</td>\n<td align=\"left\">nice值。负值表示高优先级，正值表示低优先级</td>\n</tr>\n<tr>\n<td align=\"left\">P</td>\n<td align=\"left\">最后使用的CPU，仅在多CPU环境下有意义</td>\n</tr>\n<tr>\n<td align=\"left\">%CPU</td>\n<td align=\"left\">上次更新到现在的CPU时间占用百分比</td>\n</tr>\n<tr>\n<td align=\"left\">TIME</td>\n<td align=\"left\">进程使用的CPU时间总计，单位秒</td>\n</tr>\n<tr>\n<td align=\"left\">TIME+</td>\n<td align=\"left\">进程使用的CPU时间总计，单位1&#x2F;100秒</td>\n</tr>\n<tr>\n<td align=\"left\">%MEM</td>\n<td align=\"left\">进程使用的物理内存百分比</td>\n</tr>\n<tr>\n<td align=\"left\">VIRT</td>\n<td align=\"left\">进程使用的虚拟内存总量，单位kb。VIRT&#x3D;SWAP+RES</td>\n</tr>\n<tr>\n<td align=\"left\">SWAP</td>\n<td align=\"left\">进程使用的虚拟内存中，被换出的大小，单位kb。</td>\n</tr>\n<tr>\n<td align=\"left\">RES</td>\n<td align=\"left\">进程使用的、未被换出的物理内存大小，单位kb。RES&#x3D;CODE+DATA</td>\n</tr>\n<tr>\n<td align=\"left\">CODE</td>\n<td align=\"left\">可执行代码占用的物理内存大小，单位kb</td>\n</tr>\n<tr>\n<td align=\"left\">DATA</td>\n<td align=\"left\">可执行代码以外的部分(数据段+栈)占用的物理内存大小，单位kb</td>\n</tr>\n<tr>\n<td align=\"left\">SHR</td>\n<td align=\"left\">共享内存大小，单位kb</td>\n</tr>\n<tr>\n<td align=\"left\">nFLT</td>\n<td align=\"left\">页面错误次数</td>\n</tr>\n<tr>\n<td align=\"left\">nDRT</td>\n<td align=\"left\">最后一次写入到现在，被修改过的页面数。</td>\n</tr>\n<tr>\n<td align=\"left\">S</td>\n<td align=\"left\">进程状态。D&#x3D;不可中断的睡眠状态,R&#x3D;运行,S&#x3D;睡眠,T&#x3D;跟踪&#x2F;停止,Z&#x3D;僵尸进程</td>\n</tr>\n<tr>\n<td align=\"left\">COMMAND</td>\n<td align=\"left\">命令名&#x2F;命令行</td>\n</tr>\n<tr>\n<td align=\"left\">WCHAN</td>\n<td align=\"left\">若该进程在睡眠，则显示睡眠中的系统函数名</td>\n</tr>\n<tr>\n<td align=\"left\">Flags</td>\n<td align=\"left\">任务标志，参考 sched.h</td>\n</tr>\n</tbody></table>\n<blockquote>\n<h2 id=\"dmesg-查看系统日志\"><a href=\"#dmesg-查看系统日志\" class=\"headerlink\" title=\"dmesg,查看系统日志\"></a>dmesg,查看系统日志</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dmesg</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"iostat-磁盘IO情况监控\"><a href=\"#iostat-磁盘IO情况监控\" class=\"headerlink\" title=\"iostat,磁盘IO情况监控\"></a>iostat,磁盘IO情况监控</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">iostat -xz 1</span><br><span class=\"line\"></span><br><span class=\"line\"># r/s, w/s, rkB/s, wkB/s：分别表示每秒读写次数和每秒读写数据量（千字节）。读写量过大，可能会引起性能问题。</span><br><span class=\"line\"># await：IO操作的平均等待时间，单位是毫秒。这是应用程序在和磁盘交互时，需要消耗的时间，包括IO等待和实际操作的耗时。如果这个数值过大，可能是硬件设备遇到了瓶颈或者出现故障。</span><br><span class=\"line\"># avgqu-sz：向设备发出的请求平均数量。如果这个数值大于1，可能是硬件设备已经饱和（部分前端硬件设备支持并行写入）。</span><br><span class=\"line\"># %util：设备利用率。这个数值表示设备的繁忙程度，经验值是如果超过60，可能会影响IO性能（可以参照IO操作平均等待时间）。如果到达100%，说明硬件设备已经饱和。</span><br><span class=\"line\"># 如果显示的是逻辑设备的数据，那么设备利用率不代表后端实际的硬件设备已经饱和。值得注意的是，即使IO性能不理想，也不一定意味这应用程序性能会不好，可以利用诸如预读取、写缓存等策略提升应用性能。</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"free-内存使用情况\"><a href=\"#free-内存使用情况\" class=\"headerlink\" title=\"free,内存使用情况\"></a>free,内存使用情况</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">free -m</span><br><span class=\"line\"></span><br><span class=\"line\">eg:</span><br><span class=\"line\"></span><br><span class=\"line\">     total       used       free     shared    buffers     cached</span><br><span class=\"line\">Mem:          1002        769        232          0         62        421</span><br><span class=\"line\">-/+ buffers/cache:          286        715</span><br><span class=\"line\">Swap:          1153          0       1153</span><br><span class=\"line\"></span><br><span class=\"line\">第一部分Mem行:</span><br><span class=\"line\">total 内存总数: 1002M</span><br><span class=\"line\">used 已经使用的内存数: 769M</span><br><span class=\"line\">free 空闲的内存数: 232M</span><br><span class=\"line\">shared 当前已经废弃不用,总是0</span><br><span class=\"line\">buffers Buffer 缓存内存数: 62M</span><br><span class=\"line\">cached Page 缓存内存数:421M</span><br><span class=\"line\"></span><br><span class=\"line\">关系：total(1002M) = used(769M) + free(232M)</span><br><span class=\"line\"></span><br><span class=\"line\">第二部分(-/+ buffers/cache):</span><br><span class=\"line\">(-buffers/cache) used内存数：286M (指的第一部分Mem行中的used – buffers – cached)</span><br><span class=\"line\">(+buffers/cache) free内存数: 715M (指的第一部分Mem行中的free + buffers + cached)</span><br><span class=\"line\"></span><br><span class=\"line\">可见-buffers/cache反映的是被程序实实在在吃掉的内存,而+buffers/cache反映的是可以挪用的内存总数.</span><br><span class=\"line\"></span><br><span class=\"line\">第三部分是指交换分区</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"sar-查看网络吞吐状态\"><a href=\"#sar-查看网络吞吐状态\" class=\"headerlink\" title=\"sar,查看网络吞吐状态\"></a>sar,查看网络吞吐状态</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sar命令在这里可以查看网络设备的吞吐率。在排查性能问题时，可以通过网络设备的吞吐量，判断网络设备是否已经饱和</span><br><span class=\"line\">sar -n DEV 1</span><br><span class=\"line\"></span><br><span class=\"line\">#</span><br><span class=\"line\"># sar命令在这里用于查看TCP连接状态，其中包括：</span><br><span class=\"line\"># active/s：每秒本地发起的TCP连接数，既通过connect调用创建的TCP连接；</span><br><span class=\"line\"># passive/s：每秒远程发起的TCP连接数，即通过accept调用创建的TCP连接；</span><br><span class=\"line\"># retrans/s：每秒TCP重传数量；</span><br><span class=\"line\"># TCP连接数可以用来判断性能问题是否由于建立了过多的连接，进一步可以判断是主动发起的连接，还是被动接受的连接。TCP重传可能是因为网络环境恶劣，或者服务器压力过大导致丢包</span><br><span class=\"line\">sar -n TCP,ETCP 1</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"vmstat-给定时间监控CPU使用率-内存使用-虚拟内存交互-IO读写\"><a href=\"#vmstat-给定时间监控CPU使用率-内存使用-虚拟内存交互-IO读写\" class=\"headerlink\" title=\"vmstat, 给定时间监控CPU使用率, 内存使用, 虚拟内存交互, IO读写\"></a>vmstat, 给定时间监控CPU使用率, 内存使用, 虚拟内存交互, IO读写</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 2表示每2秒采集一次状态信息, 1表示只采集一次(忽略既是一直采集)</span><br><span class=\"line\">vmstat 2 1</span><br><span class=\"line\"></span><br><span class=\"line\">eg:</span><br><span class=\"line\">r b swpd free buff cache si so bi bo in cs us sy id wa</span><br><span class=\"line\">1 0 0 3499840 315836 3819660 0 0 0 1 2 0 0 0 100 0</span><br><span class=\"line\">0 0 0 3499584 315836 3819660 0 0 0 0 88 158 0 0 100 0</span><br><span class=\"line\">0 0 0 3499708 315836 3819660 0 0 0 2 86 162 0 0 100 0</span><br><span class=\"line\">0 0 0 3499708 315836 3819660 0 0 0 10 81 151 0 0 100 0</span><br><span class=\"line\">1 0 0 3499732 315836 3819660 0 0 0 2 83 154 0 0 100 0</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>r 表示运行队列(就是说多少个进程真的分配到CPU)，我测试的服务器目前CPU比较空闲，没什么程序在跑，当这个值超过了CPU数目，就会出现CPU瓶颈了。这个也和top的负载有关系，一般负载超过了3就比较高，超过了5就高，超过了10就不正常了，服务器的状态很危险。top的负载类似每秒的运行队列。如果运行队列过大，表示你的CPU很繁忙，一般会造成CPU使用率很高。</p>\n</li>\n<li><p>b 表示阻塞的进程,这个不多说，进程阻塞，大家懂的。</p>\n</li>\n<li><p>swpd 虚拟内存已使用的大小，如果大于0，表示你的机器物理内存不足了，如果不是程序内存泄露的原因，那么你该升级内存了或者把耗内存的任务迁移到其他机器。</p>\n</li>\n<li><p>free 空闲的物理内存的大小，我的机器内存总共8G，剩余3415M。</p>\n</li>\n<li><p>buff Linux&#x2F;Unix系统是用来存储，目录里面有什么内容，权限等的缓存，我本机大概占用300多M</p>\n</li>\n<li><p>cache cache直接用来记忆我们打开的文件,给文件做缓冲，我本机大概占用300多M(这里是Linux&#x2F;Unix的聪明之处，把空闲的物理内存的一部分拿来做文件和目录的缓存，是为了提高 程序执行的性能，当程序使用内存时，buffer&#x2F;cached会很快地被使用。)</p>\n</li>\n<li><p>si 每秒从磁盘读入虚拟内存的大小，如果这个值大于0，表示物理内存不够用或者内存泄露了，要查找耗内存进程解决掉。我的机器内存充裕，一切正常。</p>\n</li>\n<li><p>so 每秒虚拟内存写入磁盘的大小，如果这个值大于0，同上。</p>\n</li>\n<li><p>bi 块设备每秒接收的块数量，这里的块设备是指系统上所有的磁盘和其他块设备，默认块大小是1024byte，我本机上没什么IO操作，所以一直是0，但是我曾在处理拷贝大量数据(2-3T)的机器上看过可以达到140000&#x2F;s，磁盘写入速度差不多140M每秒</p>\n</li>\n<li><p>bo 块设备每秒发送的块数量，例如我们读取文件，bo就要大于0。bi和bo一般都要接近0，不然就是IO过于频繁，需要调整。</p>\n</li>\n<li><p>in 每秒CPU的中断次数，包括时间中断</p>\n</li>\n<li><p>cs 每秒上下文切换次数，例如我们调用系统函数，就要进行上下文切换，线程的切换，也要进程上下文切换，这个值要越小越好，太大了，要考虑调低线程或者进程的数目,例如在apache和nginx这种web服务器中，我们一般做性能测试时会进行几千并发甚至几万并发的测试，选择web服务器的进程可以由进程或者线程的峰值一直下调，压测，直到cs到一个比较小的值，这个进程和线程数就是比较合适的值了。系统调用也是，每次调用系统函数，我们的代码就会进入内核空间，导致上下文切换，这个是很耗资源，也要尽量避免频繁调用系统函数。上下文切换次数过多表示你的CPU大部分浪费在上下文切换，导致CPU干正经事的时间少了，CPU没有充分利用，是不可取的。</p>\n</li>\n<li><p>us 用户CPU时间，我曾经在一个做加密解密很频繁的服务器上，可以看到us接近100,r运行队列达到80(机器在做压力测试，性能表现不佳)。</p>\n</li>\n<li><p>sy 系统CPU时间，如果太高，表示系统调用时间长，例如是IO操作频繁。</p>\n</li>\n<li><p>id 空闲 CPU时间，一般来说，id + us + sy &#x3D; 100,一般我认为id是空闲CPU使用率，us是用户CPU使用率，sy是系统CPU使用率。</p>\n</li>\n<li><p>wt 等待IO CPU时间。</p>\n</li>\n<li></li>\n<li><pre><code>export DOCKERPATH=/usr/bin/docker\nexport PATH=$PATH:$DOCKERPATH\n\nsz-memect.tpddns.cn:5000\nchown -R root:root /usr/share/jenkins\nchown -R root:root /usr/share/doc/jenkins\nchown -R root:root /usr/bin/jenkins\nchown -R root:root /var/lib/jenkins\nchown -R root:root /var/log/jenkins\nchown -R root:root /var/cache/jenkins\nchown -R root:root /etc/default/jenkins\nchown -R root:root /etc/init.d/jenkins\nchown -R root:root /etc/logrotate.d/jenkins\n</code></pre>\n</li>\n</ul>\n","site":{"data":{"link":[{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"动漫图片和壁纸","link":"https://anime-pictures.net/?lang=zh_CN","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"图片网站"},{"name":"Wallhaven","link":"https://wallhaven.cc/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"4k图片网站"},{"name":"WALLPAPER ABYSS","link":"https://wall.alphacoders.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"WALLPAPER ABYSS"},{"name":"极简壁纸","link":"https://bz.zzzmh.cn/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"极简壁纸"},{"name":"Wallroom","link":"https://wallroom.io/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"Wallroom"}]}]}},"excerpt":"","more":"<h1 id=\"Linux命令记录\"><a href=\"#Linux命令记录\" class=\"headerlink\" title=\"Linux命令记录\"></a>Linux命令记录</h1><h2 id=\"基本操作\"><a href=\"#基本操作\" class=\"headerlink\" title=\"基本操作\"></a>基本操作</h2><blockquote>\n<h3 id=\"Linux关机-重启\"><a href=\"#Linux关机-重启\" class=\"headerlink\" title=\"Linux关机,重启\"></a>Linux关机,重启</h3></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 关机</span><br><span class=\"line\">shutdown -h now</span><br><span class=\"line\"></span><br><span class=\"line\"># 重启</span><br><span class=\"line\">shutdown -r now</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h3 id=\"查看系统-CPU信息\"><a href=\"#查看系统-CPU信息\" class=\"headerlink\" title=\"查看系统,CPU信息\"></a>查看系统,CPU信息</h3></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 查看系统内核信息</span><br><span class=\"line\">uname -a</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看系统内核版本</span><br><span class=\"line\">cat /proc/version</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看当前用户环境变量</span><br><span class=\"line\">env</span><br><span class=\"line\"></span><br><span class=\"line\">cat /proc/cpuinfo</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看有几个逻辑cpu, 包括cpu型号</span><br><span class=\"line\">cat /proc/cpuinfo | grep name | cut -f2 -d: | uniq -c</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看有几颗cpu,每颗分别是几核</span><br><span class=\"line\">cat /proc/cpuinfo | grep physical | uniq -c</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看当前CPU运行在32bit还是64bit模式下, 如果是运行在32bit下也不代表CPU不支持64bit</span><br><span class=\"line\">getconf LONG_BIT</span><br><span class=\"line\"></span><br><span class=\"line\"># 结果大于0, 说明支持64bit计算. lm指long mode, 支持lm则是64bit</span><br><span class=\"line\">cat /proc/cpuinfo | grep flags | grep &#x27; lm &#x27; | wc -l</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h3 id=\"建立软连接\"><a href=\"#建立软连接\" class=\"headerlink\" title=\"建立软连接\"></a>建立软连接</h3></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ln -s /usr/local/jdk1.8/ jdk</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"rpm相关\"><a href=\"#rpm相关\" class=\"headerlink\" title=\"rpm相关\"></a>rpm相关</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 查看是否通过rpm安装了该软件</span><br><span class=\"line\">rpm -qa | grep 软件名</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"sshkey\"><a href=\"#sshkey\" class=\"headerlink\" title=\"sshkey\"></a>sshkey</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 创建sshkey</span><br><span class=\"line\">ssh-keygen -t rsa -C your_email@example.com</span><br><span class=\"line\"></span><br><span class=\"line\">#id_rsa.pub 的内容拷贝到要控制的服务器的 home/username/.ssh/authorized_keys 中,如果没有则新建(.ssh权限为700, authorized_keys权限为600)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"命令重命名\"><a href=\"#命令重命名\" class=\"headerlink\" title=\"命令重命名\"></a>命令重命名</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 在各个用户的.bash_profile中添加重命名配置</span><br><span class=\"line\">alias ll=&#x27;ls -alF&#x27;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"同步服务器时间\"><a href=\"#同步服务器时间\" class=\"headerlink\" title=\"同步服务器时间\"></a>同步服务器时间</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo ntpdate -u ntp.api.bz</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"后台运行命令\"><a href=\"#后台运行命令\" class=\"headerlink\" title=\"后台运行命令\"></a>后台运行命令</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 后台运行,并且有nohup.out输出</span><br><span class=\"line\">nohup xxx &amp;</span><br><span class=\"line\"></span><br><span class=\"line\"># 后台运行, 不输出任何日志</span><br><span class=\"line\">nohup xxx &gt; /dev/null &amp;</span><br><span class=\"line\"></span><br><span class=\"line\"># 后台运行, 并将错误信息做标准输出到日志中 </span><br><span class=\"line\">nohup xxx &gt;out.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"强制活动用户退出\"><a href=\"#强制活动用户退出\" class=\"headerlink\" title=\"强制活动用户退出\"></a>强制活动用户退出</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 命令来完成强制活动用户退出.其中TTY表示终端名称</span><br><span class=\"line\">pkill -kill -t [TTY]</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"查看命令路径\"><a href=\"#查看命令路径\" class=\"headerlink\" title=\"查看命令路径\"></a>查看命令路径</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">which &lt;命令&gt;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"查看进程所有打开最大fd数\"><a href=\"#查看进程所有打开最大fd数\" class=\"headerlink\" title=\"查看进程所有打开最大fd数\"></a>查看进程所有打开最大fd数</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ulimit -n</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"配置dns\"><a href=\"#配置dns\" class=\"headerlink\" title=\"配置dns\"></a>配置dns</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/resolv.conf</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"nslookup-查看域名路由表\"><a href=\"#nslookup-查看域名路由表\" class=\"headerlink\" title=\"nslookup,查看域名路由表\"></a>nslookup,查看域名路由表</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nslookup google.com</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"last-最近登录信息列表\"><a href=\"#last-最近登录信息列表\" class=\"headerlink\" title=\"last, 最近登录信息列表\"></a>last, 最近登录信息列表</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 最近登录的5个账号</span><br><span class=\"line\">last -n 5</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"设置固定ip\"><a href=\"#设置固定ip\" class=\"headerlink\" title=\"设置固定ip\"></a>设置固定ip</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ifconfig em1  192.168.5.177 netmask 255.255.255.0</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"查看进程内加载的环境变量\"><a href=\"#查看进程内加载的环境变量\" class=\"headerlink\" title=\"查看进程内加载的环境变量\"></a>查看进程内加载的环境变量</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 也可以去 cd /proc 目录下, 查看进程内存中加载的东西</span><br><span class=\"line\">ps eww -p  XXXXX(进程号)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"查看进程树找到服务器进程\"><a href=\"#查看进程树找到服务器进程\" class=\"headerlink\" title=\"查看进程树找到服务器进程\"></a>查看进程树找到服务器进程</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ps auwxf</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"查看进程启动路径\"><a href=\"#查看进程启动路径\" class=\"headerlink\" title=\"查看进程启动路径\"></a>查看进程启动路径</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /proc/xxx(进程号)</span><br><span class=\"line\">ls -all</span><br><span class=\"line\"># cwd对应的是启动路径</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"添加用户-配置sudo权限\"><a href=\"#添加用户-配置sudo权限\" class=\"headerlink\" title=\"添加用户, 配置sudo权限\"></a>添加用户, 配置sudo权限</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 新增用户</span><br><span class=\"line\">useradd 用户名</span><br><span class=\"line\">passwd 用户名</span><br><span class=\"line\"></span><br><span class=\"line\">#增加sudo权限</span><br><span class=\"line\">vim /etc/sudoers</span><br><span class=\"line\"># 修改文件里面的</span><br><span class=\"line\"># root    ALL=(ALL)       ALL</span><br><span class=\"line\"># 用户名 ALL=(ALL)       ALL</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"强制关闭进程名包含xxx的所有进程\"><a href=\"#强制关闭进程名包含xxx的所有进程\" class=\"headerlink\" title=\"强制关闭进程名包含xxx的所有进程\"></a>强制关闭进程名包含xxx的所有进程</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ps aux|grep xxx | grep -v grep | awk &#x27;&#123;print $2&#125;&#x27; | xargs kill -9</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"磁盘-文件-目录相关操作\"><a href=\"#磁盘-文件-目录相关操作\" class=\"headerlink\" title=\"磁盘,文件,目录相关操作\"></a><strong>磁盘,文件,目录相关操作</strong></h2><blockquote>\n<h2 id=\"vim操作\"><a href=\"#vim操作\" class=\"headerlink\" title=\"vim操作\"></a>vim操作</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#normal模式下 g表示全局, x表示查找的内容, y表示替换后的内容</span><br><span class=\"line\">:%s/x/y/g</span><br><span class=\"line\"></span><br><span class=\"line\">#normal模式下</span><br><span class=\"line\">0  # 光标移到行首(数字0)</span><br><span class=\"line\">$  # 光标移至行尾</span><br><span class=\"line\">shift + g # 跳到文件最后</span><br><span class=\"line\">gg # 跳到文件头</span><br><span class=\"line\"></span><br><span class=\"line\"># 显示行号</span><br><span class=\"line\">:set nu</span><br><span class=\"line\"></span><br><span class=\"line\"># 去除行号</span><br><span class=\"line\">:set nonu</span><br><span class=\"line\"></span><br><span class=\"line\"># 检索</span><br><span class=\"line\">/xxx(检索内容)  # 从头检索, 按n查找下一个</span><br><span class=\"line\">?xxx(检索内容)  # 从尾部检索</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"打开只读文件-修改后需要保存时-不用切换用户即可保存的方式\"><a href=\"#打开只读文件-修改后需要保存时-不用切换用户即可保存的方式\" class=\"headerlink\" title=\"打开只读文件,修改后需要保存时(不用切换用户即可保存的方式)\"></a>打开只读文件,修改后需要保存时(不用切换用户即可保存的方式)</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 在normal模式下</span><br><span class=\"line\">:w !sudo tee %</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"查看磁盘-文件目录基本信息\"><a href=\"#查看磁盘-文件目录基本信息\" class=\"headerlink\" title=\"查看磁盘, 文件目录基本信息\"></a>查看磁盘, 文件目录基本信息</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 查看磁盘挂载情况</span><br><span class=\"line\">mount</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看磁盘分区信息</span><br><span class=\"line\">df</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看目录及子目录大小</span><br><span class=\"line\">du -H -h</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看当前目录下各个文件, 文件夹占了多少空间, 不会递归</span><br><span class=\"line\">du -sh *</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"wc命令\"><a href=\"#wc命令\" class=\"headerlink\" title=\"wc命令\"></a>wc命令</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 查看文件里有多少行</span><br><span class=\"line\">wc -l filename</span><br><span class=\"line\"></span><br><span class=\"line\"># 看文件里有多少个word</span><br><span class=\"line\">wc -w filename</span><br><span class=\"line\"></span><br><span class=\"line\"># 文件里最长的那一行是多少个字</span><br><span class=\"line\">wc -L filename</span><br><span class=\"line\"></span><br><span class=\"line\"># 统计字节数</span><br><span class=\"line\">wc -c</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"常用压缩-解压缩命令\"><a href=\"#常用压缩-解压缩命令\" class=\"headerlink\" title=\"常用压缩, 解压缩命令\"></a>常用压缩, 解压缩命令</h2></blockquote>\n<blockquote>\n<h3 id=\"压缩命令\"><a href=\"#压缩命令\" class=\"headerlink\" title=\"压缩命令\"></a>压缩命令</h3></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar czvf xxx.tar 压缩目录</span><br><span class=\"line\"></span><br><span class=\"line\">zip -r xxx.zip 压缩目录</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h3 id=\"解压缩命令\"><a href=\"#解压缩命令\" class=\"headerlink\" title=\"解压缩命令\"></a>解压缩命令</h3></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar zxvf xxx.tar</span><br><span class=\"line\"></span><br><span class=\"line\"># 解压到指定文件夹</span><br><span class=\"line\">tar zxvf xxx.tar -C /xxx/yyy/</span><br><span class=\"line\"></span><br><span class=\"line\">unzip xxx.zip</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"变更文件所属用户-用户组\"><a href=\"#变更文件所属用户-用户组\" class=\"headerlink\" title=\"变更文件所属用户, 用户组\"></a>变更文件所属用户, 用户组</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chown eagleye.eagleye xxx.log</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"cp-scp-mkdir\"><a href=\"#cp-scp-mkdir\" class=\"headerlink\" title=\"cp, scp, mkdir\"></a>cp, scp, mkdir</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#复制</span><br><span class=\"line\">cp xxx.log</span><br><span class=\"line\"></span><br><span class=\"line\"># 复制并强制覆盖同名文件</span><br><span class=\"line\">cp -f xxx.log</span><br><span class=\"line\"></span><br><span class=\"line\"># 复制文件夹</span><br><span class=\"line\">cp -r xxx(源文件夹) yyy(目标文件夹)</span><br><span class=\"line\"></span><br><span class=\"line\"># 远程复制</span><br><span class=\"line\">scp -P ssh端口 username@10.10.10.101:/home/username/xxx /home/xxx</span><br><span class=\"line\"></span><br><span class=\"line\"># 级联创建目录</span><br><span class=\"line\">mkdir -p /xxx/yyy/zzz</span><br><span class=\"line\"></span><br><span class=\"line\"># 批量创建文件夹, 会在test,main下都创建java, resources文件夹</span><br><span class=\"line\">mkdir -p src/&#123;test,main&#125;/&#123;java,resources&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"比较两个文件\"><a href=\"#比较两个文件\" class=\"headerlink\" title=\"比较两个文件\"></a>比较两个文件</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">diff -u 1.txt 2.txt</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"日志输出的字节数-可以用作性能测试\"><a href=\"#日志输出的字节数-可以用作性能测试\" class=\"headerlink\" title=\"日志输出的字节数,可以用作性能测试\"></a>日志输出的字节数,可以用作性能测试</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 如果做性能测试, 可以每执行一次, 往日志里面输出 “.” , 这样日志中的字节数就是实际的性能测试运行的次数, 还可以看见实时速率.</span><br><span class=\"line\">tail -f xxx.log | pv -bt</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"查看-去除特殊字符\"><a href=\"#查看-去除特殊字符\" class=\"headerlink\" title=\"查看, 去除特殊字符\"></a>查看, 去除特殊字符</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 查看特殊字符</span><br><span class=\"line\">cat -v xxx.sh</span><br><span class=\"line\"></span><br><span class=\"line\"># 去除特殊字符</span><br><span class=\"line\">sed -i &#x27;s/^M//g’ env.sh  去除文件的特殊字符, 比如^M:  需要这样输入: ctrl+v+enter</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"处理因系统原因引起的文件中特殊字符的问题\"><a href=\"#处理因系统原因引起的文件中特殊字符的问题\" class=\"headerlink\" title=\"处理因系统原因引起的文件中特殊字符的问题\"></a>处理因系统原因引起的文件中特殊字符的问题</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 可以转换为该系统下的文件格式</span><br><span class=\"line\">cat file.sh &gt; file.sh_bak</span><br><span class=\"line\"></span><br><span class=\"line\"># 先将file.sh中文件内容复制下来然后运行, 然后粘贴内容, 最后ctrl + d 保存退出</span><br><span class=\"line\">cat &gt; file1.sh</span><br><span class=\"line\"></span><br><span class=\"line\"># 在vim中通过如下设置文件编码和文件格式</span><br><span class=\"line\">:set fileencodings=utf-8 ，然后 w （存盘）一下即可转化为 utf8 格式，</span><br><span class=\"line\">:set fileformat=unix</span><br><span class=\"line\"></span><br><span class=\"line\"># 在mac下使用dos2unix进行文件格式化</span><br><span class=\"line\">find . -name &quot;*.sh&quot; | xargs dos2unix</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"tee-重定向的同时输出到屏幕\"><a href=\"#tee-重定向的同时输出到屏幕\" class=\"headerlink\" title=\"tee, 重定向的同时输出到屏幕\"></a>tee, 重定向的同时输出到屏幕</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">awk ‘&#123;print $0&#125;’ xxx.log | tee test.log</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"检索相关\"><a href=\"#检索相关\" class=\"headerlink\" title=\"检索相关\"></a><strong>检索相关</strong></h2><blockquote>\n<h2 id=\"grep\"><a href=\"#grep\" class=\"headerlink\" title=\"grep\"></a>grep</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 反向匹配, 查找不包含xxx的内容</span><br><span class=\"line\">grep -v xxx</span><br><span class=\"line\"></span><br><span class=\"line\"># 排除所有空行</span><br><span class=\"line\">grep -v &#x27;^/pre&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"># 返回结果 2,则说明第二行是空行</span><br><span class=\"line\">grep -n “^$” 111.txt    </span><br><span class=\"line\"></span><br><span class=\"line\"># 查询以abc开头的行</span><br><span class=\"line\">grep -n “^abc” 111.txt </span><br><span class=\"line\"></span><br><span class=\"line\"># 同时列出该词语出现在文章的第几行</span><br><span class=\"line\">grep &#x27;xxx&#x27; -n xxx.log</span><br><span class=\"line\"></span><br><span class=\"line\"># 计算一下该字串出现的次数</span><br><span class=\"line\">grep &#x27;xxx&#x27; -c xxx.log</span><br><span class=\"line\"></span><br><span class=\"line\"># 比对的时候，不计较大小写的不同</span><br><span class=\"line\">grep &#x27;xxx&#x27; -i xxx.log</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"awk\"><a href=\"#awk\" class=\"headerlink\" title=\"awk\"></a>awk</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 以&#x27;:&#x27; 为分隔符,如果第五域有user则输出该行</span><br><span class=\"line\">awk -F &#x27;:&#x27; &#x27;&#123;if ($5 ~ /user/) print $0&#125;&#x27; /etc/passwd </span><br><span class=\"line\"></span><br><span class=\"line\"># 统计单个文件中某个字符（串）(中文无效)出现的次数</span><br><span class=\"line\">awk -v RS=&#x27;character&#x27; &#x27;END &#123;print --NR&#125;&#x27; xxx.txt</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"find检索命令\"><a href=\"#find检索命令\" class=\"headerlink\" title=\"find检索命令\"></a>find检索命令</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 在目录下找后缀是.mysql的文件</span><br><span class=\"line\">find /home/eagleye -name &#x27;*.mysql&#x27; -print</span><br><span class=\"line\"></span><br><span class=\"line\"># 会从 /usr 目录开始往下找，找最近3天之内存取过的文件。</span><br><span class=\"line\">find /usr -atime 3 –print</span><br><span class=\"line\"></span><br><span class=\"line\"># 会从 /usr 目录开始往下找，找最近5天之内修改过的文件。</span><br><span class=\"line\">find /usr -ctime 5 –print</span><br><span class=\"line\"></span><br><span class=\"line\"># 会从 /doc 目录开始往下找，找jacky 的、文件名开头是 j的文件。  </span><br><span class=\"line\">find /doc -user jacky -name &#x27;j*&#x27; –print</span><br><span class=\"line\"></span><br><span class=\"line\"># 会从 /doc 目录开始往下找，找寻文件名是 ja 开头或者 ma开头的文件。</span><br><span class=\"line\">find /doc \\( -name &#x27;ja*&#x27; -o- -name &#x27;ma*&#x27; \\) –print</span><br><span class=\"line\"></span><br><span class=\"line\">#  会从 /doc 目录开始往下找，找到凡是文件名结尾为 bak的文件，把它删除掉。-exec 选项是执行的意思，rm 是删除命令，&#123; &#125; 表示文件名，“\\;”是规定的命令结尾。 </span><br><span class=\"line\">find /doc -name &#x27;*bak&#x27; -exec rm &#123;&#125; \\;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"网络相关\"><a href=\"#网络相关\" class=\"headerlink\" title=\"网络相关\"></a><strong>网络相关</strong></h2><blockquote>\n<h2 id=\"查看什么进程使用了该端口\"><a href=\"#查看什么进程使用了该端口\" class=\"headerlink\" title=\"查看什么进程使用了该端口\"></a>查看什么进程使用了该端口</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lsof -i:port</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"获取本机ip地址\"><a href=\"#获取本机ip地址\" class=\"headerlink\" title=\"获取本机ip地址\"></a>获取本机ip地址</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/sbin/ifconfig -a|grep inet|grep -v 127.0.0.1|grep -v inet6|awk &#x27;&#123;print $2&#125;&#x27;|tr -d &quot;addr:&quot;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"iptables\"><a href=\"#iptables\" class=\"headerlink\" title=\"iptables\"></a>iptables</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 查看iptables状态</span><br><span class=\"line\">service iptables status</span><br><span class=\"line\"></span><br><span class=\"line\"># 要封停一个ip</span><br><span class=\"line\">iptables -I INPUT -s ***.***.***.*** -j DROP</span><br><span class=\"line\"></span><br><span class=\"line\"># 要解封一个IP，使用下面这条命令：</span><br><span class=\"line\">iptables -D INPUT -s ***.***.***.*** -j DROP</span><br><span class=\"line\"></span><br><span class=\"line\">备注: 参数-I是表示Insert（添加），-D表示Delete（删除）。后面跟的是规则，INPUT表示入站，***.***.***.***表示要封停的IP，DROP表示放弃连接。</span><br><span class=\"line\"></span><br><span class=\"line\">#开启9090端口的访问</span><br><span class=\"line\">/sbin/iptables -I INPUT -p tcp --dport 9090 -j ACCEPT </span><br><span class=\"line\"></span><br><span class=\"line\"># 防火墙开启、关闭、重启</span><br><span class=\"line\">/etc/init.d/iptables status</span><br><span class=\"line\">/etc/init.d/iptables start</span><br><span class=\"line\">/etc/init.d/iptables stop</span><br><span class=\"line\">/etc/init.d/iptables restart</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"nc命令-tcp调试利器\"><a href=\"#nc命令-tcp调试利器\" class=\"headerlink\" title=\"nc命令, tcp调试利器\"></a>nc命令, tcp调试利器</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#给某一个endpoint发送TCP请求,就将data的内容发送到对端</span><br><span class=\"line\">nc 192.168.0.11 8000 &lt; data.txt</span><br><span class=\"line\"></span><br><span class=\"line\">#nc可以当做服务器，监听某个端口号,把某一次请求的内容存储到received_data里</span><br><span class=\"line\">nc -l 8000 &gt; received_data</span><br><span class=\"line\"></span><br><span class=\"line\">#上边只监听一次，如果多次可以加上-k参数</span><br><span class=\"line\">nc -lk 8000</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"tcpdump\"><a href=\"#tcpdump\" class=\"headerlink\" title=\"tcpdump\"></a>tcpdump</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># dump出本机12301端口的tcp包</span><br><span class=\"line\">tcpdump -i em1 tcp port 12301 -s 1500 -w abc.pcap</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"跟踪网络路由路径\"><a href=\"#跟踪网络路由路径\" class=\"headerlink\" title=\"跟踪网络路由路径\"></a>跟踪网络路由路径</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># traceroute默认使用udp方式, 如果是-I则改成icmp方式</span><br><span class=\"line\">traceroute -I www.163.com</span><br><span class=\"line\"></span><br><span class=\"line\"># 从ttl第3跳跟踪</span><br><span class=\"line\">traceroute -M 3 www.163.com  </span><br><span class=\"line\"></span><br><span class=\"line\"># 加上端口跟踪</span><br><span class=\"line\">traceroute -p 8080 192.168.10.11</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"ss\"><a href=\"#ss\" class=\"headerlink\" title=\"ss\"></a>ss</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 显示本地打开的所有端口</span><br><span class=\"line\">ss -l </span><br><span class=\"line\"></span><br><span class=\"line\"># 显示每个进程具体打开的socket</span><br><span class=\"line\">ss -pl </span><br><span class=\"line\"></span><br><span class=\"line\"># 显示所有tcp socket</span><br><span class=\"line\">ss -t -a </span><br><span class=\"line\"></span><br><span class=\"line\"># 显示所有的UDP Socekt</span><br><span class=\"line\">ss -u -a </span><br><span class=\"line\"></span><br><span class=\"line\"># 显示所有已建立的SMTP连接</span><br><span class=\"line\">ss -o state established &#x27;( dport = :smtp or sport = :smtp )&#x27;  </span><br><span class=\"line\"></span><br><span class=\"line\"># 显示所有已建立的HTTP连接 </span><br><span class=\"line\">ss -o state established &#x27;( dport = :http or sport = :http )&#x27;  </span><br><span class=\"line\"></span><br><span class=\"line\">找出所有连接X服务器的进程</span><br><span class=\"line\">ss -x src /tmp/.X11-unix/*  </span><br><span class=\"line\"></span><br><span class=\"line\">列出当前socket统计信息</span><br><span class=\"line\">ss -s </span><br><span class=\"line\"></span><br><span class=\"line\">解释：netstat是遍历/proc下面每个PID目录，ss直接读/proc/net下面的统计信息。所以ss执行的时候消耗资源以及消耗的时间都比netstat少很多</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"netstat\"><a href=\"#netstat\" class=\"headerlink\" title=\"netstat\"></a>netstat</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 输出每个ip的连接数，以及总的各个状态的连接数</span><br><span class=\"line\">netstat -n | awk &#x27;/^tcp/ &#123;n=split($(NF-1),array,&quot;:&quot;);if(n&lt;=2)++S[array[(1)]];else++S[array[(4)]];++s[$NF];++N&#125; END &#123;for(a in S)&#123;printf(&quot;%-20s %s\\n&quot;, a, S[a]);++I&#125;printf(&quot;%-20s %s\\n&quot;,&quot;TOTAL_IP&quot;,I);for(a in s) printf(&quot;%-20s %s\\n&quot;,a, s[a]);printf(&quot;%-20s %s\\n&quot;,&quot;TOTAL_LINK&quot;,N);&#125;&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\"># 统计所有连接状态, </span><br><span class=\"line\"># CLOSED：无连接是活动的或正在进行</span><br><span class=\"line\"># LISTEN：服务器在等待进入呼叫</span><br><span class=\"line\"># SYN_RECV：一个连接请求已经到达，等待确认</span><br><span class=\"line\"># SYN_SENT：应用已经开始，打开一个连接</span><br><span class=\"line\"># ESTABLISHED：正常数据传输状态</span><br><span class=\"line\"># FIN_WAIT1：应用说它已经完成</span><br><span class=\"line\"># FIN_WAIT2：另一边已同意释放</span><br><span class=\"line\"># ITMED_WAIT：等待所有分组死掉</span><br><span class=\"line\"># CLOSING：两边同时尝试关闭</span><br><span class=\"line\"># TIME_WAIT：主动关闭连接一端还没有等到另一端反馈期间的状态</span><br><span class=\"line\"># LAST_ACK：等待所有分组死掉</span><br><span class=\"line\">netstat -n | awk &#x27;/^tcp/ &#123;++state[$NF]&#125; END &#123;for(key in state) print key,&quot;\\t&quot;,state[key]&#125;&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\"># 查找较多time_wait连接</span><br><span class=\"line\">netstat -n|grep TIME_WAIT|awk &#x27;&#123;print $5&#125;&#x27;|sort|uniq -c|sort -rn|head -n20</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"监控linux性能命令\"><a href=\"#监控linux性能命令\" class=\"headerlink\" title=\"监控linux性能命令\"></a><strong>监控linux性能命令</strong></h2><blockquote>\n<h2 id=\"top\"><a href=\"#top\" class=\"headerlink\" title=\"top\"></a>top</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">按大写的 F 或 O 键，然后按 a-z 可以将进程按照相应的列进行排序, 然后回车。而大写的 R 键可以将当前的排序倒转</span><br></pre></td></tr></table></figure>\n\n<table>\n<thead>\n<tr>\n<th align=\"left\">列名</th>\n<th align=\"left\">含义</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">PID</td>\n<td align=\"left\">进程id</td>\n</tr>\n<tr>\n<td align=\"left\">PPID</td>\n<td align=\"left\">父进程id</td>\n</tr>\n<tr>\n<td align=\"left\">RUSER</td>\n<td align=\"left\">Real user name</td>\n</tr>\n<tr>\n<td align=\"left\">UID</td>\n<td align=\"left\">进程所有者的用户id</td>\n</tr>\n<tr>\n<td align=\"left\">USER</td>\n<td align=\"left\">进程所有者的用户名</td>\n</tr>\n<tr>\n<td align=\"left\">GROUP</td>\n<td align=\"left\">进程所有者的组名</td>\n</tr>\n<tr>\n<td align=\"left\">TTY</td>\n<td align=\"left\">启动进程的终端名。不是从终端启动的进程则显示为 ?</td>\n</tr>\n<tr>\n<td align=\"left\">PR</td>\n<td align=\"left\">优先级</td>\n</tr>\n<tr>\n<td align=\"left\">NI</td>\n<td align=\"left\">nice值。负值表示高优先级，正值表示低优先级</td>\n</tr>\n<tr>\n<td align=\"left\">P</td>\n<td align=\"left\">最后使用的CPU，仅在多CPU环境下有意义</td>\n</tr>\n<tr>\n<td align=\"left\">%CPU</td>\n<td align=\"left\">上次更新到现在的CPU时间占用百分比</td>\n</tr>\n<tr>\n<td align=\"left\">TIME</td>\n<td align=\"left\">进程使用的CPU时间总计，单位秒</td>\n</tr>\n<tr>\n<td align=\"left\">TIME+</td>\n<td align=\"left\">进程使用的CPU时间总计，单位1&#x2F;100秒</td>\n</tr>\n<tr>\n<td align=\"left\">%MEM</td>\n<td align=\"left\">进程使用的物理内存百分比</td>\n</tr>\n<tr>\n<td align=\"left\">VIRT</td>\n<td align=\"left\">进程使用的虚拟内存总量，单位kb。VIRT&#x3D;SWAP+RES</td>\n</tr>\n<tr>\n<td align=\"left\">SWAP</td>\n<td align=\"left\">进程使用的虚拟内存中，被换出的大小，单位kb。</td>\n</tr>\n<tr>\n<td align=\"left\">RES</td>\n<td align=\"left\">进程使用的、未被换出的物理内存大小，单位kb。RES&#x3D;CODE+DATA</td>\n</tr>\n<tr>\n<td align=\"left\">CODE</td>\n<td align=\"left\">可执行代码占用的物理内存大小，单位kb</td>\n</tr>\n<tr>\n<td align=\"left\">DATA</td>\n<td align=\"left\">可执行代码以外的部分(数据段+栈)占用的物理内存大小，单位kb</td>\n</tr>\n<tr>\n<td align=\"left\">SHR</td>\n<td align=\"left\">共享内存大小，单位kb</td>\n</tr>\n<tr>\n<td align=\"left\">nFLT</td>\n<td align=\"left\">页面错误次数</td>\n</tr>\n<tr>\n<td align=\"left\">nDRT</td>\n<td align=\"left\">最后一次写入到现在，被修改过的页面数。</td>\n</tr>\n<tr>\n<td align=\"left\">S</td>\n<td align=\"left\">进程状态。D&#x3D;不可中断的睡眠状态,R&#x3D;运行,S&#x3D;睡眠,T&#x3D;跟踪&#x2F;停止,Z&#x3D;僵尸进程</td>\n</tr>\n<tr>\n<td align=\"left\">COMMAND</td>\n<td align=\"left\">命令名&#x2F;命令行</td>\n</tr>\n<tr>\n<td align=\"left\">WCHAN</td>\n<td align=\"left\">若该进程在睡眠，则显示睡眠中的系统函数名</td>\n</tr>\n<tr>\n<td align=\"left\">Flags</td>\n<td align=\"left\">任务标志，参考 sched.h</td>\n</tr>\n</tbody></table>\n<blockquote>\n<h2 id=\"dmesg-查看系统日志\"><a href=\"#dmesg-查看系统日志\" class=\"headerlink\" title=\"dmesg,查看系统日志\"></a>dmesg,查看系统日志</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dmesg</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"iostat-磁盘IO情况监控\"><a href=\"#iostat-磁盘IO情况监控\" class=\"headerlink\" title=\"iostat,磁盘IO情况监控\"></a>iostat,磁盘IO情况监控</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">iostat -xz 1</span><br><span class=\"line\"></span><br><span class=\"line\"># r/s, w/s, rkB/s, wkB/s：分别表示每秒读写次数和每秒读写数据量（千字节）。读写量过大，可能会引起性能问题。</span><br><span class=\"line\"># await：IO操作的平均等待时间，单位是毫秒。这是应用程序在和磁盘交互时，需要消耗的时间，包括IO等待和实际操作的耗时。如果这个数值过大，可能是硬件设备遇到了瓶颈或者出现故障。</span><br><span class=\"line\"># avgqu-sz：向设备发出的请求平均数量。如果这个数值大于1，可能是硬件设备已经饱和（部分前端硬件设备支持并行写入）。</span><br><span class=\"line\"># %util：设备利用率。这个数值表示设备的繁忙程度，经验值是如果超过60，可能会影响IO性能（可以参照IO操作平均等待时间）。如果到达100%，说明硬件设备已经饱和。</span><br><span class=\"line\"># 如果显示的是逻辑设备的数据，那么设备利用率不代表后端实际的硬件设备已经饱和。值得注意的是，即使IO性能不理想，也不一定意味这应用程序性能会不好，可以利用诸如预读取、写缓存等策略提升应用性能。</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"free-内存使用情况\"><a href=\"#free-内存使用情况\" class=\"headerlink\" title=\"free,内存使用情况\"></a>free,内存使用情况</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">free -m</span><br><span class=\"line\"></span><br><span class=\"line\">eg:</span><br><span class=\"line\"></span><br><span class=\"line\">     total       used       free     shared    buffers     cached</span><br><span class=\"line\">Mem:          1002        769        232          0         62        421</span><br><span class=\"line\">-/+ buffers/cache:          286        715</span><br><span class=\"line\">Swap:          1153          0       1153</span><br><span class=\"line\"></span><br><span class=\"line\">第一部分Mem行:</span><br><span class=\"line\">total 内存总数: 1002M</span><br><span class=\"line\">used 已经使用的内存数: 769M</span><br><span class=\"line\">free 空闲的内存数: 232M</span><br><span class=\"line\">shared 当前已经废弃不用,总是0</span><br><span class=\"line\">buffers Buffer 缓存内存数: 62M</span><br><span class=\"line\">cached Page 缓存内存数:421M</span><br><span class=\"line\"></span><br><span class=\"line\">关系：total(1002M) = used(769M) + free(232M)</span><br><span class=\"line\"></span><br><span class=\"line\">第二部分(-/+ buffers/cache):</span><br><span class=\"line\">(-buffers/cache) used内存数：286M (指的第一部分Mem行中的used – buffers – cached)</span><br><span class=\"line\">(+buffers/cache) free内存数: 715M (指的第一部分Mem行中的free + buffers + cached)</span><br><span class=\"line\"></span><br><span class=\"line\">可见-buffers/cache反映的是被程序实实在在吃掉的内存,而+buffers/cache反映的是可以挪用的内存总数.</span><br><span class=\"line\"></span><br><span class=\"line\">第三部分是指交换分区</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"sar-查看网络吞吐状态\"><a href=\"#sar-查看网络吞吐状态\" class=\"headerlink\" title=\"sar,查看网络吞吐状态\"></a>sar,查看网络吞吐状态</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sar命令在这里可以查看网络设备的吞吐率。在排查性能问题时，可以通过网络设备的吞吐量，判断网络设备是否已经饱和</span><br><span class=\"line\">sar -n DEV 1</span><br><span class=\"line\"></span><br><span class=\"line\">#</span><br><span class=\"line\"># sar命令在这里用于查看TCP连接状态，其中包括：</span><br><span class=\"line\"># active/s：每秒本地发起的TCP连接数，既通过connect调用创建的TCP连接；</span><br><span class=\"line\"># passive/s：每秒远程发起的TCP连接数，即通过accept调用创建的TCP连接；</span><br><span class=\"line\"># retrans/s：每秒TCP重传数量；</span><br><span class=\"line\"># TCP连接数可以用来判断性能问题是否由于建立了过多的连接，进一步可以判断是主动发起的连接，还是被动接受的连接。TCP重传可能是因为网络环境恶劣，或者服务器压力过大导致丢包</span><br><span class=\"line\">sar -n TCP,ETCP 1</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<h2 id=\"vmstat-给定时间监控CPU使用率-内存使用-虚拟内存交互-IO读写\"><a href=\"#vmstat-给定时间监控CPU使用率-内存使用-虚拟内存交互-IO读写\" class=\"headerlink\" title=\"vmstat, 给定时间监控CPU使用率, 内存使用, 虚拟内存交互, IO读写\"></a>vmstat, 给定时间监控CPU使用率, 内存使用, 虚拟内存交互, IO读写</h2></blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 2表示每2秒采集一次状态信息, 1表示只采集一次(忽略既是一直采集)</span><br><span class=\"line\">vmstat 2 1</span><br><span class=\"line\"></span><br><span class=\"line\">eg:</span><br><span class=\"line\">r b swpd free buff cache si so bi bo in cs us sy id wa</span><br><span class=\"line\">1 0 0 3499840 315836 3819660 0 0 0 1 2 0 0 0 100 0</span><br><span class=\"line\">0 0 0 3499584 315836 3819660 0 0 0 0 88 158 0 0 100 0</span><br><span class=\"line\">0 0 0 3499708 315836 3819660 0 0 0 2 86 162 0 0 100 0</span><br><span class=\"line\">0 0 0 3499708 315836 3819660 0 0 0 10 81 151 0 0 100 0</span><br><span class=\"line\">1 0 0 3499732 315836 3819660 0 0 0 2 83 154 0 0 100 0</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>r 表示运行队列(就是说多少个进程真的分配到CPU)，我测试的服务器目前CPU比较空闲，没什么程序在跑，当这个值超过了CPU数目，就会出现CPU瓶颈了。这个也和top的负载有关系，一般负载超过了3就比较高，超过了5就高，超过了10就不正常了，服务器的状态很危险。top的负载类似每秒的运行队列。如果运行队列过大，表示你的CPU很繁忙，一般会造成CPU使用率很高。</p>\n</li>\n<li><p>b 表示阻塞的进程,这个不多说，进程阻塞，大家懂的。</p>\n</li>\n<li><p>swpd 虚拟内存已使用的大小，如果大于0，表示你的机器物理内存不足了，如果不是程序内存泄露的原因，那么你该升级内存了或者把耗内存的任务迁移到其他机器。</p>\n</li>\n<li><p>free 空闲的物理内存的大小，我的机器内存总共8G，剩余3415M。</p>\n</li>\n<li><p>buff Linux&#x2F;Unix系统是用来存储，目录里面有什么内容，权限等的缓存，我本机大概占用300多M</p>\n</li>\n<li><p>cache cache直接用来记忆我们打开的文件,给文件做缓冲，我本机大概占用300多M(这里是Linux&#x2F;Unix的聪明之处，把空闲的物理内存的一部分拿来做文件和目录的缓存，是为了提高 程序执行的性能，当程序使用内存时，buffer&#x2F;cached会很快地被使用。)</p>\n</li>\n<li><p>si 每秒从磁盘读入虚拟内存的大小，如果这个值大于0，表示物理内存不够用或者内存泄露了，要查找耗内存进程解决掉。我的机器内存充裕，一切正常。</p>\n</li>\n<li><p>so 每秒虚拟内存写入磁盘的大小，如果这个值大于0，同上。</p>\n</li>\n<li><p>bi 块设备每秒接收的块数量，这里的块设备是指系统上所有的磁盘和其他块设备，默认块大小是1024byte，我本机上没什么IO操作，所以一直是0，但是我曾在处理拷贝大量数据(2-3T)的机器上看过可以达到140000&#x2F;s，磁盘写入速度差不多140M每秒</p>\n</li>\n<li><p>bo 块设备每秒发送的块数量，例如我们读取文件，bo就要大于0。bi和bo一般都要接近0，不然就是IO过于频繁，需要调整。</p>\n</li>\n<li><p>in 每秒CPU的中断次数，包括时间中断</p>\n</li>\n<li><p>cs 每秒上下文切换次数，例如我们调用系统函数，就要进行上下文切换，线程的切换，也要进程上下文切换，这个值要越小越好，太大了，要考虑调低线程或者进程的数目,例如在apache和nginx这种web服务器中，我们一般做性能测试时会进行几千并发甚至几万并发的测试，选择web服务器的进程可以由进程或者线程的峰值一直下调，压测，直到cs到一个比较小的值，这个进程和线程数就是比较合适的值了。系统调用也是，每次调用系统函数，我们的代码就会进入内核空间，导致上下文切换，这个是很耗资源，也要尽量避免频繁调用系统函数。上下文切换次数过多表示你的CPU大部分浪费在上下文切换，导致CPU干正经事的时间少了，CPU没有充分利用，是不可取的。</p>\n</li>\n<li><p>us 用户CPU时间，我曾经在一个做加密解密很频繁的服务器上，可以看到us接近100,r运行队列达到80(机器在做压力测试，性能表现不佳)。</p>\n</li>\n<li><p>sy 系统CPU时间，如果太高，表示系统调用时间长，例如是IO操作频繁。</p>\n</li>\n<li><p>id 空闲 CPU时间，一般来说，id + us + sy &#x3D; 100,一般我认为id是空闲CPU使用率，us是用户CPU使用率，sy是系统CPU使用率。</p>\n</li>\n<li><p>wt 等待IO CPU时间。</p>\n</li>\n<li></li>\n<li><pre><code>export DOCKERPATH=/usr/bin/docker\nexport PATH=$PATH:$DOCKERPATH\n\nsz-memect.tpddns.cn:5000\nchown -R root:root /usr/share/jenkins\nchown -R root:root /usr/share/doc/jenkins\nchown -R root:root /usr/bin/jenkins\nchown -R root:root /var/lib/jenkins\nchown -R root:root /var/log/jenkins\nchown -R root:root /var/cache/jenkins\nchown -R root:root /etc/default/jenkins\nchown -R root:root /etc/init.d/jenkins\nchown -R root:root /etc/logrotate.d/jenkins\n</code></pre>\n</li>\n</ul>\n"},{"title":"Pritunl安装","date":"2021-11-20T04:31:01.000Z","keywords":"pritunl","description":"pritunl安装","cover":"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg","top_img":"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg","_content":"\n# Pritunl的安装\n\n- 环境准备\n\n  | 序号 | 环境准备       | 版本                     |\n  | ---- | -------------- | ------------------------ |\n  | 1    | Ubantu         | 20.04桌面版              |\n  | 2    | Pritunl Server | Pritunl Server最新的版本 |\n  | 3    | Pritunl Client | Pritunl Client最新的版本 |\n\n  \n\n- Pritunl Server安装\n\n  1、通过`apt`在终端中运行以下命令来确保所有系统软件包都是最新的\n\n  ```\n  sudo apt update\n  sudo apt upgrade\n  sudo apt install curl gnupg2 wget unzip\n  ```\n\n  2、在Ubuntu 20.04上安装Pritunl VPN Server\n\n  我们将Pritunl存储库密钥和文件添加到Ubuntu系统\n\n  ```\n  sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com --recv E162F504A20CDF15827F718D4B7C549A058F8B6B\n  sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com --recv 7568D9BB55FF9E5287D586017AE645C0CF8E292A\n  ```\n\n  接下来，使用以下命令添加其存储库文件：\n\n  ```\n  echo \"deb http://repo.pritunl.com/stable/apt focal main\" | sudo tee /etc/apt/sources.list.d/pritunl.list\n  ```\n\n  添加存储库后，请使用以下命令更新存储库缓存并安装Pritunl服务器：\n\n  ```\n  sudo apt update\n  sudo apt install pritunl\n  ```\n\n  安装完成后，您可以设置启动，停止并启用Pritunl VPN服务器在服务器启动时自动启动：\n\n  ```\n  sudo systemctl stop pritunl\n  sudo systemctl start pritunl\n  sudo systemctl enable pritunl\n  ```\n\n  3、安装MongoDB\n\n  默认情况下，Ubuntu 20.04默认存储库中不提供MongoDB，因此您需要将MongoDB存储库添加到系统中：\n\n  ```\n  curl -fsSL https://www.mongodb.org/static/pgp/server-4.4.asc | sudo apt-key add -\n  echo \"deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/4.4 multiverse\" | sudo tee /etc/apt/sources.list.d/mongodb-org-4.4.list\n  ```\n\n  `apt`使用以下命令更新和安装MongoDB：\n\n  ```\n  sudo apt update\n  sudo apt-get install mongodb-server\n  ```\n\n  4、访问Pritunl\n\n  现在，打开您的Web浏览器，并使用URL访问Pritunl Web界面。应该看到以下屏幕：`https://your-server-ipaddress`\n\n  ![pritunl-web-interface](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/pritunl-web-interface.jpg)\n\n​\t\t接下来，使用以下命令生成设置密钥：\n\n```\nsudo pritunl setup-key\n```\n\n​\t\t输出：\n\n```\nfrom cryptography import x586\nc879d9o59b10012084887b2g4ua5g49u\n```\n\n之后，复制安装密钥并将其粘贴到Pritunl数据库安装向导。粘贴设置键后，单击“保存”按钮。\n\n接下来，您将需要生成一个默认的用户名和密码来登录。为此，请运行以下命令：\n\n```\nsudo pritunl default-password\n```\n\n输出：\n\n```\nfrom cryptography import x586\n[undefined][2021-03-09 12:09:16,430][INFO] Getting default administrator password\nAdministrator default password:\nusername: \"pritunl\"\npassword: \"meilana123\"\n```\n\n现在，使用默认的用户名和密码登录，并从Pritunl仪表板设置您的环境。\n\n- Pritunl Clinet安装（只能在Ubantu桌面上安装，安装后可以在Ubantu系统上看见软件图标）\n\n  ```\n  sudo tee /etc/apt/sources.list.d/pritunl.list << EOF\n  deb https://repo.pritunl.com/stable/apt focal main\n  EOF\n  \n  sudo apt --assume-yes install gnupg\n  gpg --keyserver hkp://keyserver.ubuntu.com --recv-keys 7568D9BB55FF9E5287D586017AE645C0CF8E292A\n  gpg --armor --export 7568D9BB55FF9E5287D586017AE645C0CF8E292A | sudo tee /etc/apt/trusted.gpg.d/pritunl.asc\n  sudo apt update\n  sudo apt install pritunl-client-electron\n  ```\n\n  ","source":"_posts/Pritunl的安装.md","raw":"---\ntitle: Pritunl安装\ndate: 2021-11-20 12:31:01\ntags: Pritunl\ncategories: 安装\nkeywords: pritunl\ndescription: pritunl安装\ncover: https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg\ntop_img: https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg\n---\n\n# Pritunl的安装\n\n- 环境准备\n\n  | 序号 | 环境准备       | 版本                     |\n  | ---- | -------------- | ------------------------ |\n  | 1    | Ubantu         | 20.04桌面版              |\n  | 2    | Pritunl Server | Pritunl Server最新的版本 |\n  | 3    | Pritunl Client | Pritunl Client最新的版本 |\n\n  \n\n- Pritunl Server安装\n\n  1、通过`apt`在终端中运行以下命令来确保所有系统软件包都是最新的\n\n  ```\n  sudo apt update\n  sudo apt upgrade\n  sudo apt install curl gnupg2 wget unzip\n  ```\n\n  2、在Ubuntu 20.04上安装Pritunl VPN Server\n\n  我们将Pritunl存储库密钥和文件添加到Ubuntu系统\n\n  ```\n  sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com --recv E162F504A20CDF15827F718D4B7C549A058F8B6B\n  sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com --recv 7568D9BB55FF9E5287D586017AE645C0CF8E292A\n  ```\n\n  接下来，使用以下命令添加其存储库文件：\n\n  ```\n  echo \"deb http://repo.pritunl.com/stable/apt focal main\" | sudo tee /etc/apt/sources.list.d/pritunl.list\n  ```\n\n  添加存储库后，请使用以下命令更新存储库缓存并安装Pritunl服务器：\n\n  ```\n  sudo apt update\n  sudo apt install pritunl\n  ```\n\n  安装完成后，您可以设置启动，停止并启用Pritunl VPN服务器在服务器启动时自动启动：\n\n  ```\n  sudo systemctl stop pritunl\n  sudo systemctl start pritunl\n  sudo systemctl enable pritunl\n  ```\n\n  3、安装MongoDB\n\n  默认情况下，Ubuntu 20.04默认存储库中不提供MongoDB，因此您需要将MongoDB存储库添加到系统中：\n\n  ```\n  curl -fsSL https://www.mongodb.org/static/pgp/server-4.4.asc | sudo apt-key add -\n  echo \"deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/4.4 multiverse\" | sudo tee /etc/apt/sources.list.d/mongodb-org-4.4.list\n  ```\n\n  `apt`使用以下命令更新和安装MongoDB：\n\n  ```\n  sudo apt update\n  sudo apt-get install mongodb-server\n  ```\n\n  4、访问Pritunl\n\n  现在，打开您的Web浏览器，并使用URL访问Pritunl Web界面。应该看到以下屏幕：`https://your-server-ipaddress`\n\n  ![pritunl-web-interface](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/pritunl-web-interface.jpg)\n\n​\t\t接下来，使用以下命令生成设置密钥：\n\n```\nsudo pritunl setup-key\n```\n\n​\t\t输出：\n\n```\nfrom cryptography import x586\nc879d9o59b10012084887b2g4ua5g49u\n```\n\n之后，复制安装密钥并将其粘贴到Pritunl数据库安装向导。粘贴设置键后，单击“保存”按钮。\n\n接下来，您将需要生成一个默认的用户名和密码来登录。为此，请运行以下命令：\n\n```\nsudo pritunl default-password\n```\n\n输出：\n\n```\nfrom cryptography import x586\n[undefined][2021-03-09 12:09:16,430][INFO] Getting default administrator password\nAdministrator default password:\nusername: \"pritunl\"\npassword: \"meilana123\"\n```\n\n现在，使用默认的用户名和密码登录，并从Pritunl仪表板设置您的环境。\n\n- Pritunl Clinet安装（只能在Ubantu桌面上安装，安装后可以在Ubantu系统上看见软件图标）\n\n  ```\n  sudo tee /etc/apt/sources.list.d/pritunl.list << EOF\n  deb https://repo.pritunl.com/stable/apt focal main\n  EOF\n  \n  sudo apt --assume-yes install gnupg\n  gpg --keyserver hkp://keyserver.ubuntu.com --recv-keys 7568D9BB55FF9E5287D586017AE645C0CF8E292A\n  gpg --armor --export 7568D9BB55FF9E5287D586017AE645C0CF8E292A | sudo tee /etc/apt/trusted.gpg.d/pritunl.asc\n  sudo apt update\n  sudo apt install pritunl-client-electron\n  ```\n\n  ","slug":"Pritunl的安装","published":1,"updated":"2022-10-16T06:17:49.748Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clg1mfus2000927qg1hp3amhu","content":"<h1 id=\"Pritunl的安装\"><a href=\"#Pritunl的安装\" class=\"headerlink\" title=\"Pritunl的安装\"></a>Pritunl的安装</h1><ul>\n<li><p>环境准备</p>\n<table>\n<thead>\n<tr>\n<th>序号</th>\n<th>环境准备</th>\n<th>版本</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>Ubantu</td>\n<td>20.04桌面版</td>\n</tr>\n<tr>\n<td>2</td>\n<td>Pritunl Server</td>\n<td>Pritunl Server最新的版本</td>\n</tr>\n<tr>\n<td>3</td>\n<td>Pritunl Client</td>\n<td>Pritunl Client最新的版本</td>\n</tr>\n</tbody></table>\n</li>\n<li><p>Pritunl Server安装</p>\n<p>1、通过<code>apt</code>在终端中运行以下命令来确保所有系统软件包都是最新的</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt update</span><br><span class=\"line\">sudo apt upgrade</span><br><span class=\"line\">sudo apt install curl gnupg2 wget unzip</span><br></pre></td></tr></table></figure>\n\n<p>2、在Ubuntu 20.04上安装Pritunl VPN Server</p>\n<p>我们将Pritunl存储库密钥和文件添加到Ubuntu系统</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com --recv E162F504A20CDF15827F718D4B7C549A058F8B6B</span><br><span class=\"line\">sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com --recv 7568D9BB55FF9E5287D586017AE645C0CF8E292A</span><br></pre></td></tr></table></figure>\n\n<p>接下来，使用以下命令添加其存储库文件：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &quot;deb http://repo.pritunl.com/stable/apt focal main&quot; | sudo tee /etc/apt/sources.list.d/pritunl.list</span><br></pre></td></tr></table></figure>\n\n<p>添加存储库后，请使用以下命令更新存储库缓存并安装Pritunl服务器：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt update</span><br><span class=\"line\">sudo apt install pritunl</span><br></pre></td></tr></table></figure>\n\n<p>安装完成后，您可以设置启动，停止并启用Pritunl VPN服务器在服务器启动时自动启动：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl stop pritunl</span><br><span class=\"line\">sudo systemctl start pritunl</span><br><span class=\"line\">sudo systemctl enable pritunl</span><br></pre></td></tr></table></figure>\n\n<p>3、安装MongoDB</p>\n<p>默认情况下，Ubuntu 20.04默认存储库中不提供MongoDB，因此您需要将MongoDB存储库添加到系统中：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -fsSL https://www.mongodb.org/static/pgp/server-4.4.asc | sudo apt-key add -</span><br><span class=\"line\">echo &quot;deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/4.4 multiverse&quot; | sudo tee /etc/apt/sources.list.d/mongodb-org-4.4.list</span><br></pre></td></tr></table></figure>\n\n<p><code>apt</code>使用以下命令更新和安装MongoDB：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt update</span><br><span class=\"line\">sudo apt-get install mongodb-server</span><br></pre></td></tr></table></figure>\n\n<p>4、访问Pritunl</p>\n<p>现在，打开您的Web浏览器，并使用URL访问Pritunl Web界面。应该看到以下屏幕：<code>https://your-server-ipaddress</code></p>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/pritunl-web-interface.jpg\" alt=\"pritunl-web-interface\"></p>\n</li>\n</ul>\n<p>​\t\t接下来，使用以下命令生成设置密钥：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo pritunl setup-key</span><br></pre></td></tr></table></figure>\n\n<p>​\t\t输出：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from cryptography import x586</span><br><span class=\"line\">c879d9o59b10012084887b2g4ua5g49u</span><br></pre></td></tr></table></figure>\n\n<p>之后，复制安装密钥并将其粘贴到Pritunl数据库安装向导。粘贴设置键后，单击“保存”按钮。</p>\n<p>接下来，您将需要生成一个默认的用户名和密码来登录。为此，请运行以下命令：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo pritunl default-password</span><br></pre></td></tr></table></figure>\n\n<p>输出：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from cryptography import x586</span><br><span class=\"line\">[undefined][2021-03-09 12:09:16,430][INFO] Getting default administrator password</span><br><span class=\"line\">Administrator default password:</span><br><span class=\"line\">username: &quot;pritunl&quot;</span><br><span class=\"line\">password: &quot;meilana123&quot;</span><br></pre></td></tr></table></figure>\n\n<p>现在，使用默认的用户名和密码登录，并从Pritunl仪表板设置您的环境。</p>\n<ul>\n<li><p>Pritunl Clinet安装（只能在Ubantu桌面上安装，安装后可以在Ubantu系统上看见软件图标）</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo tee /etc/apt/sources.list.d/pritunl.list &lt;&lt; EOF</span><br><span class=\"line\">deb https://repo.pritunl.com/stable/apt focal main</span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\">sudo apt --assume-yes install gnupg</span><br><span class=\"line\">gpg --keyserver hkp://keyserver.ubuntu.com --recv-keys 7568D9BB55FF9E5287D586017AE645C0CF8E292A</span><br><span class=\"line\">gpg --armor --export 7568D9BB55FF9E5287D586017AE645C0CF8E292A | sudo tee /etc/apt/trusted.gpg.d/pritunl.asc</span><br><span class=\"line\">sudo apt update</span><br><span class=\"line\">sudo apt install pritunl-client-electron</span><br></pre></td></tr></table></figure></li>\n</ul>\n","site":{"data":{"link":[{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"动漫图片和壁纸","link":"https://anime-pictures.net/?lang=zh_CN","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"图片网站"},{"name":"Wallhaven","link":"https://wallhaven.cc/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"4k图片网站"},{"name":"WALLPAPER ABYSS","link":"https://wall.alphacoders.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"WALLPAPER ABYSS"},{"name":"极简壁纸","link":"https://bz.zzzmh.cn/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"极简壁纸"},{"name":"Wallroom","link":"https://wallroom.io/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"Wallroom"}]}]}},"excerpt":"","more":"<h1 id=\"Pritunl的安装\"><a href=\"#Pritunl的安装\" class=\"headerlink\" title=\"Pritunl的安装\"></a>Pritunl的安装</h1><ul>\n<li><p>环境准备</p>\n<table>\n<thead>\n<tr>\n<th>序号</th>\n<th>环境准备</th>\n<th>版本</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>Ubantu</td>\n<td>20.04桌面版</td>\n</tr>\n<tr>\n<td>2</td>\n<td>Pritunl Server</td>\n<td>Pritunl Server最新的版本</td>\n</tr>\n<tr>\n<td>3</td>\n<td>Pritunl Client</td>\n<td>Pritunl Client最新的版本</td>\n</tr>\n</tbody></table>\n</li>\n<li><p>Pritunl Server安装</p>\n<p>1、通过<code>apt</code>在终端中运行以下命令来确保所有系统软件包都是最新的</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt update</span><br><span class=\"line\">sudo apt upgrade</span><br><span class=\"line\">sudo apt install curl gnupg2 wget unzip</span><br></pre></td></tr></table></figure>\n\n<p>2、在Ubuntu 20.04上安装Pritunl VPN Server</p>\n<p>我们将Pritunl存储库密钥和文件添加到Ubuntu系统</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com --recv E162F504A20CDF15827F718D4B7C549A058F8B6B</span><br><span class=\"line\">sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com --recv 7568D9BB55FF9E5287D586017AE645C0CF8E292A</span><br></pre></td></tr></table></figure>\n\n<p>接下来，使用以下命令添加其存储库文件：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &quot;deb http://repo.pritunl.com/stable/apt focal main&quot; | sudo tee /etc/apt/sources.list.d/pritunl.list</span><br></pre></td></tr></table></figure>\n\n<p>添加存储库后，请使用以下命令更新存储库缓存并安装Pritunl服务器：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt update</span><br><span class=\"line\">sudo apt install pritunl</span><br></pre></td></tr></table></figure>\n\n<p>安装完成后，您可以设置启动，停止并启用Pritunl VPN服务器在服务器启动时自动启动：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl stop pritunl</span><br><span class=\"line\">sudo systemctl start pritunl</span><br><span class=\"line\">sudo systemctl enable pritunl</span><br></pre></td></tr></table></figure>\n\n<p>3、安装MongoDB</p>\n<p>默认情况下，Ubuntu 20.04默认存储库中不提供MongoDB，因此您需要将MongoDB存储库添加到系统中：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -fsSL https://www.mongodb.org/static/pgp/server-4.4.asc | sudo apt-key add -</span><br><span class=\"line\">echo &quot;deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/4.4 multiverse&quot; | sudo tee /etc/apt/sources.list.d/mongodb-org-4.4.list</span><br></pre></td></tr></table></figure>\n\n<p><code>apt</code>使用以下命令更新和安装MongoDB：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt update</span><br><span class=\"line\">sudo apt-get install mongodb-server</span><br></pre></td></tr></table></figure>\n\n<p>4、访问Pritunl</p>\n<p>现在，打开您的Web浏览器，并使用URL访问Pritunl Web界面。应该看到以下屏幕：<code>https://your-server-ipaddress</code></p>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/pritunl-web-interface.jpg\" alt=\"pritunl-web-interface\"></p>\n</li>\n</ul>\n<p>​\t\t接下来，使用以下命令生成设置密钥：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo pritunl setup-key</span><br></pre></td></tr></table></figure>\n\n<p>​\t\t输出：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from cryptography import x586</span><br><span class=\"line\">c879d9o59b10012084887b2g4ua5g49u</span><br></pre></td></tr></table></figure>\n\n<p>之后，复制安装密钥并将其粘贴到Pritunl数据库安装向导。粘贴设置键后，单击“保存”按钮。</p>\n<p>接下来，您将需要生成一个默认的用户名和密码来登录。为此，请运行以下命令：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo pritunl default-password</span><br></pre></td></tr></table></figure>\n\n<p>输出：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">from cryptography import x586</span><br><span class=\"line\">[undefined][2021-03-09 12:09:16,430][INFO] Getting default administrator password</span><br><span class=\"line\">Administrator default password:</span><br><span class=\"line\">username: &quot;pritunl&quot;</span><br><span class=\"line\">password: &quot;meilana123&quot;</span><br></pre></td></tr></table></figure>\n\n<p>现在，使用默认的用户名和密码登录，并从Pritunl仪表板设置您的环境。</p>\n<ul>\n<li><p>Pritunl Clinet安装（只能在Ubantu桌面上安装，安装后可以在Ubantu系统上看见软件图标）</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo tee /etc/apt/sources.list.d/pritunl.list &lt;&lt; EOF</span><br><span class=\"line\">deb https://repo.pritunl.com/stable/apt focal main</span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\">sudo apt --assume-yes install gnupg</span><br><span class=\"line\">gpg --keyserver hkp://keyserver.ubuntu.com --recv-keys 7568D9BB55FF9E5287D586017AE645C0CF8E292A</span><br><span class=\"line\">gpg --armor --export 7568D9BB55FF9E5287D586017AE645C0CF8E292A | sudo tee /etc/apt/trusted.gpg.d/pritunl.asc</span><br><span class=\"line\">sudo apt update</span><br><span class=\"line\">sudo apt install pritunl-client-electron</span><br></pre></td></tr></table></figure></li>\n</ul>\n"},{"title":"eml文件解析","date":"2022-07-19T01:22:01.000Z","keywords":"eml","description":"eml文件解析","cover":"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg","top_img":"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg","_content":"\n# eml文件解析\n\neml文件要使用邮箱类的工具软件才能打开，可以用微软的outlook打开\n\n```python\n# -*- coding: utf-8 -*-\n\nfrom flanker import mime\nfrom datetime import datetime\n\ndef ParseEml(raw_email, path):\n    with open(raw_email, 'rb') as fhdl:\n        raw_email = fhdl.read()\n        eml = mime.from_string(raw_email)\n        # 主题\n        subjece = eml.subject\n        # 获取发信人地址及昵称\n        eml_header_from = eml.headers.get('From')\n        # 昵称\n        # eml_from = address.parse(eml_header_from)\n        # from_display_name = eml_from.display_name\n        # 发送时间\n        eml_time = eml.headers.get('Date')\n        # if eml_time is not None:\n        #     eml_time = eml_time.replace(',', '')\n        #     dates = datetime.strptime(eml_time, '%a %d %b %Y %H:%M:%S %z')\n        #     eml_time = dates.strftime(\"%Y-%m-%d %H:%M:%S\")\n        # 解析附件列表\n        eml_attachs = ';'.join(x.detected_file_name for x in eml.parts if x.detected_file_name)\n        if eml_attachs is not None and eml_attachs != '':\n            attachs = eml_attachs.split(';')\n            eml_attachs = '<p>附件</p>'\n            for ats in attachs:\n                eml_attachs += '<dl><dt><img src=\"../caseView/img/file_mail.png\"></dt>' \\\n                               ' <dd title=\"OPPO_BR_20200707.log\">' + ats + '</dd></dl>'\n        # 内容\n        eml_body = contentEml(eml)\n\n        # 收件人信息\n        eml_to = eml.headers.get('To')\n        if eml_to is not None:\n            eml_to = eml_to.replace('<', '&lt;').replace('>', '&gt;')\n\n        #  eml_to_addr = address.parse_list(eml_to)\n        # 多个地址以;拼接显示\n        # if not type(eml_to_addr) == str:\n        #     to_display_name = ';'.join(x.display_name for x in eml_to_addr if x.display_name)\n        #     to_address = ';'.join(x.address for x in eml_to_addr if x.address)\n   \n\n# 邮件正文\ndef contentEml(eml):\n    # 判断是否为单部分\n\n    if eml.content_type.is_singlepart():\n        eml_body = eml.body\n    else:\n        eml_body = ''\n        for part in eml.parts:\n            # 判断是否是多部分\n            if part.content_type.is_multipart():\n                eml_body, charset = contentEml(part)\n            else:\n                if part.content_type.main == 'text':\n                    eml_body = part.body\n\n    return eml_body\n\nif __name__ == \"__main__\":\n    ParseEml('aa.eml')\n```\n\n在eml解析这个环节中，我这边是借用了flanker这个第三方模块，这个模块提供了mine协议（eml基本上都是mine协议）的解析，在flanker中提供了将传进来的流文件转化为MIMEPart对象（这是flanker这个模块提供的），这个对象中包括了eml文件的信息（发送人、接收人、抄送人、发送时间、抄送时间、附件等基本信息），在对拿到的MIMEPart对象进行下一步处理，就得到了我们想要的信息。","source":"_posts/eml文件解析.md","raw":"---\ntitle: eml文件解析\ndate: 2022-07-19 09:22:01\ntags: mysql\ncategories: 学习\nkeywords: eml\ndescription: eml文件解析\ncover: https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg\ntop_img: https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg\n---\n\n# eml文件解析\n\neml文件要使用邮箱类的工具软件才能打开，可以用微软的outlook打开\n\n```python\n# -*- coding: utf-8 -*-\n\nfrom flanker import mime\nfrom datetime import datetime\n\ndef ParseEml(raw_email, path):\n    with open(raw_email, 'rb') as fhdl:\n        raw_email = fhdl.read()\n        eml = mime.from_string(raw_email)\n        # 主题\n        subjece = eml.subject\n        # 获取发信人地址及昵称\n        eml_header_from = eml.headers.get('From')\n        # 昵称\n        # eml_from = address.parse(eml_header_from)\n        # from_display_name = eml_from.display_name\n        # 发送时间\n        eml_time = eml.headers.get('Date')\n        # if eml_time is not None:\n        #     eml_time = eml_time.replace(',', '')\n        #     dates = datetime.strptime(eml_time, '%a %d %b %Y %H:%M:%S %z')\n        #     eml_time = dates.strftime(\"%Y-%m-%d %H:%M:%S\")\n        # 解析附件列表\n        eml_attachs = ';'.join(x.detected_file_name for x in eml.parts if x.detected_file_name)\n        if eml_attachs is not None and eml_attachs != '':\n            attachs = eml_attachs.split(';')\n            eml_attachs = '<p>附件</p>'\n            for ats in attachs:\n                eml_attachs += '<dl><dt><img src=\"../caseView/img/file_mail.png\"></dt>' \\\n                               ' <dd title=\"OPPO_BR_20200707.log\">' + ats + '</dd></dl>'\n        # 内容\n        eml_body = contentEml(eml)\n\n        # 收件人信息\n        eml_to = eml.headers.get('To')\n        if eml_to is not None:\n            eml_to = eml_to.replace('<', '&lt;').replace('>', '&gt;')\n\n        #  eml_to_addr = address.parse_list(eml_to)\n        # 多个地址以;拼接显示\n        # if not type(eml_to_addr) == str:\n        #     to_display_name = ';'.join(x.display_name for x in eml_to_addr if x.display_name)\n        #     to_address = ';'.join(x.address for x in eml_to_addr if x.address)\n   \n\n# 邮件正文\ndef contentEml(eml):\n    # 判断是否为单部分\n\n    if eml.content_type.is_singlepart():\n        eml_body = eml.body\n    else:\n        eml_body = ''\n        for part in eml.parts:\n            # 判断是否是多部分\n            if part.content_type.is_multipart():\n                eml_body, charset = contentEml(part)\n            else:\n                if part.content_type.main == 'text':\n                    eml_body = part.body\n\n    return eml_body\n\nif __name__ == \"__main__\":\n    ParseEml('aa.eml')\n```\n\n在eml解析这个环节中，我这边是借用了flanker这个第三方模块，这个模块提供了mine协议（eml基本上都是mine协议）的解析，在flanker中提供了将传进来的流文件转化为MIMEPart对象（这是flanker这个模块提供的），这个对象中包括了eml文件的信息（发送人、接收人、抄送人、发送时间、抄送时间、附件等基本信息），在对拿到的MIMEPart对象进行下一步处理，就得到了我们想要的信息。","slug":"eml文件解析","published":1,"updated":"2022-10-16T06:19:11.319Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clg1mfus3000a27qgh7m23k8q","content":"<h1 id=\"eml文件解析\"><a href=\"#eml文件解析\" class=\"headerlink\" title=\"eml文件解析\"></a>eml文件解析</h1><p>eml文件要使用邮箱类的工具软件才能打开，可以用微软的outlook打开</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> flanker <span class=\"keyword\">import</span> mime</span><br><span class=\"line\"><span class=\"keyword\">from</span> datetime <span class=\"keyword\">import</span> datetime</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">ParseEml</span>(<span class=\"params\">raw_email, path</span>):</span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(raw_email, <span class=\"string\">&#x27;rb&#x27;</span>) <span class=\"keyword\">as</span> fhdl:</span><br><span class=\"line\">        raw_email = fhdl.read()</span><br><span class=\"line\">        eml = mime.from_string(raw_email)</span><br><span class=\"line\">        <span class=\"comment\"># 主题</span></span><br><span class=\"line\">        subjece = eml.subject</span><br><span class=\"line\">        <span class=\"comment\"># 获取发信人地址及昵称</span></span><br><span class=\"line\">        eml_header_from = eml.headers.get(<span class=\"string\">&#x27;From&#x27;</span>)</span><br><span class=\"line\">        <span class=\"comment\"># 昵称</span></span><br><span class=\"line\">        <span class=\"comment\"># eml_from = address.parse(eml_header_from)</span></span><br><span class=\"line\">        <span class=\"comment\"># from_display_name = eml_from.display_name</span></span><br><span class=\"line\">        <span class=\"comment\"># 发送时间</span></span><br><span class=\"line\">        eml_time = eml.headers.get(<span class=\"string\">&#x27;Date&#x27;</span>)</span><br><span class=\"line\">        <span class=\"comment\"># if eml_time is not None:</span></span><br><span class=\"line\">        <span class=\"comment\">#     eml_time = eml_time.replace(&#x27;,&#x27;, &#x27;&#x27;)</span></span><br><span class=\"line\">        <span class=\"comment\">#     dates = datetime.strptime(eml_time, &#x27;%a %d %b %Y %H:%M:%S %z&#x27;)</span></span><br><span class=\"line\">        <span class=\"comment\">#     eml_time = dates.strftime(&quot;%Y-%m-%d %H:%M:%S&quot;)</span></span><br><span class=\"line\">        <span class=\"comment\"># 解析附件列表</span></span><br><span class=\"line\">        eml_attachs = <span class=\"string\">&#x27;;&#x27;</span>.join(x.detected_file_name <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> eml.parts <span class=\"keyword\">if</span> x.detected_file_name)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> eml_attachs <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"literal\">None</span> <span class=\"keyword\">and</span> eml_attachs != <span class=\"string\">&#x27;&#x27;</span>:</span><br><span class=\"line\">            attachs = eml_attachs.split(<span class=\"string\">&#x27;;&#x27;</span>)</span><br><span class=\"line\">            eml_attachs = <span class=\"string\">&#x27;&lt;p&gt;附件&lt;/p&gt;&#x27;</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> ats <span class=\"keyword\">in</span> attachs:</span><br><span class=\"line\">                eml_attachs += <span class=\"string\">&#x27;&lt;dl&gt;&lt;dt&gt;&lt;img src=&quot;../caseView/img/file_mail.png&quot;&gt;&lt;/dt&gt;&#x27;</span> \\</span><br><span class=\"line\">                               <span class=\"string\">&#x27; &lt;dd title=&quot;OPPO_BR_20200707.log&quot;&gt;&#x27;</span> + ats + <span class=\"string\">&#x27;&lt;/dd&gt;&lt;/dl&gt;&#x27;</span></span><br><span class=\"line\">        <span class=\"comment\"># 内容</span></span><br><span class=\"line\">        eml_body = contentEml(eml)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 收件人信息</span></span><br><span class=\"line\">        eml_to = eml.headers.get(<span class=\"string\">&#x27;To&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> eml_to <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">            eml_to = eml_to.replace(<span class=\"string\">&#x27;&lt;&#x27;</span>, <span class=\"string\">&#x27;&amp;lt;&#x27;</span>).replace(<span class=\"string\">&#x27;&gt;&#x27;</span>, <span class=\"string\">&#x27;&amp;gt;&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">#  eml_to_addr = address.parse_list(eml_to)</span></span><br><span class=\"line\">        <span class=\"comment\"># 多个地址以;拼接显示</span></span><br><span class=\"line\">        <span class=\"comment\"># if not type(eml_to_addr) == str:</span></span><br><span class=\"line\">        <span class=\"comment\">#     to_display_name = &#x27;;&#x27;.join(x.display_name for x in eml_to_addr if x.display_name)</span></span><br><span class=\"line\">        <span class=\"comment\">#     to_address = &#x27;;&#x27;.join(x.address for x in eml_to_addr if x.address)</span></span><br><span class=\"line\">   </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 邮件正文</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">contentEml</span>(<span class=\"params\">eml</span>):</span><br><span class=\"line\">    <span class=\"comment\"># 判断是否为单部分</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> eml.content_type.is_singlepart():</span><br><span class=\"line\">        eml_body = eml.body</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        eml_body = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> part <span class=\"keyword\">in</span> eml.parts:</span><br><span class=\"line\">            <span class=\"comment\"># 判断是否是多部分</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> part.content_type.is_multipart():</span><br><span class=\"line\">                eml_body, charset = contentEml(part)</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> part.content_type.main == <span class=\"string\">&#x27;text&#x27;</span>:</span><br><span class=\"line\">                    eml_body = part.body</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> eml_body</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    ParseEml(<span class=\"string\">&#x27;aa.eml&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>在eml解析这个环节中，我这边是借用了flanker这个第三方模块，这个模块提供了mine协议（eml基本上都是mine协议）的解析，在flanker中提供了将传进来的流文件转化为MIMEPart对象（这是flanker这个模块提供的），这个对象中包括了eml文件的信息（发送人、接收人、抄送人、发送时间、抄送时间、附件等基本信息），在对拿到的MIMEPart对象进行下一步处理，就得到了我们想要的信息。</p>\n","site":{"data":{"link":[{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"动漫图片和壁纸","link":"https://anime-pictures.net/?lang=zh_CN","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"图片网站"},{"name":"Wallhaven","link":"https://wallhaven.cc/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"4k图片网站"},{"name":"WALLPAPER ABYSS","link":"https://wall.alphacoders.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"WALLPAPER ABYSS"},{"name":"极简壁纸","link":"https://bz.zzzmh.cn/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"极简壁纸"},{"name":"Wallroom","link":"https://wallroom.io/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"Wallroom"}]}]}},"excerpt":"","more":"<h1 id=\"eml文件解析\"><a href=\"#eml文件解析\" class=\"headerlink\" title=\"eml文件解析\"></a>eml文件解析</h1><p>eml文件要使用邮箱类的工具软件才能打开，可以用微软的outlook打开</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> flanker <span class=\"keyword\">import</span> mime</span><br><span class=\"line\"><span class=\"keyword\">from</span> datetime <span class=\"keyword\">import</span> datetime</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">ParseEml</span>(<span class=\"params\">raw_email, path</span>):</span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(raw_email, <span class=\"string\">&#x27;rb&#x27;</span>) <span class=\"keyword\">as</span> fhdl:</span><br><span class=\"line\">        raw_email = fhdl.read()</span><br><span class=\"line\">        eml = mime.from_string(raw_email)</span><br><span class=\"line\">        <span class=\"comment\"># 主题</span></span><br><span class=\"line\">        subjece = eml.subject</span><br><span class=\"line\">        <span class=\"comment\"># 获取发信人地址及昵称</span></span><br><span class=\"line\">        eml_header_from = eml.headers.get(<span class=\"string\">&#x27;From&#x27;</span>)</span><br><span class=\"line\">        <span class=\"comment\"># 昵称</span></span><br><span class=\"line\">        <span class=\"comment\"># eml_from = address.parse(eml_header_from)</span></span><br><span class=\"line\">        <span class=\"comment\"># from_display_name = eml_from.display_name</span></span><br><span class=\"line\">        <span class=\"comment\"># 发送时间</span></span><br><span class=\"line\">        eml_time = eml.headers.get(<span class=\"string\">&#x27;Date&#x27;</span>)</span><br><span class=\"line\">        <span class=\"comment\"># if eml_time is not None:</span></span><br><span class=\"line\">        <span class=\"comment\">#     eml_time = eml_time.replace(&#x27;,&#x27;, &#x27;&#x27;)</span></span><br><span class=\"line\">        <span class=\"comment\">#     dates = datetime.strptime(eml_time, &#x27;%a %d %b %Y %H:%M:%S %z&#x27;)</span></span><br><span class=\"line\">        <span class=\"comment\">#     eml_time = dates.strftime(&quot;%Y-%m-%d %H:%M:%S&quot;)</span></span><br><span class=\"line\">        <span class=\"comment\"># 解析附件列表</span></span><br><span class=\"line\">        eml_attachs = <span class=\"string\">&#x27;;&#x27;</span>.join(x.detected_file_name <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> eml.parts <span class=\"keyword\">if</span> x.detected_file_name)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> eml_attachs <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"literal\">None</span> <span class=\"keyword\">and</span> eml_attachs != <span class=\"string\">&#x27;&#x27;</span>:</span><br><span class=\"line\">            attachs = eml_attachs.split(<span class=\"string\">&#x27;;&#x27;</span>)</span><br><span class=\"line\">            eml_attachs = <span class=\"string\">&#x27;&lt;p&gt;附件&lt;/p&gt;&#x27;</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> ats <span class=\"keyword\">in</span> attachs:</span><br><span class=\"line\">                eml_attachs += <span class=\"string\">&#x27;&lt;dl&gt;&lt;dt&gt;&lt;img src=&quot;../caseView/img/file_mail.png&quot;&gt;&lt;/dt&gt;&#x27;</span> \\</span><br><span class=\"line\">                               <span class=\"string\">&#x27; &lt;dd title=&quot;OPPO_BR_20200707.log&quot;&gt;&#x27;</span> + ats + <span class=\"string\">&#x27;&lt;/dd&gt;&lt;/dl&gt;&#x27;</span></span><br><span class=\"line\">        <span class=\"comment\"># 内容</span></span><br><span class=\"line\">        eml_body = contentEml(eml)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># 收件人信息</span></span><br><span class=\"line\">        eml_to = eml.headers.get(<span class=\"string\">&#x27;To&#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> eml_to <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">            eml_to = eml_to.replace(<span class=\"string\">&#x27;&lt;&#x27;</span>, <span class=\"string\">&#x27;&amp;lt;&#x27;</span>).replace(<span class=\"string\">&#x27;&gt;&#x27;</span>, <span class=\"string\">&#x27;&amp;gt;&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">#  eml_to_addr = address.parse_list(eml_to)</span></span><br><span class=\"line\">        <span class=\"comment\"># 多个地址以;拼接显示</span></span><br><span class=\"line\">        <span class=\"comment\"># if not type(eml_to_addr) == str:</span></span><br><span class=\"line\">        <span class=\"comment\">#     to_display_name = &#x27;;&#x27;.join(x.display_name for x in eml_to_addr if x.display_name)</span></span><br><span class=\"line\">        <span class=\"comment\">#     to_address = &#x27;;&#x27;.join(x.address for x in eml_to_addr if x.address)</span></span><br><span class=\"line\">   </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 邮件正文</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">contentEml</span>(<span class=\"params\">eml</span>):</span><br><span class=\"line\">    <span class=\"comment\"># 判断是否为单部分</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> eml.content_type.is_singlepart():</span><br><span class=\"line\">        eml_body = eml.body</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        eml_body = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> part <span class=\"keyword\">in</span> eml.parts:</span><br><span class=\"line\">            <span class=\"comment\"># 判断是否是多部分</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> part.content_type.is_multipart():</span><br><span class=\"line\">                eml_body, charset = contentEml(part)</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> part.content_type.main == <span class=\"string\">&#x27;text&#x27;</span>:</span><br><span class=\"line\">                    eml_body = part.body</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> eml_body</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&quot;__main__&quot;</span>:</span><br><span class=\"line\">    ParseEml(<span class=\"string\">&#x27;aa.eml&#x27;</span>)</span><br></pre></td></tr></table></figure>\n\n<p>在eml解析这个环节中，我这边是借用了flanker这个第三方模块，这个模块提供了mine协议（eml基本上都是mine协议）的解析，在flanker中提供了将传进来的流文件转化为MIMEPart对象（这是flanker这个模块提供的），这个对象中包括了eml文件的信息（发送人、接收人、抄送人、发送时间、抄送时间、附件等基本信息），在对拿到的MIMEPart对象进行下一步处理，就得到了我们想要的信息。</p>\n"},{"title":"docker学习","date":"2021-10-17T07:31:01.000Z","keywords":"docker","description":"docker的学习笔记","cover":"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg","top_img":"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg","_content":"\n# Docker学习笔记\n\n## 1.Docker简介\n\nDocker是一种运行于Linux和Windows上的软件，用于穿件、管理和编排容器。\n\nDocker在Github上开发的Moby开源项目的一部分。\n\n![image.png](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/1635746950373-4639ad99-25d4-446f-8ba2-64d1b4caa425.png)\n\ndockerClient客户端\n\nDocker Daemon守护进程\n\nDocker Image镜像\n\nDockerContainer容器\n\n![image.png](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/1635747181750-953109a2-9823-4591-b8c7-a713fb3e1eeb.png)\n\n## 2.Docker的优势\n\n-   轻量，秒级的快速启动速度\n\n-   简单，易用，活跃的社区&nbsp;\n\n-   标准统一的打包/部署/运行方案\n\n-   镜像支持增量分发，易于部署&nbsp;\n\n-   易于构建，良好的REST API，也很适合自动化测试和持续集成\n\n-   性能，尤其是内存和IO的开销\n\n## 3.三要素\n\n-   镜像（image）\n\n镜像/容器\n\n镜像就是模板，容器就是镜像的一个实例，例如：\n\n```java\nPerson p1 = new Person()  \nPerson p2 = new Person()  \nPerson p3 = new Person()  \n//Person都来自同一个对象，p1、p2、p3就是3个不同的实例  \n//就是一个容器，即镜像就是一个类，容器就是一个一个对象\n```\n\n\n\n-   容器（container）\n\nDocker利用容器独立运行的一个或一组应用。容器是用镜像创建的运行实例，可以把容器看成是一个简易版的Linux环境\n\n-   仓库（respository）\n\n仓库（Respository）是集中存放镜像文件的场所，仓库和仓库注册服务器（Registry）是有区别的。仓库注册服务器上往往存放着多个仓库，每个仓库中又包含了多个 镜像，每个镜像有不同的标签（tag）。\n\n仓库分为公开仓库（public）和私有仓库（Private）两种形式。最大的公开仓库是Docker Hub（https://hub.docker.com/）\n\n## 4.Docker安装\n\n-   查看自己的服务器上的系统版本\n\nuname -r\n\ncat /etc/redhat-release\n\n-   根据服务器的系统不同，版本不同，安装过程会有所区别\n\n[**](https://docs.docker.com/engine/install/centos/#install-using-the-repository)https://docs.docker.com/engine/install/centos/\\#install-using-the-repository\n\n这是官方文档的安装步骤。\n\n```sh\n# 卸载旧版本  \nsudo yum remove docker \\\ndocker-client \\  \ndocker-client-latest \\  \ndocker-common \\  \ndocker-latest \\  \ndocker-latest-logrotate \\  \ndocker-logrotate \\  \ndocker-engine  \n#设置存储库  \n#安装yum-utils包（提供yum-config-manager 实用程序）  \n#并设置稳定存储库  \nsudo yum install -y yum-utils  \nsudo yum-config-manager \\  \n--add-repo \\  \nhttps://download.docker.com/linux/centos/docker-ce.repo  \n#可选：启用夜间或测试存储库  \n#开启  \nsudo yum-config-manager --enable docker-ce-nightly  \n#要启用测试通道，请运行以下命令：  \nsudo yum-config-manager --enable docker-ce-test  \n#关闭  \nsudo yum-config-manager --disable docker-ce-nightly  \n#安装docker引擎  \nsudo yum install docker-ce docker-ce-cli containerd.io\n```\n\n-   可以配置阿里云的镜像仓库。具体的可以参考[*https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors*](https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors)\n\n## 5.Docker命令\n\n-   帮助命令\n\n    -   docker version\n\n    -   docker info&nbsp;\n\n    -   docker --help&nbsp;\n\n-   镜像命令\n\n    -   docker images 查看本地的镜像\n\n        -   docker images -a 列出本地所有的镜像\n\n        -   docker images -q 只显示镜像的摘要信息&nbsp;\n\n        -   docker images --digests 显示镜像的摘要信息\n\n        -   docker images --no-trunc 显示完整的镜像信息&nbsp;\n\n    -   docker search xxx 搜索相应的镜像(xxx为镜像名字)\n\n        -   docker search xxx -f stars=30 搜索星星数大于30的镜像\n\n        -   docker search xxx -f stars=30 --no-trunc 显示详细信息&nbsp;\n\n    -   docker pull xxx 下载镜像\n\n    -   docker rmi xxx 删除镜像\n\n        -   docker rmi -f xxx 强制删除\n\n        -   docker rmi -f xxx\\[:tag\\] xxx\\[:tag\\] 多个删除&nbsp;\n\n        -   docker rmi -f \\$(docker images -q) 全部删除&nbsp;\n\n-   容器命令（有镜像才能创建容器）\n\n    -   docker pull centos 下载centos镜像\n\n    -   docker run \\[options\\] xxx 新建并运行xxx镜像\n\n        -   options: --name（容器新名字，为容器指定一个名称）\n\n        -   options: -d（后台运行容器，并返回容器ID，也即启动守护式容器）&nbsp;\n\n        -   options: -i（以交互模式运行容器，通常与-t同时使用）\n\n        -   options: -t（为容器重新分配一个伪输入终端，通常与-i同时使用）&nbsp;\n\n        -   options: -P（随机映射端口）\n\n        -   options: -p（指定端口映射，有以下四种格式）\n\n            -   ip:hostPort:containerPort\n\n            -   ip::containerPort&nbsp;\n\n            -   hostPort:containerPort\n\n            -   containerPort&nbsp;\n\n    -   docker ps \\[options\\] 查看正在运行的镜像\n\n        -   options: -a（列出当前所有正在运行的容器+历史上运行过的）\n\n        -   options: -l（显示最近创建的容器）&nbsp;\n\n        -   options: -n（显示最近n个创建的容器）\n\n        -   options: -q（静默模式，只显示容器编号）&nbsp;\n\n        -   options: --no-trunc（不截断输出）&nbsp;\n\n    -   exit 退出并关闭容器\n\n    -   ctrl+p+q 退出但不关闭容器(windows)&nbsp;\n\n    -   docker start 容器id 启动容器\n\n    -   docker restart 容器id 重启容器&nbsp;\n\n    -   docker stop 容器id 停止容器\n\n    -   docker kill 容器id 强制停止&nbsp;\n\n    -   docker rm 容器id 删除容器\n\n        -   docker rm -f 容器id 强制删除\n\n        -   docker rm -f \\$(docker ps -a -q) 多个删除&nbsp;\n\n        -   docker ps -a -q \\| xargs docker rm 多个删除&nbsp;\n\n    -   docker run -d centos 以后台进程的模式启动容器，这样做，导致容器前台没有运行应用，这样启动后，会立即自杀，因为容器觉得没有事情可做。解决方式：将要运行的程序以前台进程的形式运行。\n\n    -   docker logs -f -t --tail 容器id 查看容器日志\n\n        -   -t 是加入时间戳\n\n        -   -f 跟随最新的日志大新&nbsp;\n\n        -   --tail 数字，显示最后多少条&nbsp;\n\n    -   docker top 容器id 查看容器内运行的进程\n\n    -   docker inspect 容器id 查看容器内部细节（json字符串的形式）&nbsp;\n\n    -   docker exec -it 容器id bashShell\n\n        -   docker exec -it 容器id /bin/bash 直接进入目录（默认为/bin/bash）&nbsp;\n\n    -   dcoker attach 容器id 重新进入容器\n\n    -   docker cp 容器id: /tmp/yum.log /root 拷贝文件到root目录下\n\n## 6.Docker镜像\n\n-   docker 的镜像实际上是由一层一层的文件系统组成，这种层级的文件系统UnionFS。\n\n-   ![image.png](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/1636004250376-b17d34f7-0313-4c04-b98e-3abee09a4772.png)\n\n-   docker Commit的操作\n\n## Docker容器数据卷\n\n-   将运用与运行的环境打包形成容器运行，运行可以伴随着容器，但是我们可以对数据的要求希望是持久化的\n\n-   容器之间是希望有可能共享数据&nbsp;\n\n-   Docker容器产生的数据，如果不通过docker commit生成新的镜像，使得数据做为镜像的一部分保存下来，那么当容器删除后，数据自然也就没有了。\n\n-   为了能保存数据在docker中我们使用卷&nbsp;\n\n-   命令添加容器卷\n\n    -   docker run -it -v /宿主机绝对路径目录:/容器内目录 镜像名\n\n    -   docker run -it -v /宿主机绝对路径目录:/容器内目录 ro 镜像名\n\n## DockerFile解析\n\n-   DockerFile是用来构建Docker镜像的构建文件，有由一系列命令和参数构成的脚本\n\n-   构建三步骤：\n\n    -   编写Dockerfile文件\n\n    -   dockerfile build&nbsp;\n\n    -   docker run&nbsp;\n\n-   Dcokerfile内容基础知识\n\n    -   1.每条保留字指令都必须为大写字母且后面要跟随至少一个参数\n\n    -   2.指令按照从上到下，顺序执行&nbsp;\n\n    -   3.\\#表示注释\n\n    -   4.每条指令都会创建一个新的镜像层。并对镜像进行提交&nbsp;\n\n-   Docker执行Dockerfile的大致流程\n\n    -   （1）docker从基础镜像运行一个容器\n\n    -   （2）执行一条指令并对容器作出更改&nbsp;\n\n    -   （3）执行类似docker commit的操作提交一个新的镜像层\n\n    -   （4）docker再基于刚提交的镜像运行一个新容器&nbsp;\n\n    -   （5）执行dockerfile中的下一条指令直到所有指令都执行完成&nbsp;\n\n-   Dockerfile体系结构（保留字指令）\n\n    -   FROM\\|基础镜像，当前镜像是基于哪个镜像的&nbsp;\n\n    -   MAINTAINER \\|镜像维护者的姓名和邮箱地址\n\n    -   RUN 容器构建时需要运行的命令&nbsp;\n\n    -   EXPOSE 当前容器对外暴露出的端口\n\n    -   WORKDIR 指定在创建容器之后，终端默认登陆的进来工作目录，一个落脚点&nbsp;\n\n    -   ENV 用来在构建镜像过程中设置环境变量\n\n    -   ADD 将宿主机目录下的文件拷贝进镜像且ADD命令会自动处理URL和解压tar压缩包&nbsp;\n\n    -   COPY 类似ADD，拷贝文件和目录到镜像中。\n\n    -   VOLUME 容器数据卷，用于数据保存和持久化工作&nbsp;\n\n    -   CMD 指定容器启动时要运行的命令，最后一个命令会顶替之前的\n\n    -   ENTRYPOINT 指定容器启动时要运行的命令，在之前的命令执行后追加&nbsp;\n\n    -   ONBUILD 当构建一个被继承的DockerFile时运行命令，父镜像子在被子继承后父镜像的onbuild被触发&nbsp;\n\n-   案例\n\n```dockerfile\nFROM cetos  \nMAINTAINER csh&lt;330289953@qq&gt;com&gt;  \n\nENV MYPATH /usr/local  \nWORKDIR \\$MYPATH  \n\nRUN yum -y install vim  \nRUN yum -y install net-tools  \n\nEXPOSE 80  \n\nCMD echo \\$MYPATH  \nCMD echo \"success------------ok\"  \nCMD /bin/bash\n```\n\n\n\n## MySql安装\n\ndocker pull mysql:5.7下载5.7版本的mysql\n\n运行：\n\ndocker run -p 3306:3306 --name mysql57 -v /opt/mysql/conf:/etc/mysql/conf.d -v /opt/mysql/logs:/logs -v /opt/mysql/data:/var/lib/mysql -e MYSQL\\_ROOT\\_PASSWORD=123456 -d mysql:5.7\n\n## Redis安装\n\ndocker pull redis 将redis从docker上拉下来\n\n运行：\n\ndocker run -p 6379:6379 -v /opt/myredis/data:/data -v /opt/myredis/conf/redis.conf:/usr/local/etc/redis/redis.conf -d redis redis-server /usr/local/etc/redis/redis.conf --appendonly yes\n\n## 案例（DockerFile）\n\n```\nFROM centos  \nMAINTAINER csh&lt;a330289953@gmail.com&gt;  \n# 把宿主机当前上下文的c.text拷贝到容器/usr/local路径下  \nCOPY c.txt /usr/local/cincontainer.txt  \n# 把java与tomcat添加到容器中  \nADD jdk-8u171-linux-x64.tar.gz /usr/local  \nADD apache-tomcat-9.0.8.tar.gz /usr.local  \n# 安装vim编辑器  \nRUN yum -y install vim  \n# 设置工作访问时候的WORKDIR路径，登录落脚点  \nENV MYPATH /usr/local  \nWORKDIR $MYPATH  \n# 配置java与tomcat环境变量  \nENV JAVA_HOME /usr/local/jdk1.8.0_171  \nENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar  \nENV CATALINA_HOME /usr/local/apache-tomcat-9.0.8  \nENV CATALINA_BASE /usr/local/apache-tomcat-9.0.8  \nENV PATH $PAHT:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin  \n# 容器运行时监听的端口  \nEXPOSE 8080  \n# 启动时运行tomcat  \n# ENTRYPOIN [\"usr/local/apache-tomcat-9.0.8/bin/startup.sh\"]  \n# CMD [\"/usr/local/apache-tomcat-9.0.8/bin/catalina.hs\",\"run\"]  \nCMD /usr/lcoal/apache-tomcat-9.0.8/bin/startup.sh && tail -F /usr/local/apache-tomcat-9.0.8/bin/logs/catailna.out\n```\n\n```sh\ndocker run \\\\\n\n-d \\\n\n-p 6379:6379 \\\\\n\n--restart unless-stopped \\\\\n\n-v /home/memect/project/tools/mydata/redis/data:/data \\\\\n\n-v /home/memect/project/tools/mydata/redis/conf/redis.conf:/etc/redis/redis.conf \\\\\n\nredis-server /etc/redis/redis.conf \\\\\n\nredis\n\n```\n\n```sh\ndocker run -p 3306:3306 --name mysql8 -v /home/chenshuhang/tools/mysql/conf/my.cnf:/etc/mysql/my.cnf -v /home/chenshuhang/tools/mysql/conf:/etc/mysql/conf.d -v /home/chenshuhang/tools/mysql/logs:/logs -v /home/chenshuhang/tools/mysql/data:/var/lib/mysql -e MYSQL\\_ROOT\\_PASSWORD=123456 -d mysql:8.0\n\ndocker run --name mysql -p 3306:3306 -e MYSQL\\_ROOT\\_PASSWORD=123456 -d mysql:8.0\n\nALTER USER 'root'@'localhost' IDENTIFIED BY '123456';\n\ndocker run -p 8848:8848 -v /home/memect/project/login\\_util:/code login\\_util\n\nsudo docker run -p 6379:6379 --name redis -v /home/memect/project/tools/myredis/conf/redis.conf:/etc/redis/redis.conf -v /home/memect/project/tools/myredis/data:/data -d redis redis-server /etc/redis/redis.conf --appendonly yes\n```\n\n设置密码\n\nconfig set requirepass 123456\n\n```\ndocker run -d \\\\\n\n--name=kibana \\\\\n\n--restart=always \\\\\n\n-p 5601:5601 \\\\\n\n-v /opt/tools/kibana/config/kibana.yml:/usr/share/kibana/config/kibana.yml \\\\\n\nkibana:7.16.2\n```\n\n```\ndocker run -p 6379:6379 --name redis -v /home/memect/tools/redis/redis.conf:/etc/redis/redis.conf -v /home/memect/tools/redis/data:/data -d redis redis-server /etc/redis/redis.conf --appendonly yes\n```\n\n```\ndocker run -p 3308:3306 --name mysql57 -v /Users/mac/canal/mysql/conf/my.cnf:/etc/mysql/my.cnf -v /Users/mac/canal/mysql/logs:/logs -v /Users/mac/canal/mysql/data:/var/lib/mysql -e MYSQL\\_ROOT\\_PASSWORD=123456 -d mysql:5.7\n```\n\n","source":"_posts/Docker学习笔记.md","raw":"---\ntitle: docker学习\ndate: 2021-10-17 15:31:01\ntags: docker\ncategories: 学习\nkeywords: docker\ndescription: docker的学习笔记\ncover: https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg\ntop_img: https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg\n---\n\n# Docker学习笔记\n\n## 1.Docker简介\n\nDocker是一种运行于Linux和Windows上的软件，用于穿件、管理和编排容器。\n\nDocker在Github上开发的Moby开源项目的一部分。\n\n![image.png](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/1635746950373-4639ad99-25d4-446f-8ba2-64d1b4caa425.png)\n\ndockerClient客户端\n\nDocker Daemon守护进程\n\nDocker Image镜像\n\nDockerContainer容器\n\n![image.png](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/1635747181750-953109a2-9823-4591-b8c7-a713fb3e1eeb.png)\n\n## 2.Docker的优势\n\n-   轻量，秒级的快速启动速度\n\n-   简单，易用，活跃的社区&nbsp;\n\n-   标准统一的打包/部署/运行方案\n\n-   镜像支持增量分发，易于部署&nbsp;\n\n-   易于构建，良好的REST API，也很适合自动化测试和持续集成\n\n-   性能，尤其是内存和IO的开销\n\n## 3.三要素\n\n-   镜像（image）\n\n镜像/容器\n\n镜像就是模板，容器就是镜像的一个实例，例如：\n\n```java\nPerson p1 = new Person()  \nPerson p2 = new Person()  \nPerson p3 = new Person()  \n//Person都来自同一个对象，p1、p2、p3就是3个不同的实例  \n//就是一个容器，即镜像就是一个类，容器就是一个一个对象\n```\n\n\n\n-   容器（container）\n\nDocker利用容器独立运行的一个或一组应用。容器是用镜像创建的运行实例，可以把容器看成是一个简易版的Linux环境\n\n-   仓库（respository）\n\n仓库（Respository）是集中存放镜像文件的场所，仓库和仓库注册服务器（Registry）是有区别的。仓库注册服务器上往往存放着多个仓库，每个仓库中又包含了多个 镜像，每个镜像有不同的标签（tag）。\n\n仓库分为公开仓库（public）和私有仓库（Private）两种形式。最大的公开仓库是Docker Hub（https://hub.docker.com/）\n\n## 4.Docker安装\n\n-   查看自己的服务器上的系统版本\n\nuname -r\n\ncat /etc/redhat-release\n\n-   根据服务器的系统不同，版本不同，安装过程会有所区别\n\n[**](https://docs.docker.com/engine/install/centos/#install-using-the-repository)https://docs.docker.com/engine/install/centos/\\#install-using-the-repository\n\n这是官方文档的安装步骤。\n\n```sh\n# 卸载旧版本  \nsudo yum remove docker \\\ndocker-client \\  \ndocker-client-latest \\  \ndocker-common \\  \ndocker-latest \\  \ndocker-latest-logrotate \\  \ndocker-logrotate \\  \ndocker-engine  \n#设置存储库  \n#安装yum-utils包（提供yum-config-manager 实用程序）  \n#并设置稳定存储库  \nsudo yum install -y yum-utils  \nsudo yum-config-manager \\  \n--add-repo \\  \nhttps://download.docker.com/linux/centos/docker-ce.repo  \n#可选：启用夜间或测试存储库  \n#开启  \nsudo yum-config-manager --enable docker-ce-nightly  \n#要启用测试通道，请运行以下命令：  \nsudo yum-config-manager --enable docker-ce-test  \n#关闭  \nsudo yum-config-manager --disable docker-ce-nightly  \n#安装docker引擎  \nsudo yum install docker-ce docker-ce-cli containerd.io\n```\n\n-   可以配置阿里云的镜像仓库。具体的可以参考[*https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors*](https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors)\n\n## 5.Docker命令\n\n-   帮助命令\n\n    -   docker version\n\n    -   docker info&nbsp;\n\n    -   docker --help&nbsp;\n\n-   镜像命令\n\n    -   docker images 查看本地的镜像\n\n        -   docker images -a 列出本地所有的镜像\n\n        -   docker images -q 只显示镜像的摘要信息&nbsp;\n\n        -   docker images --digests 显示镜像的摘要信息\n\n        -   docker images --no-trunc 显示完整的镜像信息&nbsp;\n\n    -   docker search xxx 搜索相应的镜像(xxx为镜像名字)\n\n        -   docker search xxx -f stars=30 搜索星星数大于30的镜像\n\n        -   docker search xxx -f stars=30 --no-trunc 显示详细信息&nbsp;\n\n    -   docker pull xxx 下载镜像\n\n    -   docker rmi xxx 删除镜像\n\n        -   docker rmi -f xxx 强制删除\n\n        -   docker rmi -f xxx\\[:tag\\] xxx\\[:tag\\] 多个删除&nbsp;\n\n        -   docker rmi -f \\$(docker images -q) 全部删除&nbsp;\n\n-   容器命令（有镜像才能创建容器）\n\n    -   docker pull centos 下载centos镜像\n\n    -   docker run \\[options\\] xxx 新建并运行xxx镜像\n\n        -   options: --name（容器新名字，为容器指定一个名称）\n\n        -   options: -d（后台运行容器，并返回容器ID，也即启动守护式容器）&nbsp;\n\n        -   options: -i（以交互模式运行容器，通常与-t同时使用）\n\n        -   options: -t（为容器重新分配一个伪输入终端，通常与-i同时使用）&nbsp;\n\n        -   options: -P（随机映射端口）\n\n        -   options: -p（指定端口映射，有以下四种格式）\n\n            -   ip:hostPort:containerPort\n\n            -   ip::containerPort&nbsp;\n\n            -   hostPort:containerPort\n\n            -   containerPort&nbsp;\n\n    -   docker ps \\[options\\] 查看正在运行的镜像\n\n        -   options: -a（列出当前所有正在运行的容器+历史上运行过的）\n\n        -   options: -l（显示最近创建的容器）&nbsp;\n\n        -   options: -n（显示最近n个创建的容器）\n\n        -   options: -q（静默模式，只显示容器编号）&nbsp;\n\n        -   options: --no-trunc（不截断输出）&nbsp;\n\n    -   exit 退出并关闭容器\n\n    -   ctrl+p+q 退出但不关闭容器(windows)&nbsp;\n\n    -   docker start 容器id 启动容器\n\n    -   docker restart 容器id 重启容器&nbsp;\n\n    -   docker stop 容器id 停止容器\n\n    -   docker kill 容器id 强制停止&nbsp;\n\n    -   docker rm 容器id 删除容器\n\n        -   docker rm -f 容器id 强制删除\n\n        -   docker rm -f \\$(docker ps -a -q) 多个删除&nbsp;\n\n        -   docker ps -a -q \\| xargs docker rm 多个删除&nbsp;\n\n    -   docker run -d centos 以后台进程的模式启动容器，这样做，导致容器前台没有运行应用，这样启动后，会立即自杀，因为容器觉得没有事情可做。解决方式：将要运行的程序以前台进程的形式运行。\n\n    -   docker logs -f -t --tail 容器id 查看容器日志\n\n        -   -t 是加入时间戳\n\n        -   -f 跟随最新的日志大新&nbsp;\n\n        -   --tail 数字，显示最后多少条&nbsp;\n\n    -   docker top 容器id 查看容器内运行的进程\n\n    -   docker inspect 容器id 查看容器内部细节（json字符串的形式）&nbsp;\n\n    -   docker exec -it 容器id bashShell\n\n        -   docker exec -it 容器id /bin/bash 直接进入目录（默认为/bin/bash）&nbsp;\n\n    -   dcoker attach 容器id 重新进入容器\n\n    -   docker cp 容器id: /tmp/yum.log /root 拷贝文件到root目录下\n\n## 6.Docker镜像\n\n-   docker 的镜像实际上是由一层一层的文件系统组成，这种层级的文件系统UnionFS。\n\n-   ![image.png](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/1636004250376-b17d34f7-0313-4c04-b98e-3abee09a4772.png)\n\n-   docker Commit的操作\n\n## Docker容器数据卷\n\n-   将运用与运行的环境打包形成容器运行，运行可以伴随着容器，但是我们可以对数据的要求希望是持久化的\n\n-   容器之间是希望有可能共享数据&nbsp;\n\n-   Docker容器产生的数据，如果不通过docker commit生成新的镜像，使得数据做为镜像的一部分保存下来，那么当容器删除后，数据自然也就没有了。\n\n-   为了能保存数据在docker中我们使用卷&nbsp;\n\n-   命令添加容器卷\n\n    -   docker run -it -v /宿主机绝对路径目录:/容器内目录 镜像名\n\n    -   docker run -it -v /宿主机绝对路径目录:/容器内目录 ro 镜像名\n\n## DockerFile解析\n\n-   DockerFile是用来构建Docker镜像的构建文件，有由一系列命令和参数构成的脚本\n\n-   构建三步骤：\n\n    -   编写Dockerfile文件\n\n    -   dockerfile build&nbsp;\n\n    -   docker run&nbsp;\n\n-   Dcokerfile内容基础知识\n\n    -   1.每条保留字指令都必须为大写字母且后面要跟随至少一个参数\n\n    -   2.指令按照从上到下，顺序执行&nbsp;\n\n    -   3.\\#表示注释\n\n    -   4.每条指令都会创建一个新的镜像层。并对镜像进行提交&nbsp;\n\n-   Docker执行Dockerfile的大致流程\n\n    -   （1）docker从基础镜像运行一个容器\n\n    -   （2）执行一条指令并对容器作出更改&nbsp;\n\n    -   （3）执行类似docker commit的操作提交一个新的镜像层\n\n    -   （4）docker再基于刚提交的镜像运行一个新容器&nbsp;\n\n    -   （5）执行dockerfile中的下一条指令直到所有指令都执行完成&nbsp;\n\n-   Dockerfile体系结构（保留字指令）\n\n    -   FROM\\|基础镜像，当前镜像是基于哪个镜像的&nbsp;\n\n    -   MAINTAINER \\|镜像维护者的姓名和邮箱地址\n\n    -   RUN 容器构建时需要运行的命令&nbsp;\n\n    -   EXPOSE 当前容器对外暴露出的端口\n\n    -   WORKDIR 指定在创建容器之后，终端默认登陆的进来工作目录，一个落脚点&nbsp;\n\n    -   ENV 用来在构建镜像过程中设置环境变量\n\n    -   ADD 将宿主机目录下的文件拷贝进镜像且ADD命令会自动处理URL和解压tar压缩包&nbsp;\n\n    -   COPY 类似ADD，拷贝文件和目录到镜像中。\n\n    -   VOLUME 容器数据卷，用于数据保存和持久化工作&nbsp;\n\n    -   CMD 指定容器启动时要运行的命令，最后一个命令会顶替之前的\n\n    -   ENTRYPOINT 指定容器启动时要运行的命令，在之前的命令执行后追加&nbsp;\n\n    -   ONBUILD 当构建一个被继承的DockerFile时运行命令，父镜像子在被子继承后父镜像的onbuild被触发&nbsp;\n\n-   案例\n\n```dockerfile\nFROM cetos  \nMAINTAINER csh&lt;330289953@qq&gt;com&gt;  \n\nENV MYPATH /usr/local  \nWORKDIR \\$MYPATH  \n\nRUN yum -y install vim  \nRUN yum -y install net-tools  \n\nEXPOSE 80  \n\nCMD echo \\$MYPATH  \nCMD echo \"success------------ok\"  \nCMD /bin/bash\n```\n\n\n\n## MySql安装\n\ndocker pull mysql:5.7下载5.7版本的mysql\n\n运行：\n\ndocker run -p 3306:3306 --name mysql57 -v /opt/mysql/conf:/etc/mysql/conf.d -v /opt/mysql/logs:/logs -v /opt/mysql/data:/var/lib/mysql -e MYSQL\\_ROOT\\_PASSWORD=123456 -d mysql:5.7\n\n## Redis安装\n\ndocker pull redis 将redis从docker上拉下来\n\n运行：\n\ndocker run -p 6379:6379 -v /opt/myredis/data:/data -v /opt/myredis/conf/redis.conf:/usr/local/etc/redis/redis.conf -d redis redis-server /usr/local/etc/redis/redis.conf --appendonly yes\n\n## 案例（DockerFile）\n\n```\nFROM centos  \nMAINTAINER csh&lt;a330289953@gmail.com&gt;  \n# 把宿主机当前上下文的c.text拷贝到容器/usr/local路径下  \nCOPY c.txt /usr/local/cincontainer.txt  \n# 把java与tomcat添加到容器中  \nADD jdk-8u171-linux-x64.tar.gz /usr/local  \nADD apache-tomcat-9.0.8.tar.gz /usr.local  \n# 安装vim编辑器  \nRUN yum -y install vim  \n# 设置工作访问时候的WORKDIR路径，登录落脚点  \nENV MYPATH /usr/local  \nWORKDIR $MYPATH  \n# 配置java与tomcat环境变量  \nENV JAVA_HOME /usr/local/jdk1.8.0_171  \nENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar  \nENV CATALINA_HOME /usr/local/apache-tomcat-9.0.8  \nENV CATALINA_BASE /usr/local/apache-tomcat-9.0.8  \nENV PATH $PAHT:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin  \n# 容器运行时监听的端口  \nEXPOSE 8080  \n# 启动时运行tomcat  \n# ENTRYPOIN [\"usr/local/apache-tomcat-9.0.8/bin/startup.sh\"]  \n# CMD [\"/usr/local/apache-tomcat-9.0.8/bin/catalina.hs\",\"run\"]  \nCMD /usr/lcoal/apache-tomcat-9.0.8/bin/startup.sh && tail -F /usr/local/apache-tomcat-9.0.8/bin/logs/catailna.out\n```\n\n```sh\ndocker run \\\\\n\n-d \\\n\n-p 6379:6379 \\\\\n\n--restart unless-stopped \\\\\n\n-v /home/memect/project/tools/mydata/redis/data:/data \\\\\n\n-v /home/memect/project/tools/mydata/redis/conf/redis.conf:/etc/redis/redis.conf \\\\\n\nredis-server /etc/redis/redis.conf \\\\\n\nredis\n\n```\n\n```sh\ndocker run -p 3306:3306 --name mysql8 -v /home/chenshuhang/tools/mysql/conf/my.cnf:/etc/mysql/my.cnf -v /home/chenshuhang/tools/mysql/conf:/etc/mysql/conf.d -v /home/chenshuhang/tools/mysql/logs:/logs -v /home/chenshuhang/tools/mysql/data:/var/lib/mysql -e MYSQL\\_ROOT\\_PASSWORD=123456 -d mysql:8.0\n\ndocker run --name mysql -p 3306:3306 -e MYSQL\\_ROOT\\_PASSWORD=123456 -d mysql:8.0\n\nALTER USER 'root'@'localhost' IDENTIFIED BY '123456';\n\ndocker run -p 8848:8848 -v /home/memect/project/login\\_util:/code login\\_util\n\nsudo docker run -p 6379:6379 --name redis -v /home/memect/project/tools/myredis/conf/redis.conf:/etc/redis/redis.conf -v /home/memect/project/tools/myredis/data:/data -d redis redis-server /etc/redis/redis.conf --appendonly yes\n```\n\n设置密码\n\nconfig set requirepass 123456\n\n```\ndocker run -d \\\\\n\n--name=kibana \\\\\n\n--restart=always \\\\\n\n-p 5601:5601 \\\\\n\n-v /opt/tools/kibana/config/kibana.yml:/usr/share/kibana/config/kibana.yml \\\\\n\nkibana:7.16.2\n```\n\n```\ndocker run -p 6379:6379 --name redis -v /home/memect/tools/redis/redis.conf:/etc/redis/redis.conf -v /home/memect/tools/redis/data:/data -d redis redis-server /etc/redis/redis.conf --appendonly yes\n```\n\n```\ndocker run -p 3308:3306 --name mysql57 -v /Users/mac/canal/mysql/conf/my.cnf:/etc/mysql/my.cnf -v /Users/mac/canal/mysql/logs:/logs -v /Users/mac/canal/mysql/data:/var/lib/mysql -e MYSQL\\_ROOT\\_PASSWORD=123456 -d mysql:5.7\n```\n\n","slug":"Docker学习笔记","published":1,"updated":"2022-10-09T08:57:29.160Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clg1mfus6000e27qgf06pf9kx","content":"<h1 id=\"Docker学习笔记\"><a href=\"#Docker学习笔记\" class=\"headerlink\" title=\"Docker学习笔记\"></a>Docker学习笔记</h1><h2 id=\"1-Docker简介\"><a href=\"#1-Docker简介\" class=\"headerlink\" title=\"1.Docker简介\"></a>1.Docker简介</h2><p>Docker是一种运行于Linux和Windows上的软件，用于穿件、管理和编排容器。</p>\n<p>Docker在Github上开发的Moby开源项目的一部分。</p>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/1635746950373-4639ad99-25d4-446f-8ba2-64d1b4caa425.png\" alt=\"image.png\"></p>\n<p>dockerClient客户端</p>\n<p>Docker Daemon守护进程</p>\n<p>Docker Image镜像</p>\n<p>DockerContainer容器</p>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/1635747181750-953109a2-9823-4591-b8c7-a713fb3e1eeb.png\" alt=\"image.png\"></p>\n<h2 id=\"2-Docker的优势\"><a href=\"#2-Docker的优势\" class=\"headerlink\" title=\"2.Docker的优势\"></a>2.Docker的优势</h2><ul>\n<li><p>轻量，秒级的快速启动速度</p>\n</li>\n<li><p>简单，易用，活跃的社区&amp;nbsp;</p>\n</li>\n<li><p>标准统一的打包&#x2F;部署&#x2F;运行方案</p>\n</li>\n<li><p>镜像支持增量分发，易于部署&amp;nbsp;</p>\n</li>\n<li><p>易于构建，良好的REST API，也很适合自动化测试和持续集成</p>\n</li>\n<li><p>性能，尤其是内存和IO的开销</p>\n</li>\n</ul>\n<h2 id=\"3-三要素\"><a href=\"#3-三要素\" class=\"headerlink\" title=\"3.三要素\"></a>3.三要素</h2><ul>\n<li>镜像（image）</li>\n</ul>\n<p>镜像&#x2F;容器</p>\n<p>镜像就是模板，容器就是镜像的一个实例，例如：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">Person</span> <span class=\"variable\">p1</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Person</span>()  </span><br><span class=\"line\"><span class=\"type\">Person</span> <span class=\"variable\">p2</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Person</span>()  </span><br><span class=\"line\"><span class=\"type\">Person</span> <span class=\"variable\">p3</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Person</span>()  </span><br><span class=\"line\"><span class=\"comment\">//Person都来自同一个对象，p1、p2、p3就是3个不同的实例  </span></span><br><span class=\"line\"><span class=\"comment\">//就是一个容器，即镜像就是一个类，容器就是一个一个对象</span></span><br></pre></td></tr></table></figure>\n\n\n\n<ul>\n<li>容器（container）</li>\n</ul>\n<p>Docker利用容器独立运行的一个或一组应用。容器是用镜像创建的运行实例，可以把容器看成是一个简易版的Linux环境</p>\n<ul>\n<li>仓库（respository）</li>\n</ul>\n<p>仓库（Respository）是集中存放镜像文件的场所，仓库和仓库注册服务器（Registry）是有区别的。仓库注册服务器上往往存放着多个仓库，每个仓库中又包含了多个 镜像，每个镜像有不同的标签（tag）。</p>\n<p>仓库分为公开仓库（public）和私有仓库（Private）两种形式。最大的公开仓库是Docker Hub（<a href=\"https://hub.docker.com/%EF%BC%89\">https://hub.docker.com/）</a></p>\n<h2 id=\"4-Docker安装\"><a href=\"#4-Docker安装\" class=\"headerlink\" title=\"4.Docker安装\"></a>4.Docker安装</h2><ul>\n<li>查看自己的服务器上的系统版本</li>\n</ul>\n<p>uname -r</p>\n<p>cat &#x2F;etc&#x2F;redhat-release</p>\n<ul>\n<li>根据服务器的系统不同，版本不同，安装过程会有所区别</li>\n</ul>\n<p><a href=\"https://docs.docker.com/engine/install/centos/#install-using-the-repository\">**</a><a href=\"https://docs.docker.com/engine/install/centos//#install-using-the-repository\">https://docs.docker.com/engine/install/centos/\\#install-using-the-repository</a></p>\n<p>这是官方文档的安装步骤。</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 卸载旧版本  </span></span><br><span class=\"line\">sudo yum remove docker \\</span><br><span class=\"line\">docker-client \\  </span><br><span class=\"line\">docker-client-latest \\  </span><br><span class=\"line\">docker-common \\  </span><br><span class=\"line\">docker-latest \\  </span><br><span class=\"line\">docker-latest-logrotate \\  </span><br><span class=\"line\">docker-logrotate \\  </span><br><span class=\"line\">docker-engine  </span><br><span class=\"line\"><span class=\"comment\">#设置存储库  </span></span><br><span class=\"line\"><span class=\"comment\">#安装yum-utils包（提供yum-config-manager 实用程序）  </span></span><br><span class=\"line\"><span class=\"comment\">#并设置稳定存储库  </span></span><br><span class=\"line\">sudo yum install -y yum-utils  </span><br><span class=\"line\">sudo yum-config-manager \\  </span><br><span class=\"line\">--add-repo \\  </span><br><span class=\"line\">https://download.docker.com/linux/centos/docker-ce.repo  </span><br><span class=\"line\"><span class=\"comment\">#可选：启用夜间或测试存储库  </span></span><br><span class=\"line\"><span class=\"comment\">#开启  </span></span><br><span class=\"line\">sudo yum-config-manager --<span class=\"built_in\">enable</span> docker-ce-nightly  </span><br><span class=\"line\"><span class=\"comment\">#要启用测试通道，请运行以下命令：  </span></span><br><span class=\"line\">sudo yum-config-manager --<span class=\"built_in\">enable</span> docker-ce-test  </span><br><span class=\"line\"><span class=\"comment\">#关闭  </span></span><br><span class=\"line\">sudo yum-config-manager --<span class=\"built_in\">disable</span> docker-ce-nightly  </span><br><span class=\"line\"><span class=\"comment\">#安装docker引擎  </span></span><br><span class=\"line\">sudo yum install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>可以配置阿里云的镜像仓库。具体的可以参考<a href=\"https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors\"><em>https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors</em></a></li>\n</ul>\n<h2 id=\"5-Docker命令\"><a href=\"#5-Docker命令\" class=\"headerlink\" title=\"5.Docker命令\"></a>5.Docker命令</h2><ul>\n<li><p>帮助命令</p>\n<ul>\n<li><p>docker version</p>\n</li>\n<li><p>docker info&amp;nbsp;</p>\n</li>\n<li><p>docker –help&amp;nbsp;</p>\n</li>\n</ul>\n</li>\n<li><p>镜像命令</p>\n<ul>\n<li><p>docker images 查看本地的镜像</p>\n<ul>\n<li><p>docker images -a 列出本地所有的镜像</p>\n</li>\n<li><p>docker images -q 只显示镜像的摘要信息&amp;nbsp;</p>\n</li>\n<li><p>docker images –digests 显示镜像的摘要信息</p>\n</li>\n<li><p>docker images –no-trunc 显示完整的镜像信息&amp;nbsp;</p>\n</li>\n</ul>\n</li>\n<li><p>docker search xxx 搜索相应的镜像(xxx为镜像名字)</p>\n<ul>\n<li><p>docker search xxx -f stars&#x3D;30 搜索星星数大于30的镜像</p>\n</li>\n<li><p>docker search xxx -f stars&#x3D;30 –no-trunc 显示详细信息&amp;nbsp;</p>\n</li>\n</ul>\n</li>\n<li><p>docker pull xxx 下载镜像</p>\n</li>\n<li><p>docker rmi xxx 删除镜像</p>\n<ul>\n<li><p>docker rmi -f xxx 强制删除</p>\n</li>\n<li><p>docker rmi -f xxx[:tag] xxx[:tag] 多个删除&amp;nbsp;</p>\n</li>\n<li><p>docker rmi -f $(docker images -q) 全部删除&amp;nbsp;</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>容器命令（有镜像才能创建容器）</p>\n<ul>\n<li><p>docker pull centos 下载centos镜像</p>\n</li>\n<li><p>docker run [options] xxx 新建并运行xxx镜像</p>\n<ul>\n<li><p>options: –name（容器新名字，为容器指定一个名称）</p>\n</li>\n<li><p>options: -d（后台运行容器，并返回容器ID，也即启动守护式容器）&amp;nbsp;</p>\n</li>\n<li><p>options: -i（以交互模式运行容器，通常与-t同时使用）</p>\n</li>\n<li><p>options: -t（为容器重新分配一个伪输入终端，通常与-i同时使用）&amp;nbsp;</p>\n</li>\n<li><p>options: -P（随机映射端口）</p>\n</li>\n<li><p>options: -p（指定端口映射，有以下四种格式）</p>\n<ul>\n<li><p>ip:hostPort:containerPort</p>\n</li>\n<li><p>ip::containerPort&amp;nbsp;</p>\n</li>\n<li><p>hostPort:containerPort</p>\n</li>\n<li><p>containerPort&amp;nbsp;</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>docker ps [options] 查看正在运行的镜像</p>\n<ul>\n<li><p>options: -a（列出当前所有正在运行的容器+历史上运行过的）</p>\n</li>\n<li><p>options: -l（显示最近创建的容器）&amp;nbsp;</p>\n</li>\n<li><p>options: -n（显示最近n个创建的容器）</p>\n</li>\n<li><p>options: -q（静默模式，只显示容器编号）&amp;nbsp;</p>\n</li>\n<li><p>options: –no-trunc（不截断输出）&amp;nbsp;</p>\n</li>\n</ul>\n</li>\n<li><p>exit 退出并关闭容器</p>\n</li>\n<li><p>ctrl+p+q 退出但不关闭容器(windows)&amp;nbsp;</p>\n</li>\n<li><p>docker start 容器id 启动容器</p>\n</li>\n<li><p>docker restart 容器id 重启容器&amp;nbsp;</p>\n</li>\n<li><p>docker stop 容器id 停止容器</p>\n</li>\n<li><p>docker kill 容器id 强制停止&amp;nbsp;</p>\n</li>\n<li><p>docker rm 容器id 删除容器</p>\n<ul>\n<li><p>docker rm -f 容器id 强制删除</p>\n</li>\n<li><p>docker rm -f $(docker ps -a -q) 多个删除&amp;nbsp;</p>\n</li>\n<li><p>docker ps -a -q | xargs docker rm 多个删除&amp;nbsp;</p>\n</li>\n</ul>\n</li>\n<li><p>docker run -d centos 以后台进程的模式启动容器，这样做，导致容器前台没有运行应用，这样启动后，会立即自杀，因为容器觉得没有事情可做。解决方式：将要运行的程序以前台进程的形式运行。</p>\n</li>\n<li><p>docker logs -f -t –tail 容器id 查看容器日志</p>\n<ul>\n<li><p>-t 是加入时间戳</p>\n</li>\n<li><p>-f 跟随最新的日志大新&amp;nbsp;</p>\n</li>\n<li><p>–tail 数字，显示最后多少条&amp;nbsp;</p>\n</li>\n</ul>\n</li>\n<li><p>docker top 容器id 查看容器内运行的进程</p>\n</li>\n<li><p>docker inspect 容器id 查看容器内部细节（json字符串的形式）&amp;nbsp;</p>\n</li>\n<li><p>docker exec -it 容器id bashShell</p>\n<ul>\n<li>docker exec -it 容器id &#x2F;bin&#x2F;bash 直接进入目录（默认为&#x2F;bin&#x2F;bash）&amp;nbsp;</li>\n</ul>\n</li>\n<li><p>dcoker attach 容器id 重新进入容器</p>\n</li>\n<li><p>docker cp 容器id: &#x2F;tmp&#x2F;yum.log &#x2F;root 拷贝文件到root目录下</p>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"6-Docker镜像\"><a href=\"#6-Docker镜像\" class=\"headerlink\" title=\"6.Docker镜像\"></a>6.Docker镜像</h2><ul>\n<li><p>docker 的镜像实际上是由一层一层的文件系统组成，这种层级的文件系统UnionFS。</p>\n</li>\n<li><p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/1636004250376-b17d34f7-0313-4c04-b98e-3abee09a4772.png\" alt=\"image.png\"></p>\n</li>\n<li><p>docker Commit的操作</p>\n</li>\n</ul>\n<h2 id=\"Docker容器数据卷\"><a href=\"#Docker容器数据卷\" class=\"headerlink\" title=\"Docker容器数据卷\"></a>Docker容器数据卷</h2><ul>\n<li><p>将运用与运行的环境打包形成容器运行，运行可以伴随着容器，但是我们可以对数据的要求希望是持久化的</p>\n</li>\n<li><p>容器之间是希望有可能共享数据&amp;nbsp;</p>\n</li>\n<li><p>Docker容器产生的数据，如果不通过docker commit生成新的镜像，使得数据做为镜像的一部分保存下来，那么当容器删除后，数据自然也就没有了。</p>\n</li>\n<li><p>为了能保存数据在docker中我们使用卷&amp;nbsp;</p>\n</li>\n<li><p>命令添加容器卷</p>\n<ul>\n<li><p>docker run -it -v &#x2F;宿主机绝对路径目录:&#x2F;容器内目录 镜像名</p>\n</li>\n<li><p>docker run -it -v &#x2F;宿主机绝对路径目录:&#x2F;容器内目录 ro 镜像名</p>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"DockerFile解析\"><a href=\"#DockerFile解析\" class=\"headerlink\" title=\"DockerFile解析\"></a>DockerFile解析</h2><ul>\n<li><p>DockerFile是用来构建Docker镜像的构建文件，有由一系列命令和参数构成的脚本</p>\n</li>\n<li><p>构建三步骤：</p>\n<ul>\n<li><p>编写Dockerfile文件</p>\n</li>\n<li><p>dockerfile build&amp;nbsp;</p>\n</li>\n<li><p>docker run&amp;nbsp;</p>\n</li>\n</ul>\n</li>\n<li><p>Dcokerfile内容基础知识</p>\n<ul>\n<li><p>1.每条保留字指令都必须为大写字母且后面要跟随至少一个参数</p>\n</li>\n<li><p>2.指令按照从上到下，顺序执行&amp;nbsp;</p>\n</li>\n<li><p>3.#表示注释</p>\n</li>\n<li><p>4.每条指令都会创建一个新的镜像层。并对镜像进行提交&amp;nbsp;</p>\n</li>\n</ul>\n</li>\n<li><p>Docker执行Dockerfile的大致流程</p>\n<ul>\n<li><p>（1）docker从基础镜像运行一个容器</p>\n</li>\n<li><p>（2）执行一条指令并对容器作出更改&amp;nbsp;</p>\n</li>\n<li><p>（3）执行类似docker commit的操作提交一个新的镜像层</p>\n</li>\n<li><p>（4）docker再基于刚提交的镜像运行一个新容器&amp;nbsp;</p>\n</li>\n<li><p>（5）执行dockerfile中的下一条指令直到所有指令都执行完成&amp;nbsp;</p>\n</li>\n</ul>\n</li>\n<li><p>Dockerfile体系结构（保留字指令）</p>\n<ul>\n<li><p>FROM|基础镜像，当前镜像是基于哪个镜像的&amp;nbsp;</p>\n</li>\n<li><p>MAINTAINER |镜像维护者的姓名和邮箱地址</p>\n</li>\n<li><p>RUN 容器构建时需要运行的命令&amp;nbsp;</p>\n</li>\n<li><p>EXPOSE 当前容器对外暴露出的端口</p>\n</li>\n<li><p>WORKDIR 指定在创建容器之后，终端默认登陆的进来工作目录，一个落脚点&amp;nbsp;</p>\n</li>\n<li><p>ENV 用来在构建镜像过程中设置环境变量</p>\n</li>\n<li><p>ADD 将宿主机目录下的文件拷贝进镜像且ADD命令会自动处理URL和解压tar压缩包&amp;nbsp;</p>\n</li>\n<li><p>COPY 类似ADD，拷贝文件和目录到镜像中。</p>\n</li>\n<li><p>VOLUME 容器数据卷，用于数据保存和持久化工作&amp;nbsp;</p>\n</li>\n<li><p>CMD 指定容器启动时要运行的命令，最后一个命令会顶替之前的</p>\n</li>\n<li><p>ENTRYPOINT 指定容器启动时要运行的命令，在之前的命令执行后追加&amp;nbsp;</p>\n</li>\n<li><p>ONBUILD 当构建一个被继承的DockerFile时运行命令，父镜像子在被子继承后父镜像的onbuild被触发&amp;nbsp;</p>\n</li>\n</ul>\n</li>\n<li><p>案例</p>\n</li>\n</ul>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">FROM</span> cetos  </span><br><span class=\"line\"><span class=\"keyword\">MAINTAINER</span> csh&amp;lt;<span class=\"number\">330289953</span>@qq&amp;gt;com&amp;gt;  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">ENV</span> MYPATH /usr/local  </span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"language-bash\"> \\<span class=\"variable\">$MYPATH</span>  </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> yum -y install vim  </span></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> yum -y install net-tools  </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">EXPOSE</span> <span class=\"number\">80</span>  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"language-bash\"> <span class=\"built_in\">echo</span> \\<span class=\"variable\">$MYPATH</span>  </span></span><br><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"language-bash\"> <span class=\"built_in\">echo</span> <span class=\"string\">&quot;success------------ok&quot;</span>  </span></span><br><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"language-bash\"> /bin/bash</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"MySql安装\"><a href=\"#MySql安装\" class=\"headerlink\" title=\"MySql安装\"></a>MySql安装</h2><p>docker pull mysql:5.7下载5.7版本的mysql</p>\n<p>运行：</p>\n<p>docker run -p 3306:3306 –name mysql57 -v &#x2F;opt&#x2F;mysql&#x2F;conf:&#x2F;etc&#x2F;mysql&#x2F;conf.d -v &#x2F;opt&#x2F;mysql&#x2F;logs:&#x2F;logs -v &#x2F;opt&#x2F;mysql&#x2F;data:&#x2F;var&#x2F;lib&#x2F;mysql -e MYSQL_ROOT_PASSWORD&#x3D;123456 -d mysql:5.7</p>\n<h2 id=\"Redis安装\"><a href=\"#Redis安装\" class=\"headerlink\" title=\"Redis安装\"></a>Redis安装</h2><p>docker pull redis 将redis从docker上拉下来</p>\n<p>运行：</p>\n<p>docker run -p 6379:6379 -v &#x2F;opt&#x2F;myredis&#x2F;data:&#x2F;data -v &#x2F;opt&#x2F;myredis&#x2F;conf&#x2F;redis.conf:&#x2F;usr&#x2F;local&#x2F;etc&#x2F;redis&#x2F;redis.conf -d redis redis-server &#x2F;usr&#x2F;local&#x2F;etc&#x2F;redis&#x2F;redis.conf –appendonly yes</p>\n<h2 id=\"案例（DockerFile）\"><a href=\"#案例（DockerFile）\" class=\"headerlink\" title=\"案例（DockerFile）\"></a>案例（DockerFile）</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FROM centos  </span><br><span class=\"line\">MAINTAINER csh&amp;lt;a330289953@gmail.com&amp;gt;  </span><br><span class=\"line\"># 把宿主机当前上下文的c.text拷贝到容器/usr/local路径下  </span><br><span class=\"line\">COPY c.txt /usr/local/cincontainer.txt  </span><br><span class=\"line\"># 把java与tomcat添加到容器中  </span><br><span class=\"line\">ADD jdk-8u171-linux-x64.tar.gz /usr/local  </span><br><span class=\"line\">ADD apache-tomcat-9.0.8.tar.gz /usr.local  </span><br><span class=\"line\"># 安装vim编辑器  </span><br><span class=\"line\">RUN yum -y install vim  </span><br><span class=\"line\"># 设置工作访问时候的WORKDIR路径，登录落脚点  </span><br><span class=\"line\">ENV MYPATH /usr/local  </span><br><span class=\"line\">WORKDIR $MYPATH  </span><br><span class=\"line\"># 配置java与tomcat环境变量  </span><br><span class=\"line\">ENV JAVA_HOME /usr/local/jdk1.8.0_171  </span><br><span class=\"line\">ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar  </span><br><span class=\"line\">ENV CATALINA_HOME /usr/local/apache-tomcat-9.0.8  </span><br><span class=\"line\">ENV CATALINA_BASE /usr/local/apache-tomcat-9.0.8  </span><br><span class=\"line\">ENV PATH $PAHT:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin  </span><br><span class=\"line\"># 容器运行时监听的端口  </span><br><span class=\"line\">EXPOSE 8080  </span><br><span class=\"line\"># 启动时运行tomcat  </span><br><span class=\"line\"># ENTRYPOIN [&quot;usr/local/apache-tomcat-9.0.8/bin/startup.sh&quot;]  </span><br><span class=\"line\"># CMD [&quot;/usr/local/apache-tomcat-9.0.8/bin/catalina.hs&quot;,&quot;run&quot;]  </span><br><span class=\"line\">CMD /usr/lcoal/apache-tomcat-9.0.8/bin/startup.sh &amp;&amp; tail -F /usr/local/apache-tomcat-9.0.8/bin/logs/catailna.out</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run \\\\</span><br><span class=\"line\"></span><br><span class=\"line\">-d \\</span><br><span class=\"line\"></span><br><span class=\"line\">-p 6379:6379 \\\\</span><br><span class=\"line\"></span><br><span class=\"line\">--restart unless-stopped \\\\</span><br><span class=\"line\"></span><br><span class=\"line\">-v /home/memect/project/tools/mydata/redis/data:/data \\\\</span><br><span class=\"line\"></span><br><span class=\"line\">-v /home/memect/project/tools/mydata/redis/conf/redis.conf:/etc/redis/redis.conf \\\\</span><br><span class=\"line\"></span><br><span class=\"line\">redis-server /etc/redis/redis.conf \\\\</span><br><span class=\"line\"></span><br><span class=\"line\">redis</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -p 3306:3306 --name mysql8 -v /home/chenshuhang/tools/mysql/conf/my.cnf:/etc/mysql/my.cnf -v /home/chenshuhang/tools/mysql/conf:/etc/mysql/conf.d -v /home/chenshuhang/tools/mysql/logs:/logs -v /home/chenshuhang/tools/mysql/data:/var/lib/mysql -e MYSQL\\_ROOT\\_PASSWORD=123456 -d mysql:8.0</span><br><span class=\"line\"></span><br><span class=\"line\">docker run --name mysql -p 3306:3306 -e MYSQL\\_ROOT\\_PASSWORD=123456 -d mysql:8.0</span><br><span class=\"line\"></span><br><span class=\"line\">ALTER USER <span class=\"string\">&#x27;root&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class=\"string\">&#x27;123456&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">docker run -p 8848:8848 -v /home/memect/project/login\\_util:/code login\\_util</span><br><span class=\"line\"></span><br><span class=\"line\">sudo docker run -p 6379:6379 --name redis -v /home/memect/project/tools/myredis/conf/redis.conf:/etc/redis/redis.conf -v /home/memect/project/tools/myredis/data:/data -d redis redis-server /etc/redis/redis.conf --appendonly <span class=\"built_in\">yes</span></span><br></pre></td></tr></table></figure>\n\n<p>设置密码</p>\n<p>config set requirepass 123456</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d \\\\</span><br><span class=\"line\"></span><br><span class=\"line\">--name=kibana \\\\</span><br><span class=\"line\"></span><br><span class=\"line\">--restart=always \\\\</span><br><span class=\"line\"></span><br><span class=\"line\">-p 5601:5601 \\\\</span><br><span class=\"line\"></span><br><span class=\"line\">-v /opt/tools/kibana/config/kibana.yml:/usr/share/kibana/config/kibana.yml \\\\</span><br><span class=\"line\"></span><br><span class=\"line\">kibana:7.16.2</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -p 6379:6379 --name redis -v /home/memect/tools/redis/redis.conf:/etc/redis/redis.conf -v /home/memect/tools/redis/data:/data -d redis redis-server /etc/redis/redis.conf --appendonly yes</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -p 3308:3306 --name mysql57 -v /Users/mac/canal/mysql/conf/my.cnf:/etc/mysql/my.cnf -v /Users/mac/canal/mysql/logs:/logs -v /Users/mac/canal/mysql/data:/var/lib/mysql -e MYSQL\\_ROOT\\_PASSWORD=123456 -d mysql:5.7</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{"link":[{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"动漫图片和壁纸","link":"https://anime-pictures.net/?lang=zh_CN","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"图片网站"},{"name":"Wallhaven","link":"https://wallhaven.cc/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"4k图片网站"},{"name":"WALLPAPER ABYSS","link":"https://wall.alphacoders.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"WALLPAPER ABYSS"},{"name":"极简壁纸","link":"https://bz.zzzmh.cn/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"极简壁纸"},{"name":"Wallroom","link":"https://wallroom.io/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"Wallroom"}]}]}},"excerpt":"","more":"<h1 id=\"Docker学习笔记\"><a href=\"#Docker学习笔记\" class=\"headerlink\" title=\"Docker学习笔记\"></a>Docker学习笔记</h1><h2 id=\"1-Docker简介\"><a href=\"#1-Docker简介\" class=\"headerlink\" title=\"1.Docker简介\"></a>1.Docker简介</h2><p>Docker是一种运行于Linux和Windows上的软件，用于穿件、管理和编排容器。</p>\n<p>Docker在Github上开发的Moby开源项目的一部分。</p>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/1635746950373-4639ad99-25d4-446f-8ba2-64d1b4caa425.png\" alt=\"image.png\"></p>\n<p>dockerClient客户端</p>\n<p>Docker Daemon守护进程</p>\n<p>Docker Image镜像</p>\n<p>DockerContainer容器</p>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/1635747181750-953109a2-9823-4591-b8c7-a713fb3e1eeb.png\" alt=\"image.png\"></p>\n<h2 id=\"2-Docker的优势\"><a href=\"#2-Docker的优势\" class=\"headerlink\" title=\"2.Docker的优势\"></a>2.Docker的优势</h2><ul>\n<li><p>轻量，秒级的快速启动速度</p>\n</li>\n<li><p>简单，易用，活跃的社区&amp;nbsp;</p>\n</li>\n<li><p>标准统一的打包&#x2F;部署&#x2F;运行方案</p>\n</li>\n<li><p>镜像支持增量分发，易于部署&amp;nbsp;</p>\n</li>\n<li><p>易于构建，良好的REST API，也很适合自动化测试和持续集成</p>\n</li>\n<li><p>性能，尤其是内存和IO的开销</p>\n</li>\n</ul>\n<h2 id=\"3-三要素\"><a href=\"#3-三要素\" class=\"headerlink\" title=\"3.三要素\"></a>3.三要素</h2><ul>\n<li>镜像（image）</li>\n</ul>\n<p>镜像&#x2F;容器</p>\n<p>镜像就是模板，容器就是镜像的一个实例，例如：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">Person</span> <span class=\"variable\">p1</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Person</span>()  </span><br><span class=\"line\"><span class=\"type\">Person</span> <span class=\"variable\">p2</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Person</span>()  </span><br><span class=\"line\"><span class=\"type\">Person</span> <span class=\"variable\">p3</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Person</span>()  </span><br><span class=\"line\"><span class=\"comment\">//Person都来自同一个对象，p1、p2、p3就是3个不同的实例  </span></span><br><span class=\"line\"><span class=\"comment\">//就是一个容器，即镜像就是一个类，容器就是一个一个对象</span></span><br></pre></td></tr></table></figure>\n\n\n\n<ul>\n<li>容器（container）</li>\n</ul>\n<p>Docker利用容器独立运行的一个或一组应用。容器是用镜像创建的运行实例，可以把容器看成是一个简易版的Linux环境</p>\n<ul>\n<li>仓库（respository）</li>\n</ul>\n<p>仓库（Respository）是集中存放镜像文件的场所，仓库和仓库注册服务器（Registry）是有区别的。仓库注册服务器上往往存放着多个仓库，每个仓库中又包含了多个 镜像，每个镜像有不同的标签（tag）。</p>\n<p>仓库分为公开仓库（public）和私有仓库（Private）两种形式。最大的公开仓库是Docker Hub（<a href=\"https://hub.docker.com/%EF%BC%89\">https://hub.docker.com/）</a></p>\n<h2 id=\"4-Docker安装\"><a href=\"#4-Docker安装\" class=\"headerlink\" title=\"4.Docker安装\"></a>4.Docker安装</h2><ul>\n<li>查看自己的服务器上的系统版本</li>\n</ul>\n<p>uname -r</p>\n<p>cat &#x2F;etc&#x2F;redhat-release</p>\n<ul>\n<li>根据服务器的系统不同，版本不同，安装过程会有所区别</li>\n</ul>\n<p><a href=\"https://docs.docker.com/engine/install/centos/#install-using-the-repository\">**</a><a href=\"https://docs.docker.com/engine/install/centos//#install-using-the-repository\">https://docs.docker.com/engine/install/centos/\\#install-using-the-repository</a></p>\n<p>这是官方文档的安装步骤。</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 卸载旧版本  </span></span><br><span class=\"line\">sudo yum remove docker \\</span><br><span class=\"line\">docker-client \\  </span><br><span class=\"line\">docker-client-latest \\  </span><br><span class=\"line\">docker-common \\  </span><br><span class=\"line\">docker-latest \\  </span><br><span class=\"line\">docker-latest-logrotate \\  </span><br><span class=\"line\">docker-logrotate \\  </span><br><span class=\"line\">docker-engine  </span><br><span class=\"line\"><span class=\"comment\">#设置存储库  </span></span><br><span class=\"line\"><span class=\"comment\">#安装yum-utils包（提供yum-config-manager 实用程序）  </span></span><br><span class=\"line\"><span class=\"comment\">#并设置稳定存储库  </span></span><br><span class=\"line\">sudo yum install -y yum-utils  </span><br><span class=\"line\">sudo yum-config-manager \\  </span><br><span class=\"line\">--add-repo \\  </span><br><span class=\"line\">https://download.docker.com/linux/centos/docker-ce.repo  </span><br><span class=\"line\"><span class=\"comment\">#可选：启用夜间或测试存储库  </span></span><br><span class=\"line\"><span class=\"comment\">#开启  </span></span><br><span class=\"line\">sudo yum-config-manager --<span class=\"built_in\">enable</span> docker-ce-nightly  </span><br><span class=\"line\"><span class=\"comment\">#要启用测试通道，请运行以下命令：  </span></span><br><span class=\"line\">sudo yum-config-manager --<span class=\"built_in\">enable</span> docker-ce-test  </span><br><span class=\"line\"><span class=\"comment\">#关闭  </span></span><br><span class=\"line\">sudo yum-config-manager --<span class=\"built_in\">disable</span> docker-ce-nightly  </span><br><span class=\"line\"><span class=\"comment\">#安装docker引擎  </span></span><br><span class=\"line\">sudo yum install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>可以配置阿里云的镜像仓库。具体的可以参考<a href=\"https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors\"><em>https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors</em></a></li>\n</ul>\n<h2 id=\"5-Docker命令\"><a href=\"#5-Docker命令\" class=\"headerlink\" title=\"5.Docker命令\"></a>5.Docker命令</h2><ul>\n<li><p>帮助命令</p>\n<ul>\n<li><p>docker version</p>\n</li>\n<li><p>docker info&amp;nbsp;</p>\n</li>\n<li><p>docker –help&amp;nbsp;</p>\n</li>\n</ul>\n</li>\n<li><p>镜像命令</p>\n<ul>\n<li><p>docker images 查看本地的镜像</p>\n<ul>\n<li><p>docker images -a 列出本地所有的镜像</p>\n</li>\n<li><p>docker images -q 只显示镜像的摘要信息&amp;nbsp;</p>\n</li>\n<li><p>docker images –digests 显示镜像的摘要信息</p>\n</li>\n<li><p>docker images –no-trunc 显示完整的镜像信息&amp;nbsp;</p>\n</li>\n</ul>\n</li>\n<li><p>docker search xxx 搜索相应的镜像(xxx为镜像名字)</p>\n<ul>\n<li><p>docker search xxx -f stars&#x3D;30 搜索星星数大于30的镜像</p>\n</li>\n<li><p>docker search xxx -f stars&#x3D;30 –no-trunc 显示详细信息&amp;nbsp;</p>\n</li>\n</ul>\n</li>\n<li><p>docker pull xxx 下载镜像</p>\n</li>\n<li><p>docker rmi xxx 删除镜像</p>\n<ul>\n<li><p>docker rmi -f xxx 强制删除</p>\n</li>\n<li><p>docker rmi -f xxx[:tag] xxx[:tag] 多个删除&amp;nbsp;</p>\n</li>\n<li><p>docker rmi -f $(docker images -q) 全部删除&amp;nbsp;</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>容器命令（有镜像才能创建容器）</p>\n<ul>\n<li><p>docker pull centos 下载centos镜像</p>\n</li>\n<li><p>docker run [options] xxx 新建并运行xxx镜像</p>\n<ul>\n<li><p>options: –name（容器新名字，为容器指定一个名称）</p>\n</li>\n<li><p>options: -d（后台运行容器，并返回容器ID，也即启动守护式容器）&amp;nbsp;</p>\n</li>\n<li><p>options: -i（以交互模式运行容器，通常与-t同时使用）</p>\n</li>\n<li><p>options: -t（为容器重新分配一个伪输入终端，通常与-i同时使用）&amp;nbsp;</p>\n</li>\n<li><p>options: -P（随机映射端口）</p>\n</li>\n<li><p>options: -p（指定端口映射，有以下四种格式）</p>\n<ul>\n<li><p>ip:hostPort:containerPort</p>\n</li>\n<li><p>ip::containerPort&amp;nbsp;</p>\n</li>\n<li><p>hostPort:containerPort</p>\n</li>\n<li><p>containerPort&amp;nbsp;</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>docker ps [options] 查看正在运行的镜像</p>\n<ul>\n<li><p>options: -a（列出当前所有正在运行的容器+历史上运行过的）</p>\n</li>\n<li><p>options: -l（显示最近创建的容器）&amp;nbsp;</p>\n</li>\n<li><p>options: -n（显示最近n个创建的容器）</p>\n</li>\n<li><p>options: -q（静默模式，只显示容器编号）&amp;nbsp;</p>\n</li>\n<li><p>options: –no-trunc（不截断输出）&amp;nbsp;</p>\n</li>\n</ul>\n</li>\n<li><p>exit 退出并关闭容器</p>\n</li>\n<li><p>ctrl+p+q 退出但不关闭容器(windows)&amp;nbsp;</p>\n</li>\n<li><p>docker start 容器id 启动容器</p>\n</li>\n<li><p>docker restart 容器id 重启容器&amp;nbsp;</p>\n</li>\n<li><p>docker stop 容器id 停止容器</p>\n</li>\n<li><p>docker kill 容器id 强制停止&amp;nbsp;</p>\n</li>\n<li><p>docker rm 容器id 删除容器</p>\n<ul>\n<li><p>docker rm -f 容器id 强制删除</p>\n</li>\n<li><p>docker rm -f $(docker ps -a -q) 多个删除&amp;nbsp;</p>\n</li>\n<li><p>docker ps -a -q | xargs docker rm 多个删除&amp;nbsp;</p>\n</li>\n</ul>\n</li>\n<li><p>docker run -d centos 以后台进程的模式启动容器，这样做，导致容器前台没有运行应用，这样启动后，会立即自杀，因为容器觉得没有事情可做。解决方式：将要运行的程序以前台进程的形式运行。</p>\n</li>\n<li><p>docker logs -f -t –tail 容器id 查看容器日志</p>\n<ul>\n<li><p>-t 是加入时间戳</p>\n</li>\n<li><p>-f 跟随最新的日志大新&amp;nbsp;</p>\n</li>\n<li><p>–tail 数字，显示最后多少条&amp;nbsp;</p>\n</li>\n</ul>\n</li>\n<li><p>docker top 容器id 查看容器内运行的进程</p>\n</li>\n<li><p>docker inspect 容器id 查看容器内部细节（json字符串的形式）&amp;nbsp;</p>\n</li>\n<li><p>docker exec -it 容器id bashShell</p>\n<ul>\n<li>docker exec -it 容器id &#x2F;bin&#x2F;bash 直接进入目录（默认为&#x2F;bin&#x2F;bash）&amp;nbsp;</li>\n</ul>\n</li>\n<li><p>dcoker attach 容器id 重新进入容器</p>\n</li>\n<li><p>docker cp 容器id: &#x2F;tmp&#x2F;yum.log &#x2F;root 拷贝文件到root目录下</p>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"6-Docker镜像\"><a href=\"#6-Docker镜像\" class=\"headerlink\" title=\"6.Docker镜像\"></a>6.Docker镜像</h2><ul>\n<li><p>docker 的镜像实际上是由一层一层的文件系统组成，这种层级的文件系统UnionFS。</p>\n</li>\n<li><p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/1636004250376-b17d34f7-0313-4c04-b98e-3abee09a4772.png\" alt=\"image.png\"></p>\n</li>\n<li><p>docker Commit的操作</p>\n</li>\n</ul>\n<h2 id=\"Docker容器数据卷\"><a href=\"#Docker容器数据卷\" class=\"headerlink\" title=\"Docker容器数据卷\"></a>Docker容器数据卷</h2><ul>\n<li><p>将运用与运行的环境打包形成容器运行，运行可以伴随着容器，但是我们可以对数据的要求希望是持久化的</p>\n</li>\n<li><p>容器之间是希望有可能共享数据&amp;nbsp;</p>\n</li>\n<li><p>Docker容器产生的数据，如果不通过docker commit生成新的镜像，使得数据做为镜像的一部分保存下来，那么当容器删除后，数据自然也就没有了。</p>\n</li>\n<li><p>为了能保存数据在docker中我们使用卷&amp;nbsp;</p>\n</li>\n<li><p>命令添加容器卷</p>\n<ul>\n<li><p>docker run -it -v &#x2F;宿主机绝对路径目录:&#x2F;容器内目录 镜像名</p>\n</li>\n<li><p>docker run -it -v &#x2F;宿主机绝对路径目录:&#x2F;容器内目录 ro 镜像名</p>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"DockerFile解析\"><a href=\"#DockerFile解析\" class=\"headerlink\" title=\"DockerFile解析\"></a>DockerFile解析</h2><ul>\n<li><p>DockerFile是用来构建Docker镜像的构建文件，有由一系列命令和参数构成的脚本</p>\n</li>\n<li><p>构建三步骤：</p>\n<ul>\n<li><p>编写Dockerfile文件</p>\n</li>\n<li><p>dockerfile build&amp;nbsp;</p>\n</li>\n<li><p>docker run&amp;nbsp;</p>\n</li>\n</ul>\n</li>\n<li><p>Dcokerfile内容基础知识</p>\n<ul>\n<li><p>1.每条保留字指令都必须为大写字母且后面要跟随至少一个参数</p>\n</li>\n<li><p>2.指令按照从上到下，顺序执行&amp;nbsp;</p>\n</li>\n<li><p>3.#表示注释</p>\n</li>\n<li><p>4.每条指令都会创建一个新的镜像层。并对镜像进行提交&amp;nbsp;</p>\n</li>\n</ul>\n</li>\n<li><p>Docker执行Dockerfile的大致流程</p>\n<ul>\n<li><p>（1）docker从基础镜像运行一个容器</p>\n</li>\n<li><p>（2）执行一条指令并对容器作出更改&amp;nbsp;</p>\n</li>\n<li><p>（3）执行类似docker commit的操作提交一个新的镜像层</p>\n</li>\n<li><p>（4）docker再基于刚提交的镜像运行一个新容器&amp;nbsp;</p>\n</li>\n<li><p>（5）执行dockerfile中的下一条指令直到所有指令都执行完成&amp;nbsp;</p>\n</li>\n</ul>\n</li>\n<li><p>Dockerfile体系结构（保留字指令）</p>\n<ul>\n<li><p>FROM|基础镜像，当前镜像是基于哪个镜像的&amp;nbsp;</p>\n</li>\n<li><p>MAINTAINER |镜像维护者的姓名和邮箱地址</p>\n</li>\n<li><p>RUN 容器构建时需要运行的命令&amp;nbsp;</p>\n</li>\n<li><p>EXPOSE 当前容器对外暴露出的端口</p>\n</li>\n<li><p>WORKDIR 指定在创建容器之后，终端默认登陆的进来工作目录，一个落脚点&amp;nbsp;</p>\n</li>\n<li><p>ENV 用来在构建镜像过程中设置环境变量</p>\n</li>\n<li><p>ADD 将宿主机目录下的文件拷贝进镜像且ADD命令会自动处理URL和解压tar压缩包&amp;nbsp;</p>\n</li>\n<li><p>COPY 类似ADD，拷贝文件和目录到镜像中。</p>\n</li>\n<li><p>VOLUME 容器数据卷，用于数据保存和持久化工作&amp;nbsp;</p>\n</li>\n<li><p>CMD 指定容器启动时要运行的命令，最后一个命令会顶替之前的</p>\n</li>\n<li><p>ENTRYPOINT 指定容器启动时要运行的命令，在之前的命令执行后追加&amp;nbsp;</p>\n</li>\n<li><p>ONBUILD 当构建一个被继承的DockerFile时运行命令，父镜像子在被子继承后父镜像的onbuild被触发&amp;nbsp;</p>\n</li>\n</ul>\n</li>\n<li><p>案例</p>\n</li>\n</ul>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">FROM</span> cetos  </span><br><span class=\"line\"><span class=\"keyword\">MAINTAINER</span> csh&amp;lt;<span class=\"number\">330289953</span>@qq&amp;gt;com&amp;gt;  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">ENV</span> MYPATH /usr/local  </span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"language-bash\"> \\<span class=\"variable\">$MYPATH</span>  </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> yum -y install vim  </span></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> yum -y install net-tools  </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">EXPOSE</span> <span class=\"number\">80</span>  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"language-bash\"> <span class=\"built_in\">echo</span> \\<span class=\"variable\">$MYPATH</span>  </span></span><br><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"language-bash\"> <span class=\"built_in\">echo</span> <span class=\"string\">&quot;success------------ok&quot;</span>  </span></span><br><span class=\"line\"><span class=\"keyword\">CMD</span><span class=\"language-bash\"> /bin/bash</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"MySql安装\"><a href=\"#MySql安装\" class=\"headerlink\" title=\"MySql安装\"></a>MySql安装</h2><p>docker pull mysql:5.7下载5.7版本的mysql</p>\n<p>运行：</p>\n<p>docker run -p 3306:3306 –name mysql57 -v &#x2F;opt&#x2F;mysql&#x2F;conf:&#x2F;etc&#x2F;mysql&#x2F;conf.d -v &#x2F;opt&#x2F;mysql&#x2F;logs:&#x2F;logs -v &#x2F;opt&#x2F;mysql&#x2F;data:&#x2F;var&#x2F;lib&#x2F;mysql -e MYSQL_ROOT_PASSWORD&#x3D;123456 -d mysql:5.7</p>\n<h2 id=\"Redis安装\"><a href=\"#Redis安装\" class=\"headerlink\" title=\"Redis安装\"></a>Redis安装</h2><p>docker pull redis 将redis从docker上拉下来</p>\n<p>运行：</p>\n<p>docker run -p 6379:6379 -v &#x2F;opt&#x2F;myredis&#x2F;data:&#x2F;data -v &#x2F;opt&#x2F;myredis&#x2F;conf&#x2F;redis.conf:&#x2F;usr&#x2F;local&#x2F;etc&#x2F;redis&#x2F;redis.conf -d redis redis-server &#x2F;usr&#x2F;local&#x2F;etc&#x2F;redis&#x2F;redis.conf –appendonly yes</p>\n<h2 id=\"案例（DockerFile）\"><a href=\"#案例（DockerFile）\" class=\"headerlink\" title=\"案例（DockerFile）\"></a>案例（DockerFile）</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FROM centos  </span><br><span class=\"line\">MAINTAINER csh&amp;lt;a330289953@gmail.com&amp;gt;  </span><br><span class=\"line\"># 把宿主机当前上下文的c.text拷贝到容器/usr/local路径下  </span><br><span class=\"line\">COPY c.txt /usr/local/cincontainer.txt  </span><br><span class=\"line\"># 把java与tomcat添加到容器中  </span><br><span class=\"line\">ADD jdk-8u171-linux-x64.tar.gz /usr/local  </span><br><span class=\"line\">ADD apache-tomcat-9.0.8.tar.gz /usr.local  </span><br><span class=\"line\"># 安装vim编辑器  </span><br><span class=\"line\">RUN yum -y install vim  </span><br><span class=\"line\"># 设置工作访问时候的WORKDIR路径，登录落脚点  </span><br><span class=\"line\">ENV MYPATH /usr/local  </span><br><span class=\"line\">WORKDIR $MYPATH  </span><br><span class=\"line\"># 配置java与tomcat环境变量  </span><br><span class=\"line\">ENV JAVA_HOME /usr/local/jdk1.8.0_171  </span><br><span class=\"line\">ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar  </span><br><span class=\"line\">ENV CATALINA_HOME /usr/local/apache-tomcat-9.0.8  </span><br><span class=\"line\">ENV CATALINA_BASE /usr/local/apache-tomcat-9.0.8  </span><br><span class=\"line\">ENV PATH $PAHT:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin  </span><br><span class=\"line\"># 容器运行时监听的端口  </span><br><span class=\"line\">EXPOSE 8080  </span><br><span class=\"line\"># 启动时运行tomcat  </span><br><span class=\"line\"># ENTRYPOIN [&quot;usr/local/apache-tomcat-9.0.8/bin/startup.sh&quot;]  </span><br><span class=\"line\"># CMD [&quot;/usr/local/apache-tomcat-9.0.8/bin/catalina.hs&quot;,&quot;run&quot;]  </span><br><span class=\"line\">CMD /usr/lcoal/apache-tomcat-9.0.8/bin/startup.sh &amp;&amp; tail -F /usr/local/apache-tomcat-9.0.8/bin/logs/catailna.out</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run \\\\</span><br><span class=\"line\"></span><br><span class=\"line\">-d \\</span><br><span class=\"line\"></span><br><span class=\"line\">-p 6379:6379 \\\\</span><br><span class=\"line\"></span><br><span class=\"line\">--restart unless-stopped \\\\</span><br><span class=\"line\"></span><br><span class=\"line\">-v /home/memect/project/tools/mydata/redis/data:/data \\\\</span><br><span class=\"line\"></span><br><span class=\"line\">-v /home/memect/project/tools/mydata/redis/conf/redis.conf:/etc/redis/redis.conf \\\\</span><br><span class=\"line\"></span><br><span class=\"line\">redis-server /etc/redis/redis.conf \\\\</span><br><span class=\"line\"></span><br><span class=\"line\">redis</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -p 3306:3306 --name mysql8 -v /home/chenshuhang/tools/mysql/conf/my.cnf:/etc/mysql/my.cnf -v /home/chenshuhang/tools/mysql/conf:/etc/mysql/conf.d -v /home/chenshuhang/tools/mysql/logs:/logs -v /home/chenshuhang/tools/mysql/data:/var/lib/mysql -e MYSQL\\_ROOT\\_PASSWORD=123456 -d mysql:8.0</span><br><span class=\"line\"></span><br><span class=\"line\">docker run --name mysql -p 3306:3306 -e MYSQL\\_ROOT\\_PASSWORD=123456 -d mysql:8.0</span><br><span class=\"line\"></span><br><span class=\"line\">ALTER USER <span class=\"string\">&#x27;root&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class=\"string\">&#x27;123456&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">docker run -p 8848:8848 -v /home/memect/project/login\\_util:/code login\\_util</span><br><span class=\"line\"></span><br><span class=\"line\">sudo docker run -p 6379:6379 --name redis -v /home/memect/project/tools/myredis/conf/redis.conf:/etc/redis/redis.conf -v /home/memect/project/tools/myredis/data:/data -d redis redis-server /etc/redis/redis.conf --appendonly <span class=\"built_in\">yes</span></span><br></pre></td></tr></table></figure>\n\n<p>设置密码</p>\n<p>config set requirepass 123456</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d \\\\</span><br><span class=\"line\"></span><br><span class=\"line\">--name=kibana \\\\</span><br><span class=\"line\"></span><br><span class=\"line\">--restart=always \\\\</span><br><span class=\"line\"></span><br><span class=\"line\">-p 5601:5601 \\\\</span><br><span class=\"line\"></span><br><span class=\"line\">-v /opt/tools/kibana/config/kibana.yml:/usr/share/kibana/config/kibana.yml \\\\</span><br><span class=\"line\"></span><br><span class=\"line\">kibana:7.16.2</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -p 6379:6379 --name redis -v /home/memect/tools/redis/redis.conf:/etc/redis/redis.conf -v /home/memect/tools/redis/data:/data -d redis redis-server /etc/redis/redis.conf --appendonly yes</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -p 3308:3306 --name mysql57 -v /Users/mac/canal/mysql/conf/my.cnf:/etc/mysql/my.cnf -v /Users/mac/canal/mysql/logs:/logs -v /Users/mac/canal/mysql/data:/var/lib/mysql -e MYSQL\\_ROOT\\_PASSWORD=123456 -d mysql:5.7</span><br></pre></td></tr></table></figure>\n\n"},{"title":"jenkins安装","date":"2022-10-14T06:21:11.000Z","keywords":"jenkins","description":"jenkins安装","cover":"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg","top_img":"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg","_content":"\n# jenkins安装\n\n| 序号 | 环境准备 | 版本        |\n| ---- | -------- | ----------- |\n| 1    | jdk      | Jdk11       |\n| 2    | jenkins  | 2.346.1     |\n| 3    | Ubantu   | 20.04桌面版 |\n\n\n\n> 注意：jenkins安装时，jdk版本要与jenkins的版本匹配\n\njdk和jenkins对应的版本如下图所示：\n\n![image-20221014102439062](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221014102439062.png)\n\n在安装jenkins时的过程中得注意，在最新版本，也就是**2.361.1**这个版本中，jenkins的默认配置是jenkins用户（jenkins在安装的时候会自动创建一个名叫jenkins的用户），***这会导致在执行shell脚本命令，或者安装某些插件时，没有权限***，jenkins的配置文件所在地址/etc/default/jenkins，\n\n- Jenkins2.361.1的版本（截止2022.10.14最新的版本）\n\n  ```\n  JENKINS_USER=$NAME\n  JENKINS_GROUP=$NAME\n  ```\n\n- Jenkins2.346.1的版本\n\n  ```\n  JENKINS_USER=root\n  JENKINS_GROUP=root\n  ```\n\n- 2.346.1具体的配置信息如下：\n\n  ```\n  # defaults for Jenkins automation server\n  \n  # pulled in from the init script; makes things easier.\n  NAME=jenkins\n  \n  # arguments to pass to java\n  \n  # Allow graphs etc. to work even when an X server is present\n  JAVA_ARGS=\"-Djava.awt.headless=true\"\n  \n  #JAVA_ARGS=\"-Xmx256m\"\n  \n  # make jenkins listen on IPv4 address\n  #JAVA_ARGS=\"-Djava.net.preferIPv4Stack=true\"\n  \n  PIDFILE=/var/run/$NAME/$NAME.pid\n  \n  # user and group to be invoked as (default to jenkins)\n  JENKINS_USER=root\n  JENKINS_GROUP=root\n  \n  # location of the jenkins war file\n  JENKINS_WAR=/usr/share/java/$NAME.war\n  \n  # jenkins home location\n  JENKINS_HOME=/var/lib/$NAME\n  \n  # set this to false if you don't want Jenkins to run by itself\n  # in this set up, you are expected to provide a servlet container\n  # to host jenkins.\n  RUN_STANDALONE=true\n  \n  # log location.  this may be a syslog facility.priority\n  JENKINS_LOG=/var/log/$NAME/$NAME.log\n  #JENKINS_LOG=daemon.info\n  \n  # Whether to enable web access logging or not.\n  # Set to \"yes\" to enable logging to /var/log/$NAME/access_log\n  JENKINS_ENABLE_ACCESS_LOG=\"yes\"\n  \n  # OS LIMITS SETUP\n  #   comment this out to observe /etc/security/limits.conf\n  #   this is on by default because http://github.com/jenkinsci/jenkins/commit/2fb288474e980d0e7ff9c4a3b768874835a3e92e\n  #   reported that Ubuntu's PAM configuration doesn't include pam_limits.so, and as a result the # of file\n  #   descriptors are forced to 1024 regardless of /etc/security/limits.conf\n  MAXOPENFILES=8192\n  \n  # set the umask to control permission bits of files that Jenkins creates.\n  #   027 makes files read-only for group and inaccessible for others, which some security sensitive users\n  #   might consider benefitial, especially if Jenkins runs in a box that's used for multiple purposes.\n  #   Beware that 027 permission would interfere with sudo scripts that run on the master (JENKINS-25065.)\n  #\n  #   Note also that the particularly sensitive part of $JENKINS_HOME (such as credentials) are always\n  #   written without 'others' access. So the umask values only affect job configuration, build records,\n  #   that sort of things.\n  #\n  #   If commented out, the value from the OS is inherited,  which is normally 022 (as of Ubuntu 12.04,\n  #   by default umask comes from pam_umask(8) and /etc/login.defs\n  \n  # UMASK=027\n  \n  # port for HTTP connector (default 8080; disable with -1)\n  HTTP_PORT=8080\n  \n  \n  # servlet context, important if you want to use apache proxying\n  PREFIX=/$NAME\n  \n  # arguments to pass to jenkins.\n  # full list available from java -jar jenkins.war --help\n  # --javaHome=$JAVA_HOME\n  # --httpListenAddress=$HTTP_HOST (default 0.0.0.0)\n  # --httpPort=$HTTP_PORT (default 8080; disable with -1)\n  # --httpsPort=$HTTP_PORT\n  # --argumentsRealm.passwd.$ADMIN_USER=[password]\n  # --argumentsRealm.roles.$ADMIN_USER=admin\n  # --webroot=~/.jenkins/war\n  # --prefix=$PREFIX\n  \n  JENKINS_ARGS=\"--webroot=/var/cache/$NAME/war --httpPort=$HTTP_PORT\"\n  ```\n\n安装命令：\n\n```\ncurl -fsSL https://pkg.jenkins.io/debian-stable/jenkins.io.key | sudo tee \\\n    /usr/share/keyrings/jenkins-keyring.asc > /dev/null\n    \necho deb [signed-by=/usr/share/keyrings/jenkins-keyring.asc] \\\n    https://pkg.jenkins.io/debian-stable binary/ | sudo tee \\\n    /etc/apt/sources.list.d/jenkins.list > /dev/null\n\nsudo apt-get update\nsudo apt-get install fontconfig openjdk-11-jre\nsudo apt-get install jenkins==2.346.1\n```\n\n启动jenkins\n\n```\nsudo systemctl start jenkins\n```\n\n查看jenkins状态\n\n```\nsudo systemctl status jenkins\n```\n\n关闭jenkins\n\n```\nsudo systemctl stop jenkins\n```\n\n重启jenkins\n\n```\nsudo systemctl restart jenkins\n```\n\njenkins的访问网址，jenkins默认的端口是8080\n\nhttp://127.0.0.1:8080\n\n","source":"_posts/jenkins安装.md","raw":"---\ntitle: jenkins安装\ndate: 2022-10-14 14:21:11\ntags: jenkins\ncategories: 安装\nkeywords: jenkins\ndescription: jenkins安装\ncover: https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg\ntop_img: https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg\n---\n\n# jenkins安装\n\n| 序号 | 环境准备 | 版本        |\n| ---- | -------- | ----------- |\n| 1    | jdk      | Jdk11       |\n| 2    | jenkins  | 2.346.1     |\n| 3    | Ubantu   | 20.04桌面版 |\n\n\n\n> 注意：jenkins安装时，jdk版本要与jenkins的版本匹配\n\njdk和jenkins对应的版本如下图所示：\n\n![image-20221014102439062](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221014102439062.png)\n\n在安装jenkins时的过程中得注意，在最新版本，也就是**2.361.1**这个版本中，jenkins的默认配置是jenkins用户（jenkins在安装的时候会自动创建一个名叫jenkins的用户），***这会导致在执行shell脚本命令，或者安装某些插件时，没有权限***，jenkins的配置文件所在地址/etc/default/jenkins，\n\n- Jenkins2.361.1的版本（截止2022.10.14最新的版本）\n\n  ```\n  JENKINS_USER=$NAME\n  JENKINS_GROUP=$NAME\n  ```\n\n- Jenkins2.346.1的版本\n\n  ```\n  JENKINS_USER=root\n  JENKINS_GROUP=root\n  ```\n\n- 2.346.1具体的配置信息如下：\n\n  ```\n  # defaults for Jenkins automation server\n  \n  # pulled in from the init script; makes things easier.\n  NAME=jenkins\n  \n  # arguments to pass to java\n  \n  # Allow graphs etc. to work even when an X server is present\n  JAVA_ARGS=\"-Djava.awt.headless=true\"\n  \n  #JAVA_ARGS=\"-Xmx256m\"\n  \n  # make jenkins listen on IPv4 address\n  #JAVA_ARGS=\"-Djava.net.preferIPv4Stack=true\"\n  \n  PIDFILE=/var/run/$NAME/$NAME.pid\n  \n  # user and group to be invoked as (default to jenkins)\n  JENKINS_USER=root\n  JENKINS_GROUP=root\n  \n  # location of the jenkins war file\n  JENKINS_WAR=/usr/share/java/$NAME.war\n  \n  # jenkins home location\n  JENKINS_HOME=/var/lib/$NAME\n  \n  # set this to false if you don't want Jenkins to run by itself\n  # in this set up, you are expected to provide a servlet container\n  # to host jenkins.\n  RUN_STANDALONE=true\n  \n  # log location.  this may be a syslog facility.priority\n  JENKINS_LOG=/var/log/$NAME/$NAME.log\n  #JENKINS_LOG=daemon.info\n  \n  # Whether to enable web access logging or not.\n  # Set to \"yes\" to enable logging to /var/log/$NAME/access_log\n  JENKINS_ENABLE_ACCESS_LOG=\"yes\"\n  \n  # OS LIMITS SETUP\n  #   comment this out to observe /etc/security/limits.conf\n  #   this is on by default because http://github.com/jenkinsci/jenkins/commit/2fb288474e980d0e7ff9c4a3b768874835a3e92e\n  #   reported that Ubuntu's PAM configuration doesn't include pam_limits.so, and as a result the # of file\n  #   descriptors are forced to 1024 regardless of /etc/security/limits.conf\n  MAXOPENFILES=8192\n  \n  # set the umask to control permission bits of files that Jenkins creates.\n  #   027 makes files read-only for group and inaccessible for others, which some security sensitive users\n  #   might consider benefitial, especially if Jenkins runs in a box that's used for multiple purposes.\n  #   Beware that 027 permission would interfere with sudo scripts that run on the master (JENKINS-25065.)\n  #\n  #   Note also that the particularly sensitive part of $JENKINS_HOME (such as credentials) are always\n  #   written without 'others' access. So the umask values only affect job configuration, build records,\n  #   that sort of things.\n  #\n  #   If commented out, the value from the OS is inherited,  which is normally 022 (as of Ubuntu 12.04,\n  #   by default umask comes from pam_umask(8) and /etc/login.defs\n  \n  # UMASK=027\n  \n  # port for HTTP connector (default 8080; disable with -1)\n  HTTP_PORT=8080\n  \n  \n  # servlet context, important if you want to use apache proxying\n  PREFIX=/$NAME\n  \n  # arguments to pass to jenkins.\n  # full list available from java -jar jenkins.war --help\n  # --javaHome=$JAVA_HOME\n  # --httpListenAddress=$HTTP_HOST (default 0.0.0.0)\n  # --httpPort=$HTTP_PORT (default 8080; disable with -1)\n  # --httpsPort=$HTTP_PORT\n  # --argumentsRealm.passwd.$ADMIN_USER=[password]\n  # --argumentsRealm.roles.$ADMIN_USER=admin\n  # --webroot=~/.jenkins/war\n  # --prefix=$PREFIX\n  \n  JENKINS_ARGS=\"--webroot=/var/cache/$NAME/war --httpPort=$HTTP_PORT\"\n  ```\n\n安装命令：\n\n```\ncurl -fsSL https://pkg.jenkins.io/debian-stable/jenkins.io.key | sudo tee \\\n    /usr/share/keyrings/jenkins-keyring.asc > /dev/null\n    \necho deb [signed-by=/usr/share/keyrings/jenkins-keyring.asc] \\\n    https://pkg.jenkins.io/debian-stable binary/ | sudo tee \\\n    /etc/apt/sources.list.d/jenkins.list > /dev/null\n\nsudo apt-get update\nsudo apt-get install fontconfig openjdk-11-jre\nsudo apt-get install jenkins==2.346.1\n```\n\n启动jenkins\n\n```\nsudo systemctl start jenkins\n```\n\n查看jenkins状态\n\n```\nsudo systemctl status jenkins\n```\n\n关闭jenkins\n\n```\nsudo systemctl stop jenkins\n```\n\n重启jenkins\n\n```\nsudo systemctl restart jenkins\n```\n\njenkins的访问网址，jenkins默认的端口是8080\n\nhttp://127.0.0.1:8080\n\n","slug":"jenkins安装","published":1,"updated":"2022-10-16T06:16:50.196Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clg1mfus7000f27qgg76y684f","content":"<h1 id=\"jenkins安装\"><a href=\"#jenkins安装\" class=\"headerlink\" title=\"jenkins安装\"></a>jenkins安装</h1><table>\n<thead>\n<tr>\n<th>序号</th>\n<th>环境准备</th>\n<th>版本</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>jdk</td>\n<td>Jdk11</td>\n</tr>\n<tr>\n<td>2</td>\n<td>jenkins</td>\n<td>2.346.1</td>\n</tr>\n<tr>\n<td>3</td>\n<td>Ubantu</td>\n<td>20.04桌面版</td>\n</tr>\n</tbody></table>\n<blockquote>\n<p>注意：jenkins安装时，jdk版本要与jenkins的版本匹配</p>\n</blockquote>\n<p>jdk和jenkins对应的版本如下图所示：</p>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221014102439062.png\" alt=\"image-20221014102439062\"></p>\n<p>在安装jenkins时的过程中得注意，在最新版本，也就是<strong>2.361.1</strong>这个版本中，jenkins的默认配置是jenkins用户（jenkins在安装的时候会自动创建一个名叫jenkins的用户），<em><strong>这会导致在执行shell脚本命令，或者安装某些插件时，没有权限</strong></em>，jenkins的配置文件所在地址&#x2F;etc&#x2F;default&#x2F;jenkins，</p>\n<ul>\n<li><p>Jenkins2.361.1的版本（截止2022.10.14最新的版本）</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">JENKINS_USER=$NAME</span><br><span class=\"line\">JENKINS_GROUP=$NAME</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Jenkins2.346.1的版本</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">JENKINS_USER=root</span><br><span class=\"line\">JENKINS_GROUP=root</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>2.346.1具体的配置信息如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># defaults for Jenkins automation server</span><br><span class=\"line\"></span><br><span class=\"line\"># pulled in from the init script; makes things easier.</span><br><span class=\"line\">NAME=jenkins</span><br><span class=\"line\"></span><br><span class=\"line\"># arguments to pass to java</span><br><span class=\"line\"></span><br><span class=\"line\"># Allow graphs etc. to work even when an X server is present</span><br><span class=\"line\">JAVA_ARGS=&quot;-Djava.awt.headless=true&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">#JAVA_ARGS=&quot;-Xmx256m&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># make jenkins listen on IPv4 address</span><br><span class=\"line\">#JAVA_ARGS=&quot;-Djava.net.preferIPv4Stack=true&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">PIDFILE=/var/run/$NAME/$NAME.pid</span><br><span class=\"line\"></span><br><span class=\"line\"># user and group to be invoked as (default to jenkins)</span><br><span class=\"line\">JENKINS_USER=root</span><br><span class=\"line\">JENKINS_GROUP=root</span><br><span class=\"line\"></span><br><span class=\"line\"># location of the jenkins war file</span><br><span class=\"line\">JENKINS_WAR=/usr/share/java/$NAME.war</span><br><span class=\"line\"></span><br><span class=\"line\"># jenkins home location</span><br><span class=\"line\">JENKINS_HOME=/var/lib/$NAME</span><br><span class=\"line\"></span><br><span class=\"line\"># set this to false if you don&#x27;t want Jenkins to run by itself</span><br><span class=\"line\"># in this set up, you are expected to provide a servlet container</span><br><span class=\"line\"># to host jenkins.</span><br><span class=\"line\">RUN_STANDALONE=true</span><br><span class=\"line\"></span><br><span class=\"line\"># log location.  this may be a syslog facility.priority</span><br><span class=\"line\">JENKINS_LOG=/var/log/$NAME/$NAME.log</span><br><span class=\"line\">#JENKINS_LOG=daemon.info</span><br><span class=\"line\"></span><br><span class=\"line\"># Whether to enable web access logging or not.</span><br><span class=\"line\"># Set to &quot;yes&quot; to enable logging to /var/log/$NAME/access_log</span><br><span class=\"line\">JENKINS_ENABLE_ACCESS_LOG=&quot;yes&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># OS LIMITS SETUP</span><br><span class=\"line\">#   comment this out to observe /etc/security/limits.conf</span><br><span class=\"line\">#   this is on by default because http://github.com/jenkinsci/jenkins/commit/2fb288474e980d0e7ff9c4a3b768874835a3e92e</span><br><span class=\"line\">#   reported that Ubuntu&#x27;s PAM configuration doesn&#x27;t include pam_limits.so, and as a result the # of file</span><br><span class=\"line\">#   descriptors are forced to 1024 regardless of /etc/security/limits.conf</span><br><span class=\"line\">MAXOPENFILES=8192</span><br><span class=\"line\"></span><br><span class=\"line\"># set the umask to control permission bits of files that Jenkins creates.</span><br><span class=\"line\">#   027 makes files read-only for group and inaccessible for others, which some security sensitive users</span><br><span class=\"line\">#   might consider benefitial, especially if Jenkins runs in a box that&#x27;s used for multiple purposes.</span><br><span class=\"line\">#   Beware that 027 permission would interfere with sudo scripts that run on the master (JENKINS-25065.)</span><br><span class=\"line\">#</span><br><span class=\"line\">#   Note also that the particularly sensitive part of $JENKINS_HOME (such as credentials) are always</span><br><span class=\"line\">#   written without &#x27;others&#x27; access. So the umask values only affect job configuration, build records,</span><br><span class=\"line\">#   that sort of things.</span><br><span class=\"line\">#</span><br><span class=\"line\">#   If commented out, the value from the OS is inherited,  which is normally 022 (as of Ubuntu 12.04,</span><br><span class=\"line\">#   by default umask comes from pam_umask(8) and /etc/login.defs</span><br><span class=\"line\"></span><br><span class=\"line\"># UMASK=027</span><br><span class=\"line\"></span><br><span class=\"line\"># port for HTTP connector (default 8080; disable with -1)</span><br><span class=\"line\">HTTP_PORT=8080</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># servlet context, important if you want to use apache proxying</span><br><span class=\"line\">PREFIX=/$NAME</span><br><span class=\"line\"></span><br><span class=\"line\"># arguments to pass to jenkins.</span><br><span class=\"line\"># full list available from java -jar jenkins.war --help</span><br><span class=\"line\"># --javaHome=$JAVA_HOME</span><br><span class=\"line\"># --httpListenAddress=$HTTP_HOST (default 0.0.0.0)</span><br><span class=\"line\"># --httpPort=$HTTP_PORT (default 8080; disable with -1)</span><br><span class=\"line\"># --httpsPort=$HTTP_PORT</span><br><span class=\"line\"># --argumentsRealm.passwd.$ADMIN_USER=[password]</span><br><span class=\"line\"># --argumentsRealm.roles.$ADMIN_USER=admin</span><br><span class=\"line\"># --webroot=~/.jenkins/war</span><br><span class=\"line\"># --prefix=$PREFIX</span><br><span class=\"line\"></span><br><span class=\"line\">JENKINS_ARGS=&quot;--webroot=/var/cache/$NAME/war --httpPort=$HTTP_PORT&quot;</span><br></pre></td></tr></table></figure></li>\n</ul>\n<p>安装命令：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -fsSL https://pkg.jenkins.io/debian-stable/jenkins.io.key | sudo tee \\</span><br><span class=\"line\">    /usr/share/keyrings/jenkins-keyring.asc &gt; /dev/null</span><br><span class=\"line\">    </span><br><span class=\"line\">echo deb [signed-by=/usr/share/keyrings/jenkins-keyring.asc] \\</span><br><span class=\"line\">    https://pkg.jenkins.io/debian-stable binary/ | sudo tee \\</span><br><span class=\"line\">    /etc/apt/sources.list.d/jenkins.list &gt; /dev/null</span><br><span class=\"line\"></span><br><span class=\"line\">sudo apt-get update</span><br><span class=\"line\">sudo apt-get install fontconfig openjdk-11-jre</span><br><span class=\"line\">sudo apt-get install jenkins==2.346.1</span><br></pre></td></tr></table></figure>\n\n<p>启动jenkins</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl start jenkins</span><br></pre></td></tr></table></figure>\n\n<p>查看jenkins状态</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl status jenkins</span><br></pre></td></tr></table></figure>\n\n<p>关闭jenkins</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl stop jenkins</span><br></pre></td></tr></table></figure>\n\n<p>重启jenkins</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl restart jenkins</span><br></pre></td></tr></table></figure>\n\n<p>jenkins的访问网址，jenkins默认的端口是8080</p>\n<p><a href=\"http://127.0.0.1:8080/\">http://127.0.0.1:8080</a></p>\n","site":{"data":{"link":[{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"动漫图片和壁纸","link":"https://anime-pictures.net/?lang=zh_CN","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"图片网站"},{"name":"Wallhaven","link":"https://wallhaven.cc/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"4k图片网站"},{"name":"WALLPAPER ABYSS","link":"https://wall.alphacoders.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"WALLPAPER ABYSS"},{"name":"极简壁纸","link":"https://bz.zzzmh.cn/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"极简壁纸"},{"name":"Wallroom","link":"https://wallroom.io/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"Wallroom"}]}]}},"excerpt":"","more":"<h1 id=\"jenkins安装\"><a href=\"#jenkins安装\" class=\"headerlink\" title=\"jenkins安装\"></a>jenkins安装</h1><table>\n<thead>\n<tr>\n<th>序号</th>\n<th>环境准备</th>\n<th>版本</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>jdk</td>\n<td>Jdk11</td>\n</tr>\n<tr>\n<td>2</td>\n<td>jenkins</td>\n<td>2.346.1</td>\n</tr>\n<tr>\n<td>3</td>\n<td>Ubantu</td>\n<td>20.04桌面版</td>\n</tr>\n</tbody></table>\n<blockquote>\n<p>注意：jenkins安装时，jdk版本要与jenkins的版本匹配</p>\n</blockquote>\n<p>jdk和jenkins对应的版本如下图所示：</p>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221014102439062.png\" alt=\"image-20221014102439062\"></p>\n<p>在安装jenkins时的过程中得注意，在最新版本，也就是<strong>2.361.1</strong>这个版本中，jenkins的默认配置是jenkins用户（jenkins在安装的时候会自动创建一个名叫jenkins的用户），<em><strong>这会导致在执行shell脚本命令，或者安装某些插件时，没有权限</strong></em>，jenkins的配置文件所在地址&#x2F;etc&#x2F;default&#x2F;jenkins，</p>\n<ul>\n<li><p>Jenkins2.361.1的版本（截止2022.10.14最新的版本）</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">JENKINS_USER=$NAME</span><br><span class=\"line\">JENKINS_GROUP=$NAME</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Jenkins2.346.1的版本</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">JENKINS_USER=root</span><br><span class=\"line\">JENKINS_GROUP=root</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>2.346.1具体的配置信息如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># defaults for Jenkins automation server</span><br><span class=\"line\"></span><br><span class=\"line\"># pulled in from the init script; makes things easier.</span><br><span class=\"line\">NAME=jenkins</span><br><span class=\"line\"></span><br><span class=\"line\"># arguments to pass to java</span><br><span class=\"line\"></span><br><span class=\"line\"># Allow graphs etc. to work even when an X server is present</span><br><span class=\"line\">JAVA_ARGS=&quot;-Djava.awt.headless=true&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">#JAVA_ARGS=&quot;-Xmx256m&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># make jenkins listen on IPv4 address</span><br><span class=\"line\">#JAVA_ARGS=&quot;-Djava.net.preferIPv4Stack=true&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">PIDFILE=/var/run/$NAME/$NAME.pid</span><br><span class=\"line\"></span><br><span class=\"line\"># user and group to be invoked as (default to jenkins)</span><br><span class=\"line\">JENKINS_USER=root</span><br><span class=\"line\">JENKINS_GROUP=root</span><br><span class=\"line\"></span><br><span class=\"line\"># location of the jenkins war file</span><br><span class=\"line\">JENKINS_WAR=/usr/share/java/$NAME.war</span><br><span class=\"line\"></span><br><span class=\"line\"># jenkins home location</span><br><span class=\"line\">JENKINS_HOME=/var/lib/$NAME</span><br><span class=\"line\"></span><br><span class=\"line\"># set this to false if you don&#x27;t want Jenkins to run by itself</span><br><span class=\"line\"># in this set up, you are expected to provide a servlet container</span><br><span class=\"line\"># to host jenkins.</span><br><span class=\"line\">RUN_STANDALONE=true</span><br><span class=\"line\"></span><br><span class=\"line\"># log location.  this may be a syslog facility.priority</span><br><span class=\"line\">JENKINS_LOG=/var/log/$NAME/$NAME.log</span><br><span class=\"line\">#JENKINS_LOG=daemon.info</span><br><span class=\"line\"></span><br><span class=\"line\"># Whether to enable web access logging or not.</span><br><span class=\"line\"># Set to &quot;yes&quot; to enable logging to /var/log/$NAME/access_log</span><br><span class=\"line\">JENKINS_ENABLE_ACCESS_LOG=&quot;yes&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># OS LIMITS SETUP</span><br><span class=\"line\">#   comment this out to observe /etc/security/limits.conf</span><br><span class=\"line\">#   this is on by default because http://github.com/jenkinsci/jenkins/commit/2fb288474e980d0e7ff9c4a3b768874835a3e92e</span><br><span class=\"line\">#   reported that Ubuntu&#x27;s PAM configuration doesn&#x27;t include pam_limits.so, and as a result the # of file</span><br><span class=\"line\">#   descriptors are forced to 1024 regardless of /etc/security/limits.conf</span><br><span class=\"line\">MAXOPENFILES=8192</span><br><span class=\"line\"></span><br><span class=\"line\"># set the umask to control permission bits of files that Jenkins creates.</span><br><span class=\"line\">#   027 makes files read-only for group and inaccessible for others, which some security sensitive users</span><br><span class=\"line\">#   might consider benefitial, especially if Jenkins runs in a box that&#x27;s used for multiple purposes.</span><br><span class=\"line\">#   Beware that 027 permission would interfere with sudo scripts that run on the master (JENKINS-25065.)</span><br><span class=\"line\">#</span><br><span class=\"line\">#   Note also that the particularly sensitive part of $JENKINS_HOME (such as credentials) are always</span><br><span class=\"line\">#   written without &#x27;others&#x27; access. So the umask values only affect job configuration, build records,</span><br><span class=\"line\">#   that sort of things.</span><br><span class=\"line\">#</span><br><span class=\"line\">#   If commented out, the value from the OS is inherited,  which is normally 022 (as of Ubuntu 12.04,</span><br><span class=\"line\">#   by default umask comes from pam_umask(8) and /etc/login.defs</span><br><span class=\"line\"></span><br><span class=\"line\"># UMASK=027</span><br><span class=\"line\"></span><br><span class=\"line\"># port for HTTP connector (default 8080; disable with -1)</span><br><span class=\"line\">HTTP_PORT=8080</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># servlet context, important if you want to use apache proxying</span><br><span class=\"line\">PREFIX=/$NAME</span><br><span class=\"line\"></span><br><span class=\"line\"># arguments to pass to jenkins.</span><br><span class=\"line\"># full list available from java -jar jenkins.war --help</span><br><span class=\"line\"># --javaHome=$JAVA_HOME</span><br><span class=\"line\"># --httpListenAddress=$HTTP_HOST (default 0.0.0.0)</span><br><span class=\"line\"># --httpPort=$HTTP_PORT (default 8080; disable with -1)</span><br><span class=\"line\"># --httpsPort=$HTTP_PORT</span><br><span class=\"line\"># --argumentsRealm.passwd.$ADMIN_USER=[password]</span><br><span class=\"line\"># --argumentsRealm.roles.$ADMIN_USER=admin</span><br><span class=\"line\"># --webroot=~/.jenkins/war</span><br><span class=\"line\"># --prefix=$PREFIX</span><br><span class=\"line\"></span><br><span class=\"line\">JENKINS_ARGS=&quot;--webroot=/var/cache/$NAME/war --httpPort=$HTTP_PORT&quot;</span><br></pre></td></tr></table></figure></li>\n</ul>\n<p>安装命令：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -fsSL https://pkg.jenkins.io/debian-stable/jenkins.io.key | sudo tee \\</span><br><span class=\"line\">    /usr/share/keyrings/jenkins-keyring.asc &gt; /dev/null</span><br><span class=\"line\">    </span><br><span class=\"line\">echo deb [signed-by=/usr/share/keyrings/jenkins-keyring.asc] \\</span><br><span class=\"line\">    https://pkg.jenkins.io/debian-stable binary/ | sudo tee \\</span><br><span class=\"line\">    /etc/apt/sources.list.d/jenkins.list &gt; /dev/null</span><br><span class=\"line\"></span><br><span class=\"line\">sudo apt-get update</span><br><span class=\"line\">sudo apt-get install fontconfig openjdk-11-jre</span><br><span class=\"line\">sudo apt-get install jenkins==2.346.1</span><br></pre></td></tr></table></figure>\n\n<p>启动jenkins</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl start jenkins</span><br></pre></td></tr></table></figure>\n\n<p>查看jenkins状态</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl status jenkins</span><br></pre></td></tr></table></figure>\n\n<p>关闭jenkins</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl stop jenkins</span><br></pre></td></tr></table></figure>\n\n<p>重启jenkins</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo systemctl restart jenkins</span><br></pre></td></tr></table></figure>\n\n<p>jenkins的访问网址，jenkins默认的端口是8080</p>\n<p><a href=\"http://127.0.0.1:8080/\">http://127.0.0.1:8080</a></p>\n"},{"title":"Vue学习","date":"2021-10-17T07:31:01.000Z","keywords":"vue","description":"Vue的学习笔记","cover":"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg","top_img":"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg","_content":"\n# Vue学习\n\n# 1.Vue是什么？\n\n一套用于构建用户界面的渐进式JavaScript框架，vue可以自底向上逐层应用。\n\n简单应用：只需一个轻量小巧的核心库\n\n复杂应用：可以引用各式各样的Vue插件\n\n# 2.Vue特点\n\n1.  采用组件化模式，提高代码复用率、且让代码更好维护。\n\n2.  声明式编码，让编码人员无需直接操作DOM，提高开发效率。&nbsp;\n\n3.  使用虚拟DOM+优秀的Diff算法，尽量服用Dom节点。\n\n# 3.学习Vue\n\n## 3.1初识Vue\n\n1.  想让Vue工作，就必须创建一个vue实例，且要传入一个配置对象。\n\n2.  root容器里的代码依然符合html规范，只不过混入了一些特殊的Vue语法&nbsp;\n\n3.  root容器里的代码被称为【Vue模板】\n\n4.  Vue实例和容器是一一对应的&nbsp;\n\n5.  真实开发中只有一个Vue实例，并且会配合着组件一起使用\n\n6.  {{xxx}}中的xxx要写进js表达式，且xxx可以自动读取到data中的所有属性&nbsp;\n\n7.  一旦data中的数据发生改变，那么页面中用到该数据的地方也会自动更新\n\n8.  注意区分：1.js表达式 和 js代码（语句）\n\n    1.  表达式：一个表达式会产生一个值，可以放在任何一个需要值的地方\n\n        1.  a\n\n        2.  a+b&nbsp;\n\n        3.  demo(1)\n\n        4.  x === y? 'a' : 'b'&nbsp;\n\n    2.  js代码（语句）\n\n        1.  if(){}\n\n        2.  for(){}\n\n## 3.2模板语法\n\n### 3.2.1插值语法\n\n功能：用于解析标签体内容\n\n写法：{{xxx}}，xxx是js表达式，且可以直接读取到data中所有属性。\n\n### 3.2.1指令语法\n\n功能：用于解析标签（包括：标签属性、标签体内容、绑定时间。。。。）\n\n举例：v-bind:href=\"xxx\" 或 简写为:href=\"xxx\"，xxx同样要写js表达式。且可以直接读取到data中的所有属性。\n\n备注：Vue中有很多的指令，且形式都是：v-???，此处我们只是拿v-bind举个例子。\n\n## 3.3数据绑定\n\n1.  单项绑定（v-bind）：数据只能从data流向页面\n\n2.  双向绑定（v-model）：数据不仅能从data流向页面，还可以从页面流向data。&nbsp;\n\n3.  备注：\n\n    1.  1.双向绑定一般都应用在表单元素上（如：input、select等）\n\n    2.  2.v-model:value 可以简写为v-model，因为v-model默认收集的就是value值\n\n## 3.4data与el的两种写法\n\n1.  el有两种写法\n\n    1.  new Vue时配置el属性\n\n    2.  先创建Vue实例，随后再通过vm.\\$mount('\\#root')指定el的值。&nbsp;\n\n2.  data的两种写法\n\n    1.  对象式\n\n    2.  函数式&nbsp;\n\n    3.  如何选择，目前哪种写法都可以，以后学习到组件时，data必须使用函数式，否则会报错。&nbsp;\n\n3.  一个重要的原则：\n\n    1.  由Vue管理的函数，一定不要写箭头函数，一旦写了箭头函数，this就不在是Vue的实例了\n\n## 3.5MVVM模型\n\n1.  M：模型（Model）：data中的数据\n\n2.  V：视图（View）：模板代码&nbsp;\n\n3.  VM：视图模型（ViewModel）：Vue实例\n\n4.  观察发现：\n\n    1.  data中所有的属性，最后都出现在vm身上\n\n    2.  vm身上所有的属性，及Vue原型上所有的属性，在Vue模板中都可以直接使用。\n","source":"_posts/Vue学习.md","raw":"---\ntitle: Vue学习\ndate: 2021-10-17 15:31:01\ntags: vue\ncategories: 学习\nkeywords: vue\ndescription: Vue的学习笔记\ncover: https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg\ntop_img: https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg\n---\n\n# Vue学习\n\n# 1.Vue是什么？\n\n一套用于构建用户界面的渐进式JavaScript框架，vue可以自底向上逐层应用。\n\n简单应用：只需一个轻量小巧的核心库\n\n复杂应用：可以引用各式各样的Vue插件\n\n# 2.Vue特点\n\n1.  采用组件化模式，提高代码复用率、且让代码更好维护。\n\n2.  声明式编码，让编码人员无需直接操作DOM，提高开发效率。&nbsp;\n\n3.  使用虚拟DOM+优秀的Diff算法，尽量服用Dom节点。\n\n# 3.学习Vue\n\n## 3.1初识Vue\n\n1.  想让Vue工作，就必须创建一个vue实例，且要传入一个配置对象。\n\n2.  root容器里的代码依然符合html规范，只不过混入了一些特殊的Vue语法&nbsp;\n\n3.  root容器里的代码被称为【Vue模板】\n\n4.  Vue实例和容器是一一对应的&nbsp;\n\n5.  真实开发中只有一个Vue实例，并且会配合着组件一起使用\n\n6.  {{xxx}}中的xxx要写进js表达式，且xxx可以自动读取到data中的所有属性&nbsp;\n\n7.  一旦data中的数据发生改变，那么页面中用到该数据的地方也会自动更新\n\n8.  注意区分：1.js表达式 和 js代码（语句）\n\n    1.  表达式：一个表达式会产生一个值，可以放在任何一个需要值的地方\n\n        1.  a\n\n        2.  a+b&nbsp;\n\n        3.  demo(1)\n\n        4.  x === y? 'a' : 'b'&nbsp;\n\n    2.  js代码（语句）\n\n        1.  if(){}\n\n        2.  for(){}\n\n## 3.2模板语法\n\n### 3.2.1插值语法\n\n功能：用于解析标签体内容\n\n写法：{{xxx}}，xxx是js表达式，且可以直接读取到data中所有属性。\n\n### 3.2.1指令语法\n\n功能：用于解析标签（包括：标签属性、标签体内容、绑定时间。。。。）\n\n举例：v-bind:href=\"xxx\" 或 简写为:href=\"xxx\"，xxx同样要写js表达式。且可以直接读取到data中的所有属性。\n\n备注：Vue中有很多的指令，且形式都是：v-???，此处我们只是拿v-bind举个例子。\n\n## 3.3数据绑定\n\n1.  单项绑定（v-bind）：数据只能从data流向页面\n\n2.  双向绑定（v-model）：数据不仅能从data流向页面，还可以从页面流向data。&nbsp;\n\n3.  备注：\n\n    1.  1.双向绑定一般都应用在表单元素上（如：input、select等）\n\n    2.  2.v-model:value 可以简写为v-model，因为v-model默认收集的就是value值\n\n## 3.4data与el的两种写法\n\n1.  el有两种写法\n\n    1.  new Vue时配置el属性\n\n    2.  先创建Vue实例，随后再通过vm.\\$mount('\\#root')指定el的值。&nbsp;\n\n2.  data的两种写法\n\n    1.  对象式\n\n    2.  函数式&nbsp;\n\n    3.  如何选择，目前哪种写法都可以，以后学习到组件时，data必须使用函数式，否则会报错。&nbsp;\n\n3.  一个重要的原则：\n\n    1.  由Vue管理的函数，一定不要写箭头函数，一旦写了箭头函数，this就不在是Vue的实例了\n\n## 3.5MVVM模型\n\n1.  M：模型（Model）：data中的数据\n\n2.  V：视图（View）：模板代码&nbsp;\n\n3.  VM：视图模型（ViewModel）：Vue实例\n\n4.  观察发现：\n\n    1.  data中所有的属性，最后都出现在vm身上\n\n    2.  vm身上所有的属性，及Vue原型上所有的属性，在Vue模板中都可以直接使用。\n","slug":"Vue学习","published":1,"updated":"2022-10-09T08:58:09.722Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clg1mfus9000k27qg7agw72xm","content":"<h1 id=\"Vue学习\"><a href=\"#Vue学习\" class=\"headerlink\" title=\"Vue学习\"></a>Vue学习</h1><h1 id=\"1-Vue是什么？\"><a href=\"#1-Vue是什么？\" class=\"headerlink\" title=\"1.Vue是什么？\"></a>1.Vue是什么？</h1><p>一套用于构建用户界面的渐进式JavaScript框架，vue可以自底向上逐层应用。</p>\n<p>简单应用：只需一个轻量小巧的核心库</p>\n<p>复杂应用：可以引用各式各样的Vue插件</p>\n<h1 id=\"2-Vue特点\"><a href=\"#2-Vue特点\" class=\"headerlink\" title=\"2.Vue特点\"></a>2.Vue特点</h1><ol>\n<li><p>采用组件化模式，提高代码复用率、且让代码更好维护。</p>\n</li>\n<li><p>声明式编码，让编码人员无需直接操作DOM，提高开发效率。&amp;nbsp;</p>\n</li>\n<li><p>使用虚拟DOM+优秀的Diff算法，尽量服用Dom节点。</p>\n</li>\n</ol>\n<h1 id=\"3-学习Vue\"><a href=\"#3-学习Vue\" class=\"headerlink\" title=\"3.学习Vue\"></a>3.学习Vue</h1><h2 id=\"3-1初识Vue\"><a href=\"#3-1初识Vue\" class=\"headerlink\" title=\"3.1初识Vue\"></a>3.1初识Vue</h2><ol>\n<li><p>想让Vue工作，就必须创建一个vue实例，且要传入一个配置对象。</p>\n</li>\n<li><p>root容器里的代码依然符合html规范，只不过混入了一些特殊的Vue语法&amp;nbsp;</p>\n</li>\n<li><p>root容器里的代码被称为【Vue模板】</p>\n</li>\n<li><p>Vue实例和容器是一一对应的&amp;nbsp;</p>\n</li>\n<li><p>真实开发中只有一个Vue实例，并且会配合着组件一起使用</p>\n</li>\n<li>中的xxx要写进js表达式，且xxx可以自动读取到data中的所有属性&nbsp;\n</li>\n<li><p>一旦data中的数据发生改变，那么页面中用到该数据的地方也会自动更新</p>\n</li>\n<li><p>注意区分：1.js表达式 和 js代码（语句）</p>\n<ol>\n<li><p>表达式：一个表达式会产生一个值，可以放在任何一个需要值的地方</p>\n<ol>\n<li><p>a</p>\n</li>\n<li><p>a+b&amp;nbsp;</p>\n</li>\n<li><p>demo(1)</p>\n</li>\n<li><p>x &#x3D;&#x3D;&#x3D; y? ‘a’ : ‘b’&amp;nbsp;</p>\n</li>\n</ol>\n</li>\n<li><p>js代码（语句）</p>\n<ol>\n<li><p>if(){}</p>\n</li>\n<li><p>for(){}</p>\n</li>\n</ol>\n</li>\n</ol>\n</li>\n</ol>\n<h2 id=\"3-2模板语法\"><a href=\"#3-2模板语法\" class=\"headerlink\" title=\"3.2模板语法\"></a>3.2模板语法</h2><h3 id=\"3-2-1插值语法\"><a href=\"#3-2-1插值语法\" class=\"headerlink\" title=\"3.2.1插值语法\"></a>3.2.1插值语法</h3><p>功能：用于解析标签体内容</p>\n<p>写法：，xxx是js表达式，且可以直接读取到data中所有属性。</p>\n<h3 id=\"3-2-1指令语法\"><a href=\"#3-2-1指令语法\" class=\"headerlink\" title=\"3.2.1指令语法\"></a>3.2.1指令语法</h3><p>功能：用于解析标签（包括：标签属性、标签体内容、绑定时间。。。。）</p>\n<p>举例：v-bind:href&#x3D;”xxx” 或 简写为:href&#x3D;”xxx”，xxx同样要写js表达式。且可以直接读取到data中的所有属性。</p>\n<p>备注：Vue中有很多的指令，且形式都是：v-???，此处我们只是拿v-bind举个例子。</p>\n<h2 id=\"3-3数据绑定\"><a href=\"#3-3数据绑定\" class=\"headerlink\" title=\"3.3数据绑定\"></a>3.3数据绑定</h2><ol>\n<li><p>单项绑定（v-bind）：数据只能从data流向页面</p>\n</li>\n<li><p>双向绑定（v-model）：数据不仅能从data流向页面，还可以从页面流向data。&amp;nbsp;</p>\n</li>\n<li><p>备注：</p>\n<ol>\n<li><p>1.双向绑定一般都应用在表单元素上（如：input、select等）</p>\n</li>\n<li><p>2.v-model:value 可以简写为v-model，因为v-model默认收集的就是value值</p>\n</li>\n</ol>\n</li>\n</ol>\n<h2 id=\"3-4data与el的两种写法\"><a href=\"#3-4data与el的两种写法\" class=\"headerlink\" title=\"3.4data与el的两种写法\"></a>3.4data与el的两种写法</h2><ol>\n<li><p>el有两种写法</p>\n<ol>\n<li><p>new Vue时配置el属性</p>\n</li>\n<li><p>先创建Vue实例，随后再通过vm.$mount(‘#root’)指定el的值。&amp;nbsp;</p>\n</li>\n</ol>\n</li>\n<li><p>data的两种写法</p>\n<ol>\n<li><p>对象式</p>\n</li>\n<li><p>函数式&amp;nbsp;</p>\n</li>\n<li><p>如何选择，目前哪种写法都可以，以后学习到组件时，data必须使用函数式，否则会报错。&amp;nbsp;</p>\n</li>\n</ol>\n</li>\n<li><p>一个重要的原则：</p>\n<ol>\n<li>由Vue管理的函数，一定不要写箭头函数，一旦写了箭头函数，this就不在是Vue的实例了</li>\n</ol>\n</li>\n</ol>\n<h2 id=\"3-5MVVM模型\"><a href=\"#3-5MVVM模型\" class=\"headerlink\" title=\"3.5MVVM模型\"></a>3.5MVVM模型</h2><ol>\n<li><p>M：模型（Model）：data中的数据</p>\n</li>\n<li><p>V：视图（View）：模板代码&amp;nbsp;</p>\n</li>\n<li><p>VM：视图模型（ViewModel）：Vue实例</p>\n</li>\n<li><p>观察发现：</p>\n<ol>\n<li><p>data中所有的属性，最后都出现在vm身上</p>\n</li>\n<li><p>vm身上所有的属性，及Vue原型上所有的属性，在Vue模板中都可以直接使用。</p>\n</li>\n</ol>\n</li>\n</ol>\n","site":{"data":{"link":[{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"动漫图片和壁纸","link":"https://anime-pictures.net/?lang=zh_CN","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"图片网站"},{"name":"Wallhaven","link":"https://wallhaven.cc/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"4k图片网站"},{"name":"WALLPAPER ABYSS","link":"https://wall.alphacoders.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"WALLPAPER ABYSS"},{"name":"极简壁纸","link":"https://bz.zzzmh.cn/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"极简壁纸"},{"name":"Wallroom","link":"https://wallroom.io/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"Wallroom"}]}]}},"excerpt":"","more":"<h1 id=\"Vue学习\"><a href=\"#Vue学习\" class=\"headerlink\" title=\"Vue学习\"></a>Vue学习</h1><h1 id=\"1-Vue是什么？\"><a href=\"#1-Vue是什么？\" class=\"headerlink\" title=\"1.Vue是什么？\"></a>1.Vue是什么？</h1><p>一套用于构建用户界面的渐进式JavaScript框架，vue可以自底向上逐层应用。</p>\n<p>简单应用：只需一个轻量小巧的核心库</p>\n<p>复杂应用：可以引用各式各样的Vue插件</p>\n<h1 id=\"2-Vue特点\"><a href=\"#2-Vue特点\" class=\"headerlink\" title=\"2.Vue特点\"></a>2.Vue特点</h1><ol>\n<li><p>采用组件化模式，提高代码复用率、且让代码更好维护。</p>\n</li>\n<li><p>声明式编码，让编码人员无需直接操作DOM，提高开发效率。&amp;nbsp;</p>\n</li>\n<li><p>使用虚拟DOM+优秀的Diff算法，尽量服用Dom节点。</p>\n</li>\n</ol>\n<h1 id=\"3-学习Vue\"><a href=\"#3-学习Vue\" class=\"headerlink\" title=\"3.学习Vue\"></a>3.学习Vue</h1><h2 id=\"3-1初识Vue\"><a href=\"#3-1初识Vue\" class=\"headerlink\" title=\"3.1初识Vue\"></a>3.1初识Vue</h2><ol>\n<li><p>想让Vue工作，就必须创建一个vue实例，且要传入一个配置对象。</p>\n</li>\n<li><p>root容器里的代码依然符合html规范，只不过混入了一些特殊的Vue语法&amp;nbsp;</p>\n</li>\n<li><p>root容器里的代码被称为【Vue模板】</p>\n</li>\n<li><p>Vue实例和容器是一一对应的&amp;nbsp;</p>\n</li>\n<li><p>真实开发中只有一个Vue实例，并且会配合着组件一起使用</p>\n</li>\n<li>中的xxx要写进js表达式，且xxx可以自动读取到data中的所有属性&nbsp;\n</li>\n<li><p>一旦data中的数据发生改变，那么页面中用到该数据的地方也会自动更新</p>\n</li>\n<li><p>注意区分：1.js表达式 和 js代码（语句）</p>\n<ol>\n<li><p>表达式：一个表达式会产生一个值，可以放在任何一个需要值的地方</p>\n<ol>\n<li><p>a</p>\n</li>\n<li><p>a+b&amp;nbsp;</p>\n</li>\n<li><p>demo(1)</p>\n</li>\n<li><p>x &#x3D;&#x3D;&#x3D; y? ‘a’ : ‘b’&amp;nbsp;</p>\n</li>\n</ol>\n</li>\n<li><p>js代码（语句）</p>\n<ol>\n<li><p>if(){}</p>\n</li>\n<li><p>for(){}</p>\n</li>\n</ol>\n</li>\n</ol>\n</li>\n</ol>\n<h2 id=\"3-2模板语法\"><a href=\"#3-2模板语法\" class=\"headerlink\" title=\"3.2模板语法\"></a>3.2模板语法</h2><h3 id=\"3-2-1插值语法\"><a href=\"#3-2-1插值语法\" class=\"headerlink\" title=\"3.2.1插值语法\"></a>3.2.1插值语法</h3><p>功能：用于解析标签体内容</p>\n<p>写法：，xxx是js表达式，且可以直接读取到data中所有属性。</p>\n<h3 id=\"3-2-1指令语法\"><a href=\"#3-2-1指令语法\" class=\"headerlink\" title=\"3.2.1指令语法\"></a>3.2.1指令语法</h3><p>功能：用于解析标签（包括：标签属性、标签体内容、绑定时间。。。。）</p>\n<p>举例：v-bind:href&#x3D;”xxx” 或 简写为:href&#x3D;”xxx”，xxx同样要写js表达式。且可以直接读取到data中的所有属性。</p>\n<p>备注：Vue中有很多的指令，且形式都是：v-???，此处我们只是拿v-bind举个例子。</p>\n<h2 id=\"3-3数据绑定\"><a href=\"#3-3数据绑定\" class=\"headerlink\" title=\"3.3数据绑定\"></a>3.3数据绑定</h2><ol>\n<li><p>单项绑定（v-bind）：数据只能从data流向页面</p>\n</li>\n<li><p>双向绑定（v-model）：数据不仅能从data流向页面，还可以从页面流向data。&amp;nbsp;</p>\n</li>\n<li><p>备注：</p>\n<ol>\n<li><p>1.双向绑定一般都应用在表单元素上（如：input、select等）</p>\n</li>\n<li><p>2.v-model:value 可以简写为v-model，因为v-model默认收集的就是value值</p>\n</li>\n</ol>\n</li>\n</ol>\n<h2 id=\"3-4data与el的两种写法\"><a href=\"#3-4data与el的两种写法\" class=\"headerlink\" title=\"3.4data与el的两种写法\"></a>3.4data与el的两种写法</h2><ol>\n<li><p>el有两种写法</p>\n<ol>\n<li><p>new Vue时配置el属性</p>\n</li>\n<li><p>先创建Vue实例，随后再通过vm.$mount(‘#root’)指定el的值。&amp;nbsp;</p>\n</li>\n</ol>\n</li>\n<li><p>data的两种写法</p>\n<ol>\n<li><p>对象式</p>\n</li>\n<li><p>函数式&amp;nbsp;</p>\n</li>\n<li><p>如何选择，目前哪种写法都可以，以后学习到组件时，data必须使用函数式，否则会报错。&amp;nbsp;</p>\n</li>\n</ol>\n</li>\n<li><p>一个重要的原则：</p>\n<ol>\n<li>由Vue管理的函数，一定不要写箭头函数，一旦写了箭头函数，this就不在是Vue的实例了</li>\n</ol>\n</li>\n</ol>\n<h2 id=\"3-5MVVM模型\"><a href=\"#3-5MVVM模型\" class=\"headerlink\" title=\"3.5MVVM模型\"></a>3.5MVVM模型</h2><ol>\n<li><p>M：模型（Model）：data中的数据</p>\n</li>\n<li><p>V：视图（View）：模板代码&amp;nbsp;</p>\n</li>\n<li><p>VM：视图模型（ViewModel）：Vue实例</p>\n</li>\n<li><p>观察发现：</p>\n<ol>\n<li><p>data中所有的属性，最后都出现在vm身上</p>\n</li>\n<li><p>vm身上所有的属性，及Vue原型上所有的属性，在Vue模板中都可以直接使用。</p>\n</li>\n</ol>\n</li>\n</ol>\n"},{"title":"爬虫的简单介绍","date":"2021-10-17T07:31:01.000Z","keywords":"爬虫","description":"爬虫的记录","cover":"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg","top_img":"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg","_content":"\n# 爬虫的简单介绍\n\n## 场景\n\n对于爬取数据来说，有在不同的场景下爬取数据。绝大多数的情况下，要么是网页，要么是app。这里就简单的介绍一下这两个类别吧。\n\n分享一个爬虫案例平台，可以上去测试各种各样的爬虫： <https://scrape.center>\n\njava爬虫的一个样例，可以瞅瞅： <https://juejin.cn/post/6844904064736559117>\n\n-   网页爬取\n\n    -   服务端渲染\n\n    -   客户端渲染\n\n-   App爬取\n\n    -   普通接口\n\n    -   加密参数接口\n\n    -   加密内容接口\n\n    -   非常规协议接口\n\n## 爬取——网页爬取\n\n服务端渲染的意思就是页面的结果是由服务器渲染后返回的，有效信息包含在请求的HTML页面里面，比如猫眼电影这个站点。\n\n客户端渲染的意思就是页面的主要内容是由JavaScript渲染而成，真实的数据是通过Ajax接口的形式获取的，比如淘宝、微博等等站点。\n\n下图是一个电影网站的榜单数据，这是直接在html页面中渲染出来的：\n\n![image-20221010104624247](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104624247.png)\n\n附上源代码：\n\n```python\nimport requests  \nfrom bs4 import BeautifulSoup  \nimport lxml  \n\n  \n\ndef spdier_maoyan(url):  \n    headers = {  \n        \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\",  \n        \"Accept-Encoding\": \"gzip, deflate, br\",  \n        \"Accept-Language\": \"zh-CN,zh;q=0.9\",  \n        \"Cookie\": \"UM_distinctid=180690fa304d50-049f7b7b2b113d-53580614-13c680-180690fa3057ff\",  \n        \"Host\": \"ssr1.scrape.center\",  \n        \"Referer\": \"https://ssr1.scrape.center/\",  \n        \"User-Agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.127 Safari/537.36\",  \n    }  \n    response = requests.get(url, headers=headers)  \n    text = response.text  \n    soup = BeautifulSoup(response.text, 'lxml')  \n    all_div = soup.find_all('div',attrs={\"el-card item m-t is-hover-shadow\"})  \n    for div in all_div:  \n        a = div.find('a')  \n        title = div.find('h2')  \n        print(url+a['href'])  \n        print('title',title.text)  \n\n  \n\n# 按间距中的绿色按钮以运行脚本。  \nif __name__ == '__main__':  \n    url = 'https://ssr1.scrape.center'  \n    spdier_maoyan(url)\n\n\n```\n\n服务端渲染的情况就比较简单了，用一些基本的 HTTP 请求库就可以实现爬取，如 urllib、urllib3、pycurl、hyper、requests、grab 等框架，其中应用最多的可能就是 requests 了。\n\n客户端渲染的情况如下：\n\n-   寻找Ajax接口，可以通过浏览器的开发者工具直接查看Ajax请求方式。\n\n-   模拟浏览器进行爬取，这种可用于网页接口较为复杂的情况。例如。可以使用Selenium、异步Asyncio + Pyppeteer等等\n\n-   复杂一点的，就是要获取到网页的js，然后执行js获取到数据\n\n## 爬取——App爬取\n\n这里分了几种情况：\n\n-   对于普通无加密接口，这种直接通过抓包软件，拿到接口的具体请求形式就ok了。可用的抓包工具有Charles、Fiddler、mitmproxy。\n\n-   对于一些加密参数的接口，一种方法是可以实时处理的，例如Fiddler、mitmproxy、Xposed等等，另一种方法是将加密逻辑破解，这里就涉及到反编译的技巧了\n\n-   对于一些加密内容的忌口，接口返回结果完全看不懂是什么东西，可以使用可见即可爬的工具 Appium，也可以使用 Xposed 来 hook 获取渲染结果，也可以通过反编译和改写手机底层来实现破解。这里可以举一个例子，【得道App】，这个App的数据内容是加密的，可以拿这个软件试手，网上也有很多爬取【得道App】的例子。\n\n## 反爬的一些常见情况\n\n-   非浏览器检测：识别请求头Headers里面有咩有包含User-Agent\n\n-   封Ip：一个Ip如果频繁访问，会被封禁\n\n-   弹验证码框：输入验证码之后才能看到网页\n\n## 反反爬\n\n-   非浏览器检测\n\n    -   这个相对来说是最简单的，可以自己做一个User-Agent的数组，用到时从中取一个就行，或者直接借用python的第三方模块【fake-useragent】。\n\n-   封Ip\n\n    -   这种情况的话，可以使用代理去访问，可以先去爬取代理网站，做一个代理池，每次切换不同的ip代理去访问网页，这样可以避免频繁访问封锁ip\n\n-   弹验证码框，验证码分为非常多种，如普通图形验证码、算术题验证码、滑动验证码、点触验证码、手机验证码、扫二维码等。\n\n    -   对于普通图形验证码，如果非常规整且没有变形或干扰，可以使用 OCR 识别，也可以使用机器学习、深度学习来进行模型训练，当然打码平台是最方便的方式。\n\n    -   对于算术题验证码，推荐直接使用打码平台。\n\n    -   对于滑动验证码，可以使用破解算法，也可以模拟滑动。后者的关键在于缺口的找寻，可以使用图片比对，也可以写基本的图形识别算法，也可以对接打码平台，也可以使用深度学习训练识别接口。\n\n    -   对于点触验证码，推荐使用打码平台。\n\n    -   对于手机验证码，可以使用验证码分发平台，也可以购买专门的收码设备，也可以人工验证。\n\n    -   对于扫二维码，可以人工扫码，也可以对接打码平台。【这里对应的一个场景，就是微信公众号】\n\n## 加速爬取\n\n当爬取的数据量非常大时，如何高效快速地进行数据抓取是关键。常见的措施有多线程、多进程、异步、分布式、细节优化等。\n\n这里就不多介绍了。\n\n## 数据存储\n\n这个根据具体实际情况，用不同的方式进行存储，有用Mysql、MongoDB这类数据进行数据存储的，也可以用TXT、Excel等形式进行数据存储。选哪一种都可以。\n\n## 爬虫框架\n\n主流的爬虫框架有Scrapy(Python) 、Pyspider(Python)、Apache Nutch(高大上)、WebMagic(Java爬虫框架)、WebCollector(Java爬虫框架)等等。\n\n## 1、在公司接触过的爬虫\n\n-   在安科院时，爬取抖音、微博、微信的数据\n\n### 1. 1    抖音、微博、微信数据爬取\n\n#### 1. 1. 1    微博\n\n像微博的话，它的源网址是 <https://passport.weibo.cn/signin/login>。点击进入网址后，是需要进行登录的。下面这张图是登录之后的页面\n\n![image-20221010104652413](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104652413.png)\n\n然后打开开发者工具去看请求参数，\n\n![image-20221010104713891](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104713891.png)\n\n代码已经封存好了，直接输入uid就可以进行爬取了，这里附上gitlab上的项目链接 <https://github.com/dataabc/weiboSpider>\n\n由于业务场景需要，需要视频的缩略图，我这里借用了第三方的工具和模块，取第一帧作为视频缩略图。附上代码，\n\n```python\nimport ffmpy  \n# 将视频的第一帧取下来，作为视频的缩略图存下来  \ndef get_thumbnail_from_video(video_path):  \n    print(\"开始将视频转换为缩略图\")  \n    thumbnail_path = video_path.replace(\".mp4\", \"_min.jpg\")  \n    ff = ffmpy.FFmpeg(  \n        inputs={video_path: None},  \n        outputs={thumbnail_path: ['-ss', '00:00:00.000', '-vframes', '1']}  \n    )  \n    ff.run()  \n    print(\"转换为缩略图结束\")  \n    return thumbnail_path\n```\n\n\n\n#### 1. 1. 2    抖音\n\n首先，获取源网页，这里就不用App进行爬取了，这里应用的通过手机App上的个人主页获取到抖音的链接，之后就可以通过这个链接进行分析，进行爬取了。就举一个例子吧，以目前最火的刘畊宏为例，\n\n![image-20221010104735019](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104735019.png)\n\n![image-20221010104749532](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104749532.png)\n\n![image-20221010104803277](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104803277.png)\n\n在获取到链接后，将链接替换掉，运行脚本，就可以将数据爬取下来了。\n\n![image-20221010104816216](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104816216.png)\n\n#!/usr/bin/python  \n\n```python\n# -*- coding: utf-8 -*-  \nfrom bs4 import BeautifulSoup  \nimport requests  \nimport urllib.request  \nimport urllib  \nimport json  \nimport re  \nimport csv  \nimport os  \nimport uuid  \nimport logging  \n\nheaders = {  \n    'accept-encoding': 'deflate',  \n    'accept-language': 'zh-CN,zh;q=0.9',  \n    'pragma': 'no-cache',  \n    'cache-control': 'no-cache',  \n    'upgrade-insecure-requests': '1',  \n    'user-agent': \"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1\",  \n}  \n\nHEADERS = {'user-agent': \"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1\"}  \n\nmapCode2Name = {\"0xe602\":\"num_\",\"0xe605\":\"num_3\",\"0xe606\":\"num_4\",\"0xe603\":\"num_1\",\"0xe604\":\"num_2\",\"0xe618\":\"num_\",\"0xe619\":\"num_4\",\"0xe60a\":\"num_8\",\"0xe60b\":\"num_9\",\"0xe60e\":\"num_\",\"0xe60f\":\"num_5\",\"0xe60c\":\"num_4\",   \n    \"0xe60d\":\"num_1\",\"0xe612\":\"num_6\",\"0xe613\":\"num_8\",\"0xe610\":\"num_3\",\"0xe611\":\"num_2\",\"0xe616\":\"num_1\",\"0xe617\":\"num_3\",\"0xe614\":\"num_9\",\"0xe615\":\"num_7\",\"0xe609\":\"num_7\",\"0xe607\":\"num_5\",\"0xe608\":\"num_6\",\"0xe61b\":\"num_5\",  \n        \"0xe61c\":\"num_8\",\"0xe61a\":\"num_2\",\"0xe61f\":\"num_6\",\"0xe61d\":\"num_9\",\"0xe61e\":\"num_7\"}  \nmapCode2Font = {\"num_9\":8,\"num_5\":5,\"num_6\":6,\"num_\":1,\"num_7\":9,\"num_8\":7,\"num_1\":0,\"num_2\":3,\"num_3\":2,\"num_4\":4}  \n\ndef getUserInfo(shared_url, **headers):  \n    real_url = getRealAddress(shared_url)  \n    parsed = urllib.parse.urlparse(real_url)  \n    hostname = parsed.hostname  \n    sec_uid = urllib.parse.parse_qs(parsed.query)['sec_uid']  \n    user_info_url = \"https://%s/web/api/v2/user/info/\" % hostname  \n    user_info_params = { 'sec_uid': sec_uid }  \n    res = requests.get(user_info_url, headers=headers,  \n                            params=user_info_params).json()  \n    user_info = res['user_info']  \n    user_avatar = user_info['avatar_larger']['url_list'][2]  \n    user_nickname = user_info['nickname']  \n    user_sign = user_info['signature']  \n    user_id = user_info['unique_id']  \n    count_of_videos = user_info['aweme_count']  \n    follower_count = user_info['follower_count']  \n    following_count = user_info['following_count']  \n    zan_count = user_info['total_favorited']  \n    like_count = user_info['favoriting_count']  \n    return {'user_avatar':user_avatar, 'user_nickname':user_nickname, 'user_sign':user_sign, 'user_id':user_id,  \n           'count_of_videos':count_of_videos, 'follower_count':follower_count, 'following_count':following_count,  \n           'zan_count':zan_count, 'like_count':like_count, 'like_count':like_count}  \n\ndef getUserVideos(url):  \n    # number = re.findall(r'share/user/(d+)', url)  \n    number = url.split('share/user/')[1].split('?')[0]  \n    if not len(number):  \n        return  \n    dytk = get_dytk(url)  \n    # hostname = urllib.parse.urlparse(url).hostname  \n    # if hostname != 't.tiktok.com' and not dytk:  \n    #     return  \n    user_id = number[0]  \n    return getUserMedia(user_id, dytk, url)  \n\n\ndef getRealAddress(url):  \n    if url.find('v.douyin.com') &lt; 0:  \n        return url  \n    res = requests.get(url, headers=headers, allow_redirects=False)  \n    return res.headers['Location'] if res.status_code == 302 else None  \n\n\ndef get_dytk(url):  \n    res = requests.get(url, headers=headers)  \n    if not res:  \n        return None  \n    dytk = re.findall(\"dytk: '(.*)'\", res.content.decode('utf-8'))  \n    if len(dytk):  \n        return dytk[0]  \n    return None  \n\ndef getUserMedia(user_id, dytk, url):  \n    videos = []  \n    parsed = urllib.parse.urlparse(url)  \n    hostname = parsed.hostname  \n    sec_uid = urllib.parse.parse_qs(parsed.query)['sec_uid']  \n\n    #signature = generateSignature(str(user_id))  \n    user_video_url = \"https://%s/web/api/v2/aweme/post/\" % hostname  \n    user_video_params = {  \n        'sec_uid': sec_uid,  \n        'count': '21',  \n        'max_cursor': '0',  \n        'aid': '1128',  \n        '_signature': '2Vx9mxAZh0o-K4Wdv7NFKNlcfY',  \n        'dytk': dytk  \n    }  \n    if hostname == 't.tiktok.com':  \n        user_video_params.pop('dytk')  \n        user_video_params['aid'] = '1180'  \n\n    max_cursor, video_count = None, 0  \n    while True:  \n        if max_cursor:  \n            user_video_params['max_cursor'] = str(max_cursor)  \n        res = requests.get(user_video_url, headers=headers,  \n                            params=user_video_params)  \n        contentJson = json.loads(res.content.decode('utf-8'))  \n        aweme_list = contentJson.get('aweme_list', [])  \n        for aweme in aweme_list:  \n            video_count += 1  \n            aweme['hostname'] = hostname  \n            video =  {  \n                'addr': aweme['video']['play_addr']['url_list'][0],  \n                'desc': aweme['desc'],  \n                'duration': aweme['video']['duration'],  \n                'cover': aweme['video']['cover']['url_list'][0],  \n                'statistics': aweme['statistics']  \n            }  \n            videos.append(video)  \n        if contentJson.get('has_more'):  \n            max_cursor = contentJson.get('max_cursor')  \n        else:  \n            break  \n    \n\n    if video_count == 0:  \n        print(\"There's no video in number %s.\" % user_id)  \n\n    return videos  \n\n  \n\ndef getHtml(url,**headers):  \n    try:  \n        req = urllib.request.Request(url,headers=headers)  \n        resp = urllib.request.urlopen(req)  \n        return str(resp.read(), 'utf-8')  \n    except urllib.error.HTTPError as e:  \n        print(e.msg)  \n        return ''  \n\n  \n\ndef woff2tff(ls):  \n    res = ''  \n    for s in ls:  \n       res = res + formatNum(s)  \n    return res  \n\ndef splitByChinese(s):  \n    p = re.compile(\"[u4e00-u9fa5]\", re.U)  \n    return p.split(s)  \n\ndef isChinese(s):  \n    p = re.compile(\"[u4e00-u9fa5]\", re.U)  \n    result = p.match(s)  \n    if result :  \n        return True  \n    return False  \n      \n\ndef formatNum(s):  \n    if isChinese(s):  \n        return ''  \n    if len(s)&lt;8 or s.find(\"hzsdxe6\") &lt; 0 :  \n        return s  \n    s1 = '0'+s[4:-1]  \n    res = mapCode2Font[mapCode2Name[s1]]  \n    return str(res)  \n\n\ndef getUserAll(shared_url):  \n    profile = getUserInfo(shared_url, **HEADERS)  \n    if profile:  \n        videos = getUserVideos(getRealAddress(shared_url))  \n        profile['videos'] = videos  \n    return profile  \n\ndef download_csv(file_path,video):  \n    result_headers = [('标题内容', 'desc'), ('视频时长', 'duration'),  \n                      ('点赞数', 'share_count'),  \n                      ('原始视频url', 'url'),  \n                      ('视频存储位置','id'),  \n                      ('缩略图','cover'),  \n                      ('缩略图id','cover_id')]  \n\n    result_data = [[w[kv[1]] for kv in result_headers]  \n                   for w in video]  \n    with open(file_path, 'a', encoding='utf-8-sig',  \n              newline='') as f:  \n        writer = csv.writer(f)  \n        writer.writerows([[kv[0] for kv in result_headers]])  \n        writer.writerows(result_data)  \n    for i in video:  \n        # 下载视频  \n        download_video(i['url'],i['id'])  \n        # 下载视频的缩略图  \n        download_min_jpg(i['cover'],i['cover_id'])  \n    logging.info(u'%d条微博写入csv文件完毕，保存路径：%s', len(video), file_path)  \n\ndef download_video(url,id):  \n    \"\"\"下载文件(图片/视频)\"\"\"  \n    path = \"/Users/mac/Desktop/data/douyin3/\"  \n    r = requests.get(url)  # 获取到目标视频的所有信息  \n    with open(path+id+\".mp4\", 'wb') as f:  # 以二进制写的方式将r的二进制内容写入path  \n        f.write(r.content)  \n        f.close()  \n        print(\"视频文件保存成功\")  \n\ndef download_min_jpg(url,id):  \n    path = \"/Users/mac/Desktop/data/douyin3/\"  \n    r = requests.get(url)  # 获取到目标视频的所有信息  \n    with open(path + id + \".jpg\", 'wb') as f:  # 以二进制写的方式将r的二进制内容写入path  \n        f.write(r.content)  \n        f.close()  \n        print(\"缩略图保存成功\")  \n\nif __name__ == '__main__':  \n    userInfo = getUserAll(\"https://v.douyin.com/FNyoaSR/\")  \n    print(len(userInfo['videos']))  \n    print(userInfo)  \n    list = []  \n    for i in userInfo['videos']:  \n        # 点赞数  \n        share_count = i['statistics']['share_count']  \n        # 原始视频地址  \n        url = i['addr']  \n        #视频时长  \n        duration = i['duration']  \n        # 标题内容  将ascii码转为中文  \n        desc = i['desc']  \n        uid = str(uuid.uuid4())  \n        suid = ''.join(uid.split('-'))  \n        # 缩略图 url  \n        cover =  i['cover']  \n        # 缩略图id  \n        cover_id = suid+\"_min\"  \n        list1 = {'desc': desc, 'duration': duration, 'share_count': share_count,  \n                 'url': url, 'id': suid, 'cover': cover, 'cover_id': cover_id}  \n        list.append(list1)  \n    #print(list)  \n    filepath = '/Users/mac/Desktop/data/douyin3/douyin.csv'  \n    download_csv(filepath,list)\n```\n\n\n\n#### 1. 1. 3 微信\n\n在之前的操作中，将获取到的cookie存储到txt文档中，之后有用到的时候取，目前登录的cookie值是在2-4个小时内失效的。\n\n在通过Selenium，控制浏览器后，微信会出现一个二维码页面，需要扫描二维码才能登录，这一步只能人工去解决。\n\n![image-20221010104841428](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104841428.png)\n\n进入微信公众号平台后，找到相应的位置，剩下的是找到安科院下的两个微信公众号的请求链接地址，分析里面的参数。\n\n![image-20221010104852717](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104852717.png)\n\n继续点击下一页，看看每一页哪些参数发生了变化，有没有规律，经分析得到了begin是变化的，并且是按照5的倍数递增的，之后就是请求每一页的数据，然后获取到发送的每一条数据的信息。在这期间，被封过几次号，爬取的太频繁的话，微信会对访问公众号进行限制，大概一天解封。\n\n![image-20221010104902165](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104902165.png)\n\n找到规律后，就是循环替换请求参数，然后去访问获取到公众号发布文章的链接地址和时间。\n","source":"_posts/爬虫的简单介绍.md","raw":"---\ntitle: 爬虫的简单介绍\ndate: 2021-10-17 15:31:01\ntags: 爬虫\ncategories: 学习\nkeywords: 爬虫\ndescription: 爬虫的记录\ncover: https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg\ntop_img: https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg\n---\n\n# 爬虫的简单介绍\n\n## 场景\n\n对于爬取数据来说，有在不同的场景下爬取数据。绝大多数的情况下，要么是网页，要么是app。这里就简单的介绍一下这两个类别吧。\n\n分享一个爬虫案例平台，可以上去测试各种各样的爬虫： <https://scrape.center>\n\njava爬虫的一个样例，可以瞅瞅： <https://juejin.cn/post/6844904064736559117>\n\n-   网页爬取\n\n    -   服务端渲染\n\n    -   客户端渲染\n\n-   App爬取\n\n    -   普通接口\n\n    -   加密参数接口\n\n    -   加密内容接口\n\n    -   非常规协议接口\n\n## 爬取——网页爬取\n\n服务端渲染的意思就是页面的结果是由服务器渲染后返回的，有效信息包含在请求的HTML页面里面，比如猫眼电影这个站点。\n\n客户端渲染的意思就是页面的主要内容是由JavaScript渲染而成，真实的数据是通过Ajax接口的形式获取的，比如淘宝、微博等等站点。\n\n下图是一个电影网站的榜单数据，这是直接在html页面中渲染出来的：\n\n![image-20221010104624247](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104624247.png)\n\n附上源代码：\n\n```python\nimport requests  \nfrom bs4 import BeautifulSoup  \nimport lxml  \n\n  \n\ndef spdier_maoyan(url):  \n    headers = {  \n        \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\",  \n        \"Accept-Encoding\": \"gzip, deflate, br\",  \n        \"Accept-Language\": \"zh-CN,zh;q=0.9\",  \n        \"Cookie\": \"UM_distinctid=180690fa304d50-049f7b7b2b113d-53580614-13c680-180690fa3057ff\",  \n        \"Host\": \"ssr1.scrape.center\",  \n        \"Referer\": \"https://ssr1.scrape.center/\",  \n        \"User-Agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.127 Safari/537.36\",  \n    }  \n    response = requests.get(url, headers=headers)  \n    text = response.text  \n    soup = BeautifulSoup(response.text, 'lxml')  \n    all_div = soup.find_all('div',attrs={\"el-card item m-t is-hover-shadow\"})  \n    for div in all_div:  \n        a = div.find('a')  \n        title = div.find('h2')  \n        print(url+a['href'])  \n        print('title',title.text)  \n\n  \n\n# 按间距中的绿色按钮以运行脚本。  \nif __name__ == '__main__':  \n    url = 'https://ssr1.scrape.center'  \n    spdier_maoyan(url)\n\n\n```\n\n服务端渲染的情况就比较简单了，用一些基本的 HTTP 请求库就可以实现爬取，如 urllib、urllib3、pycurl、hyper、requests、grab 等框架，其中应用最多的可能就是 requests 了。\n\n客户端渲染的情况如下：\n\n-   寻找Ajax接口，可以通过浏览器的开发者工具直接查看Ajax请求方式。\n\n-   模拟浏览器进行爬取，这种可用于网页接口较为复杂的情况。例如。可以使用Selenium、异步Asyncio + Pyppeteer等等\n\n-   复杂一点的，就是要获取到网页的js，然后执行js获取到数据\n\n## 爬取——App爬取\n\n这里分了几种情况：\n\n-   对于普通无加密接口，这种直接通过抓包软件，拿到接口的具体请求形式就ok了。可用的抓包工具有Charles、Fiddler、mitmproxy。\n\n-   对于一些加密参数的接口，一种方法是可以实时处理的，例如Fiddler、mitmproxy、Xposed等等，另一种方法是将加密逻辑破解，这里就涉及到反编译的技巧了\n\n-   对于一些加密内容的忌口，接口返回结果完全看不懂是什么东西，可以使用可见即可爬的工具 Appium，也可以使用 Xposed 来 hook 获取渲染结果，也可以通过反编译和改写手机底层来实现破解。这里可以举一个例子，【得道App】，这个App的数据内容是加密的，可以拿这个软件试手，网上也有很多爬取【得道App】的例子。\n\n## 反爬的一些常见情况\n\n-   非浏览器检测：识别请求头Headers里面有咩有包含User-Agent\n\n-   封Ip：一个Ip如果频繁访问，会被封禁\n\n-   弹验证码框：输入验证码之后才能看到网页\n\n## 反反爬\n\n-   非浏览器检测\n\n    -   这个相对来说是最简单的，可以自己做一个User-Agent的数组，用到时从中取一个就行，或者直接借用python的第三方模块【fake-useragent】。\n\n-   封Ip\n\n    -   这种情况的话，可以使用代理去访问，可以先去爬取代理网站，做一个代理池，每次切换不同的ip代理去访问网页，这样可以避免频繁访问封锁ip\n\n-   弹验证码框，验证码分为非常多种，如普通图形验证码、算术题验证码、滑动验证码、点触验证码、手机验证码、扫二维码等。\n\n    -   对于普通图形验证码，如果非常规整且没有变形或干扰，可以使用 OCR 识别，也可以使用机器学习、深度学习来进行模型训练，当然打码平台是最方便的方式。\n\n    -   对于算术题验证码，推荐直接使用打码平台。\n\n    -   对于滑动验证码，可以使用破解算法，也可以模拟滑动。后者的关键在于缺口的找寻，可以使用图片比对，也可以写基本的图形识别算法，也可以对接打码平台，也可以使用深度学习训练识别接口。\n\n    -   对于点触验证码，推荐使用打码平台。\n\n    -   对于手机验证码，可以使用验证码分发平台，也可以购买专门的收码设备，也可以人工验证。\n\n    -   对于扫二维码，可以人工扫码，也可以对接打码平台。【这里对应的一个场景，就是微信公众号】\n\n## 加速爬取\n\n当爬取的数据量非常大时，如何高效快速地进行数据抓取是关键。常见的措施有多线程、多进程、异步、分布式、细节优化等。\n\n这里就不多介绍了。\n\n## 数据存储\n\n这个根据具体实际情况，用不同的方式进行存储，有用Mysql、MongoDB这类数据进行数据存储的，也可以用TXT、Excel等形式进行数据存储。选哪一种都可以。\n\n## 爬虫框架\n\n主流的爬虫框架有Scrapy(Python) 、Pyspider(Python)、Apache Nutch(高大上)、WebMagic(Java爬虫框架)、WebCollector(Java爬虫框架)等等。\n\n## 1、在公司接触过的爬虫\n\n-   在安科院时，爬取抖音、微博、微信的数据\n\n### 1. 1    抖音、微博、微信数据爬取\n\n#### 1. 1. 1    微博\n\n像微博的话，它的源网址是 <https://passport.weibo.cn/signin/login>。点击进入网址后，是需要进行登录的。下面这张图是登录之后的页面\n\n![image-20221010104652413](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104652413.png)\n\n然后打开开发者工具去看请求参数，\n\n![image-20221010104713891](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104713891.png)\n\n代码已经封存好了，直接输入uid就可以进行爬取了，这里附上gitlab上的项目链接 <https://github.com/dataabc/weiboSpider>\n\n由于业务场景需要，需要视频的缩略图，我这里借用了第三方的工具和模块，取第一帧作为视频缩略图。附上代码，\n\n```python\nimport ffmpy  \n# 将视频的第一帧取下来，作为视频的缩略图存下来  \ndef get_thumbnail_from_video(video_path):  \n    print(\"开始将视频转换为缩略图\")  \n    thumbnail_path = video_path.replace(\".mp4\", \"_min.jpg\")  \n    ff = ffmpy.FFmpeg(  \n        inputs={video_path: None},  \n        outputs={thumbnail_path: ['-ss', '00:00:00.000', '-vframes', '1']}  \n    )  \n    ff.run()  \n    print(\"转换为缩略图结束\")  \n    return thumbnail_path\n```\n\n\n\n#### 1. 1. 2    抖音\n\n首先，获取源网页，这里就不用App进行爬取了，这里应用的通过手机App上的个人主页获取到抖音的链接，之后就可以通过这个链接进行分析，进行爬取了。就举一个例子吧，以目前最火的刘畊宏为例，\n\n![image-20221010104735019](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104735019.png)\n\n![image-20221010104749532](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104749532.png)\n\n![image-20221010104803277](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104803277.png)\n\n在获取到链接后，将链接替换掉，运行脚本，就可以将数据爬取下来了。\n\n![image-20221010104816216](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104816216.png)\n\n#!/usr/bin/python  \n\n```python\n# -*- coding: utf-8 -*-  \nfrom bs4 import BeautifulSoup  \nimport requests  \nimport urllib.request  \nimport urllib  \nimport json  \nimport re  \nimport csv  \nimport os  \nimport uuid  \nimport logging  \n\nheaders = {  \n    'accept-encoding': 'deflate',  \n    'accept-language': 'zh-CN,zh;q=0.9',  \n    'pragma': 'no-cache',  \n    'cache-control': 'no-cache',  \n    'upgrade-insecure-requests': '1',  \n    'user-agent': \"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1\",  \n}  \n\nHEADERS = {'user-agent': \"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1\"}  \n\nmapCode2Name = {\"0xe602\":\"num_\",\"0xe605\":\"num_3\",\"0xe606\":\"num_4\",\"0xe603\":\"num_1\",\"0xe604\":\"num_2\",\"0xe618\":\"num_\",\"0xe619\":\"num_4\",\"0xe60a\":\"num_8\",\"0xe60b\":\"num_9\",\"0xe60e\":\"num_\",\"0xe60f\":\"num_5\",\"0xe60c\":\"num_4\",   \n    \"0xe60d\":\"num_1\",\"0xe612\":\"num_6\",\"0xe613\":\"num_8\",\"0xe610\":\"num_3\",\"0xe611\":\"num_2\",\"0xe616\":\"num_1\",\"0xe617\":\"num_3\",\"0xe614\":\"num_9\",\"0xe615\":\"num_7\",\"0xe609\":\"num_7\",\"0xe607\":\"num_5\",\"0xe608\":\"num_6\",\"0xe61b\":\"num_5\",  \n        \"0xe61c\":\"num_8\",\"0xe61a\":\"num_2\",\"0xe61f\":\"num_6\",\"0xe61d\":\"num_9\",\"0xe61e\":\"num_7\"}  \nmapCode2Font = {\"num_9\":8,\"num_5\":5,\"num_6\":6,\"num_\":1,\"num_7\":9,\"num_8\":7,\"num_1\":0,\"num_2\":3,\"num_3\":2,\"num_4\":4}  \n\ndef getUserInfo(shared_url, **headers):  \n    real_url = getRealAddress(shared_url)  \n    parsed = urllib.parse.urlparse(real_url)  \n    hostname = parsed.hostname  \n    sec_uid = urllib.parse.parse_qs(parsed.query)['sec_uid']  \n    user_info_url = \"https://%s/web/api/v2/user/info/\" % hostname  \n    user_info_params = { 'sec_uid': sec_uid }  \n    res = requests.get(user_info_url, headers=headers,  \n                            params=user_info_params).json()  \n    user_info = res['user_info']  \n    user_avatar = user_info['avatar_larger']['url_list'][2]  \n    user_nickname = user_info['nickname']  \n    user_sign = user_info['signature']  \n    user_id = user_info['unique_id']  \n    count_of_videos = user_info['aweme_count']  \n    follower_count = user_info['follower_count']  \n    following_count = user_info['following_count']  \n    zan_count = user_info['total_favorited']  \n    like_count = user_info['favoriting_count']  \n    return {'user_avatar':user_avatar, 'user_nickname':user_nickname, 'user_sign':user_sign, 'user_id':user_id,  \n           'count_of_videos':count_of_videos, 'follower_count':follower_count, 'following_count':following_count,  \n           'zan_count':zan_count, 'like_count':like_count, 'like_count':like_count}  \n\ndef getUserVideos(url):  \n    # number = re.findall(r'share/user/(d+)', url)  \n    number = url.split('share/user/')[1].split('?')[0]  \n    if not len(number):  \n        return  \n    dytk = get_dytk(url)  \n    # hostname = urllib.parse.urlparse(url).hostname  \n    # if hostname != 't.tiktok.com' and not dytk:  \n    #     return  \n    user_id = number[0]  \n    return getUserMedia(user_id, dytk, url)  \n\n\ndef getRealAddress(url):  \n    if url.find('v.douyin.com') &lt; 0:  \n        return url  \n    res = requests.get(url, headers=headers, allow_redirects=False)  \n    return res.headers['Location'] if res.status_code == 302 else None  \n\n\ndef get_dytk(url):  \n    res = requests.get(url, headers=headers)  \n    if not res:  \n        return None  \n    dytk = re.findall(\"dytk: '(.*)'\", res.content.decode('utf-8'))  \n    if len(dytk):  \n        return dytk[0]  \n    return None  \n\ndef getUserMedia(user_id, dytk, url):  \n    videos = []  \n    parsed = urllib.parse.urlparse(url)  \n    hostname = parsed.hostname  \n    sec_uid = urllib.parse.parse_qs(parsed.query)['sec_uid']  \n\n    #signature = generateSignature(str(user_id))  \n    user_video_url = \"https://%s/web/api/v2/aweme/post/\" % hostname  \n    user_video_params = {  \n        'sec_uid': sec_uid,  \n        'count': '21',  \n        'max_cursor': '0',  \n        'aid': '1128',  \n        '_signature': '2Vx9mxAZh0o-K4Wdv7NFKNlcfY',  \n        'dytk': dytk  \n    }  \n    if hostname == 't.tiktok.com':  \n        user_video_params.pop('dytk')  \n        user_video_params['aid'] = '1180'  \n\n    max_cursor, video_count = None, 0  \n    while True:  \n        if max_cursor:  \n            user_video_params['max_cursor'] = str(max_cursor)  \n        res = requests.get(user_video_url, headers=headers,  \n                            params=user_video_params)  \n        contentJson = json.loads(res.content.decode('utf-8'))  \n        aweme_list = contentJson.get('aweme_list', [])  \n        for aweme in aweme_list:  \n            video_count += 1  \n            aweme['hostname'] = hostname  \n            video =  {  \n                'addr': aweme['video']['play_addr']['url_list'][0],  \n                'desc': aweme['desc'],  \n                'duration': aweme['video']['duration'],  \n                'cover': aweme['video']['cover']['url_list'][0],  \n                'statistics': aweme['statistics']  \n            }  \n            videos.append(video)  \n        if contentJson.get('has_more'):  \n            max_cursor = contentJson.get('max_cursor')  \n        else:  \n            break  \n    \n\n    if video_count == 0:  \n        print(\"There's no video in number %s.\" % user_id)  \n\n    return videos  \n\n  \n\ndef getHtml(url,**headers):  \n    try:  \n        req = urllib.request.Request(url,headers=headers)  \n        resp = urllib.request.urlopen(req)  \n        return str(resp.read(), 'utf-8')  \n    except urllib.error.HTTPError as e:  \n        print(e.msg)  \n        return ''  \n\n  \n\ndef woff2tff(ls):  \n    res = ''  \n    for s in ls:  \n       res = res + formatNum(s)  \n    return res  \n\ndef splitByChinese(s):  \n    p = re.compile(\"[u4e00-u9fa5]\", re.U)  \n    return p.split(s)  \n\ndef isChinese(s):  \n    p = re.compile(\"[u4e00-u9fa5]\", re.U)  \n    result = p.match(s)  \n    if result :  \n        return True  \n    return False  \n      \n\ndef formatNum(s):  \n    if isChinese(s):  \n        return ''  \n    if len(s)&lt;8 or s.find(\"hzsdxe6\") &lt; 0 :  \n        return s  \n    s1 = '0'+s[4:-1]  \n    res = mapCode2Font[mapCode2Name[s1]]  \n    return str(res)  \n\n\ndef getUserAll(shared_url):  \n    profile = getUserInfo(shared_url, **HEADERS)  \n    if profile:  \n        videos = getUserVideos(getRealAddress(shared_url))  \n        profile['videos'] = videos  \n    return profile  \n\ndef download_csv(file_path,video):  \n    result_headers = [('标题内容', 'desc'), ('视频时长', 'duration'),  \n                      ('点赞数', 'share_count'),  \n                      ('原始视频url', 'url'),  \n                      ('视频存储位置','id'),  \n                      ('缩略图','cover'),  \n                      ('缩略图id','cover_id')]  \n\n    result_data = [[w[kv[1]] for kv in result_headers]  \n                   for w in video]  \n    with open(file_path, 'a', encoding='utf-8-sig',  \n              newline='') as f:  \n        writer = csv.writer(f)  \n        writer.writerows([[kv[0] for kv in result_headers]])  \n        writer.writerows(result_data)  \n    for i in video:  \n        # 下载视频  \n        download_video(i['url'],i['id'])  \n        # 下载视频的缩略图  \n        download_min_jpg(i['cover'],i['cover_id'])  \n    logging.info(u'%d条微博写入csv文件完毕，保存路径：%s', len(video), file_path)  \n\ndef download_video(url,id):  \n    \"\"\"下载文件(图片/视频)\"\"\"  \n    path = \"/Users/mac/Desktop/data/douyin3/\"  \n    r = requests.get(url)  # 获取到目标视频的所有信息  \n    with open(path+id+\".mp4\", 'wb') as f:  # 以二进制写的方式将r的二进制内容写入path  \n        f.write(r.content)  \n        f.close()  \n        print(\"视频文件保存成功\")  \n\ndef download_min_jpg(url,id):  \n    path = \"/Users/mac/Desktop/data/douyin3/\"  \n    r = requests.get(url)  # 获取到目标视频的所有信息  \n    with open(path + id + \".jpg\", 'wb') as f:  # 以二进制写的方式将r的二进制内容写入path  \n        f.write(r.content)  \n        f.close()  \n        print(\"缩略图保存成功\")  \n\nif __name__ == '__main__':  \n    userInfo = getUserAll(\"https://v.douyin.com/FNyoaSR/\")  \n    print(len(userInfo['videos']))  \n    print(userInfo)  \n    list = []  \n    for i in userInfo['videos']:  \n        # 点赞数  \n        share_count = i['statistics']['share_count']  \n        # 原始视频地址  \n        url = i['addr']  \n        #视频时长  \n        duration = i['duration']  \n        # 标题内容  将ascii码转为中文  \n        desc = i['desc']  \n        uid = str(uuid.uuid4())  \n        suid = ''.join(uid.split('-'))  \n        # 缩略图 url  \n        cover =  i['cover']  \n        # 缩略图id  \n        cover_id = suid+\"_min\"  \n        list1 = {'desc': desc, 'duration': duration, 'share_count': share_count,  \n                 'url': url, 'id': suid, 'cover': cover, 'cover_id': cover_id}  \n        list.append(list1)  \n    #print(list)  \n    filepath = '/Users/mac/Desktop/data/douyin3/douyin.csv'  \n    download_csv(filepath,list)\n```\n\n\n\n#### 1. 1. 3 微信\n\n在之前的操作中，将获取到的cookie存储到txt文档中，之后有用到的时候取，目前登录的cookie值是在2-4个小时内失效的。\n\n在通过Selenium，控制浏览器后，微信会出现一个二维码页面，需要扫描二维码才能登录，这一步只能人工去解决。\n\n![image-20221010104841428](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104841428.png)\n\n进入微信公众号平台后，找到相应的位置，剩下的是找到安科院下的两个微信公众号的请求链接地址，分析里面的参数。\n\n![image-20221010104852717](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104852717.png)\n\n继续点击下一页，看看每一页哪些参数发生了变化，有没有规律，经分析得到了begin是变化的，并且是按照5的倍数递增的，之后就是请求每一页的数据，然后获取到发送的每一条数据的信息。在这期间，被封过几次号，爬取的太频繁的话，微信会对访问公众号进行限制，大概一天解封。\n\n![image-20221010104902165](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104902165.png)\n\n找到规律后，就是循环替换请求参数，然后去访问获取到公众号发布文章的链接地址和时间。\n","slug":"爬虫的简单介绍","published":1,"updated":"2022-10-10T03:10:33.187Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clg1mfusa000n27qg8x4t5hsz","content":"<h1 id=\"爬虫的简单介绍\"><a href=\"#爬虫的简单介绍\" class=\"headerlink\" title=\"爬虫的简单介绍\"></a>爬虫的简单介绍</h1><h2 id=\"场景\"><a href=\"#场景\" class=\"headerlink\" title=\"场景\"></a>场景</h2><p>对于爬取数据来说，有在不同的场景下爬取数据。绝大多数的情况下，要么是网页，要么是app。这里就简单的介绍一下这两个类别吧。</p>\n<p>分享一个爬虫案例平台，可以上去测试各种各样的爬虫： <a href=\"https://scrape.center/\">https://scrape.center</a></p>\n<p>java爬虫的一个样例，可以瞅瞅： <a href=\"https://juejin.cn/post/6844904064736559117\">https://juejin.cn/post/6844904064736559117</a></p>\n<ul>\n<li><p>网页爬取</p>\n<ul>\n<li><p>服务端渲染</p>\n</li>\n<li><p>客户端渲染</p>\n</li>\n</ul>\n</li>\n<li><p>App爬取</p>\n<ul>\n<li><p>普通接口</p>\n</li>\n<li><p>加密参数接口</p>\n</li>\n<li><p>加密内容接口</p>\n</li>\n<li><p>非常规协议接口</p>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"爬取——网页爬取\"><a href=\"#爬取——网页爬取\" class=\"headerlink\" title=\"爬取——网页爬取\"></a>爬取——网页爬取</h2><p>服务端渲染的意思就是页面的结果是由服务器渲染后返回的，有效信息包含在请求的HTML页面里面，比如猫眼电影这个站点。</p>\n<p>客户端渲染的意思就是页面的主要内容是由JavaScript渲染而成，真实的数据是通过Ajax接口的形式获取的，比如淘宝、微博等等站点。</p>\n<p>下图是一个电影网站的榜单数据，这是直接在html页面中渲染出来的：</p>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104624247.png\" alt=\"image-20221010104624247\"></p>\n<p>附上源代码：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests  </span><br><span class=\"line\"><span class=\"keyword\">from</span> bs4 <span class=\"keyword\">import</span> BeautifulSoup  </span><br><span class=\"line\"><span class=\"keyword\">import</span> lxml  </span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">spdier_maoyan</span>(<span class=\"params\">url</span>):  </span><br><span class=\"line\">    headers = &#123;  </span><br><span class=\"line\">        <span class=\"string\">&quot;Accept&quot;</span>: <span class=\"string\">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span>,  </span><br><span class=\"line\">        <span class=\"string\">&quot;Accept-Encoding&quot;</span>: <span class=\"string\">&quot;gzip, deflate, br&quot;</span>,  </span><br><span class=\"line\">        <span class=\"string\">&quot;Accept-Language&quot;</span>: <span class=\"string\">&quot;zh-CN,zh;q=0.9&quot;</span>,  </span><br><span class=\"line\">        <span class=\"string\">&quot;Cookie&quot;</span>: <span class=\"string\">&quot;UM_distinctid=180690fa304d50-049f7b7b2b113d-53580614-13c680-180690fa3057ff&quot;</span>,  </span><br><span class=\"line\">        <span class=\"string\">&quot;Host&quot;</span>: <span class=\"string\">&quot;ssr1.scrape.center&quot;</span>,  </span><br><span class=\"line\">        <span class=\"string\">&quot;Referer&quot;</span>: <span class=\"string\">&quot;https://ssr1.scrape.center/&quot;</span>,  </span><br><span class=\"line\">        <span class=\"string\">&quot;User-Agent&quot;</span>: <span class=\"string\">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.127 Safari/537.36&quot;</span>,  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">    response = requests.get(url, headers=headers)  </span><br><span class=\"line\">    text = response.text  </span><br><span class=\"line\">    soup = BeautifulSoup(response.text, <span class=\"string\">&#x27;lxml&#x27;</span>)  </span><br><span class=\"line\">    all_div = soup.find_all(<span class=\"string\">&#x27;div&#x27;</span>,attrs=&#123;<span class=\"string\">&quot;el-card item m-t is-hover-shadow&quot;</span>&#125;)  </span><br><span class=\"line\">    <span class=\"keyword\">for</span> div <span class=\"keyword\">in</span> all_div:  </span><br><span class=\"line\">        a = div.find(<span class=\"string\">&#x27;a&#x27;</span>)  </span><br><span class=\"line\">        title = div.find(<span class=\"string\">&#x27;h2&#x27;</span>)  </span><br><span class=\"line\">        <span class=\"built_in\">print</span>(url+a[<span class=\"string\">&#x27;href&#x27;</span>])  </span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;title&#x27;</span>,title.text)  </span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 按间距中的绿色按钮以运行脚本。  </span></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:  </span><br><span class=\"line\">    url = <span class=\"string\">&#x27;https://ssr1.scrape.center&#x27;</span>  </span><br><span class=\"line\">    spdier_maoyan(url)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>服务端渲染的情况就比较简单了，用一些基本的 HTTP 请求库就可以实现爬取，如 urllib、urllib3、pycurl、hyper、requests、grab 等框架，其中应用最多的可能就是 requests 了。</p>\n<p>客户端渲染的情况如下：</p>\n<ul>\n<li><p>寻找Ajax接口，可以通过浏览器的开发者工具直接查看Ajax请求方式。</p>\n</li>\n<li><p>模拟浏览器进行爬取，这种可用于网页接口较为复杂的情况。例如。可以使用Selenium、异步Asyncio + Pyppeteer等等</p>\n</li>\n<li><p>复杂一点的，就是要获取到网页的js，然后执行js获取到数据</p>\n</li>\n</ul>\n<h2 id=\"爬取——App爬取\"><a href=\"#爬取——App爬取\" class=\"headerlink\" title=\"爬取——App爬取\"></a>爬取——App爬取</h2><p>这里分了几种情况：</p>\n<ul>\n<li><p>对于普通无加密接口，这种直接通过抓包软件，拿到接口的具体请求形式就ok了。可用的抓包工具有Charles、Fiddler、mitmproxy。</p>\n</li>\n<li><p>对于一些加密参数的接口，一种方法是可以实时处理的，例如Fiddler、mitmproxy、Xposed等等，另一种方法是将加密逻辑破解，这里就涉及到反编译的技巧了</p>\n</li>\n<li><p>对于一些加密内容的忌口，接口返回结果完全看不懂是什么东西，可以使用可见即可爬的工具 Appium，也可以使用 Xposed 来 hook 获取渲染结果，也可以通过反编译和改写手机底层来实现破解。这里可以举一个例子，【得道App】，这个App的数据内容是加密的，可以拿这个软件试手，网上也有很多爬取【得道App】的例子。</p>\n</li>\n</ul>\n<h2 id=\"反爬的一些常见情况\"><a href=\"#反爬的一些常见情况\" class=\"headerlink\" title=\"反爬的一些常见情况\"></a>反爬的一些常见情况</h2><ul>\n<li><p>非浏览器检测：识别请求头Headers里面有咩有包含User-Agent</p>\n</li>\n<li><p>封Ip：一个Ip如果频繁访问，会被封禁</p>\n</li>\n<li><p>弹验证码框：输入验证码之后才能看到网页</p>\n</li>\n</ul>\n<h2 id=\"反反爬\"><a href=\"#反反爬\" class=\"headerlink\" title=\"反反爬\"></a>反反爬</h2><ul>\n<li><p>非浏览器检测</p>\n<ul>\n<li>这个相对来说是最简单的，可以自己做一个User-Agent的数组，用到时从中取一个就行，或者直接借用python的第三方模块【fake-useragent】。</li>\n</ul>\n</li>\n<li><p>封Ip</p>\n<ul>\n<li>这种情况的话，可以使用代理去访问，可以先去爬取代理网站，做一个代理池，每次切换不同的ip代理去访问网页，这样可以避免频繁访问封锁ip</li>\n</ul>\n</li>\n<li><p>弹验证码框，验证码分为非常多种，如普通图形验证码、算术题验证码、滑动验证码、点触验证码、手机验证码、扫二维码等。</p>\n<ul>\n<li><p>对于普通图形验证码，如果非常规整且没有变形或干扰，可以使用 OCR 识别，也可以使用机器学习、深度学习来进行模型训练，当然打码平台是最方便的方式。</p>\n</li>\n<li><p>对于算术题验证码，推荐直接使用打码平台。</p>\n</li>\n<li><p>对于滑动验证码，可以使用破解算法，也可以模拟滑动。后者的关键在于缺口的找寻，可以使用图片比对，也可以写基本的图形识别算法，也可以对接打码平台，也可以使用深度学习训练识别接口。</p>\n</li>\n<li><p>对于点触验证码，推荐使用打码平台。</p>\n</li>\n<li><p>对于手机验证码，可以使用验证码分发平台，也可以购买专门的收码设备，也可以人工验证。</p>\n</li>\n<li><p>对于扫二维码，可以人工扫码，也可以对接打码平台。【这里对应的一个场景，就是微信公众号】</p>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"加速爬取\"><a href=\"#加速爬取\" class=\"headerlink\" title=\"加速爬取\"></a>加速爬取</h2><p>当爬取的数据量非常大时，如何高效快速地进行数据抓取是关键。常见的措施有多线程、多进程、异步、分布式、细节优化等。</p>\n<p>这里就不多介绍了。</p>\n<h2 id=\"数据存储\"><a href=\"#数据存储\" class=\"headerlink\" title=\"数据存储\"></a>数据存储</h2><p>这个根据具体实际情况，用不同的方式进行存储，有用Mysql、MongoDB这类数据进行数据存储的，也可以用TXT、Excel等形式进行数据存储。选哪一种都可以。</p>\n<h2 id=\"爬虫框架\"><a href=\"#爬虫框架\" class=\"headerlink\" title=\"爬虫框架\"></a>爬虫框架</h2><p>主流的爬虫框架有Scrapy(Python) 、Pyspider(Python)、Apache Nutch(高大上)、WebMagic(Java爬虫框架)、WebCollector(Java爬虫框架)等等。</p>\n<h2 id=\"1、在公司接触过的爬虫\"><a href=\"#1、在公司接触过的爬虫\" class=\"headerlink\" title=\"1、在公司接触过的爬虫\"></a>1、在公司接触过的爬虫</h2><ul>\n<li>在安科院时，爬取抖音、微博、微信的数据</li>\n</ul>\n<h3 id=\"1-1-抖音、微博、微信数据爬取\"><a href=\"#1-1-抖音、微博、微信数据爬取\" class=\"headerlink\" title=\"1. 1    抖音、微博、微信数据爬取\"></a>1. 1    抖音、微博、微信数据爬取</h3><h4 id=\"1-1-1-微博\"><a href=\"#1-1-1-微博\" class=\"headerlink\" title=\"1. 1. 1    微博\"></a>1. 1. 1    微博</h4><p>像微博的话，它的源网址是 <a href=\"https://passport.weibo.cn/signin/login\">https://passport.weibo.cn/signin/login</a>。点击进入网址后，是需要进行登录的。下面这张图是登录之后的页面</p>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104652413.png\" alt=\"image-20221010104652413\"></p>\n<p>然后打开开发者工具去看请求参数，</p>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104713891.png\" alt=\"image-20221010104713891\"></p>\n<p>代码已经封存好了，直接输入uid就可以进行爬取了，这里附上gitlab上的项目链接 <a href=\"https://github.com/dataabc/weiboSpider\">https://github.com/dataabc/weiboSpider</a></p>\n<p>由于业务场景需要，需要视频的缩略图，我这里借用了第三方的工具和模块，取第一帧作为视频缩略图。附上代码，</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> ffmpy  </span><br><span class=\"line\"><span class=\"comment\"># 将视频的第一帧取下来，作为视频的缩略图存下来  </span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_thumbnail_from_video</span>(<span class=\"params\">video_path</span>):  </span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;开始将视频转换为缩略图&quot;</span>)  </span><br><span class=\"line\">    thumbnail_path = video_path.replace(<span class=\"string\">&quot;.mp4&quot;</span>, <span class=\"string\">&quot;_min.jpg&quot;</span>)  </span><br><span class=\"line\">    ff = ffmpy.FFmpeg(  </span><br><span class=\"line\">        inputs=&#123;video_path: <span class=\"literal\">None</span>&#125;,  </span><br><span class=\"line\">        outputs=&#123;thumbnail_path: [<span class=\"string\">&#x27;-ss&#x27;</span>, <span class=\"string\">&#x27;00:00:00.000&#x27;</span>, <span class=\"string\">&#x27;-vframes&#x27;</span>, <span class=\"string\">&#x27;1&#x27;</span>]&#125;  </span><br><span class=\"line\">    )  </span><br><span class=\"line\">    ff.run()  </span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;转换为缩略图结束&quot;</span>)  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> thumbnail_path</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"1-1-2-抖音\"><a href=\"#1-1-2-抖音\" class=\"headerlink\" title=\"1. 1. 2    抖音\"></a>1. 1. 2    抖音</h4><p>首先，获取源网页，这里就不用App进行爬取了，这里应用的通过手机App上的个人主页获取到抖音的链接，之后就可以通过这个链接进行分析，进行爬取了。就举一个例子吧，以目前最火的刘畊宏为例，</p>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104735019.png\" alt=\"image-20221010104735019\"></p>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104749532.png\" alt=\"image-20221010104749532\"></p>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104803277.png\" alt=\"image-20221010104803277\"></p>\n<p>在获取到链接后，将链接替换掉，运行脚本，就可以将数据爬取下来了。</p>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104816216.png\" alt=\"image-20221010104816216\"></p>\n<p>#!&#x2F;usr&#x2F;bin&#x2F;python  </p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-  </span></span><br><span class=\"line\"><span class=\"keyword\">from</span> bs4 <span class=\"keyword\">import</span> BeautifulSoup  </span><br><span class=\"line\"><span class=\"keyword\">import</span> requests  </span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib.request  </span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib  </span><br><span class=\"line\"><span class=\"keyword\">import</span> json  </span><br><span class=\"line\"><span class=\"keyword\">import</span> re  </span><br><span class=\"line\"><span class=\"keyword\">import</span> csv  </span><br><span class=\"line\"><span class=\"keyword\">import</span> os  </span><br><span class=\"line\"><span class=\"keyword\">import</span> uuid  </span><br><span class=\"line\"><span class=\"keyword\">import</span> logging  </span><br><span class=\"line\"></span><br><span class=\"line\">headers = &#123;  </span><br><span class=\"line\">    <span class=\"string\">&#x27;accept-encoding&#x27;</span>: <span class=\"string\">&#x27;deflate&#x27;</span>,  </span><br><span class=\"line\">    <span class=\"string\">&#x27;accept-language&#x27;</span>: <span class=\"string\">&#x27;zh-CN,zh;q=0.9&#x27;</span>,  </span><br><span class=\"line\">    <span class=\"string\">&#x27;pragma&#x27;</span>: <span class=\"string\">&#x27;no-cache&#x27;</span>,  </span><br><span class=\"line\">    <span class=\"string\">&#x27;cache-control&#x27;</span>: <span class=\"string\">&#x27;no-cache&#x27;</span>,  </span><br><span class=\"line\">    <span class=\"string\">&#x27;upgrade-insecure-requests&#x27;</span>: <span class=\"string\">&#x27;1&#x27;</span>,  </span><br><span class=\"line\">    <span class=\"string\">&#x27;user-agent&#x27;</span>: <span class=\"string\">&quot;Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1&quot;</span>,  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\"></span><br><span class=\"line\">HEADERS = &#123;<span class=\"string\">&#x27;user-agent&#x27;</span>: <span class=\"string\">&quot;Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1&quot;</span>&#125;  </span><br><span class=\"line\"></span><br><span class=\"line\">mapCode2Name = &#123;<span class=\"string\">&quot;0xe602&quot;</span>:<span class=\"string\">&quot;num_&quot;</span>,<span class=\"string\">&quot;0xe605&quot;</span>:<span class=\"string\">&quot;num_3&quot;</span>,<span class=\"string\">&quot;0xe606&quot;</span>:<span class=\"string\">&quot;num_4&quot;</span>,<span class=\"string\">&quot;0xe603&quot;</span>:<span class=\"string\">&quot;num_1&quot;</span>,<span class=\"string\">&quot;0xe604&quot;</span>:<span class=\"string\">&quot;num_2&quot;</span>,<span class=\"string\">&quot;0xe618&quot;</span>:<span class=\"string\">&quot;num_&quot;</span>,<span class=\"string\">&quot;0xe619&quot;</span>:<span class=\"string\">&quot;num_4&quot;</span>,<span class=\"string\">&quot;0xe60a&quot;</span>:<span class=\"string\">&quot;num_8&quot;</span>,<span class=\"string\">&quot;0xe60b&quot;</span>:<span class=\"string\">&quot;num_9&quot;</span>,<span class=\"string\">&quot;0xe60e&quot;</span>:<span class=\"string\">&quot;num_&quot;</span>,<span class=\"string\">&quot;0xe60f&quot;</span>:<span class=\"string\">&quot;num_5&quot;</span>,<span class=\"string\">&quot;0xe60c&quot;</span>:<span class=\"string\">&quot;num_4&quot;</span>,   </span><br><span class=\"line\">    <span class=\"string\">&quot;0xe60d&quot;</span>:<span class=\"string\">&quot;num_1&quot;</span>,<span class=\"string\">&quot;0xe612&quot;</span>:<span class=\"string\">&quot;num_6&quot;</span>,<span class=\"string\">&quot;0xe613&quot;</span>:<span class=\"string\">&quot;num_8&quot;</span>,<span class=\"string\">&quot;0xe610&quot;</span>:<span class=\"string\">&quot;num_3&quot;</span>,<span class=\"string\">&quot;0xe611&quot;</span>:<span class=\"string\">&quot;num_2&quot;</span>,<span class=\"string\">&quot;0xe616&quot;</span>:<span class=\"string\">&quot;num_1&quot;</span>,<span class=\"string\">&quot;0xe617&quot;</span>:<span class=\"string\">&quot;num_3&quot;</span>,<span class=\"string\">&quot;0xe614&quot;</span>:<span class=\"string\">&quot;num_9&quot;</span>,<span class=\"string\">&quot;0xe615&quot;</span>:<span class=\"string\">&quot;num_7&quot;</span>,<span class=\"string\">&quot;0xe609&quot;</span>:<span class=\"string\">&quot;num_7&quot;</span>,<span class=\"string\">&quot;0xe607&quot;</span>:<span class=\"string\">&quot;num_5&quot;</span>,<span class=\"string\">&quot;0xe608&quot;</span>:<span class=\"string\">&quot;num_6&quot;</span>,<span class=\"string\">&quot;0xe61b&quot;</span>:<span class=\"string\">&quot;num_5&quot;</span>,  </span><br><span class=\"line\">        <span class=\"string\">&quot;0xe61c&quot;</span>:<span class=\"string\">&quot;num_8&quot;</span>,<span class=\"string\">&quot;0xe61a&quot;</span>:<span class=\"string\">&quot;num_2&quot;</span>,<span class=\"string\">&quot;0xe61f&quot;</span>:<span class=\"string\">&quot;num_6&quot;</span>,<span class=\"string\">&quot;0xe61d&quot;</span>:<span class=\"string\">&quot;num_9&quot;</span>,<span class=\"string\">&quot;0xe61e&quot;</span>:<span class=\"string\">&quot;num_7&quot;</span>&#125;  </span><br><span class=\"line\">mapCode2Font = &#123;<span class=\"string\">&quot;num_9&quot;</span>:<span class=\"number\">8</span>,<span class=\"string\">&quot;num_5&quot;</span>:<span class=\"number\">5</span>,<span class=\"string\">&quot;num_6&quot;</span>:<span class=\"number\">6</span>,<span class=\"string\">&quot;num_&quot;</span>:<span class=\"number\">1</span>,<span class=\"string\">&quot;num_7&quot;</span>:<span class=\"number\">9</span>,<span class=\"string\">&quot;num_8&quot;</span>:<span class=\"number\">7</span>,<span class=\"string\">&quot;num_1&quot;</span>:<span class=\"number\">0</span>,<span class=\"string\">&quot;num_2&quot;</span>:<span class=\"number\">3</span>,<span class=\"string\">&quot;num_3&quot;</span>:<span class=\"number\">2</span>,<span class=\"string\">&quot;num_4&quot;</span>:<span class=\"number\">4</span>&#125;  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">getUserInfo</span>(<span class=\"params\">shared_url, **headers</span>):  </span><br><span class=\"line\">    real_url = getRealAddress(shared_url)  </span><br><span class=\"line\">    parsed = urllib.parse.urlparse(real_url)  </span><br><span class=\"line\">    hostname = parsed.hostname  </span><br><span class=\"line\">    sec_uid = urllib.parse.parse_qs(parsed.query)[<span class=\"string\">&#x27;sec_uid&#x27;</span>]  </span><br><span class=\"line\">    user_info_url = <span class=\"string\">&quot;https://%s/web/api/v2/user/info/&quot;</span> % hostname  </span><br><span class=\"line\">    user_info_params = &#123; <span class=\"string\">&#x27;sec_uid&#x27;</span>: sec_uid &#125;  </span><br><span class=\"line\">    res = requests.get(user_info_url, headers=headers,  </span><br><span class=\"line\">                            params=user_info_params).json()  </span><br><span class=\"line\">    user_info = res[<span class=\"string\">&#x27;user_info&#x27;</span>]  </span><br><span class=\"line\">    user_avatar = user_info[<span class=\"string\">&#x27;avatar_larger&#x27;</span>][<span class=\"string\">&#x27;url_list&#x27;</span>][<span class=\"number\">2</span>]  </span><br><span class=\"line\">    user_nickname = user_info[<span class=\"string\">&#x27;nickname&#x27;</span>]  </span><br><span class=\"line\">    user_sign = user_info[<span class=\"string\">&#x27;signature&#x27;</span>]  </span><br><span class=\"line\">    user_id = user_info[<span class=\"string\">&#x27;unique_id&#x27;</span>]  </span><br><span class=\"line\">    count_of_videos = user_info[<span class=\"string\">&#x27;aweme_count&#x27;</span>]  </span><br><span class=\"line\">    follower_count = user_info[<span class=\"string\">&#x27;follower_count&#x27;</span>]  </span><br><span class=\"line\">    following_count = user_info[<span class=\"string\">&#x27;following_count&#x27;</span>]  </span><br><span class=\"line\">    zan_count = user_info[<span class=\"string\">&#x27;total_favorited&#x27;</span>]  </span><br><span class=\"line\">    like_count = user_info[<span class=\"string\">&#x27;favoriting_count&#x27;</span>]  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&#x27;user_avatar&#x27;</span>:user_avatar, <span class=\"string\">&#x27;user_nickname&#x27;</span>:user_nickname, <span class=\"string\">&#x27;user_sign&#x27;</span>:user_sign, <span class=\"string\">&#x27;user_id&#x27;</span>:user_id,  </span><br><span class=\"line\">           <span class=\"string\">&#x27;count_of_videos&#x27;</span>:count_of_videos, <span class=\"string\">&#x27;follower_count&#x27;</span>:follower_count, <span class=\"string\">&#x27;following_count&#x27;</span>:following_count,  </span><br><span class=\"line\">           <span class=\"string\">&#x27;zan_count&#x27;</span>:zan_count, <span class=\"string\">&#x27;like_count&#x27;</span>:like_count, <span class=\"string\">&#x27;like_count&#x27;</span>:like_count&#125;  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">getUserVideos</span>(<span class=\"params\">url</span>):  </span><br><span class=\"line\">    <span class=\"comment\"># number = re.findall(r&#x27;share/user/(d+)&#x27;, url)  </span></span><br><span class=\"line\">    number = url.split(<span class=\"string\">&#x27;share/user/&#x27;</span>)[<span class=\"number\">1</span>].split(<span class=\"string\">&#x27;?&#x27;</span>)[<span class=\"number\">0</span>]  </span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> <span class=\"built_in\">len</span>(number):  </span><br><span class=\"line\">        <span class=\"keyword\">return</span>  </span><br><span class=\"line\">    dytk = get_dytk(url)  </span><br><span class=\"line\">    <span class=\"comment\"># hostname = urllib.parse.urlparse(url).hostname  </span></span><br><span class=\"line\">    <span class=\"comment\"># if hostname != &#x27;t.tiktok.com&#x27; and not dytk:  </span></span><br><span class=\"line\">    <span class=\"comment\">#     return  </span></span><br><span class=\"line\">    user_id = number[<span class=\"number\">0</span>]  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> getUserMedia(user_id, dytk, url)  </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">getRealAddress</span>(<span class=\"params\">url</span>):  </span><br><span class=\"line\">    <span class=\"keyword\">if</span> url.find(<span class=\"string\">&#x27;v.douyin.com&#x27;</span>) &amp;lt; <span class=\"number\">0</span>:  </span><br><span class=\"line\">        <span class=\"keyword\">return</span> url  </span><br><span class=\"line\">    res = requests.get(url, headers=headers, allow_redirects=<span class=\"literal\">False</span>)  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> res.headers[<span class=\"string\">&#x27;Location&#x27;</span>] <span class=\"keyword\">if</span> res.status_code == <span class=\"number\">302</span> <span class=\"keyword\">else</span> <span class=\"literal\">None</span>  </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_dytk</span>(<span class=\"params\">url</span>):  </span><br><span class=\"line\">    res = requests.get(url, headers=headers)  </span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> res:  </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">None</span>  </span><br><span class=\"line\">    dytk = re.findall(<span class=\"string\">&quot;dytk: &#x27;(.*)&#x27;&quot;</span>, res.content.decode(<span class=\"string\">&#x27;utf-8&#x27;</span>))  </span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(dytk):  </span><br><span class=\"line\">        <span class=\"keyword\">return</span> dytk[<span class=\"number\">0</span>]  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">None</span>  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">getUserMedia</span>(<span class=\"params\">user_id, dytk, url</span>):  </span><br><span class=\"line\">    videos = []  </span><br><span class=\"line\">    parsed = urllib.parse.urlparse(url)  </span><br><span class=\"line\">    hostname = parsed.hostname  </span><br><span class=\"line\">    sec_uid = urllib.parse.parse_qs(parsed.query)[<span class=\"string\">&#x27;sec_uid&#x27;</span>]  </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">#signature = generateSignature(str(user_id))  </span></span><br><span class=\"line\">    user_video_url = <span class=\"string\">&quot;https://%s/web/api/v2/aweme/post/&quot;</span> % hostname  </span><br><span class=\"line\">    user_video_params = &#123;  </span><br><span class=\"line\">        <span class=\"string\">&#x27;sec_uid&#x27;</span>: sec_uid,  </span><br><span class=\"line\">        <span class=\"string\">&#x27;count&#x27;</span>: <span class=\"string\">&#x27;21&#x27;</span>,  </span><br><span class=\"line\">        <span class=\"string\">&#x27;max_cursor&#x27;</span>: <span class=\"string\">&#x27;0&#x27;</span>,  </span><br><span class=\"line\">        <span class=\"string\">&#x27;aid&#x27;</span>: <span class=\"string\">&#x27;1128&#x27;</span>,  </span><br><span class=\"line\">        <span class=\"string\">&#x27;_signature&#x27;</span>: <span class=\"string\">&#x27;2Vx9mxAZh0o-K4Wdv7NFKNlcfY&#x27;</span>,  </span><br><span class=\"line\">        <span class=\"string\">&#x27;dytk&#x27;</span>: dytk  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">    <span class=\"keyword\">if</span> hostname == <span class=\"string\">&#x27;t.tiktok.com&#x27;</span>:  </span><br><span class=\"line\">        user_video_params.pop(<span class=\"string\">&#x27;dytk&#x27;</span>)  </span><br><span class=\"line\">        user_video_params[<span class=\"string\">&#x27;aid&#x27;</span>] = <span class=\"string\">&#x27;1180&#x27;</span>  </span><br><span class=\"line\"></span><br><span class=\"line\">    max_cursor, video_count = <span class=\"literal\">None</span>, <span class=\"number\">0</span>  </span><br><span class=\"line\">    <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:  </span><br><span class=\"line\">        <span class=\"keyword\">if</span> max_cursor:  </span><br><span class=\"line\">            user_video_params[<span class=\"string\">&#x27;max_cursor&#x27;</span>] = <span class=\"built_in\">str</span>(max_cursor)  </span><br><span class=\"line\">        res = requests.get(user_video_url, headers=headers,  </span><br><span class=\"line\">                            params=user_video_params)  </span><br><span class=\"line\">        contentJson = json.loads(res.content.decode(<span class=\"string\">&#x27;utf-8&#x27;</span>))  </span><br><span class=\"line\">        aweme_list = contentJson.get(<span class=\"string\">&#x27;aweme_list&#x27;</span>, [])  </span><br><span class=\"line\">        <span class=\"keyword\">for</span> aweme <span class=\"keyword\">in</span> aweme_list:  </span><br><span class=\"line\">            video_count += <span class=\"number\">1</span>  </span><br><span class=\"line\">            aweme[<span class=\"string\">&#x27;hostname&#x27;</span>] = hostname  </span><br><span class=\"line\">            video =  &#123;  </span><br><span class=\"line\">                <span class=\"string\">&#x27;addr&#x27;</span>: aweme[<span class=\"string\">&#x27;video&#x27;</span>][<span class=\"string\">&#x27;play_addr&#x27;</span>][<span class=\"string\">&#x27;url_list&#x27;</span>][<span class=\"number\">0</span>],  </span><br><span class=\"line\">                <span class=\"string\">&#x27;desc&#x27;</span>: aweme[<span class=\"string\">&#x27;desc&#x27;</span>],  </span><br><span class=\"line\">                <span class=\"string\">&#x27;duration&#x27;</span>: aweme[<span class=\"string\">&#x27;video&#x27;</span>][<span class=\"string\">&#x27;duration&#x27;</span>],  </span><br><span class=\"line\">                <span class=\"string\">&#x27;cover&#x27;</span>: aweme[<span class=\"string\">&#x27;video&#x27;</span>][<span class=\"string\">&#x27;cover&#x27;</span>][<span class=\"string\">&#x27;url_list&#x27;</span>][<span class=\"number\">0</span>],  </span><br><span class=\"line\">                <span class=\"string\">&#x27;statistics&#x27;</span>: aweme[<span class=\"string\">&#x27;statistics&#x27;</span>]  </span><br><span class=\"line\">            &#125;  </span><br><span class=\"line\">            videos.append(video)  </span><br><span class=\"line\">        <span class=\"keyword\">if</span> contentJson.get(<span class=\"string\">&#x27;has_more&#x27;</span>):  </span><br><span class=\"line\">            max_cursor = contentJson.get(<span class=\"string\">&#x27;max_cursor&#x27;</span>)  </span><br><span class=\"line\">        <span class=\"keyword\">else</span>:  </span><br><span class=\"line\">            <span class=\"keyword\">break</span>  </span><br><span class=\"line\">    </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> video_count == <span class=\"number\">0</span>:  </span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;There&#x27;s no video in number %s.&quot;</span> % user_id)  </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> videos  </span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">getHtml</span>(<span class=\"params\">url,**headers</span>):  </span><br><span class=\"line\">    <span class=\"keyword\">try</span>:  </span><br><span class=\"line\">        req = urllib.request.Request(url,headers=headers)  </span><br><span class=\"line\">        resp = urllib.request.urlopen(req)  </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">str</span>(resp.read(), <span class=\"string\">&#x27;utf-8&#x27;</span>)  </span><br><span class=\"line\">    <span class=\"keyword\">except</span> urllib.error.HTTPError <span class=\"keyword\">as</span> e:  </span><br><span class=\"line\">        <span class=\"built_in\">print</span>(e.msg)  </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;&#x27;</span>  </span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">woff2tff</span>(<span class=\"params\">ls</span>):  </span><br><span class=\"line\">    res = <span class=\"string\">&#x27;&#x27;</span>  </span><br><span class=\"line\">    <span class=\"keyword\">for</span> s <span class=\"keyword\">in</span> ls:  </span><br><span class=\"line\">       res = res + formatNum(s)  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> res  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">splitByChinese</span>(<span class=\"params\">s</span>):  </span><br><span class=\"line\">    p = re.<span class=\"built_in\">compile</span>(<span class=\"string\">&quot;[u4e00-u9fa5]&quot;</span>, re.U)  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> p.split(s)  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">isChinese</span>(<span class=\"params\">s</span>):  </span><br><span class=\"line\">    p = re.<span class=\"built_in\">compile</span>(<span class=\"string\">&quot;[u4e00-u9fa5]&quot;</span>, re.U)  </span><br><span class=\"line\">    result = p.<span class=\"keyword\">match</span>(s)  </span><br><span class=\"line\">    <span class=\"keyword\">if</span> result :  </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">True</span>  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">False</span>  </span><br><span class=\"line\">      </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">formatNum</span>(<span class=\"params\">s</span>):  </span><br><span class=\"line\">    <span class=\"keyword\">if</span> isChinese(s):  </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;&#x27;</span>  </span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(s)&amp;lt;<span class=\"number\">8</span> <span class=\"keyword\">or</span> s.find(<span class=\"string\">&quot;hzsdxe6&quot;</span>) &amp;lt; <span class=\"number\">0</span> :  </span><br><span class=\"line\">        <span class=\"keyword\">return</span> s  </span><br><span class=\"line\">    s1 = <span class=\"string\">&#x27;0&#x27;</span>+s[<span class=\"number\">4</span>:-<span class=\"number\">1</span>]  </span><br><span class=\"line\">    res = mapCode2Font[mapCode2Name[s1]]  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">str</span>(res)  </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">getUserAll</span>(<span class=\"params\">shared_url</span>):  </span><br><span class=\"line\">    profile = getUserInfo(shared_url, **HEADERS)  </span><br><span class=\"line\">    <span class=\"keyword\">if</span> profile:  </span><br><span class=\"line\">        videos = getUserVideos(getRealAddress(shared_url))  </span><br><span class=\"line\">        profile[<span class=\"string\">&#x27;videos&#x27;</span>] = videos  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> profile  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">download_csv</span>(<span class=\"params\">file_path,video</span>):  </span><br><span class=\"line\">    result_headers = [(<span class=\"string\">&#x27;标题内容&#x27;</span>, <span class=\"string\">&#x27;desc&#x27;</span>), (<span class=\"string\">&#x27;视频时长&#x27;</span>, <span class=\"string\">&#x27;duration&#x27;</span>),  </span><br><span class=\"line\">                      (<span class=\"string\">&#x27;点赞数&#x27;</span>, <span class=\"string\">&#x27;share_count&#x27;</span>),  </span><br><span class=\"line\">                      (<span class=\"string\">&#x27;原始视频url&#x27;</span>, <span class=\"string\">&#x27;url&#x27;</span>),  </span><br><span class=\"line\">                      (<span class=\"string\">&#x27;视频存储位置&#x27;</span>,<span class=\"string\">&#x27;id&#x27;</span>),  </span><br><span class=\"line\">                      (<span class=\"string\">&#x27;缩略图&#x27;</span>,<span class=\"string\">&#x27;cover&#x27;</span>),  </span><br><span class=\"line\">                      (<span class=\"string\">&#x27;缩略图id&#x27;</span>,<span class=\"string\">&#x27;cover_id&#x27;</span>)]  </span><br><span class=\"line\"></span><br><span class=\"line\">    result_data = [[w[kv[<span class=\"number\">1</span>]] <span class=\"keyword\">for</span> kv <span class=\"keyword\">in</span> result_headers]  </span><br><span class=\"line\">                   <span class=\"keyword\">for</span> w <span class=\"keyword\">in</span> video]  </span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(file_path, <span class=\"string\">&#x27;a&#x27;</span>, encoding=<span class=\"string\">&#x27;utf-8-sig&#x27;</span>,  </span><br><span class=\"line\">              newline=<span class=\"string\">&#x27;&#x27;</span>) <span class=\"keyword\">as</span> f:  </span><br><span class=\"line\">        writer = csv.writer(f)  </span><br><span class=\"line\">        writer.writerows([[kv[<span class=\"number\">0</span>] <span class=\"keyword\">for</span> kv <span class=\"keyword\">in</span> result_headers]])  </span><br><span class=\"line\">        writer.writerows(result_data)  </span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> video:  </span><br><span class=\"line\">        <span class=\"comment\"># 下载视频  </span></span><br><span class=\"line\">        download_video(i[<span class=\"string\">&#x27;url&#x27;</span>],i[<span class=\"string\">&#x27;id&#x27;</span>])  </span><br><span class=\"line\">        <span class=\"comment\"># 下载视频的缩略图  </span></span><br><span class=\"line\">        download_min_jpg(i[<span class=\"string\">&#x27;cover&#x27;</span>],i[<span class=\"string\">&#x27;cover_id&#x27;</span>])  </span><br><span class=\"line\">    logging.info(<span class=\"string\">u&#x27;%d条微博写入csv文件完毕，保存路径：%s&#x27;</span>, <span class=\"built_in\">len</span>(video), file_path)  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">download_video</span>(<span class=\"params\">url,<span class=\"built_in\">id</span></span>):  </span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;下载文件(图片/视频)&quot;&quot;&quot;</span>  </span><br><span class=\"line\">    path = <span class=\"string\">&quot;/Users/mac/Desktop/data/douyin3/&quot;</span>  </span><br><span class=\"line\">    r = requests.get(url)  <span class=\"comment\"># 获取到目标视频的所有信息  </span></span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(path+<span class=\"built_in\">id</span>+<span class=\"string\">&quot;.mp4&quot;</span>, <span class=\"string\">&#x27;wb&#x27;</span>) <span class=\"keyword\">as</span> f:  <span class=\"comment\"># 以二进制写的方式将r的二进制内容写入path  </span></span><br><span class=\"line\">        f.write(r.content)  </span><br><span class=\"line\">        f.close()  </span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;视频文件保存成功&quot;</span>)  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">download_min_jpg</span>(<span class=\"params\">url,<span class=\"built_in\">id</span></span>):  </span><br><span class=\"line\">    path = <span class=\"string\">&quot;/Users/mac/Desktop/data/douyin3/&quot;</span>  </span><br><span class=\"line\">    r = requests.get(url)  <span class=\"comment\"># 获取到目标视频的所有信息  </span></span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(path + <span class=\"built_in\">id</span> + <span class=\"string\">&quot;.jpg&quot;</span>, <span class=\"string\">&#x27;wb&#x27;</span>) <span class=\"keyword\">as</span> f:  <span class=\"comment\"># 以二进制写的方式将r的二进制内容写入path  </span></span><br><span class=\"line\">        f.write(r.content)  </span><br><span class=\"line\">        f.close()  </span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;缩略图保存成功&quot;</span>)  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:  </span><br><span class=\"line\">    userInfo = getUserAll(<span class=\"string\">&quot;https://v.douyin.com/FNyoaSR/&quot;</span>)  </span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"built_in\">len</span>(userInfo[<span class=\"string\">&#x27;videos&#x27;</span>]))  </span><br><span class=\"line\">    <span class=\"built_in\">print</span>(userInfo)  </span><br><span class=\"line\">    <span class=\"built_in\">list</span> = []  </span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> userInfo[<span class=\"string\">&#x27;videos&#x27;</span>]:  </span><br><span class=\"line\">        <span class=\"comment\"># 点赞数  </span></span><br><span class=\"line\">        share_count = i[<span class=\"string\">&#x27;statistics&#x27;</span>][<span class=\"string\">&#x27;share_count&#x27;</span>]  </span><br><span class=\"line\">        <span class=\"comment\"># 原始视频地址  </span></span><br><span class=\"line\">        url = i[<span class=\"string\">&#x27;addr&#x27;</span>]  </span><br><span class=\"line\">        <span class=\"comment\">#视频时长  </span></span><br><span class=\"line\">        duration = i[<span class=\"string\">&#x27;duration&#x27;</span>]  </span><br><span class=\"line\">        <span class=\"comment\"># 标题内容  将ascii码转为中文  </span></span><br><span class=\"line\">        desc = i[<span class=\"string\">&#x27;desc&#x27;</span>]  </span><br><span class=\"line\">        uid = <span class=\"built_in\">str</span>(uuid.uuid4())  </span><br><span class=\"line\">        suid = <span class=\"string\">&#x27;&#x27;</span>.join(uid.split(<span class=\"string\">&#x27;-&#x27;</span>))  </span><br><span class=\"line\">        <span class=\"comment\"># 缩略图 url  </span></span><br><span class=\"line\">        cover =  i[<span class=\"string\">&#x27;cover&#x27;</span>]  </span><br><span class=\"line\">        <span class=\"comment\"># 缩略图id  </span></span><br><span class=\"line\">        cover_id = suid+<span class=\"string\">&quot;_min&quot;</span>  </span><br><span class=\"line\">        list1 = &#123;<span class=\"string\">&#x27;desc&#x27;</span>: desc, <span class=\"string\">&#x27;duration&#x27;</span>: duration, <span class=\"string\">&#x27;share_count&#x27;</span>: share_count,  </span><br><span class=\"line\">                 <span class=\"string\">&#x27;url&#x27;</span>: url, <span class=\"string\">&#x27;id&#x27;</span>: suid, <span class=\"string\">&#x27;cover&#x27;</span>: cover, <span class=\"string\">&#x27;cover_id&#x27;</span>: cover_id&#125;  </span><br><span class=\"line\">        <span class=\"built_in\">list</span>.append(list1)  </span><br><span class=\"line\">    <span class=\"comment\">#print(list)  </span></span><br><span class=\"line\">    filepath = <span class=\"string\">&#x27;/Users/mac/Desktop/data/douyin3/douyin.csv&#x27;</span>  </span><br><span class=\"line\">    download_csv(filepath,<span class=\"built_in\">list</span>)</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"1-1-3-微信\"><a href=\"#1-1-3-微信\" class=\"headerlink\" title=\"1. 1. 3 微信\"></a>1. 1. 3 微信</h4><p>在之前的操作中，将获取到的cookie存储到txt文档中，之后有用到的时候取，目前登录的cookie值是在2-4个小时内失效的。</p>\n<p>在通过Selenium，控制浏览器后，微信会出现一个二维码页面，需要扫描二维码才能登录，这一步只能人工去解决。</p>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104841428.png\" alt=\"image-20221010104841428\"></p>\n<p>进入微信公众号平台后，找到相应的位置，剩下的是找到安科院下的两个微信公众号的请求链接地址，分析里面的参数。</p>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104852717.png\" alt=\"image-20221010104852717\"></p>\n<p>继续点击下一页，看看每一页哪些参数发生了变化，有没有规律，经分析得到了begin是变化的，并且是按照5的倍数递增的，之后就是请求每一页的数据，然后获取到发送的每一条数据的信息。在这期间，被封过几次号，爬取的太频繁的话，微信会对访问公众号进行限制，大概一天解封。</p>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104902165.png\" alt=\"image-20221010104902165\"></p>\n<p>找到规律后，就是循环替换请求参数，然后去访问获取到公众号发布文章的链接地址和时间。</p>\n","site":{"data":{"link":[{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"动漫图片和壁纸","link":"https://anime-pictures.net/?lang=zh_CN","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"图片网站"},{"name":"Wallhaven","link":"https://wallhaven.cc/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"4k图片网站"},{"name":"WALLPAPER ABYSS","link":"https://wall.alphacoders.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"WALLPAPER ABYSS"},{"name":"极简壁纸","link":"https://bz.zzzmh.cn/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"极简壁纸"},{"name":"Wallroom","link":"https://wallroom.io/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"Wallroom"}]}]}},"excerpt":"","more":"<h1 id=\"爬虫的简单介绍\"><a href=\"#爬虫的简单介绍\" class=\"headerlink\" title=\"爬虫的简单介绍\"></a>爬虫的简单介绍</h1><h2 id=\"场景\"><a href=\"#场景\" class=\"headerlink\" title=\"场景\"></a>场景</h2><p>对于爬取数据来说，有在不同的场景下爬取数据。绝大多数的情况下，要么是网页，要么是app。这里就简单的介绍一下这两个类别吧。</p>\n<p>分享一个爬虫案例平台，可以上去测试各种各样的爬虫： <a href=\"https://scrape.center/\">https://scrape.center</a></p>\n<p>java爬虫的一个样例，可以瞅瞅： <a href=\"https://juejin.cn/post/6844904064736559117\">https://juejin.cn/post/6844904064736559117</a></p>\n<ul>\n<li><p>网页爬取</p>\n<ul>\n<li><p>服务端渲染</p>\n</li>\n<li><p>客户端渲染</p>\n</li>\n</ul>\n</li>\n<li><p>App爬取</p>\n<ul>\n<li><p>普通接口</p>\n</li>\n<li><p>加密参数接口</p>\n</li>\n<li><p>加密内容接口</p>\n</li>\n<li><p>非常规协议接口</p>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"爬取——网页爬取\"><a href=\"#爬取——网页爬取\" class=\"headerlink\" title=\"爬取——网页爬取\"></a>爬取——网页爬取</h2><p>服务端渲染的意思就是页面的结果是由服务器渲染后返回的，有效信息包含在请求的HTML页面里面，比如猫眼电影这个站点。</p>\n<p>客户端渲染的意思就是页面的主要内容是由JavaScript渲染而成，真实的数据是通过Ajax接口的形式获取的，比如淘宝、微博等等站点。</p>\n<p>下图是一个电影网站的榜单数据，这是直接在html页面中渲染出来的：</p>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104624247.png\" alt=\"image-20221010104624247\"></p>\n<p>附上源代码：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests  </span><br><span class=\"line\"><span class=\"keyword\">from</span> bs4 <span class=\"keyword\">import</span> BeautifulSoup  </span><br><span class=\"line\"><span class=\"keyword\">import</span> lxml  </span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">spdier_maoyan</span>(<span class=\"params\">url</span>):  </span><br><span class=\"line\">    headers = &#123;  </span><br><span class=\"line\">        <span class=\"string\">&quot;Accept&quot;</span>: <span class=\"string\">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span>,  </span><br><span class=\"line\">        <span class=\"string\">&quot;Accept-Encoding&quot;</span>: <span class=\"string\">&quot;gzip, deflate, br&quot;</span>,  </span><br><span class=\"line\">        <span class=\"string\">&quot;Accept-Language&quot;</span>: <span class=\"string\">&quot;zh-CN,zh;q=0.9&quot;</span>,  </span><br><span class=\"line\">        <span class=\"string\">&quot;Cookie&quot;</span>: <span class=\"string\">&quot;UM_distinctid=180690fa304d50-049f7b7b2b113d-53580614-13c680-180690fa3057ff&quot;</span>,  </span><br><span class=\"line\">        <span class=\"string\">&quot;Host&quot;</span>: <span class=\"string\">&quot;ssr1.scrape.center&quot;</span>,  </span><br><span class=\"line\">        <span class=\"string\">&quot;Referer&quot;</span>: <span class=\"string\">&quot;https://ssr1.scrape.center/&quot;</span>,  </span><br><span class=\"line\">        <span class=\"string\">&quot;User-Agent&quot;</span>: <span class=\"string\">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.127 Safari/537.36&quot;</span>,  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">    response = requests.get(url, headers=headers)  </span><br><span class=\"line\">    text = response.text  </span><br><span class=\"line\">    soup = BeautifulSoup(response.text, <span class=\"string\">&#x27;lxml&#x27;</span>)  </span><br><span class=\"line\">    all_div = soup.find_all(<span class=\"string\">&#x27;div&#x27;</span>,attrs=&#123;<span class=\"string\">&quot;el-card item m-t is-hover-shadow&quot;</span>&#125;)  </span><br><span class=\"line\">    <span class=\"keyword\">for</span> div <span class=\"keyword\">in</span> all_div:  </span><br><span class=\"line\">        a = div.find(<span class=\"string\">&#x27;a&#x27;</span>)  </span><br><span class=\"line\">        title = div.find(<span class=\"string\">&#x27;h2&#x27;</span>)  </span><br><span class=\"line\">        <span class=\"built_in\">print</span>(url+a[<span class=\"string\">&#x27;href&#x27;</span>])  </span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;title&#x27;</span>,title.text)  </span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 按间距中的绿色按钮以运行脚本。  </span></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:  </span><br><span class=\"line\">    url = <span class=\"string\">&#x27;https://ssr1.scrape.center&#x27;</span>  </span><br><span class=\"line\">    spdier_maoyan(url)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>服务端渲染的情况就比较简单了，用一些基本的 HTTP 请求库就可以实现爬取，如 urllib、urllib3、pycurl、hyper、requests、grab 等框架，其中应用最多的可能就是 requests 了。</p>\n<p>客户端渲染的情况如下：</p>\n<ul>\n<li><p>寻找Ajax接口，可以通过浏览器的开发者工具直接查看Ajax请求方式。</p>\n</li>\n<li><p>模拟浏览器进行爬取，这种可用于网页接口较为复杂的情况。例如。可以使用Selenium、异步Asyncio + Pyppeteer等等</p>\n</li>\n<li><p>复杂一点的，就是要获取到网页的js，然后执行js获取到数据</p>\n</li>\n</ul>\n<h2 id=\"爬取——App爬取\"><a href=\"#爬取——App爬取\" class=\"headerlink\" title=\"爬取——App爬取\"></a>爬取——App爬取</h2><p>这里分了几种情况：</p>\n<ul>\n<li><p>对于普通无加密接口，这种直接通过抓包软件，拿到接口的具体请求形式就ok了。可用的抓包工具有Charles、Fiddler、mitmproxy。</p>\n</li>\n<li><p>对于一些加密参数的接口，一种方法是可以实时处理的，例如Fiddler、mitmproxy、Xposed等等，另一种方法是将加密逻辑破解，这里就涉及到反编译的技巧了</p>\n</li>\n<li><p>对于一些加密内容的忌口，接口返回结果完全看不懂是什么东西，可以使用可见即可爬的工具 Appium，也可以使用 Xposed 来 hook 获取渲染结果，也可以通过反编译和改写手机底层来实现破解。这里可以举一个例子，【得道App】，这个App的数据内容是加密的，可以拿这个软件试手，网上也有很多爬取【得道App】的例子。</p>\n</li>\n</ul>\n<h2 id=\"反爬的一些常见情况\"><a href=\"#反爬的一些常见情况\" class=\"headerlink\" title=\"反爬的一些常见情况\"></a>反爬的一些常见情况</h2><ul>\n<li><p>非浏览器检测：识别请求头Headers里面有咩有包含User-Agent</p>\n</li>\n<li><p>封Ip：一个Ip如果频繁访问，会被封禁</p>\n</li>\n<li><p>弹验证码框：输入验证码之后才能看到网页</p>\n</li>\n</ul>\n<h2 id=\"反反爬\"><a href=\"#反反爬\" class=\"headerlink\" title=\"反反爬\"></a>反反爬</h2><ul>\n<li><p>非浏览器检测</p>\n<ul>\n<li>这个相对来说是最简单的，可以自己做一个User-Agent的数组，用到时从中取一个就行，或者直接借用python的第三方模块【fake-useragent】。</li>\n</ul>\n</li>\n<li><p>封Ip</p>\n<ul>\n<li>这种情况的话，可以使用代理去访问，可以先去爬取代理网站，做一个代理池，每次切换不同的ip代理去访问网页，这样可以避免频繁访问封锁ip</li>\n</ul>\n</li>\n<li><p>弹验证码框，验证码分为非常多种，如普通图形验证码、算术题验证码、滑动验证码、点触验证码、手机验证码、扫二维码等。</p>\n<ul>\n<li><p>对于普通图形验证码，如果非常规整且没有变形或干扰，可以使用 OCR 识别，也可以使用机器学习、深度学习来进行模型训练，当然打码平台是最方便的方式。</p>\n</li>\n<li><p>对于算术题验证码，推荐直接使用打码平台。</p>\n</li>\n<li><p>对于滑动验证码，可以使用破解算法，也可以模拟滑动。后者的关键在于缺口的找寻，可以使用图片比对，也可以写基本的图形识别算法，也可以对接打码平台，也可以使用深度学习训练识别接口。</p>\n</li>\n<li><p>对于点触验证码，推荐使用打码平台。</p>\n</li>\n<li><p>对于手机验证码，可以使用验证码分发平台，也可以购买专门的收码设备，也可以人工验证。</p>\n</li>\n<li><p>对于扫二维码，可以人工扫码，也可以对接打码平台。【这里对应的一个场景，就是微信公众号】</p>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"加速爬取\"><a href=\"#加速爬取\" class=\"headerlink\" title=\"加速爬取\"></a>加速爬取</h2><p>当爬取的数据量非常大时，如何高效快速地进行数据抓取是关键。常见的措施有多线程、多进程、异步、分布式、细节优化等。</p>\n<p>这里就不多介绍了。</p>\n<h2 id=\"数据存储\"><a href=\"#数据存储\" class=\"headerlink\" title=\"数据存储\"></a>数据存储</h2><p>这个根据具体实际情况，用不同的方式进行存储，有用Mysql、MongoDB这类数据进行数据存储的，也可以用TXT、Excel等形式进行数据存储。选哪一种都可以。</p>\n<h2 id=\"爬虫框架\"><a href=\"#爬虫框架\" class=\"headerlink\" title=\"爬虫框架\"></a>爬虫框架</h2><p>主流的爬虫框架有Scrapy(Python) 、Pyspider(Python)、Apache Nutch(高大上)、WebMagic(Java爬虫框架)、WebCollector(Java爬虫框架)等等。</p>\n<h2 id=\"1、在公司接触过的爬虫\"><a href=\"#1、在公司接触过的爬虫\" class=\"headerlink\" title=\"1、在公司接触过的爬虫\"></a>1、在公司接触过的爬虫</h2><ul>\n<li>在安科院时，爬取抖音、微博、微信的数据</li>\n</ul>\n<h3 id=\"1-1-抖音、微博、微信数据爬取\"><a href=\"#1-1-抖音、微博、微信数据爬取\" class=\"headerlink\" title=\"1. 1    抖音、微博、微信数据爬取\"></a>1. 1    抖音、微博、微信数据爬取</h3><h4 id=\"1-1-1-微博\"><a href=\"#1-1-1-微博\" class=\"headerlink\" title=\"1. 1. 1    微博\"></a>1. 1. 1    微博</h4><p>像微博的话，它的源网址是 <a href=\"https://passport.weibo.cn/signin/login\">https://passport.weibo.cn/signin/login</a>。点击进入网址后，是需要进行登录的。下面这张图是登录之后的页面</p>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104652413.png\" alt=\"image-20221010104652413\"></p>\n<p>然后打开开发者工具去看请求参数，</p>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104713891.png\" alt=\"image-20221010104713891\"></p>\n<p>代码已经封存好了，直接输入uid就可以进行爬取了，这里附上gitlab上的项目链接 <a href=\"https://github.com/dataabc/weiboSpider\">https://github.com/dataabc/weiboSpider</a></p>\n<p>由于业务场景需要，需要视频的缩略图，我这里借用了第三方的工具和模块，取第一帧作为视频缩略图。附上代码，</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> ffmpy  </span><br><span class=\"line\"><span class=\"comment\"># 将视频的第一帧取下来，作为视频的缩略图存下来  </span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_thumbnail_from_video</span>(<span class=\"params\">video_path</span>):  </span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;开始将视频转换为缩略图&quot;</span>)  </span><br><span class=\"line\">    thumbnail_path = video_path.replace(<span class=\"string\">&quot;.mp4&quot;</span>, <span class=\"string\">&quot;_min.jpg&quot;</span>)  </span><br><span class=\"line\">    ff = ffmpy.FFmpeg(  </span><br><span class=\"line\">        inputs=&#123;video_path: <span class=\"literal\">None</span>&#125;,  </span><br><span class=\"line\">        outputs=&#123;thumbnail_path: [<span class=\"string\">&#x27;-ss&#x27;</span>, <span class=\"string\">&#x27;00:00:00.000&#x27;</span>, <span class=\"string\">&#x27;-vframes&#x27;</span>, <span class=\"string\">&#x27;1&#x27;</span>]&#125;  </span><br><span class=\"line\">    )  </span><br><span class=\"line\">    ff.run()  </span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;转换为缩略图结束&quot;</span>)  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> thumbnail_path</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"1-1-2-抖音\"><a href=\"#1-1-2-抖音\" class=\"headerlink\" title=\"1. 1. 2    抖音\"></a>1. 1. 2    抖音</h4><p>首先，获取源网页，这里就不用App进行爬取了，这里应用的通过手机App上的个人主页获取到抖音的链接，之后就可以通过这个链接进行分析，进行爬取了。就举一个例子吧，以目前最火的刘畊宏为例，</p>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104735019.png\" alt=\"image-20221010104735019\"></p>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104749532.png\" alt=\"image-20221010104749532\"></p>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104803277.png\" alt=\"image-20221010104803277\"></p>\n<p>在获取到链接后，将链接替换掉，运行脚本，就可以将数据爬取下来了。</p>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104816216.png\" alt=\"image-20221010104816216\"></p>\n<p>#!&#x2F;usr&#x2F;bin&#x2F;python  </p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-  </span></span><br><span class=\"line\"><span class=\"keyword\">from</span> bs4 <span class=\"keyword\">import</span> BeautifulSoup  </span><br><span class=\"line\"><span class=\"keyword\">import</span> requests  </span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib.request  </span><br><span class=\"line\"><span class=\"keyword\">import</span> urllib  </span><br><span class=\"line\"><span class=\"keyword\">import</span> json  </span><br><span class=\"line\"><span class=\"keyword\">import</span> re  </span><br><span class=\"line\"><span class=\"keyword\">import</span> csv  </span><br><span class=\"line\"><span class=\"keyword\">import</span> os  </span><br><span class=\"line\"><span class=\"keyword\">import</span> uuid  </span><br><span class=\"line\"><span class=\"keyword\">import</span> logging  </span><br><span class=\"line\"></span><br><span class=\"line\">headers = &#123;  </span><br><span class=\"line\">    <span class=\"string\">&#x27;accept-encoding&#x27;</span>: <span class=\"string\">&#x27;deflate&#x27;</span>,  </span><br><span class=\"line\">    <span class=\"string\">&#x27;accept-language&#x27;</span>: <span class=\"string\">&#x27;zh-CN,zh;q=0.9&#x27;</span>,  </span><br><span class=\"line\">    <span class=\"string\">&#x27;pragma&#x27;</span>: <span class=\"string\">&#x27;no-cache&#x27;</span>,  </span><br><span class=\"line\">    <span class=\"string\">&#x27;cache-control&#x27;</span>: <span class=\"string\">&#x27;no-cache&#x27;</span>,  </span><br><span class=\"line\">    <span class=\"string\">&#x27;upgrade-insecure-requests&#x27;</span>: <span class=\"string\">&#x27;1&#x27;</span>,  </span><br><span class=\"line\">    <span class=\"string\">&#x27;user-agent&#x27;</span>: <span class=\"string\">&quot;Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1&quot;</span>,  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\"></span><br><span class=\"line\">HEADERS = &#123;<span class=\"string\">&#x27;user-agent&#x27;</span>: <span class=\"string\">&quot;Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1&quot;</span>&#125;  </span><br><span class=\"line\"></span><br><span class=\"line\">mapCode2Name = &#123;<span class=\"string\">&quot;0xe602&quot;</span>:<span class=\"string\">&quot;num_&quot;</span>,<span class=\"string\">&quot;0xe605&quot;</span>:<span class=\"string\">&quot;num_3&quot;</span>,<span class=\"string\">&quot;0xe606&quot;</span>:<span class=\"string\">&quot;num_4&quot;</span>,<span class=\"string\">&quot;0xe603&quot;</span>:<span class=\"string\">&quot;num_1&quot;</span>,<span class=\"string\">&quot;0xe604&quot;</span>:<span class=\"string\">&quot;num_2&quot;</span>,<span class=\"string\">&quot;0xe618&quot;</span>:<span class=\"string\">&quot;num_&quot;</span>,<span class=\"string\">&quot;0xe619&quot;</span>:<span class=\"string\">&quot;num_4&quot;</span>,<span class=\"string\">&quot;0xe60a&quot;</span>:<span class=\"string\">&quot;num_8&quot;</span>,<span class=\"string\">&quot;0xe60b&quot;</span>:<span class=\"string\">&quot;num_9&quot;</span>,<span class=\"string\">&quot;0xe60e&quot;</span>:<span class=\"string\">&quot;num_&quot;</span>,<span class=\"string\">&quot;0xe60f&quot;</span>:<span class=\"string\">&quot;num_5&quot;</span>,<span class=\"string\">&quot;0xe60c&quot;</span>:<span class=\"string\">&quot;num_4&quot;</span>,   </span><br><span class=\"line\">    <span class=\"string\">&quot;0xe60d&quot;</span>:<span class=\"string\">&quot;num_1&quot;</span>,<span class=\"string\">&quot;0xe612&quot;</span>:<span class=\"string\">&quot;num_6&quot;</span>,<span class=\"string\">&quot;0xe613&quot;</span>:<span class=\"string\">&quot;num_8&quot;</span>,<span class=\"string\">&quot;0xe610&quot;</span>:<span class=\"string\">&quot;num_3&quot;</span>,<span class=\"string\">&quot;0xe611&quot;</span>:<span class=\"string\">&quot;num_2&quot;</span>,<span class=\"string\">&quot;0xe616&quot;</span>:<span class=\"string\">&quot;num_1&quot;</span>,<span class=\"string\">&quot;0xe617&quot;</span>:<span class=\"string\">&quot;num_3&quot;</span>,<span class=\"string\">&quot;0xe614&quot;</span>:<span class=\"string\">&quot;num_9&quot;</span>,<span class=\"string\">&quot;0xe615&quot;</span>:<span class=\"string\">&quot;num_7&quot;</span>,<span class=\"string\">&quot;0xe609&quot;</span>:<span class=\"string\">&quot;num_7&quot;</span>,<span class=\"string\">&quot;0xe607&quot;</span>:<span class=\"string\">&quot;num_5&quot;</span>,<span class=\"string\">&quot;0xe608&quot;</span>:<span class=\"string\">&quot;num_6&quot;</span>,<span class=\"string\">&quot;0xe61b&quot;</span>:<span class=\"string\">&quot;num_5&quot;</span>,  </span><br><span class=\"line\">        <span class=\"string\">&quot;0xe61c&quot;</span>:<span class=\"string\">&quot;num_8&quot;</span>,<span class=\"string\">&quot;0xe61a&quot;</span>:<span class=\"string\">&quot;num_2&quot;</span>,<span class=\"string\">&quot;0xe61f&quot;</span>:<span class=\"string\">&quot;num_6&quot;</span>,<span class=\"string\">&quot;0xe61d&quot;</span>:<span class=\"string\">&quot;num_9&quot;</span>,<span class=\"string\">&quot;0xe61e&quot;</span>:<span class=\"string\">&quot;num_7&quot;</span>&#125;  </span><br><span class=\"line\">mapCode2Font = &#123;<span class=\"string\">&quot;num_9&quot;</span>:<span class=\"number\">8</span>,<span class=\"string\">&quot;num_5&quot;</span>:<span class=\"number\">5</span>,<span class=\"string\">&quot;num_6&quot;</span>:<span class=\"number\">6</span>,<span class=\"string\">&quot;num_&quot;</span>:<span class=\"number\">1</span>,<span class=\"string\">&quot;num_7&quot;</span>:<span class=\"number\">9</span>,<span class=\"string\">&quot;num_8&quot;</span>:<span class=\"number\">7</span>,<span class=\"string\">&quot;num_1&quot;</span>:<span class=\"number\">0</span>,<span class=\"string\">&quot;num_2&quot;</span>:<span class=\"number\">3</span>,<span class=\"string\">&quot;num_3&quot;</span>:<span class=\"number\">2</span>,<span class=\"string\">&quot;num_4&quot;</span>:<span class=\"number\">4</span>&#125;  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">getUserInfo</span>(<span class=\"params\">shared_url, **headers</span>):  </span><br><span class=\"line\">    real_url = getRealAddress(shared_url)  </span><br><span class=\"line\">    parsed = urllib.parse.urlparse(real_url)  </span><br><span class=\"line\">    hostname = parsed.hostname  </span><br><span class=\"line\">    sec_uid = urllib.parse.parse_qs(parsed.query)[<span class=\"string\">&#x27;sec_uid&#x27;</span>]  </span><br><span class=\"line\">    user_info_url = <span class=\"string\">&quot;https://%s/web/api/v2/user/info/&quot;</span> % hostname  </span><br><span class=\"line\">    user_info_params = &#123; <span class=\"string\">&#x27;sec_uid&#x27;</span>: sec_uid &#125;  </span><br><span class=\"line\">    res = requests.get(user_info_url, headers=headers,  </span><br><span class=\"line\">                            params=user_info_params).json()  </span><br><span class=\"line\">    user_info = res[<span class=\"string\">&#x27;user_info&#x27;</span>]  </span><br><span class=\"line\">    user_avatar = user_info[<span class=\"string\">&#x27;avatar_larger&#x27;</span>][<span class=\"string\">&#x27;url_list&#x27;</span>][<span class=\"number\">2</span>]  </span><br><span class=\"line\">    user_nickname = user_info[<span class=\"string\">&#x27;nickname&#x27;</span>]  </span><br><span class=\"line\">    user_sign = user_info[<span class=\"string\">&#x27;signature&#x27;</span>]  </span><br><span class=\"line\">    user_id = user_info[<span class=\"string\">&#x27;unique_id&#x27;</span>]  </span><br><span class=\"line\">    count_of_videos = user_info[<span class=\"string\">&#x27;aweme_count&#x27;</span>]  </span><br><span class=\"line\">    follower_count = user_info[<span class=\"string\">&#x27;follower_count&#x27;</span>]  </span><br><span class=\"line\">    following_count = user_info[<span class=\"string\">&#x27;following_count&#x27;</span>]  </span><br><span class=\"line\">    zan_count = user_info[<span class=\"string\">&#x27;total_favorited&#x27;</span>]  </span><br><span class=\"line\">    like_count = user_info[<span class=\"string\">&#x27;favoriting_count&#x27;</span>]  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&#x27;user_avatar&#x27;</span>:user_avatar, <span class=\"string\">&#x27;user_nickname&#x27;</span>:user_nickname, <span class=\"string\">&#x27;user_sign&#x27;</span>:user_sign, <span class=\"string\">&#x27;user_id&#x27;</span>:user_id,  </span><br><span class=\"line\">           <span class=\"string\">&#x27;count_of_videos&#x27;</span>:count_of_videos, <span class=\"string\">&#x27;follower_count&#x27;</span>:follower_count, <span class=\"string\">&#x27;following_count&#x27;</span>:following_count,  </span><br><span class=\"line\">           <span class=\"string\">&#x27;zan_count&#x27;</span>:zan_count, <span class=\"string\">&#x27;like_count&#x27;</span>:like_count, <span class=\"string\">&#x27;like_count&#x27;</span>:like_count&#125;  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">getUserVideos</span>(<span class=\"params\">url</span>):  </span><br><span class=\"line\">    <span class=\"comment\"># number = re.findall(r&#x27;share/user/(d+)&#x27;, url)  </span></span><br><span class=\"line\">    number = url.split(<span class=\"string\">&#x27;share/user/&#x27;</span>)[<span class=\"number\">1</span>].split(<span class=\"string\">&#x27;?&#x27;</span>)[<span class=\"number\">0</span>]  </span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> <span class=\"built_in\">len</span>(number):  </span><br><span class=\"line\">        <span class=\"keyword\">return</span>  </span><br><span class=\"line\">    dytk = get_dytk(url)  </span><br><span class=\"line\">    <span class=\"comment\"># hostname = urllib.parse.urlparse(url).hostname  </span></span><br><span class=\"line\">    <span class=\"comment\"># if hostname != &#x27;t.tiktok.com&#x27; and not dytk:  </span></span><br><span class=\"line\">    <span class=\"comment\">#     return  </span></span><br><span class=\"line\">    user_id = number[<span class=\"number\">0</span>]  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> getUserMedia(user_id, dytk, url)  </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">getRealAddress</span>(<span class=\"params\">url</span>):  </span><br><span class=\"line\">    <span class=\"keyword\">if</span> url.find(<span class=\"string\">&#x27;v.douyin.com&#x27;</span>) &amp;lt; <span class=\"number\">0</span>:  </span><br><span class=\"line\">        <span class=\"keyword\">return</span> url  </span><br><span class=\"line\">    res = requests.get(url, headers=headers, allow_redirects=<span class=\"literal\">False</span>)  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> res.headers[<span class=\"string\">&#x27;Location&#x27;</span>] <span class=\"keyword\">if</span> res.status_code == <span class=\"number\">302</span> <span class=\"keyword\">else</span> <span class=\"literal\">None</span>  </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_dytk</span>(<span class=\"params\">url</span>):  </span><br><span class=\"line\">    res = requests.get(url, headers=headers)  </span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> res:  </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">None</span>  </span><br><span class=\"line\">    dytk = re.findall(<span class=\"string\">&quot;dytk: &#x27;(.*)&#x27;&quot;</span>, res.content.decode(<span class=\"string\">&#x27;utf-8&#x27;</span>))  </span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(dytk):  </span><br><span class=\"line\">        <span class=\"keyword\">return</span> dytk[<span class=\"number\">0</span>]  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">None</span>  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">getUserMedia</span>(<span class=\"params\">user_id, dytk, url</span>):  </span><br><span class=\"line\">    videos = []  </span><br><span class=\"line\">    parsed = urllib.parse.urlparse(url)  </span><br><span class=\"line\">    hostname = parsed.hostname  </span><br><span class=\"line\">    sec_uid = urllib.parse.parse_qs(parsed.query)[<span class=\"string\">&#x27;sec_uid&#x27;</span>]  </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">#signature = generateSignature(str(user_id))  </span></span><br><span class=\"line\">    user_video_url = <span class=\"string\">&quot;https://%s/web/api/v2/aweme/post/&quot;</span> % hostname  </span><br><span class=\"line\">    user_video_params = &#123;  </span><br><span class=\"line\">        <span class=\"string\">&#x27;sec_uid&#x27;</span>: sec_uid,  </span><br><span class=\"line\">        <span class=\"string\">&#x27;count&#x27;</span>: <span class=\"string\">&#x27;21&#x27;</span>,  </span><br><span class=\"line\">        <span class=\"string\">&#x27;max_cursor&#x27;</span>: <span class=\"string\">&#x27;0&#x27;</span>,  </span><br><span class=\"line\">        <span class=\"string\">&#x27;aid&#x27;</span>: <span class=\"string\">&#x27;1128&#x27;</span>,  </span><br><span class=\"line\">        <span class=\"string\">&#x27;_signature&#x27;</span>: <span class=\"string\">&#x27;2Vx9mxAZh0o-K4Wdv7NFKNlcfY&#x27;</span>,  </span><br><span class=\"line\">        <span class=\"string\">&#x27;dytk&#x27;</span>: dytk  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">    <span class=\"keyword\">if</span> hostname == <span class=\"string\">&#x27;t.tiktok.com&#x27;</span>:  </span><br><span class=\"line\">        user_video_params.pop(<span class=\"string\">&#x27;dytk&#x27;</span>)  </span><br><span class=\"line\">        user_video_params[<span class=\"string\">&#x27;aid&#x27;</span>] = <span class=\"string\">&#x27;1180&#x27;</span>  </span><br><span class=\"line\"></span><br><span class=\"line\">    max_cursor, video_count = <span class=\"literal\">None</span>, <span class=\"number\">0</span>  </span><br><span class=\"line\">    <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:  </span><br><span class=\"line\">        <span class=\"keyword\">if</span> max_cursor:  </span><br><span class=\"line\">            user_video_params[<span class=\"string\">&#x27;max_cursor&#x27;</span>] = <span class=\"built_in\">str</span>(max_cursor)  </span><br><span class=\"line\">        res = requests.get(user_video_url, headers=headers,  </span><br><span class=\"line\">                            params=user_video_params)  </span><br><span class=\"line\">        contentJson = json.loads(res.content.decode(<span class=\"string\">&#x27;utf-8&#x27;</span>))  </span><br><span class=\"line\">        aweme_list = contentJson.get(<span class=\"string\">&#x27;aweme_list&#x27;</span>, [])  </span><br><span class=\"line\">        <span class=\"keyword\">for</span> aweme <span class=\"keyword\">in</span> aweme_list:  </span><br><span class=\"line\">            video_count += <span class=\"number\">1</span>  </span><br><span class=\"line\">            aweme[<span class=\"string\">&#x27;hostname&#x27;</span>] = hostname  </span><br><span class=\"line\">            video =  &#123;  </span><br><span class=\"line\">                <span class=\"string\">&#x27;addr&#x27;</span>: aweme[<span class=\"string\">&#x27;video&#x27;</span>][<span class=\"string\">&#x27;play_addr&#x27;</span>][<span class=\"string\">&#x27;url_list&#x27;</span>][<span class=\"number\">0</span>],  </span><br><span class=\"line\">                <span class=\"string\">&#x27;desc&#x27;</span>: aweme[<span class=\"string\">&#x27;desc&#x27;</span>],  </span><br><span class=\"line\">                <span class=\"string\">&#x27;duration&#x27;</span>: aweme[<span class=\"string\">&#x27;video&#x27;</span>][<span class=\"string\">&#x27;duration&#x27;</span>],  </span><br><span class=\"line\">                <span class=\"string\">&#x27;cover&#x27;</span>: aweme[<span class=\"string\">&#x27;video&#x27;</span>][<span class=\"string\">&#x27;cover&#x27;</span>][<span class=\"string\">&#x27;url_list&#x27;</span>][<span class=\"number\">0</span>],  </span><br><span class=\"line\">                <span class=\"string\">&#x27;statistics&#x27;</span>: aweme[<span class=\"string\">&#x27;statistics&#x27;</span>]  </span><br><span class=\"line\">            &#125;  </span><br><span class=\"line\">            videos.append(video)  </span><br><span class=\"line\">        <span class=\"keyword\">if</span> contentJson.get(<span class=\"string\">&#x27;has_more&#x27;</span>):  </span><br><span class=\"line\">            max_cursor = contentJson.get(<span class=\"string\">&#x27;max_cursor&#x27;</span>)  </span><br><span class=\"line\">        <span class=\"keyword\">else</span>:  </span><br><span class=\"line\">            <span class=\"keyword\">break</span>  </span><br><span class=\"line\">    </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> video_count == <span class=\"number\">0</span>:  </span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;There&#x27;s no video in number %s.&quot;</span> % user_id)  </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> videos  </span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">getHtml</span>(<span class=\"params\">url,**headers</span>):  </span><br><span class=\"line\">    <span class=\"keyword\">try</span>:  </span><br><span class=\"line\">        req = urllib.request.Request(url,headers=headers)  </span><br><span class=\"line\">        resp = urllib.request.urlopen(req)  </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">str</span>(resp.read(), <span class=\"string\">&#x27;utf-8&#x27;</span>)  </span><br><span class=\"line\">    <span class=\"keyword\">except</span> urllib.error.HTTPError <span class=\"keyword\">as</span> e:  </span><br><span class=\"line\">        <span class=\"built_in\">print</span>(e.msg)  </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;&#x27;</span>  </span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">woff2tff</span>(<span class=\"params\">ls</span>):  </span><br><span class=\"line\">    res = <span class=\"string\">&#x27;&#x27;</span>  </span><br><span class=\"line\">    <span class=\"keyword\">for</span> s <span class=\"keyword\">in</span> ls:  </span><br><span class=\"line\">       res = res + formatNum(s)  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> res  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">splitByChinese</span>(<span class=\"params\">s</span>):  </span><br><span class=\"line\">    p = re.<span class=\"built_in\">compile</span>(<span class=\"string\">&quot;[u4e00-u9fa5]&quot;</span>, re.U)  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> p.split(s)  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">isChinese</span>(<span class=\"params\">s</span>):  </span><br><span class=\"line\">    p = re.<span class=\"built_in\">compile</span>(<span class=\"string\">&quot;[u4e00-u9fa5]&quot;</span>, re.U)  </span><br><span class=\"line\">    result = p.<span class=\"keyword\">match</span>(s)  </span><br><span class=\"line\">    <span class=\"keyword\">if</span> result :  </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">True</span>  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">False</span>  </span><br><span class=\"line\">      </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">formatNum</span>(<span class=\"params\">s</span>):  </span><br><span class=\"line\">    <span class=\"keyword\">if</span> isChinese(s):  </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;&#x27;</span>  </span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(s)&amp;lt;<span class=\"number\">8</span> <span class=\"keyword\">or</span> s.find(<span class=\"string\">&quot;hzsdxe6&quot;</span>) &amp;lt; <span class=\"number\">0</span> :  </span><br><span class=\"line\">        <span class=\"keyword\">return</span> s  </span><br><span class=\"line\">    s1 = <span class=\"string\">&#x27;0&#x27;</span>+s[<span class=\"number\">4</span>:-<span class=\"number\">1</span>]  </span><br><span class=\"line\">    res = mapCode2Font[mapCode2Name[s1]]  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">str</span>(res)  </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">getUserAll</span>(<span class=\"params\">shared_url</span>):  </span><br><span class=\"line\">    profile = getUserInfo(shared_url, **HEADERS)  </span><br><span class=\"line\">    <span class=\"keyword\">if</span> profile:  </span><br><span class=\"line\">        videos = getUserVideos(getRealAddress(shared_url))  </span><br><span class=\"line\">        profile[<span class=\"string\">&#x27;videos&#x27;</span>] = videos  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> profile  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">download_csv</span>(<span class=\"params\">file_path,video</span>):  </span><br><span class=\"line\">    result_headers = [(<span class=\"string\">&#x27;标题内容&#x27;</span>, <span class=\"string\">&#x27;desc&#x27;</span>), (<span class=\"string\">&#x27;视频时长&#x27;</span>, <span class=\"string\">&#x27;duration&#x27;</span>),  </span><br><span class=\"line\">                      (<span class=\"string\">&#x27;点赞数&#x27;</span>, <span class=\"string\">&#x27;share_count&#x27;</span>),  </span><br><span class=\"line\">                      (<span class=\"string\">&#x27;原始视频url&#x27;</span>, <span class=\"string\">&#x27;url&#x27;</span>),  </span><br><span class=\"line\">                      (<span class=\"string\">&#x27;视频存储位置&#x27;</span>,<span class=\"string\">&#x27;id&#x27;</span>),  </span><br><span class=\"line\">                      (<span class=\"string\">&#x27;缩略图&#x27;</span>,<span class=\"string\">&#x27;cover&#x27;</span>),  </span><br><span class=\"line\">                      (<span class=\"string\">&#x27;缩略图id&#x27;</span>,<span class=\"string\">&#x27;cover_id&#x27;</span>)]  </span><br><span class=\"line\"></span><br><span class=\"line\">    result_data = [[w[kv[<span class=\"number\">1</span>]] <span class=\"keyword\">for</span> kv <span class=\"keyword\">in</span> result_headers]  </span><br><span class=\"line\">                   <span class=\"keyword\">for</span> w <span class=\"keyword\">in</span> video]  </span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(file_path, <span class=\"string\">&#x27;a&#x27;</span>, encoding=<span class=\"string\">&#x27;utf-8-sig&#x27;</span>,  </span><br><span class=\"line\">              newline=<span class=\"string\">&#x27;&#x27;</span>) <span class=\"keyword\">as</span> f:  </span><br><span class=\"line\">        writer = csv.writer(f)  </span><br><span class=\"line\">        writer.writerows([[kv[<span class=\"number\">0</span>] <span class=\"keyword\">for</span> kv <span class=\"keyword\">in</span> result_headers]])  </span><br><span class=\"line\">        writer.writerows(result_data)  </span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> video:  </span><br><span class=\"line\">        <span class=\"comment\"># 下载视频  </span></span><br><span class=\"line\">        download_video(i[<span class=\"string\">&#x27;url&#x27;</span>],i[<span class=\"string\">&#x27;id&#x27;</span>])  </span><br><span class=\"line\">        <span class=\"comment\"># 下载视频的缩略图  </span></span><br><span class=\"line\">        download_min_jpg(i[<span class=\"string\">&#x27;cover&#x27;</span>],i[<span class=\"string\">&#x27;cover_id&#x27;</span>])  </span><br><span class=\"line\">    logging.info(<span class=\"string\">u&#x27;%d条微博写入csv文件完毕，保存路径：%s&#x27;</span>, <span class=\"built_in\">len</span>(video), file_path)  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">download_video</span>(<span class=\"params\">url,<span class=\"built_in\">id</span></span>):  </span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;下载文件(图片/视频)&quot;&quot;&quot;</span>  </span><br><span class=\"line\">    path = <span class=\"string\">&quot;/Users/mac/Desktop/data/douyin3/&quot;</span>  </span><br><span class=\"line\">    r = requests.get(url)  <span class=\"comment\"># 获取到目标视频的所有信息  </span></span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(path+<span class=\"built_in\">id</span>+<span class=\"string\">&quot;.mp4&quot;</span>, <span class=\"string\">&#x27;wb&#x27;</span>) <span class=\"keyword\">as</span> f:  <span class=\"comment\"># 以二进制写的方式将r的二进制内容写入path  </span></span><br><span class=\"line\">        f.write(r.content)  </span><br><span class=\"line\">        f.close()  </span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;视频文件保存成功&quot;</span>)  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">download_min_jpg</span>(<span class=\"params\">url,<span class=\"built_in\">id</span></span>):  </span><br><span class=\"line\">    path = <span class=\"string\">&quot;/Users/mac/Desktop/data/douyin3/&quot;</span>  </span><br><span class=\"line\">    r = requests.get(url)  <span class=\"comment\"># 获取到目标视频的所有信息  </span></span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(path + <span class=\"built_in\">id</span> + <span class=\"string\">&quot;.jpg&quot;</span>, <span class=\"string\">&#x27;wb&#x27;</span>) <span class=\"keyword\">as</span> f:  <span class=\"comment\"># 以二进制写的方式将r的二进制内容写入path  </span></span><br><span class=\"line\">        f.write(r.content)  </span><br><span class=\"line\">        f.close()  </span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;缩略图保存成功&quot;</span>)  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:  </span><br><span class=\"line\">    userInfo = getUserAll(<span class=\"string\">&quot;https://v.douyin.com/FNyoaSR/&quot;</span>)  </span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"built_in\">len</span>(userInfo[<span class=\"string\">&#x27;videos&#x27;</span>]))  </span><br><span class=\"line\">    <span class=\"built_in\">print</span>(userInfo)  </span><br><span class=\"line\">    <span class=\"built_in\">list</span> = []  </span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> userInfo[<span class=\"string\">&#x27;videos&#x27;</span>]:  </span><br><span class=\"line\">        <span class=\"comment\"># 点赞数  </span></span><br><span class=\"line\">        share_count = i[<span class=\"string\">&#x27;statistics&#x27;</span>][<span class=\"string\">&#x27;share_count&#x27;</span>]  </span><br><span class=\"line\">        <span class=\"comment\"># 原始视频地址  </span></span><br><span class=\"line\">        url = i[<span class=\"string\">&#x27;addr&#x27;</span>]  </span><br><span class=\"line\">        <span class=\"comment\">#视频时长  </span></span><br><span class=\"line\">        duration = i[<span class=\"string\">&#x27;duration&#x27;</span>]  </span><br><span class=\"line\">        <span class=\"comment\"># 标题内容  将ascii码转为中文  </span></span><br><span class=\"line\">        desc = i[<span class=\"string\">&#x27;desc&#x27;</span>]  </span><br><span class=\"line\">        uid = <span class=\"built_in\">str</span>(uuid.uuid4())  </span><br><span class=\"line\">        suid = <span class=\"string\">&#x27;&#x27;</span>.join(uid.split(<span class=\"string\">&#x27;-&#x27;</span>))  </span><br><span class=\"line\">        <span class=\"comment\"># 缩略图 url  </span></span><br><span class=\"line\">        cover =  i[<span class=\"string\">&#x27;cover&#x27;</span>]  </span><br><span class=\"line\">        <span class=\"comment\"># 缩略图id  </span></span><br><span class=\"line\">        cover_id = suid+<span class=\"string\">&quot;_min&quot;</span>  </span><br><span class=\"line\">        list1 = &#123;<span class=\"string\">&#x27;desc&#x27;</span>: desc, <span class=\"string\">&#x27;duration&#x27;</span>: duration, <span class=\"string\">&#x27;share_count&#x27;</span>: share_count,  </span><br><span class=\"line\">                 <span class=\"string\">&#x27;url&#x27;</span>: url, <span class=\"string\">&#x27;id&#x27;</span>: suid, <span class=\"string\">&#x27;cover&#x27;</span>: cover, <span class=\"string\">&#x27;cover_id&#x27;</span>: cover_id&#125;  </span><br><span class=\"line\">        <span class=\"built_in\">list</span>.append(list1)  </span><br><span class=\"line\">    <span class=\"comment\">#print(list)  </span></span><br><span class=\"line\">    filepath = <span class=\"string\">&#x27;/Users/mac/Desktop/data/douyin3/douyin.csv&#x27;</span>  </span><br><span class=\"line\">    download_csv(filepath,<span class=\"built_in\">list</span>)</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"1-1-3-微信\"><a href=\"#1-1-3-微信\" class=\"headerlink\" title=\"1. 1. 3 微信\"></a>1. 1. 3 微信</h4><p>在之前的操作中，将获取到的cookie存储到txt文档中，之后有用到的时候取，目前登录的cookie值是在2-4个小时内失效的。</p>\n<p>在通过Selenium，控制浏览器后，微信会出现一个二维码页面，需要扫描二维码才能登录，这一步只能人工去解决。</p>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104841428.png\" alt=\"image-20221010104841428\"></p>\n<p>进入微信公众号平台后，找到相应的位置，剩下的是找到安科院下的两个微信公众号的请求链接地址，分析里面的参数。</p>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104852717.png\" alt=\"image-20221010104852717\"></p>\n<p>继续点击下一页，看看每一页哪些参数发生了变化，有没有规律，经分析得到了begin是变化的，并且是按照5的倍数递增的，之后就是请求每一页的数据，然后获取到发送的每一条数据的信息。在这期间，被封过几次号，爬取的太频繁的话，微信会对访问公众号进行限制，大概一天解封。</p>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010104902165.png\" alt=\"image-20221010104902165\"></p>\n<p>找到规律后，就是循环替换请求参数，然后去访问获取到公众号发布文章的链接地址和时间。</p>\n"},{"title":"mysql实时同步至es","date":"2021-11-20T04:31:01.000Z","keywords":"mysql","description":"mysql实时同步","cover":"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg","top_img":"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg","_content":"\n\n# mysql实时同步至es\n\n目前是在本地进行测试同步的，由于在服务器上运行，占用的内存有点大，服务器上的配置与本地的配置稍微有所差别\n\n使用的工具版本：\n\nMySql8.0：通过 show variables like '%log_bin%'; 查看*二进制日志功能是否开启，一般情况下是默认开启的*\n\n> **Elasticsearch7.10.2由于log4j的问题导致用docker安装不了，可以换个版本**\n\n| 工具           | 端口  | 版本   | 问题                                                         |\n| -------------- | ----- | ------ | ------------------------------------------------------------ |\n| mysql          | 3308  | 5.7    |                                                              |\n| Elasticsearch  | 9200  | 7.10.2 | [7.17.0](https://hub.docker.com/layers/elasticsearch/library/elasticsearch/7.17.0/images/sha256-fa7141154a7e14df214e42f08c333702403eb88c02ba44e79322a1f42d733013?context=explore) |\n| Kibanba        | 5601  | 7.10.2 |                                                              |\n| canal-deployer | 11111 | 1.1.16 |                                                              |\n| canal-adapter  | 8081  | 1.1.16 |                                                              |\n| canal-admin    | 8089  | 1.1.16 |                                                              |\n\n# 1.安装MySql\n\n通过docker安装mysql，pull下来mysql5.7版本\n\ndocker pull mysql:5.7\n\n新建目录及配置文件\n\n```sh\ncd /Users/mac/  \nmkdir mysql  \ncd mysql  \nmkdir {data,conf,logs}  \ncd conf  \nvim my.cnf\n```\n\n创建并修改my.cnf配置文件\n\n```cnf\n[mysqld]  \n## 设置server_id，同一局域网中需要唯一  \nserver_id=101  \n## 指定不需要同步的数据库名称  \nbinlog-ignore-db=mysql    \n## 开启二进制日志功能  \nlog-bin=mall-mysql-bin    \n## 设置二进制日志使用内存大小（事务）  \nbinlog_cache_size=1M    \n## 设置使用的二进制日志格式（mixed,statement,row）  \nbinlog_format=row    \n## 二进制日志过期清理时间。默认值为0，表示不自动清理。  \nexpire_logs_days=7    \n## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。  \n## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致  \nslave_skip_errors=1062    \n\n## 增加配置\ncharacter-set-server=utf8  \nsecure_file_priv=/var/lib/mysql\n```\n\n通过docker启动mysql5.7\n\n```sh\ndocker run -p 3308:3306 --name mysql57 -v /Users/mac/canal/mysql/conf/my.cnf:/etc/mysql/my.cnf -v /Users/mac/canal/mysql/logs:/logs -v /Users/mac/canal/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7\n```\n\n启动后，通过docker ps查看mysql是否启动成功。\n\n如果启动成功了，那么运行\n\n```sh\ndocker exec -it 容器id /bin/bash\n```\n\n进入容器查看，通过输入命令进入mysql\n\n```\nmysql -uroot -p\n```\n\n输入密码：123456进行mysql，之后可以通过输入查询语句，查看my.cnf是否配置成功。\n\n这是查看binlog是否启用\n\n```\nshow variables like '%log_bin%';\n```\n\n![image-20221010105441843](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010105441843.png)\n\n这是查看binlog模式\n\n```\nshow variables like 'binlog_format%';  \n```\n\n![image-20221010105454917](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010105454917.png)\n\n建立一个测试用的数据库，canal_test数据库（这里是直接可视化界面建立的），之后再建立一张商品表product\n\n```sql\nCREATE TABLE `product`  (  \n  `id` bigint(20) NOT NULL AUTO_INCREMENT,  \n  `title` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,  \n  `sub_title` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,  \n  `price` decimal(10, 2) NULL DEFAULT NULL,  \n  `pic` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,  \n  PRIMARY KEY (`id`) USING BTREE  \n) ENGINE = InnoDB AUTO_INCREMENT = 2 CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;\n```\n\n\n\n# 2.Elasticsearch和Kibana安装\n\n上dockerhub上，找到es的版本，然后下载安装，在mac上安装和通过docker安装并没有什么太大的区别\n\ndocker pull elasticsearch:7.17.0\n\n之后运行es，如果没有映射文件夹，记得创建\n\n```sh\ndocker run --name myes -d -e ES_JAVA_OPTS=\"-Xms256m -Xmx256m\"   \n-e \"discovery.type=single-node\" -p 9200:9200 -p 9300:9300   \n-v /etc/localtime:/etc/localtime:ro   \n-v /home/es/data:/usr/share/elasticsearch/data elasticsearch:7.17.0\n```\n\n同理，kibana也是这样安装的。拉取镜像，创建配置文件夹，\n\n```\ndocker pull kibana:7.17.0\n\nmkdir -p /root/mydata/kibana/conf  \ncd /root/mydata/kibana/conf\n```\n\n**vim kibana.yml**  这是kibana的配置文件，配置连接es的\n\n```\n# \n## ** THIS IS AN AUTO-GENERATED FILE **  \n#  \n# Default Kibana configuration for docker target  \n\nserver.name: kibana  \nserver.host: \"0\"  \n```\n\n如果是云服务器，则将127.0.0.1改成服务器的ip地址  \n\n```\nelasticsearch.hosts: [ \"http://127.0.0.1:9200\" ]  \nxpack.monitoring.ui.container.elasticsearch.enabled: true\n```\n\n之后是创建kibana容器\n\n```\ndocker run -d --name=kibana --restart=always -p 5601:5601   \n-v $PWD/conf/kibana.yml:/usr/share/kibana/config/kibana.yml kibana:7.17.0\n```\n\n\n\n# 3.canal组件安装\n\n## 3.1安装canal-server\n\n-   首先我们需要下载canal的各个组件canal-server、canal-adapter、canal-admin，下载地址：<https://github.com/alibaba/canal/releases>\n\n-   **canal是基于Java的，启动canal服务器一定要保证安装好了jdk**\n\n![image-20221010105719713](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010105719713.png)\n\ncanal的各个组件的用途各不相同，下面分别介绍下：\n\n-   **canal-server（canal-deploy）**：可以直接监听MySQL的binlog，把自己伪装成MySQL的从库，只负责接收数据，并不做处理。\n\n-   canal-adapter：相当于canal的客户端，会从canal-server中获取数据，然后对数据进行同步，可以同步到MySQL、Elasticsearch和HBase等存储中去。\n\n-   canal-admin：为canal提供整体配置管理、节点运维等面向运维的功能，提供相对友好的WebUI操作界面，方便更多用户快速和安全的操作。\n\n进入到canal组件目录，然后将他们分别解压至相应的目录\n\n```\ncd /Users/mac/canal  \nmkdir {canal-server,canal-adapter,canal-admin}  \ntar -zxvf canal.deployer-1.1.6-SNAPSHOT.tar.gz -C canal-server  \ntar -zxvf canal.adapter-1.1.6-SNAPSHOT.tar.gz -C canal-adapter  \ntar -zxvf canal.admin-1.1.6-SNAPSHOT.tar.gz -C canal-admin\n```\n\n进入到canal-server目录，修改配置文件**conf/example/instance.properties**，按照如下配置\n\n```\n# 需要同步数据的MySQL地址  \ncanal.instance.master.address=127.0.0.1:3308  \ncanal.instance.master.journal.name=  \ncanal.instance.master.position=  \ncanal.instance.master.timestamp=  \ncanal.instance.master.gtid=  \n# 用于同步数据的数据库账号  \ncanal.instance.dbUsername=root  \n# 用于同步数据的数据库密码  \ncanal.instance.dbPassword=123456  \n# 数据库连接编码  \ncanal.instance.connectionCharset = UTF-8  \n# 需要订阅binlog的表过滤正则表达式  \ncanal.instance.filter.regex=.*\\\\..*\n```\n\n-   使用startup.sh脚本启动canal-server服务；\n\n```\nsh bin/startup.sh\n```\n\n-   启动成功后可使用如下命令查看服务日志信息；\n\n-   注意：只有启动成功了，才会创建canal文件夹和cancal/canal.log、example文件夹和example/example.log \n\n```\ntail -f logs/canal/canal.log\n```\n\n![image-20221010105823795](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010105823795.png)\n\n-   启动成功后可使用如下命令查看instance日志信息；\n\n```\ntail -f logs/example/example.log \n```\n\n![image-20221010105837062](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010105837062.png)\n\n-   如果想要停止canal-server服务可以使用如下命令。\n\n```\nsh bin/stop.sh\n```\n\n\n\n## 3.2安装canal-adapter\n\n进入canal-adapter目录\n\n```\ncd /Users/mac/canal/canal-adapter\n```\n\n\n\n-   修改配置文件conf/application.yml，按如下配置即可，主要是修改canal-server配置、数据源配置和客户端适配器配置；\n\n  - - ```\n       canal.conf:  \n         mode: tcp # 客户端的模式，可选tcp kafka rocketMQ  \n         flatMessage: true # 扁平message开关, 是否以json字符串形式投递数据, 仅在kafka/rocketMQ模式下有效  \n         zookeeperHosts:    # 对应集群模式下的zk地址  \n         syncBatchSize: 1000 # 每次同步的批数量  \n         retries: 0 # 重试次数, -1为无限重试  \n         timeout: # 同步超时时间, 单位毫秒  \n         accessKey:  \n         secretKey:  \n         consumerProperties:  \n       \n           # canal tcp consumer  \n       \n           canal.tcp.server.host: 127.0.0.1:11111 #设置canal-server的地址  \n           canal.tcp.zookeeper.hosts:  \n           canal.tcp.batch.size: 500  \n           canal.tcp.username:  \n           canal.tcp.password:  \n       \n         srcDataSources: # 源数据库配置  \n           defaultDS:  \n             url: jdbc:mysql://127.0.0.1:3308/canal_test?useUnicode=true  \n             username: root  \n             password: 123456  \n         canalAdapters: # 适配器列表  \n       \n         - instance: example # canal实例名或者MQ topic名  \n             groups: # 分组列表  \n              - groupId: g1 # 分组id, 如果是MQ模式将用到该值  \n                outerAdapters:  \n                   - name: logger # 日志打印适配器  \n                     name: es7 # ES同步适配器  \n                             hosts: http://127.0.0.1:9200 # ES连接地址  \n                             properties:  \n                               mode: rest # 模式可选transport(9300) 或者 rest(9200)  \n                               # security.auth: test:123456 #  only used for rest mode  \n                               cluster.name: elasticsearch # ES集群名称\n       ```\n  \n       \n  \n-   注意：在配置es时，es的连接地址前面一定要加http://，不然在启动canal-adapter组件时就会报错；还有就是: 后面一定要加空格\n\n-   **注意：如果是在云服务上启动报错，错误内容为**\n\n    -   Could not resolve placeholder 'HOSTNAME%%.*'  \n        in value \"history -a; printf \"033]0;%s@%s:%s007\" \"${USER}\" \"${HOSTNAME%%.*}\" \"${PWD/#$HOME/~}\"\"\n\n    -   那么，则需要在application.yml的配置文件中最后面定格加入\n\n    -   HOSTNAME%%.*:  \n        PWD/*#$HOME/~:*\n\n![image-20221010105931138](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010105931138.png)\n\n-   可以参考链接：[启动canal-adapter时候未成功](https://github.com/alibaba/canal/issues/3063)&nbsp;\n\n-   添加配置文件canal-adapter/conf/es7/product.yml，用于配置MySQL中的表与Elasticsearch中索引的映射关系；\n\n```\ndataSourceKey: defaultDS # 源数据源的key, 对应上面配置的srcDataSources中的值  \ndestination: example  # canal的instance或者MQ的topic  \ngroupId: g1 # 对应MQ模式下的groupId, 只会同步对应groupId的数据  \nesMapping:  \n  _index: canal_product # es 的索引名称  \n  _id: _id  # es 的_id, 如果不配置该项必须配置下面的pk项_id则会由es自动分配  \n  sql: \"SELECT  \n            p.id AS _id,  \n            p.title,  \n            p.sub_title,  \n            p.price,  \n            p.pic  \n        FROM  \n            product p\"        # sql映射  \n  etlCondition: \"where a.c_time&gt;={}\"   #etl的条件参数  \n  commitBatch: 3000   # 提交批大小\n```\n\n-   使用startup.sh脚本启动canal-adapter服务；\n\n```\nsh bin/startup.sh\n```\n\n-   启动成功后可使用如下命令查看服务日志信息；\n\n```\ntail -f logs/adapter/adapter.log\n```\n\n![image-20221010110018421](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010110018421.png)\n\n-   启动成功后，日志会将表的映射文件信息给打印出来\n\n-   如果需要停止canal-adapter服务可以使用如下命令。\n\n-   sh bin/stop.sh\n\n# 4.数据同步测试\n\n-   首先我们需要在Elasticsearch中创建索引，和MySQL中的product表相对应，直接在Kibana的Dev Tools中使用如下命令创建即可；\n\n```\nPUT canal_product  \n{  \n  \"mappings\": {  \n    \"properties\": {  \n      \"title\": {  \n        \"type\": \"text\"  \n      },  \n      \"sub_title\": {  \n        \"type\": \"text\"  \n      },  \n      \"pic\": {  \n        \"type\": \"text\"  \n      },  \n      \"price\": {  \n        \"type\": \"double\"  \n      }  \n    }  \n  }  \n}\n```\n\n![image-20221010110038451](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010110038451.png)\n\n-   创建完成后可以查看下索引的结构；\n\nGET canal_product/_mapping\n\n![image-20221010110052888](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010110052888.png)\n\n-   之后使用如下SQL语句在数据库中创建一条记录；\n\n```sql\nINSERT INTO product ( id, title, sub_title, price, pic ) VALUES ( 5, '小米8', ' 全面屏游戏智能手机 6GB+64GB', 1999.00, NULL );\n```\n\n-   创建成功后，在Elasticsearch中搜索下，发现数据已经同步了；\n\nGET canal_product/_search\n\n![image-20221010110126304](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010110126304.png)\n\n-   再使用如下SQL对数据进行修改；\n\n```sql\nUPDATE product SET title='小米10' WHERE id=5\n```\n\n-   修改成功后，在Elasticsearch中搜索下，发现数据已经修改了；\n\n![image-20221010110145988](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010110145988.png)\n\n-   再使用如下SQL对数据进行删除操作；\n\n```sql\nDELETE FROM product WHERE id=5\n```\n\n-   删除成功后，在Elasticsearch中搜索下，发现数据已经删除了，至此MySQL同步到Elasticsearch的功能完成了！\n\n![image-20221010110213694](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010110213694.png)\n","source":"_posts/mysql实时同步至es.md","raw":"---\ntitle: mysql实时同步至es\ndate: 2021-11-20 12:31:01\ntags: mysql\ncategories: 学习\nkeywords: mysql\ndescription: mysql实时同步\ncover: https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg\ntop_img: https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora%2F4327c995d22931a33f4ae872ee8605a42d8dc974.jpg%40942w_531h_progressive.jpg\n---\n\n\n# mysql实时同步至es\n\n目前是在本地进行测试同步的，由于在服务器上运行，占用的内存有点大，服务器上的配置与本地的配置稍微有所差别\n\n使用的工具版本：\n\nMySql8.0：通过 show variables like '%log_bin%'; 查看*二进制日志功能是否开启，一般情况下是默认开启的*\n\n> **Elasticsearch7.10.2由于log4j的问题导致用docker安装不了，可以换个版本**\n\n| 工具           | 端口  | 版本   | 问题                                                         |\n| -------------- | ----- | ------ | ------------------------------------------------------------ |\n| mysql          | 3308  | 5.7    |                                                              |\n| Elasticsearch  | 9200  | 7.10.2 | [7.17.0](https://hub.docker.com/layers/elasticsearch/library/elasticsearch/7.17.0/images/sha256-fa7141154a7e14df214e42f08c333702403eb88c02ba44e79322a1f42d733013?context=explore) |\n| Kibanba        | 5601  | 7.10.2 |                                                              |\n| canal-deployer | 11111 | 1.1.16 |                                                              |\n| canal-adapter  | 8081  | 1.1.16 |                                                              |\n| canal-admin    | 8089  | 1.1.16 |                                                              |\n\n# 1.安装MySql\n\n通过docker安装mysql，pull下来mysql5.7版本\n\ndocker pull mysql:5.7\n\n新建目录及配置文件\n\n```sh\ncd /Users/mac/  \nmkdir mysql  \ncd mysql  \nmkdir {data,conf,logs}  \ncd conf  \nvim my.cnf\n```\n\n创建并修改my.cnf配置文件\n\n```cnf\n[mysqld]  \n## 设置server_id，同一局域网中需要唯一  \nserver_id=101  \n## 指定不需要同步的数据库名称  \nbinlog-ignore-db=mysql    \n## 开启二进制日志功能  \nlog-bin=mall-mysql-bin    \n## 设置二进制日志使用内存大小（事务）  \nbinlog_cache_size=1M    \n## 设置使用的二进制日志格式（mixed,statement,row）  \nbinlog_format=row    \n## 二进制日志过期清理时间。默认值为0，表示不自动清理。  \nexpire_logs_days=7    \n## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。  \n## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致  \nslave_skip_errors=1062    \n\n## 增加配置\ncharacter-set-server=utf8  \nsecure_file_priv=/var/lib/mysql\n```\n\n通过docker启动mysql5.7\n\n```sh\ndocker run -p 3308:3306 --name mysql57 -v /Users/mac/canal/mysql/conf/my.cnf:/etc/mysql/my.cnf -v /Users/mac/canal/mysql/logs:/logs -v /Users/mac/canal/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7\n```\n\n启动后，通过docker ps查看mysql是否启动成功。\n\n如果启动成功了，那么运行\n\n```sh\ndocker exec -it 容器id /bin/bash\n```\n\n进入容器查看，通过输入命令进入mysql\n\n```\nmysql -uroot -p\n```\n\n输入密码：123456进行mysql，之后可以通过输入查询语句，查看my.cnf是否配置成功。\n\n这是查看binlog是否启用\n\n```\nshow variables like '%log_bin%';\n```\n\n![image-20221010105441843](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010105441843.png)\n\n这是查看binlog模式\n\n```\nshow variables like 'binlog_format%';  \n```\n\n![image-20221010105454917](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010105454917.png)\n\n建立一个测试用的数据库，canal_test数据库（这里是直接可视化界面建立的），之后再建立一张商品表product\n\n```sql\nCREATE TABLE `product`  (  \n  `id` bigint(20) NOT NULL AUTO_INCREMENT,  \n  `title` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,  \n  `sub_title` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,  \n  `price` decimal(10, 2) NULL DEFAULT NULL,  \n  `pic` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,  \n  PRIMARY KEY (`id`) USING BTREE  \n) ENGINE = InnoDB AUTO_INCREMENT = 2 CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;\n```\n\n\n\n# 2.Elasticsearch和Kibana安装\n\n上dockerhub上，找到es的版本，然后下载安装，在mac上安装和通过docker安装并没有什么太大的区别\n\ndocker pull elasticsearch:7.17.0\n\n之后运行es，如果没有映射文件夹，记得创建\n\n```sh\ndocker run --name myes -d -e ES_JAVA_OPTS=\"-Xms256m -Xmx256m\"   \n-e \"discovery.type=single-node\" -p 9200:9200 -p 9300:9300   \n-v /etc/localtime:/etc/localtime:ro   \n-v /home/es/data:/usr/share/elasticsearch/data elasticsearch:7.17.0\n```\n\n同理，kibana也是这样安装的。拉取镜像，创建配置文件夹，\n\n```\ndocker pull kibana:7.17.0\n\nmkdir -p /root/mydata/kibana/conf  \ncd /root/mydata/kibana/conf\n```\n\n**vim kibana.yml**  这是kibana的配置文件，配置连接es的\n\n```\n# \n## ** THIS IS AN AUTO-GENERATED FILE **  \n#  \n# Default Kibana configuration for docker target  \n\nserver.name: kibana  \nserver.host: \"0\"  \n```\n\n如果是云服务器，则将127.0.0.1改成服务器的ip地址  \n\n```\nelasticsearch.hosts: [ \"http://127.0.0.1:9200\" ]  \nxpack.monitoring.ui.container.elasticsearch.enabled: true\n```\n\n之后是创建kibana容器\n\n```\ndocker run -d --name=kibana --restart=always -p 5601:5601   \n-v $PWD/conf/kibana.yml:/usr/share/kibana/config/kibana.yml kibana:7.17.0\n```\n\n\n\n# 3.canal组件安装\n\n## 3.1安装canal-server\n\n-   首先我们需要下载canal的各个组件canal-server、canal-adapter、canal-admin，下载地址：<https://github.com/alibaba/canal/releases>\n\n-   **canal是基于Java的，启动canal服务器一定要保证安装好了jdk**\n\n![image-20221010105719713](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010105719713.png)\n\ncanal的各个组件的用途各不相同，下面分别介绍下：\n\n-   **canal-server（canal-deploy）**：可以直接监听MySQL的binlog，把自己伪装成MySQL的从库，只负责接收数据，并不做处理。\n\n-   canal-adapter：相当于canal的客户端，会从canal-server中获取数据，然后对数据进行同步，可以同步到MySQL、Elasticsearch和HBase等存储中去。\n\n-   canal-admin：为canal提供整体配置管理、节点运维等面向运维的功能，提供相对友好的WebUI操作界面，方便更多用户快速和安全的操作。\n\n进入到canal组件目录，然后将他们分别解压至相应的目录\n\n```\ncd /Users/mac/canal  \nmkdir {canal-server,canal-adapter,canal-admin}  \ntar -zxvf canal.deployer-1.1.6-SNAPSHOT.tar.gz -C canal-server  \ntar -zxvf canal.adapter-1.1.6-SNAPSHOT.tar.gz -C canal-adapter  \ntar -zxvf canal.admin-1.1.6-SNAPSHOT.tar.gz -C canal-admin\n```\n\n进入到canal-server目录，修改配置文件**conf/example/instance.properties**，按照如下配置\n\n```\n# 需要同步数据的MySQL地址  \ncanal.instance.master.address=127.0.0.1:3308  \ncanal.instance.master.journal.name=  \ncanal.instance.master.position=  \ncanal.instance.master.timestamp=  \ncanal.instance.master.gtid=  \n# 用于同步数据的数据库账号  \ncanal.instance.dbUsername=root  \n# 用于同步数据的数据库密码  \ncanal.instance.dbPassword=123456  \n# 数据库连接编码  \ncanal.instance.connectionCharset = UTF-8  \n# 需要订阅binlog的表过滤正则表达式  \ncanal.instance.filter.regex=.*\\\\..*\n```\n\n-   使用startup.sh脚本启动canal-server服务；\n\n```\nsh bin/startup.sh\n```\n\n-   启动成功后可使用如下命令查看服务日志信息；\n\n-   注意：只有启动成功了，才会创建canal文件夹和cancal/canal.log、example文件夹和example/example.log \n\n```\ntail -f logs/canal/canal.log\n```\n\n![image-20221010105823795](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010105823795.png)\n\n-   启动成功后可使用如下命令查看instance日志信息；\n\n```\ntail -f logs/example/example.log \n```\n\n![image-20221010105837062](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010105837062.png)\n\n-   如果想要停止canal-server服务可以使用如下命令。\n\n```\nsh bin/stop.sh\n```\n\n\n\n## 3.2安装canal-adapter\n\n进入canal-adapter目录\n\n```\ncd /Users/mac/canal/canal-adapter\n```\n\n\n\n-   修改配置文件conf/application.yml，按如下配置即可，主要是修改canal-server配置、数据源配置和客户端适配器配置；\n\n  - - ```\n       canal.conf:  \n         mode: tcp # 客户端的模式，可选tcp kafka rocketMQ  \n         flatMessage: true # 扁平message开关, 是否以json字符串形式投递数据, 仅在kafka/rocketMQ模式下有效  \n         zookeeperHosts:    # 对应集群模式下的zk地址  \n         syncBatchSize: 1000 # 每次同步的批数量  \n         retries: 0 # 重试次数, -1为无限重试  \n         timeout: # 同步超时时间, 单位毫秒  \n         accessKey:  \n         secretKey:  \n         consumerProperties:  \n       \n           # canal tcp consumer  \n       \n           canal.tcp.server.host: 127.0.0.1:11111 #设置canal-server的地址  \n           canal.tcp.zookeeper.hosts:  \n           canal.tcp.batch.size: 500  \n           canal.tcp.username:  \n           canal.tcp.password:  \n       \n         srcDataSources: # 源数据库配置  \n           defaultDS:  \n             url: jdbc:mysql://127.0.0.1:3308/canal_test?useUnicode=true  \n             username: root  \n             password: 123456  \n         canalAdapters: # 适配器列表  \n       \n         - instance: example # canal实例名或者MQ topic名  \n             groups: # 分组列表  \n              - groupId: g1 # 分组id, 如果是MQ模式将用到该值  \n                outerAdapters:  \n                   - name: logger # 日志打印适配器  \n                     name: es7 # ES同步适配器  \n                             hosts: http://127.0.0.1:9200 # ES连接地址  \n                             properties:  \n                               mode: rest # 模式可选transport(9300) 或者 rest(9200)  \n                               # security.auth: test:123456 #  only used for rest mode  \n                               cluster.name: elasticsearch # ES集群名称\n       ```\n  \n       \n  \n-   注意：在配置es时，es的连接地址前面一定要加http://，不然在启动canal-adapter组件时就会报错；还有就是: 后面一定要加空格\n\n-   **注意：如果是在云服务上启动报错，错误内容为**\n\n    -   Could not resolve placeholder 'HOSTNAME%%.*'  \n        in value \"history -a; printf \"033]0;%s@%s:%s007\" \"${USER}\" \"${HOSTNAME%%.*}\" \"${PWD/#$HOME/~}\"\"\n\n    -   那么，则需要在application.yml的配置文件中最后面定格加入\n\n    -   HOSTNAME%%.*:  \n        PWD/*#$HOME/~:*\n\n![image-20221010105931138](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010105931138.png)\n\n-   可以参考链接：[启动canal-adapter时候未成功](https://github.com/alibaba/canal/issues/3063)&nbsp;\n\n-   添加配置文件canal-adapter/conf/es7/product.yml，用于配置MySQL中的表与Elasticsearch中索引的映射关系；\n\n```\ndataSourceKey: defaultDS # 源数据源的key, 对应上面配置的srcDataSources中的值  \ndestination: example  # canal的instance或者MQ的topic  \ngroupId: g1 # 对应MQ模式下的groupId, 只会同步对应groupId的数据  \nesMapping:  \n  _index: canal_product # es 的索引名称  \n  _id: _id  # es 的_id, 如果不配置该项必须配置下面的pk项_id则会由es自动分配  \n  sql: \"SELECT  \n            p.id AS _id,  \n            p.title,  \n            p.sub_title,  \n            p.price,  \n            p.pic  \n        FROM  \n            product p\"        # sql映射  \n  etlCondition: \"where a.c_time&gt;={}\"   #etl的条件参数  \n  commitBatch: 3000   # 提交批大小\n```\n\n-   使用startup.sh脚本启动canal-adapter服务；\n\n```\nsh bin/startup.sh\n```\n\n-   启动成功后可使用如下命令查看服务日志信息；\n\n```\ntail -f logs/adapter/adapter.log\n```\n\n![image-20221010110018421](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010110018421.png)\n\n-   启动成功后，日志会将表的映射文件信息给打印出来\n\n-   如果需要停止canal-adapter服务可以使用如下命令。\n\n-   sh bin/stop.sh\n\n# 4.数据同步测试\n\n-   首先我们需要在Elasticsearch中创建索引，和MySQL中的product表相对应，直接在Kibana的Dev Tools中使用如下命令创建即可；\n\n```\nPUT canal_product  \n{  \n  \"mappings\": {  \n    \"properties\": {  \n      \"title\": {  \n        \"type\": \"text\"  \n      },  \n      \"sub_title\": {  \n        \"type\": \"text\"  \n      },  \n      \"pic\": {  \n        \"type\": \"text\"  \n      },  \n      \"price\": {  \n        \"type\": \"double\"  \n      }  \n    }  \n  }  \n}\n```\n\n![image-20221010110038451](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010110038451.png)\n\n-   创建完成后可以查看下索引的结构；\n\nGET canal_product/_mapping\n\n![image-20221010110052888](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010110052888.png)\n\n-   之后使用如下SQL语句在数据库中创建一条记录；\n\n```sql\nINSERT INTO product ( id, title, sub_title, price, pic ) VALUES ( 5, '小米8', ' 全面屏游戏智能手机 6GB+64GB', 1999.00, NULL );\n```\n\n-   创建成功后，在Elasticsearch中搜索下，发现数据已经同步了；\n\nGET canal_product/_search\n\n![image-20221010110126304](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010110126304.png)\n\n-   再使用如下SQL对数据进行修改；\n\n```sql\nUPDATE product SET title='小米10' WHERE id=5\n```\n\n-   修改成功后，在Elasticsearch中搜索下，发现数据已经修改了；\n\n![image-20221010110145988](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010110145988.png)\n\n-   再使用如下SQL对数据进行删除操作；\n\n```sql\nDELETE FROM product WHERE id=5\n```\n\n-   删除成功后，在Elasticsearch中搜索下，发现数据已经删除了，至此MySQL同步到Elasticsearch的功能完成了！\n\n![image-20221010110213694](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010110213694.png)\n","slug":"mysql实时同步至es","published":1,"updated":"2022-10-10T03:12:02.399Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clg1mfuse000r27qgethf2um0","content":"<h1 id=\"mysql实时同步至es\"><a href=\"#mysql实时同步至es\" class=\"headerlink\" title=\"mysql实时同步至es\"></a>mysql实时同步至es</h1><p>目前是在本地进行测试同步的，由于在服务器上运行，占用的内存有点大，服务器上的配置与本地的配置稍微有所差别</p>\n<p>使用的工具版本：</p>\n<p>MySql8.0：通过 show variables like ‘%log_bin%’; 查看<em>二进制日志功能是否开启，一般情况下是默认开启的</em></p>\n<blockquote>\n<p><strong>Elasticsearch7.10.2由于log4j的问题导致用docker安装不了，可以换个版本</strong></p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>工具</th>\n<th>端口</th>\n<th>版本</th>\n<th>问题</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>mysql</td>\n<td>3308</td>\n<td>5.7</td>\n<td></td>\n</tr>\n<tr>\n<td>Elasticsearch</td>\n<td>9200</td>\n<td>7.10.2</td>\n<td><a href=\"https://hub.docker.com/layers/elasticsearch/library/elasticsearch/7.17.0/images/sha256-fa7141154a7e14df214e42f08c333702403eb88c02ba44e79322a1f42d733013?context=explore\">7.17.0</a></td>\n</tr>\n<tr>\n<td>Kibanba</td>\n<td>5601</td>\n<td>7.10.2</td>\n<td></td>\n</tr>\n<tr>\n<td>canal-deployer</td>\n<td>11111</td>\n<td>1.1.16</td>\n<td></td>\n</tr>\n<tr>\n<td>canal-adapter</td>\n<td>8081</td>\n<td>1.1.16</td>\n<td></td>\n</tr>\n<tr>\n<td>canal-admin</td>\n<td>8089</td>\n<td>1.1.16</td>\n<td></td>\n</tr>\n</tbody></table>\n<h1 id=\"1-安装MySql\"><a href=\"#1-安装MySql\" class=\"headerlink\" title=\"1.安装MySql\"></a>1.安装MySql</h1><p>通过docker安装mysql，pull下来mysql5.7版本</p>\n<p>docker pull mysql:5.7</p>\n<p>新建目录及配置文件</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /Users/mac/  </span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> mysql  </span><br><span class=\"line\"><span class=\"built_in\">cd</span> mysql  </span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> &#123;data,conf,logs&#125;  </span><br><span class=\"line\"><span class=\"built_in\">cd</span> conf  </span><br><span class=\"line\">vim my.cnf</span><br></pre></td></tr></table></figure>\n\n<p>创建并修改my.cnf配置文件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[mysqld]  </span><br><span class=\"line\">## 设置server_id，同一局域网中需要唯一  </span><br><span class=\"line\">server_id=101  </span><br><span class=\"line\">## 指定不需要同步的数据库名称  </span><br><span class=\"line\">binlog-ignore-db=mysql    </span><br><span class=\"line\">## 开启二进制日志功能  </span><br><span class=\"line\">log-bin=mall-mysql-bin    </span><br><span class=\"line\">## 设置二进制日志使用内存大小（事务）  </span><br><span class=\"line\">binlog_cache_size=1M    </span><br><span class=\"line\">## 设置使用的二进制日志格式（mixed,statement,row）  </span><br><span class=\"line\">binlog_format=row    </span><br><span class=\"line\">## 二进制日志过期清理时间。默认值为0，表示不自动清理。  </span><br><span class=\"line\">expire_logs_days=7    </span><br><span class=\"line\">## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。  </span><br><span class=\"line\">## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致  </span><br><span class=\"line\">slave_skip_errors=1062    </span><br><span class=\"line\"></span><br><span class=\"line\">## 增加配置</span><br><span class=\"line\">character-set-server=utf8  </span><br><span class=\"line\">secure_file_priv=/var/lib/mysql</span><br></pre></td></tr></table></figure>\n\n<p>通过docker启动mysql5.7</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -p 3308:3306 --name mysql57 -v /Users/mac/canal/mysql/conf/my.cnf:/etc/mysql/my.cnf -v /Users/mac/canal/mysql/logs:/logs -v /Users/mac/canal/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7</span><br></pre></td></tr></table></figure>\n\n<p>启动后，通过docker ps查看mysql是否启动成功。</p>\n<p>如果启动成功了，那么运行</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker <span class=\"built_in\">exec</span> -it 容器<span class=\"built_in\">id</span> /bin/bash</span><br></pre></td></tr></table></figure>\n\n<p>进入容器查看，通过输入命令进入mysql</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql -uroot -p</span><br></pre></td></tr></table></figure>\n\n<p>输入密码：123456进行mysql，之后可以通过输入查询语句，查看my.cnf是否配置成功。</p>\n<p>这是查看binlog是否启用</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">show variables like &#x27;%log_bin%&#x27;;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010105441843.png\" alt=\"image-20221010105441843\"></p>\n<p>这是查看binlog模式</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">show variables like &#x27;binlog_format%&#x27;;  </span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010105454917.png\" alt=\"image-20221010105454917\"></p>\n<p>建立一个测试用的数据库，canal_test数据库（这里是直接可视化界面建立的），之后再建立一张商品表product</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> `product`  (  </span><br><span class=\"line\">  `id` <span class=\"type\">bigint</span>(<span class=\"number\">20</span>) <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span> AUTO_INCREMENT,  </span><br><span class=\"line\">  `title` <span class=\"type\">varchar</span>(<span class=\"number\">255</span>) <span class=\"type\">CHARACTER</span> <span class=\"keyword\">SET</span> utf8 <span class=\"keyword\">COLLATE</span> utf8_general_ci <span class=\"keyword\">NULL</span> <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>,  </span><br><span class=\"line\">  `sub_title` <span class=\"type\">varchar</span>(<span class=\"number\">255</span>) <span class=\"type\">CHARACTER</span> <span class=\"keyword\">SET</span> utf8 <span class=\"keyword\">COLLATE</span> utf8_general_ci <span class=\"keyword\">NULL</span> <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>,  </span><br><span class=\"line\">  `price` <span class=\"type\">decimal</span>(<span class=\"number\">10</span>, <span class=\"number\">2</span>) <span class=\"keyword\">NULL</span> <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>,  </span><br><span class=\"line\">  `pic` <span class=\"type\">varchar</span>(<span class=\"number\">255</span>) <span class=\"type\">CHARACTER</span> <span class=\"keyword\">SET</span> utf8 <span class=\"keyword\">COLLATE</span> utf8_general_ci <span class=\"keyword\">NULL</span> <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>,  </span><br><span class=\"line\">  <span class=\"keyword\">PRIMARY</span> KEY (`id`) <span class=\"keyword\">USING</span> BTREE  </span><br><span class=\"line\">) ENGINE <span class=\"operator\">=</span> InnoDB AUTO_INCREMENT <span class=\"operator\">=</span> <span class=\"number\">2</span> <span class=\"type\">CHARACTER</span> <span class=\"keyword\">SET</span> <span class=\"operator\">=</span> utf8 <span class=\"keyword\">COLLATE</span> <span class=\"operator\">=</span> utf8_general_ci ROW_FORMAT <span class=\"operator\">=</span> <span class=\"keyword\">Dynamic</span>;</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"2-Elasticsearch和Kibana安装\"><a href=\"#2-Elasticsearch和Kibana安装\" class=\"headerlink\" title=\"2.Elasticsearch和Kibana安装\"></a>2.Elasticsearch和Kibana安装</h1><p>上dockerhub上，找到es的版本，然后下载安装，在mac上安装和通过docker安装并没有什么太大的区别</p>\n<p>docker pull elasticsearch:7.17.0</p>\n<p>之后运行es，如果没有映射文件夹，记得创建</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run --name myes -d -e ES_JAVA_OPTS=<span class=\"string\">&quot;-Xms256m -Xmx256m&quot;</span>   </span><br><span class=\"line\">-e <span class=\"string\">&quot;discovery.type=single-node&quot;</span> -p 9200:9200 -p 9300:9300   </span><br><span class=\"line\">-v /etc/localtime:/etc/localtime:ro   </span><br><span class=\"line\">-v /home/es/data:/usr/share/elasticsearch/data elasticsearch:7.17.0</span><br></pre></td></tr></table></figure>\n\n<p>同理，kibana也是这样安装的。拉取镜像，创建配置文件夹，</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull kibana:7.17.0</span><br><span class=\"line\"></span><br><span class=\"line\">mkdir -p /root/mydata/kibana/conf  </span><br><span class=\"line\">cd /root/mydata/kibana/conf</span><br></pre></td></tr></table></figure>\n\n<p><strong>vim kibana.yml</strong>  这是kibana的配置文件，配置连接es的</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># </span><br><span class=\"line\">## ** THIS IS AN AUTO-GENERATED FILE **  </span><br><span class=\"line\">#  </span><br><span class=\"line\"># Default Kibana configuration for docker target  </span><br><span class=\"line\"></span><br><span class=\"line\">server.name: kibana  </span><br><span class=\"line\">server.host: &quot;0&quot;  </span><br></pre></td></tr></table></figure>\n\n<p>如果是云服务器，则将127.0.0.1改成服务器的ip地址  </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">elasticsearch.hosts: [ &quot;http://127.0.0.1:9200&quot; ]  </span><br><span class=\"line\">xpack.monitoring.ui.container.elasticsearch.enabled: true</span><br></pre></td></tr></table></figure>\n\n<p>之后是创建kibana容器</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d --name=kibana --restart=always -p 5601:5601   </span><br><span class=\"line\">-v $PWD/conf/kibana.yml:/usr/share/kibana/config/kibana.yml kibana:7.17.0</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"3-canal组件安装\"><a href=\"#3-canal组件安装\" class=\"headerlink\" title=\"3.canal组件安装\"></a>3.canal组件安装</h1><h2 id=\"3-1安装canal-server\"><a href=\"#3-1安装canal-server\" class=\"headerlink\" title=\"3.1安装canal-server\"></a>3.1安装canal-server</h2><ul>\n<li><p>首先我们需要下载canal的各个组件canal-server、canal-adapter、canal-admin，下载地址：<a href=\"https://github.com/alibaba/canal/releases\">https://github.com/alibaba/canal/releases</a></p>\n</li>\n<li><p><strong>canal是基于Java的，启动canal服务器一定要保证安装好了jdk</strong></p>\n</li>\n</ul>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010105719713.png\" alt=\"image-20221010105719713\"></p>\n<p>canal的各个组件的用途各不相同，下面分别介绍下：</p>\n<ul>\n<li><p><strong>canal-server（canal-deploy）</strong>：可以直接监听MySQL的binlog，把自己伪装成MySQL的从库，只负责接收数据，并不做处理。</p>\n</li>\n<li><p>canal-adapter：相当于canal的客户端，会从canal-server中获取数据，然后对数据进行同步，可以同步到MySQL、Elasticsearch和HBase等存储中去。</p>\n</li>\n<li><p>canal-admin：为canal提供整体配置管理、节点运维等面向运维的功能，提供相对友好的WebUI操作界面，方便更多用户快速和安全的操作。</p>\n</li>\n</ul>\n<p>进入到canal组件目录，然后将他们分别解压至相应的目录</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /Users/mac/canal  </span><br><span class=\"line\">mkdir &#123;canal-server,canal-adapter,canal-admin&#125;  </span><br><span class=\"line\">tar -zxvf canal.deployer-1.1.6-SNAPSHOT.tar.gz -C canal-server  </span><br><span class=\"line\">tar -zxvf canal.adapter-1.1.6-SNAPSHOT.tar.gz -C canal-adapter  </span><br><span class=\"line\">tar -zxvf canal.admin-1.1.6-SNAPSHOT.tar.gz -C canal-admin</span><br></pre></td></tr></table></figure>\n\n<p>进入到canal-server目录，修改配置文件<strong>conf&#x2F;example&#x2F;instance.properties</strong>，按照如下配置</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 需要同步数据的MySQL地址  </span><br><span class=\"line\">canal.instance.master.address=127.0.0.1:3308  </span><br><span class=\"line\">canal.instance.master.journal.name=  </span><br><span class=\"line\">canal.instance.master.position=  </span><br><span class=\"line\">canal.instance.master.timestamp=  </span><br><span class=\"line\">canal.instance.master.gtid=  </span><br><span class=\"line\"># 用于同步数据的数据库账号  </span><br><span class=\"line\">canal.instance.dbUsername=root  </span><br><span class=\"line\"># 用于同步数据的数据库密码  </span><br><span class=\"line\">canal.instance.dbPassword=123456  </span><br><span class=\"line\"># 数据库连接编码  </span><br><span class=\"line\">canal.instance.connectionCharset = UTF-8  </span><br><span class=\"line\"># 需要订阅binlog的表过滤正则表达式  </span><br><span class=\"line\">canal.instance.filter.regex=.*\\\\..*</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>使用startup.sh脚本启动canal-server服务；</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sh bin/startup.sh</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>启动成功后可使用如下命令查看服务日志信息；</p>\n</li>\n<li><p>注意：只有启动成功了，才会创建canal文件夹和cancal&#x2F;canal.log、example文件夹和example&#x2F;example.log</p>\n</li>\n</ul>\n<p> </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tail -f logs/canal/canal.log</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010105823795.png\" alt=\"image-20221010105823795\"></p>\n<ul>\n<li>启动成功后可使用如下命令查看instance日志信息；</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tail -f logs/example/example.log </span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010105837062.png\" alt=\"image-20221010105837062\"></p>\n<ul>\n<li>如果想要停止canal-server服务可以使用如下命令。</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sh bin/stop.sh</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"3-2安装canal-adapter\"><a href=\"#3-2安装canal-adapter\" class=\"headerlink\" title=\"3.2安装canal-adapter\"></a>3.2安装canal-adapter</h2><p>进入canal-adapter目录</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /Users/mac/canal/canal-adapter</span><br></pre></td></tr></table></figure>\n\n\n\n<ul>\n<li>修改配置文件conf&#x2F;application.yml，按如下配置即可，主要是修改canal-server配置、数据源配置和客户端适配器配置；</li>\n</ul>\n<p>  - - &#96;&#96;&#96;<br>       canal.conf:<br>         mode: tcp # 客户端的模式，可选tcp kafka rocketMQ<br>         flatMessage: true # 扁平message开关, 是否以json字符串形式投递数据, 仅在kafka&#x2F;rocketMQ模式下有效<br>         zookeeperHosts:    # 对应集群模式下的zk地址<br>         syncBatchSize: 1000 # 每次同步的批数量<br>         retries: 0 # 重试次数, -1为无限重试<br>         timeout: # 同步超时时间, 单位毫秒<br>         accessKey:<br>         secretKey:<br>         consumerProperties:<br>  <br>           # canal tcp consumer<br>  <br>           canal.tcp.server.host: 127.0.0.1:11111 #设置canal-server的地址<br>           canal.tcp.zookeeper.hosts:<br>           canal.tcp.batch.size: 500<br>           canal.tcp.username:<br>           canal.tcp.password:<br>  <br>         srcDataSources: # 源数据库配置<br>           defaultDS:<br>             url: jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3308&#x2F;canal_test?useUnicode&#x3D;true<br>             username: root<br>             password: 123456<br>         canalAdapters: # 适配器列表<br>  <br>         - instance: example # canal实例名或者MQ topic名<br>             groups: # 分组列表<br>              - groupId: g1 # 分组id, 如果是MQ模式将用到该值<br>                outerAdapters:<br>                   - name: logger # 日志打印适配器<br>                     name: es7 # ES同步适配器<br>                             hosts: <a href=\"http://127.0.0.1:9200/\">http://127.0.0.1:9200</a> # ES连接地址<br>                             properties:<br>                               mode: rest # 模式可选transport(9300) 或者 rest(9200)<br>                               # security.auth: test:123456 #  only used for rest mode<br>                               cluster.name: elasticsearch # ES集群名称<br>       <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  </span><br><span class=\"line\">       </span><br><span class=\"line\">  </span><br><span class=\"line\">-   注意：在配置es时，es的连接地址前面一定要加http://，不然在启动canal-adapter组件时就会报错；还有就是: 后面一定要加空格</span><br><span class=\"line\"></span><br><span class=\"line\">-   **注意：如果是在云服务上启动报错，错误内容为**</span><br><span class=\"line\"></span><br><span class=\"line\">    -   Could not resolve placeholder &#x27;HOSTNAME%%.*&#x27;  </span><br><span class=\"line\">        in value &quot;history -a; printf &quot;033]0;%s@%s:%s007&quot; &quot;$&#123;USER&#125;&quot; &quot;$&#123;HOSTNAME%%.*&#125;&quot; &quot;$&#123;PWD/#$HOME/~&#125;&quot;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    -   那么，则需要在application.yml的配置文件中最后面定格加入</span><br><span class=\"line\"></span><br><span class=\"line\">    -   HOSTNAME%%.*:  </span><br><span class=\"line\">        PWD/*#$HOME/~:*</span><br><span class=\"line\"></span><br><span class=\"line\">![image-20221010105931138](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010105931138.png)</span><br><span class=\"line\"></span><br><span class=\"line\">-   可以参考链接：[启动canal-adapter时候未成功](https://github.com/alibaba/canal/issues/3063)&amp;nbsp;</span><br><span class=\"line\"></span><br><span class=\"line\">-   添加配置文件canal-adapter/conf/es7/product.yml，用于配置MySQL中的表与Elasticsearch中索引的映射关系；</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure><br>dataSourceKey: defaultDS # 源数据源的key, 对应上面配置的srcDataSources中的值<br>destination: example  # canal的instance或者MQ的topic<br>groupId: g1 # 对应MQ模式下的groupId, 只会同步对应groupId的数据<br>esMapping:<br>  _index: canal_product # es 的索引名称<br>  _id: _id  # es 的_id, 如果不配置该项必须配置下面的pk项_id则会由es自动分配<br>  sql: “SELECT<br>            p.id AS _id,<br>            p.title,<br>            p.sub_title,<br>            p.price,<br>            p.pic<br>        FROM<br>            product p”        # sql映射<br>  etlCondition: “where a.c_time&gt;&#x3D;{}”   #etl的条件参数<br>  commitBatch: 3000   # 提交批大小</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">-   使用startup.sh脚本启动canal-adapter服务；</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>sh bin&#x2F;startup.sh</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">-   启动成功后可使用如下命令查看服务日志信息；</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>tail -f logs&#x2F;adapter&#x2F;adapter.log</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">![image-20221010110018421](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010110018421.png)</span><br><span class=\"line\"></span><br><span class=\"line\">-   启动成功后，日志会将表的映射文件信息给打印出来</span><br><span class=\"line\"></span><br><span class=\"line\">-   如果需要停止canal-adapter服务可以使用如下命令。</span><br><span class=\"line\"></span><br><span class=\"line\">-   sh bin/stop.sh</span><br><span class=\"line\"></span><br><span class=\"line\"># 4.数据同步测试</span><br><span class=\"line\"></span><br><span class=\"line\">-   首先我们需要在Elasticsearch中创建索引，和MySQL中的product表相对应，直接在Kibana的Dev Tools中使用如下命令创建即可；</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>PUT canal_product<br>{<br>  “mappings”: {<br>    “properties”: {<br>      “title”: {<br>        “type”: “text”<br>      },<br>      “sub_title”: {<br>        “type”: “text”<br>      },<br>      “pic”: {<br>        “type”: “text”<br>      },<br>      “price”: {<br>        “type”: “double”<br>      }<br>    }<br>  }<br>}</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">![image-20221010110038451](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010110038451.png)</span><br><span class=\"line\"></span><br><span class=\"line\">-   创建完成后可以查看下索引的结构；</span><br><span class=\"line\"></span><br><span class=\"line\">GET canal_product/_mapping</span><br><span class=\"line\"></span><br><span class=\"line\">![image-20221010110052888](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010110052888.png)</span><br><span class=\"line\"></span><br><span class=\"line\">-   之后使用如下SQL语句在数据库中创建一条记录；</span><br><span class=\"line\"></span><br><span class=\"line\">```sql</span><br><span class=\"line\">INSERT INTO product ( id, title, sub_title, price, pic ) VALUES ( 5, &#x27;小米8&#x27;, &#x27; 全面屏游戏智能手机 6GB+64GB&#x27;, 1999.00, NULL );</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>创建成功后，在Elasticsearch中搜索下，发现数据已经同步了；</li>\n</ul>\n<p>GET canal_product&#x2F;_search</p>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010110126304.png\" alt=\"image-20221010110126304\"></p>\n<ul>\n<li>再使用如下SQL对数据进行修改；</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">UPDATE</span> product <span class=\"keyword\">SET</span> title<span class=\"operator\">=</span><span class=\"string\">&#x27;小米10&#x27;</span> <span class=\"keyword\">WHERE</span> id<span class=\"operator\">=</span><span class=\"number\">5</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>修改成功后，在Elasticsearch中搜索下，发现数据已经修改了；</li>\n</ul>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010110145988.png\" alt=\"image-20221010110145988\"></p>\n<ul>\n<li>再使用如下SQL对数据进行删除操作；</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">DELETE</span> <span class=\"keyword\">FROM</span> product <span class=\"keyword\">WHERE</span> id<span class=\"operator\">=</span><span class=\"number\">5</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>删除成功后，在Elasticsearch中搜索下，发现数据已经删除了，至此MySQL同步到Elasticsearch的功能完成了！</li>\n</ul>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010110213694.png\" alt=\"image-20221010110213694\"></p>\n","site":{"data":{"link":[{"class_name":"网站","class_desc":"值得推荐的网站","link_list":[{"name":"动漫图片和壁纸","link":"https://anime-pictures.net/?lang=zh_CN","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"图片网站"},{"name":"Wallhaven","link":"https://wallhaven.cc/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"4k图片网站"},{"name":"WALLPAPER ABYSS","link":"https://wall.alphacoders.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"WALLPAPER ABYSS"},{"name":"极简壁纸","link":"https://bz.zzzmh.cn/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"极简壁纸"},{"name":"Wallroom","link":"https://wallroom.io/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"Wallroom"}]}]}},"excerpt":"","more":"<h1 id=\"mysql实时同步至es\"><a href=\"#mysql实时同步至es\" class=\"headerlink\" title=\"mysql实时同步至es\"></a>mysql实时同步至es</h1><p>目前是在本地进行测试同步的，由于在服务器上运行，占用的内存有点大，服务器上的配置与本地的配置稍微有所差别</p>\n<p>使用的工具版本：</p>\n<p>MySql8.0：通过 show variables like ‘%log_bin%’; 查看<em>二进制日志功能是否开启，一般情况下是默认开启的</em></p>\n<blockquote>\n<p><strong>Elasticsearch7.10.2由于log4j的问题导致用docker安装不了，可以换个版本</strong></p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>工具</th>\n<th>端口</th>\n<th>版本</th>\n<th>问题</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>mysql</td>\n<td>3308</td>\n<td>5.7</td>\n<td></td>\n</tr>\n<tr>\n<td>Elasticsearch</td>\n<td>9200</td>\n<td>7.10.2</td>\n<td><a href=\"https://hub.docker.com/layers/elasticsearch/library/elasticsearch/7.17.0/images/sha256-fa7141154a7e14df214e42f08c333702403eb88c02ba44e79322a1f42d733013?context=explore\">7.17.0</a></td>\n</tr>\n<tr>\n<td>Kibanba</td>\n<td>5601</td>\n<td>7.10.2</td>\n<td></td>\n</tr>\n<tr>\n<td>canal-deployer</td>\n<td>11111</td>\n<td>1.1.16</td>\n<td></td>\n</tr>\n<tr>\n<td>canal-adapter</td>\n<td>8081</td>\n<td>1.1.16</td>\n<td></td>\n</tr>\n<tr>\n<td>canal-admin</td>\n<td>8089</td>\n<td>1.1.16</td>\n<td></td>\n</tr>\n</tbody></table>\n<h1 id=\"1-安装MySql\"><a href=\"#1-安装MySql\" class=\"headerlink\" title=\"1.安装MySql\"></a>1.安装MySql</h1><p>通过docker安装mysql，pull下来mysql5.7版本</p>\n<p>docker pull mysql:5.7</p>\n<p>新建目录及配置文件</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /Users/mac/  </span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> mysql  </span><br><span class=\"line\"><span class=\"built_in\">cd</span> mysql  </span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> &#123;data,conf,logs&#125;  </span><br><span class=\"line\"><span class=\"built_in\">cd</span> conf  </span><br><span class=\"line\">vim my.cnf</span><br></pre></td></tr></table></figure>\n\n<p>创建并修改my.cnf配置文件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[mysqld]  </span><br><span class=\"line\">## 设置server_id，同一局域网中需要唯一  </span><br><span class=\"line\">server_id=101  </span><br><span class=\"line\">## 指定不需要同步的数据库名称  </span><br><span class=\"line\">binlog-ignore-db=mysql    </span><br><span class=\"line\">## 开启二进制日志功能  </span><br><span class=\"line\">log-bin=mall-mysql-bin    </span><br><span class=\"line\">## 设置二进制日志使用内存大小（事务）  </span><br><span class=\"line\">binlog_cache_size=1M    </span><br><span class=\"line\">## 设置使用的二进制日志格式（mixed,statement,row）  </span><br><span class=\"line\">binlog_format=row    </span><br><span class=\"line\">## 二进制日志过期清理时间。默认值为0，表示不自动清理。  </span><br><span class=\"line\">expire_logs_days=7    </span><br><span class=\"line\">## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。  </span><br><span class=\"line\">## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致  </span><br><span class=\"line\">slave_skip_errors=1062    </span><br><span class=\"line\"></span><br><span class=\"line\">## 增加配置</span><br><span class=\"line\">character-set-server=utf8  </span><br><span class=\"line\">secure_file_priv=/var/lib/mysql</span><br></pre></td></tr></table></figure>\n\n<p>通过docker启动mysql5.7</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -p 3308:3306 --name mysql57 -v /Users/mac/canal/mysql/conf/my.cnf:/etc/mysql/my.cnf -v /Users/mac/canal/mysql/logs:/logs -v /Users/mac/canal/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7</span><br></pre></td></tr></table></figure>\n\n<p>启动后，通过docker ps查看mysql是否启动成功。</p>\n<p>如果启动成功了，那么运行</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker <span class=\"built_in\">exec</span> -it 容器<span class=\"built_in\">id</span> /bin/bash</span><br></pre></td></tr></table></figure>\n\n<p>进入容器查看，通过输入命令进入mysql</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql -uroot -p</span><br></pre></td></tr></table></figure>\n\n<p>输入密码：123456进行mysql，之后可以通过输入查询语句，查看my.cnf是否配置成功。</p>\n<p>这是查看binlog是否启用</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">show variables like &#x27;%log_bin%&#x27;;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010105441843.png\" alt=\"image-20221010105441843\"></p>\n<p>这是查看binlog模式</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">show variables like &#x27;binlog_format%&#x27;;  </span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010105454917.png\" alt=\"image-20221010105454917\"></p>\n<p>建立一个测试用的数据库，canal_test数据库（这里是直接可视化界面建立的），之后再建立一张商品表product</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> `product`  (  </span><br><span class=\"line\">  `id` <span class=\"type\">bigint</span>(<span class=\"number\">20</span>) <span class=\"keyword\">NOT</span> <span class=\"keyword\">NULL</span> AUTO_INCREMENT,  </span><br><span class=\"line\">  `title` <span class=\"type\">varchar</span>(<span class=\"number\">255</span>) <span class=\"type\">CHARACTER</span> <span class=\"keyword\">SET</span> utf8 <span class=\"keyword\">COLLATE</span> utf8_general_ci <span class=\"keyword\">NULL</span> <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>,  </span><br><span class=\"line\">  `sub_title` <span class=\"type\">varchar</span>(<span class=\"number\">255</span>) <span class=\"type\">CHARACTER</span> <span class=\"keyword\">SET</span> utf8 <span class=\"keyword\">COLLATE</span> utf8_general_ci <span class=\"keyword\">NULL</span> <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>,  </span><br><span class=\"line\">  `price` <span class=\"type\">decimal</span>(<span class=\"number\">10</span>, <span class=\"number\">2</span>) <span class=\"keyword\">NULL</span> <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>,  </span><br><span class=\"line\">  `pic` <span class=\"type\">varchar</span>(<span class=\"number\">255</span>) <span class=\"type\">CHARACTER</span> <span class=\"keyword\">SET</span> utf8 <span class=\"keyword\">COLLATE</span> utf8_general_ci <span class=\"keyword\">NULL</span> <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">NULL</span>,  </span><br><span class=\"line\">  <span class=\"keyword\">PRIMARY</span> KEY (`id`) <span class=\"keyword\">USING</span> BTREE  </span><br><span class=\"line\">) ENGINE <span class=\"operator\">=</span> InnoDB AUTO_INCREMENT <span class=\"operator\">=</span> <span class=\"number\">2</span> <span class=\"type\">CHARACTER</span> <span class=\"keyword\">SET</span> <span class=\"operator\">=</span> utf8 <span class=\"keyword\">COLLATE</span> <span class=\"operator\">=</span> utf8_general_ci ROW_FORMAT <span class=\"operator\">=</span> <span class=\"keyword\">Dynamic</span>;</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"2-Elasticsearch和Kibana安装\"><a href=\"#2-Elasticsearch和Kibana安装\" class=\"headerlink\" title=\"2.Elasticsearch和Kibana安装\"></a>2.Elasticsearch和Kibana安装</h1><p>上dockerhub上，找到es的版本，然后下载安装，在mac上安装和通过docker安装并没有什么太大的区别</p>\n<p>docker pull elasticsearch:7.17.0</p>\n<p>之后运行es，如果没有映射文件夹，记得创建</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run --name myes -d -e ES_JAVA_OPTS=<span class=\"string\">&quot;-Xms256m -Xmx256m&quot;</span>   </span><br><span class=\"line\">-e <span class=\"string\">&quot;discovery.type=single-node&quot;</span> -p 9200:9200 -p 9300:9300   </span><br><span class=\"line\">-v /etc/localtime:/etc/localtime:ro   </span><br><span class=\"line\">-v /home/es/data:/usr/share/elasticsearch/data elasticsearch:7.17.0</span><br></pre></td></tr></table></figure>\n\n<p>同理，kibana也是这样安装的。拉取镜像，创建配置文件夹，</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull kibana:7.17.0</span><br><span class=\"line\"></span><br><span class=\"line\">mkdir -p /root/mydata/kibana/conf  </span><br><span class=\"line\">cd /root/mydata/kibana/conf</span><br></pre></td></tr></table></figure>\n\n<p><strong>vim kibana.yml</strong>  这是kibana的配置文件，配置连接es的</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># </span><br><span class=\"line\">## ** THIS IS AN AUTO-GENERATED FILE **  </span><br><span class=\"line\">#  </span><br><span class=\"line\"># Default Kibana configuration for docker target  </span><br><span class=\"line\"></span><br><span class=\"line\">server.name: kibana  </span><br><span class=\"line\">server.host: &quot;0&quot;  </span><br></pre></td></tr></table></figure>\n\n<p>如果是云服务器，则将127.0.0.1改成服务器的ip地址  </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">elasticsearch.hosts: [ &quot;http://127.0.0.1:9200&quot; ]  </span><br><span class=\"line\">xpack.monitoring.ui.container.elasticsearch.enabled: true</span><br></pre></td></tr></table></figure>\n\n<p>之后是创建kibana容器</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d --name=kibana --restart=always -p 5601:5601   </span><br><span class=\"line\">-v $PWD/conf/kibana.yml:/usr/share/kibana/config/kibana.yml kibana:7.17.0</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"3-canal组件安装\"><a href=\"#3-canal组件安装\" class=\"headerlink\" title=\"3.canal组件安装\"></a>3.canal组件安装</h1><h2 id=\"3-1安装canal-server\"><a href=\"#3-1安装canal-server\" class=\"headerlink\" title=\"3.1安装canal-server\"></a>3.1安装canal-server</h2><ul>\n<li><p>首先我们需要下载canal的各个组件canal-server、canal-adapter、canal-admin，下载地址：<a href=\"https://github.com/alibaba/canal/releases\">https://github.com/alibaba/canal/releases</a></p>\n</li>\n<li><p><strong>canal是基于Java的，启动canal服务器一定要保证安装好了jdk</strong></p>\n</li>\n</ul>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010105719713.png\" alt=\"image-20221010105719713\"></p>\n<p>canal的各个组件的用途各不相同，下面分别介绍下：</p>\n<ul>\n<li><p><strong>canal-server（canal-deploy）</strong>：可以直接监听MySQL的binlog，把自己伪装成MySQL的从库，只负责接收数据，并不做处理。</p>\n</li>\n<li><p>canal-adapter：相当于canal的客户端，会从canal-server中获取数据，然后对数据进行同步，可以同步到MySQL、Elasticsearch和HBase等存储中去。</p>\n</li>\n<li><p>canal-admin：为canal提供整体配置管理、节点运维等面向运维的功能，提供相对友好的WebUI操作界面，方便更多用户快速和安全的操作。</p>\n</li>\n</ul>\n<p>进入到canal组件目录，然后将他们分别解压至相应的目录</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /Users/mac/canal  </span><br><span class=\"line\">mkdir &#123;canal-server,canal-adapter,canal-admin&#125;  </span><br><span class=\"line\">tar -zxvf canal.deployer-1.1.6-SNAPSHOT.tar.gz -C canal-server  </span><br><span class=\"line\">tar -zxvf canal.adapter-1.1.6-SNAPSHOT.tar.gz -C canal-adapter  </span><br><span class=\"line\">tar -zxvf canal.admin-1.1.6-SNAPSHOT.tar.gz -C canal-admin</span><br></pre></td></tr></table></figure>\n\n<p>进入到canal-server目录，修改配置文件<strong>conf&#x2F;example&#x2F;instance.properties</strong>，按照如下配置</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 需要同步数据的MySQL地址  </span><br><span class=\"line\">canal.instance.master.address=127.0.0.1:3308  </span><br><span class=\"line\">canal.instance.master.journal.name=  </span><br><span class=\"line\">canal.instance.master.position=  </span><br><span class=\"line\">canal.instance.master.timestamp=  </span><br><span class=\"line\">canal.instance.master.gtid=  </span><br><span class=\"line\"># 用于同步数据的数据库账号  </span><br><span class=\"line\">canal.instance.dbUsername=root  </span><br><span class=\"line\"># 用于同步数据的数据库密码  </span><br><span class=\"line\">canal.instance.dbPassword=123456  </span><br><span class=\"line\"># 数据库连接编码  </span><br><span class=\"line\">canal.instance.connectionCharset = UTF-8  </span><br><span class=\"line\"># 需要订阅binlog的表过滤正则表达式  </span><br><span class=\"line\">canal.instance.filter.regex=.*\\\\..*</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>使用startup.sh脚本启动canal-server服务；</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sh bin/startup.sh</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>启动成功后可使用如下命令查看服务日志信息；</p>\n</li>\n<li><p>注意：只有启动成功了，才会创建canal文件夹和cancal&#x2F;canal.log、example文件夹和example&#x2F;example.log</p>\n</li>\n</ul>\n<p> </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tail -f logs/canal/canal.log</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010105823795.png\" alt=\"image-20221010105823795\"></p>\n<ul>\n<li>启动成功后可使用如下命令查看instance日志信息；</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tail -f logs/example/example.log </span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010105837062.png\" alt=\"image-20221010105837062\"></p>\n<ul>\n<li>如果想要停止canal-server服务可以使用如下命令。</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sh bin/stop.sh</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"3-2安装canal-adapter\"><a href=\"#3-2安装canal-adapter\" class=\"headerlink\" title=\"3.2安装canal-adapter\"></a>3.2安装canal-adapter</h2><p>进入canal-adapter目录</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /Users/mac/canal/canal-adapter</span><br></pre></td></tr></table></figure>\n\n\n\n<ul>\n<li>修改配置文件conf&#x2F;application.yml，按如下配置即可，主要是修改canal-server配置、数据源配置和客户端适配器配置；</li>\n</ul>\n<p>  - - &#96;&#96;&#96;<br>       canal.conf:<br>         mode: tcp # 客户端的模式，可选tcp kafka rocketMQ<br>         flatMessage: true # 扁平message开关, 是否以json字符串形式投递数据, 仅在kafka&#x2F;rocketMQ模式下有效<br>         zookeeperHosts:    # 对应集群模式下的zk地址<br>         syncBatchSize: 1000 # 每次同步的批数量<br>         retries: 0 # 重试次数, -1为无限重试<br>         timeout: # 同步超时时间, 单位毫秒<br>         accessKey:<br>         secretKey:<br>         consumerProperties:<br>  <br>           # canal tcp consumer<br>  <br>           canal.tcp.server.host: 127.0.0.1:11111 #设置canal-server的地址<br>           canal.tcp.zookeeper.hosts:<br>           canal.tcp.batch.size: 500<br>           canal.tcp.username:<br>           canal.tcp.password:<br>  <br>         srcDataSources: # 源数据库配置<br>           defaultDS:<br>             url: jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3308&#x2F;canal_test?useUnicode&#x3D;true<br>             username: root<br>             password: 123456<br>         canalAdapters: # 适配器列表<br>  <br>         - instance: example # canal实例名或者MQ topic名<br>             groups: # 分组列表<br>              - groupId: g1 # 分组id, 如果是MQ模式将用到该值<br>                outerAdapters:<br>                   - name: logger # 日志打印适配器<br>                     name: es7 # ES同步适配器<br>                             hosts: <a href=\"http://127.0.0.1:9200/\">http://127.0.0.1:9200</a> # ES连接地址<br>                             properties:<br>                               mode: rest # 模式可选transport(9300) 或者 rest(9200)<br>                               # security.auth: test:123456 #  only used for rest mode<br>                               cluster.name: elasticsearch # ES集群名称<br>       <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  </span><br><span class=\"line\">       </span><br><span class=\"line\">  </span><br><span class=\"line\">-   注意：在配置es时，es的连接地址前面一定要加http://，不然在启动canal-adapter组件时就会报错；还有就是: 后面一定要加空格</span><br><span class=\"line\"></span><br><span class=\"line\">-   **注意：如果是在云服务上启动报错，错误内容为**</span><br><span class=\"line\"></span><br><span class=\"line\">    -   Could not resolve placeholder &#x27;HOSTNAME%%.*&#x27;  </span><br><span class=\"line\">        in value &quot;history -a; printf &quot;033]0;%s@%s:%s007&quot; &quot;$&#123;USER&#125;&quot; &quot;$&#123;HOSTNAME%%.*&#125;&quot; &quot;$&#123;PWD/#$HOME/~&#125;&quot;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">    -   那么，则需要在application.yml的配置文件中最后面定格加入</span><br><span class=\"line\"></span><br><span class=\"line\">    -   HOSTNAME%%.*:  </span><br><span class=\"line\">        PWD/*#$HOME/~:*</span><br><span class=\"line\"></span><br><span class=\"line\">![image-20221010105931138](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010105931138.png)</span><br><span class=\"line\"></span><br><span class=\"line\">-   可以参考链接：[启动canal-adapter时候未成功](https://github.com/alibaba/canal/issues/3063)&amp;nbsp;</span><br><span class=\"line\"></span><br><span class=\"line\">-   添加配置文件canal-adapter/conf/es7/product.yml，用于配置MySQL中的表与Elasticsearch中索引的映射关系；</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure><br>dataSourceKey: defaultDS # 源数据源的key, 对应上面配置的srcDataSources中的值<br>destination: example  # canal的instance或者MQ的topic<br>groupId: g1 # 对应MQ模式下的groupId, 只会同步对应groupId的数据<br>esMapping:<br>  _index: canal_product # es 的索引名称<br>  _id: _id  # es 的_id, 如果不配置该项必须配置下面的pk项_id则会由es自动分配<br>  sql: “SELECT<br>            p.id AS _id,<br>            p.title,<br>            p.sub_title,<br>            p.price,<br>            p.pic<br>        FROM<br>            product p”        # sql映射<br>  etlCondition: “where a.c_time&gt;&#x3D;{}”   #etl的条件参数<br>  commitBatch: 3000   # 提交批大小</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">-   使用startup.sh脚本启动canal-adapter服务；</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>sh bin&#x2F;startup.sh</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">-   启动成功后可使用如下命令查看服务日志信息；</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>tail -f logs&#x2F;adapter&#x2F;adapter.log</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">![image-20221010110018421](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010110018421.png)</span><br><span class=\"line\"></span><br><span class=\"line\">-   启动成功后，日志会将表的映射文件信息给打印出来</span><br><span class=\"line\"></span><br><span class=\"line\">-   如果需要停止canal-adapter服务可以使用如下命令。</span><br><span class=\"line\"></span><br><span class=\"line\">-   sh bin/stop.sh</span><br><span class=\"line\"></span><br><span class=\"line\"># 4.数据同步测试</span><br><span class=\"line\"></span><br><span class=\"line\">-   首先我们需要在Elasticsearch中创建索引，和MySQL中的product表相对应，直接在Kibana的Dev Tools中使用如下命令创建即可；</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>PUT canal_product<br>{<br>  “mappings”: {<br>    “properties”: {<br>      “title”: {<br>        “type”: “text”<br>      },<br>      “sub_title”: {<br>        “type”: “text”<br>      },<br>      “pic”: {<br>        “type”: “text”<br>      },<br>      “price”: {<br>        “type”: “double”<br>      }<br>    }<br>  }<br>}</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">![image-20221010110038451](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010110038451.png)</span><br><span class=\"line\"></span><br><span class=\"line\">-   创建完成后可以查看下索引的结构；</span><br><span class=\"line\"></span><br><span class=\"line\">GET canal_product/_mapping</span><br><span class=\"line\"></span><br><span class=\"line\">![image-20221010110052888](https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010110052888.png)</span><br><span class=\"line\"></span><br><span class=\"line\">-   之后使用如下SQL语句在数据库中创建一条记录；</span><br><span class=\"line\"></span><br><span class=\"line\">```sql</span><br><span class=\"line\">INSERT INTO product ( id, title, sub_title, price, pic ) VALUES ( 5, &#x27;小米8&#x27;, &#x27; 全面屏游戏智能手机 6GB+64GB&#x27;, 1999.00, NULL );</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>创建成功后，在Elasticsearch中搜索下，发现数据已经同步了；</li>\n</ul>\n<p>GET canal_product&#x2F;_search</p>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010110126304.png\" alt=\"image-20221010110126304\"></p>\n<ul>\n<li>再使用如下SQL对数据进行修改；</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">UPDATE</span> product <span class=\"keyword\">SET</span> title<span class=\"operator\">=</span><span class=\"string\">&#x27;小米10&#x27;</span> <span class=\"keyword\">WHERE</span> id<span class=\"operator\">=</span><span class=\"number\">5</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>修改成功后，在Elasticsearch中搜索下，发现数据已经修改了；</li>\n</ul>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010110145988.png\" alt=\"image-20221010110145988\"></p>\n<ul>\n<li>再使用如下SQL对数据进行删除操作；</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">DELETE</span> <span class=\"keyword\">FROM</span> product <span class=\"keyword\">WHERE</span> id<span class=\"operator\">=</span><span class=\"number\">5</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>删除成功后，在Elasticsearch中搜索下，发现数据已经删除了，至此MySQL同步到Elasticsearch的功能完成了！</li>\n</ul>\n<p><img src=\"https://typora-1303886849.cos.ap-guangzhou.myqcloud.com/typora/image-20221010110213694.png\" alt=\"image-20221010110213694\"></p>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"clg1mfus2000927qg1hp3amhu","category_id":"clg1mfury000427qg0uvu344d","_id":"clg1mfus8000g27qgayg2bacl"},{"post_id":"clg1mfurt000127qg0lu193c6","category_id":"clg1mfury000427qg0uvu344d","_id":"clg1mfus9000l27qgd1q0d1js"},{"post_id":"clg1mfurw000327qgg4lngu3x","category_id":"clg1mfury000427qg0uvu344d","_id":"clg1mfusd000o27qgavtwhfwq"},{"post_id":"clg1mfus7000f27qgg76y684f","category_id":"clg1mfury000427qg0uvu344d","_id":"clg1mfusf000s27qgdpfe5x45"},{"post_id":"clg1mfus0000727qg3quyhn8n","category_id":"clg1mfus8000h27qghsf260rh","_id":"clg1mfusg000u27qg7e697va1"},{"post_id":"clg1mfuse000r27qgethf2um0","category_id":"clg1mfuse000p27qgbd5p63mr","_id":"clg1mfush000y27qg1mqk6zu6"},{"post_id":"clg1mfus3000a27qgh7m23k8q","category_id":"clg1mfuse000p27qgbd5p63mr","_id":"clg1mfush001027qgdh9wdfuo"},{"post_id":"clg1mfus6000e27qgf06pf9kx","category_id":"clg1mfuse000p27qgbd5p63mr","_id":"clg1mfusi001427qg8zycdso3"},{"post_id":"clg1mfus9000k27qg7agw72xm","category_id":"clg1mfuse000p27qgbd5p63mr","_id":"clg1mfusj001727qgcigk4z43"},{"post_id":"clg1mfusa000n27qg8x4t5hsz","category_id":"clg1mfuse000p27qgbd5p63mr","_id":"clg1mfusj001a27qg71523oll"}],"PostTag":[{"post_id":"clg1mfurt000127qg0lu193c6","tag_id":"clg1mfurz000527qgehbkeljr","_id":"clg1mfus6000d27qgc41t9s5p"},{"post_id":"clg1mfus6000e27qgf06pf9kx","tag_id":"clg1mfurz000527qgehbkeljr","_id":"clg1mfus8000j27qgciqbe4b2"},{"post_id":"clg1mfurw000327qgg4lngu3x","tag_id":"clg1mfus4000c27qghy8e8e0p","_id":"clg1mfus9000m27qg1dcahrox"},{"post_id":"clg1mfus0000727qg3quyhn8n","tag_id":"clg1mfus8000i27qg68260pyd","_id":"clg1mfusf000t27qg74koafuc"},{"post_id":"clg1mfus2000927qg1hp3amhu","tag_id":"clg1mfuse000q27qg0h9613kp","_id":"clg1mfush000x27qg9imc8c09"},{"post_id":"clg1mfus3000a27qgh7m23k8q","tag_id":"clg1mfusg000w27qg3m5a1jwz","_id":"clg1mfusi001227qg95uuc2s1"},{"post_id":"clg1mfus7000f27qgg76y684f","tag_id":"clg1mfusi001127qgfplzgr5f","_id":"clg1mfusj001627qg7qj28sjk"},{"post_id":"clg1mfus9000k27qg7agw72xm","tag_id":"clg1mfusj001527qg4st64cma","_id":"clg1mfusj001927qgbqpa2hdc"},{"post_id":"clg1mfusa000n27qg8x4t5hsz","tag_id":"clg1mfusj001827qg2ft28t1m","_id":"clg1mfusk001c27qgg0t6fi3i"},{"post_id":"clg1mfuse000r27qgethf2um0","tag_id":"clg1mfusg000w27qg3m5a1jwz","_id":"clg1mfusk001d27qgd6qt3x9p"}],"Tag":[{"name":"docker","_id":"clg1mfurz000527qgehbkeljr"},{"name":"Harbor","_id":"clg1mfus4000c27qghy8e8e0p"},{"name":"linux","_id":"clg1mfus8000i27qg68260pyd"},{"name":"Pritunl","_id":"clg1mfuse000q27qg0h9613kp"},{"name":"mysql","_id":"clg1mfusg000w27qg3m5a1jwz"},{"name":"jenkins","_id":"clg1mfusi001127qgfplzgr5f"},{"name":"vue","_id":"clg1mfusj001527qg4st64cma"},{"name":"爬虫","_id":"clg1mfusj001827qg2ft28t1m"}]}}